// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DataAggregation/js/UI/templates/StartPage.html":'\x3cdiv class\x3d"pad-left-10"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"task-instruction-row" \x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.locationMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-row" data-dojo-attach-event\x3d"onClick:_locationMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"locationMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-top-10 task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction pad-top-10"\x3e${nls.mapping.schemaMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-row" data-dojo-attach-event\x3d"onClick:_schemaMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"fieldMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right display-none" data-dojo-attach-point\x3d"addToMapButton" data-dojo-attach-event\x3d"onClick:_addToMapClick"\x3e${nls.buttons.addToMap}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/StartPage.html dojo/dom-class dojo/query ./Review".split(" "),function(m,d,k,g,l,n,p,q,r,t,e,u,v){return m([n,p,q,r],{baseClass:"cf-startpage",declaredClass:"CriticalFacilities.StartPage",templateString:t,_started:null,label:"StartPage",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",isDarkTheme:"",
styleColor:"",state:"mapping",csvStore:null,_syncFields:{},singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._darkThemes=["DartTheme","DashboardTheme"];this.updateImageNodes()},startup:function(){this._started=!0;this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},onShown:function(){this._initDependencies();this._validateStatus();this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?
!1:!0},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){var a=-1<this._darkThemes.indexOf(this.theme),b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",a=u("."+b,this.domNode);k.forEach(a,function(a){e.remove(a,b);e.add(a,c)})},updateTheme:function(a){this.theme=a;this.updateImageNodes()},validate:function(a,b){var c=new l;"next-view"===a?c.resolve(this._nextView(b)):"back-view"===a?c.resolve(this._backView()):"home-view"===a&&this._homeView(b).then(function(a){c.resolve(a)});
return c},_nextView:function(a){a.navView.label===this.label&&this.pageContainer.toggleController(!1);if(this.parent._locationMappingComplete&&this.parent._fieldMappingComplete)return this.nextDisabled=!0,!1;this.pageContainer.backDisabled=!1;return!0},_backView:function(){return 0<this.pageContainer._backLabels.length},_homeView:function(a){var b=new l;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_locationMappingClick:function(){this._validateStatus();
this._setViewByTitle(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)?"LocationType":this.xyEnabled?"Coordinates":"Addresses")},_schemaMappingClick:function(){this._validateStatus();this._setViewByTitle("FieldMapping")},_setViewByTitle:function(a){a=this.pageContainer.getViewByTitle(a);this.pageContainer.selectView(a.index)},_initDependencies:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView&&!this._fieldMappingView){this.xyEnabled&&(this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates"),
this.own(g(this._coordinatesView,"location-mapping-update",d.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()}))));if(this.singleEnabled||this.multiEnabled)this._addressView=this.pageContainer.getViewByTitle("Addresses"),this.own(g(this._addressView,"location-mapping-update",d.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()})));this._fieldMappingView=this.pageContainer.getViewByTitle("FieldMapping");this.own(g(this._fieldMappingView,
"field-mapping-update",d.hitch(this,function(a){this.parent._fieldMappingComplete=a;this._validateStatus()})));(this._locationTypeView=this.xyEnabled&&(this.singleEnabled||this.multiEnabled)?this.pageContainer.getViewByTitle("LocationType"):this.xyEnabled?this._coordinatesView:this._addressView)&&!this.parent._locationMappingComplete&&(this.altNextIndex=this._locationTypeView.index)}},_validateStatus:function(){this._updateNode(this.locationMappingComplete,this.parent._locationMappingComplete);this._updateNode(this.fieldMappingComplete,
this.parent._fieldMappingComplete);var a=this.pageContainer.backDisabled=!1;this.parent._locationMappingComplete&&this.parent._fieldMappingComplete&&"mapping"===this.state?(a=!0,this.pageContainer.nextDisabled=!0):!this.parent._locationMappingComplete&&this._locationTypeView?this.altNextIndex=this._locationTypeView.index:!this.parent._fieldMappingComplete&&this._fieldMappingView&&(this.altNextIndex=this._fieldMappingView.index);a||(this.pageContainer.nextDisabled=!1);this._updateNode(this.addToMapButton,
a)},_updateNode:function(a,b){b?e.contains(a,"display-none")&&e.remove(a,"display-none"):e.contains(a,"display-none")||e.add(a,"display-none")},_addToMapClick:function(){this._updateNode(this.addToMapButton,!1);this._updateNode(this.progressNode,!0);var a=this._fieldMappingView._getResults(),b=this._locationTypeView._getResults();this._syncFields=this._checkFields(a.results,b);this._locateFeatures(a,b)},_checkFields:function(a,b){var c={};b&&b.fields&&k.forEach(b.fields,function(b){var h=b.value?
b.value:b.sourceField;b=b.keyField?b.keyField:b.sourceField;if("undefined"!==typeof h&&"undefined"!==typeof b&&!c.hasOwnProperty(h)&&a)for(var f=Object.keys(a),d=0;d<f.length;d++)if(a[f[d]]===h){c[b]={layerFieldName:f[d]};break}});return c},_locateFeatures:function(a,b){this.csvStore.useMultiFields="multi"===b.type?!0:!1;this.csvStore.mappedArrayFields=a.results;this.csvStore.labelField=a.labelField;if("single"===b.type)this.csvStore.addrFieldName=b.fields[0].keyField,this.csvStore.singleFields=b.fields;
else if("multi"===b.type)this.csvStore.multiFields=b.fields;else if("xy"===b.type){this.csvStore.useAddr=!1;var c=b.fields[0];b=b.fields[1];this.csvStore.xFieldName="X"===c.targetField?c.sourceField:b.sourceField;this.csvStore.yFieldName="Y"===b.targetField?b.sourceField:c.sourceField}this.csvStore.processForm().then(d.hitch(this,function(b){this._addResultView({matchedFeatures:this._formatFeatures(b.matchedLayer,a.labelField),matchedLayer:b.matchedLayer,unMatchedFeatures:this._formatFeatures(b.unMatchedLayer,
a.labelField),unMatchedLayer:b.unMatchedLayer,duplicateFeatures:this._formatFeatures(b.duplicateLayer,a.labelField,b.duplicateLookupList),duplicateLayer:b.duplicateLayer});this.state="review";this._reviewView=this.pageContainer.getViewByTitle("Review");this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!0;this.pageContainer._backLabels=[];this.pageContainer.altHomeIndex=this._reviewView.index;this._updateNode(this.progressNode,!1);this.pageContainer.selectView(this._reviewView.index,
!0);this.pageContainer._backLabels=[]}),d.hitch(this,function(a){console.log(a);this._updateNode(this.progressNode,!1)}))},_formatFeatures:function(a,b,c){var h=[];if(a){var e=a.objectIdField;this._currentFields=a.fields;k.forEach(a.graphics,d.hitch(this,function(a){var g=[],f;c&&(f=c[a.attributes[e]]);k.forEach(Object.keys(a.attributes),d.hitch(this,function(b){var c=this._currentFields.filter(function(a){return a.name===b}),c={name:b,label:c&&c.hasOwnProperty("length")&&1===c.length&&c[0].alias?
c[0].alias:b,value:a.attributes[b]};f&&(c.duplicateFieldInfo={value:f[b]});g.push(c)}));h.push({label:a.attributes[b],fieldInfo:g,geometry:a.geometry,address:"this will need to pass through but will support locate function"})}))}return h},_addResultView:function(a){var b=new v({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,matchedList:a.matchedFeatures,unMatchedList:a.unMatchedFeatures,duplicateList:a.duplicateFeatures,theme:this.theme,isDarkTheme:this.isDarkTheme,
csvStore:this.csvStore,editLayer:this.parent.editLayer,matchedLayer:a.matchedLayer,unMatchedLayer:a.unMatchedLayer,duplicateLayer:a.duplicateLayer,duplicateLookupList:a.duplicateLookupList,_syncFields:this._syncFields});this.pageContainer.addView(b);this._zoomToAllFeatures([a.matchedLayer,a.unMatchedLayer,a.duplicateLayer])},_zoomToAllFeatures:function(a){var b=[];k.forEach(a,function(a){if(a&&a.graphics)for(var c=0;c<a.graphics.length;c++)b.push(a.graphics[c])});this.csvStore._zoomToData(b)}})});