// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DataAggregation/js/UI/templates/Review.html":'\x3cdiv class\x3d"pad-left-10" style\x3d"height: 100%"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"matchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"pad-bottom-10 bottom-border task-row" data-dojo-attach-point\x3d"matchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"matchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"unMatchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"unMatchedHintTd"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"pad-bottom-10 bottom-border task-row" data-dojo-attach-point\x3d"unMatchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewUnMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"unMatchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"duplicateHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"duplicateHintTd"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"pad-bottom-10 bottom-border task-row" data-dojo-attach-point\x3d"duplicateControlRow" data-dojo-attach-event\x3d"onclick:_reviewDuplicate"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"duplicateCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right" data-dojo-attach-point\x3d"submitButton" data-dojo-attach-event\x3d"onclick:_submit"\x3e${nls.buttons.submit}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right margin-right-15" data-dojo-attach-point\x3d"downloadButton" data-dojo-attach-event\x3d"onclick:_download"\x3e${nls.buttons.download}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/Review.html dojo/query dojo/on ./FeatureList jimu/dijit/Message jimu/CSVUtils esri/toolbars/edit esri/lang".split(" "),function(n,g,h,e,p,q,r,t,l,u,v,k,w,m,x,y,z){return n([p,q,r,t],{baseClass:"cf-review",declaredClass:"CriticalFacilities.Review",templateString:u,_started:null,label:"Review",parent:null,nls:null,
map:null,appConfig:null,config:null,matchedList:[],unMatchedList:[],duplicateList:[],theme:"",isDarkTheme:"",styleColor:"",csvStore:null,editLayer:null,matchedLayer:null,unMatchedLayer:null,duplicateLayer:null,_editToolbar:null,_syncFields:{},_currentIndex:0,constructor:function(a){g.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._initReviewRows();this._darkThemes=["DartTheme","DashboardTheme"];this.updateImageNodes();this._editToolbar=new y(this.map)},startup:function(){this._started=
!0;this._initNavPages();this._updateIndexesList();this.altNextIndex=this.altNextIndexes[this._currentIndex];this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0;this.own(k(this.pageContainer,"nav-view",g.hitch(this,this._navView)))},onShown:function(){this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},_navView:function(a){a===this.index&&(this._updateIndexesList(),this._currentIndex<this.altNextIndexes.length?(this.altNextIndex=this.altNextIndexes[this._currentIndex],
this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0):(this._currentIndex=0,this.altNextIndex=this.altNextIndexes[this._currentIndex]))},validate:function(a,b){var c=new l;"next-view"===a?c.resolve(this._nextView()):"back-view"===a?c.resolve(this._backView(b)):this._homeView(b).then(function(a){c.resolve(a)});return c},_nextView:function(){return!0},_backView:function(a){return 0<this.pageContainer._backLabels.length?!0:a.navView>this.index},_homeView:function(a){var b=
new l;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_updateIndexesList:function(){this.altNextIndexes=[];0<this.matchedList.length&&this.altNextIndexes.push(this._matchedListView.index);0<this.unMatchedList.length&&this.altNextIndexes.push(this._unMatchedListView.index);0<this.duplicateList.length&&this.altNextIndexes.push(this._duplicateListView.index)},_initNavPages:function(){this.pageContainer&&(this._addMatchedFeaturesList(),0<this.unMatchedList.length&&
this._addUnmatchedFeatureList(),0<this.duplicateList.length&&this._addDuplicateFeatureList());this.pageContainer.selectView(this.index,!0)},_addMatchedFeaturesList:function(){this.matchedFeatureList=this._initFeatureList(this.matchedList,this.matchedLayer,"MatchedFeatures",this.nls.review.reviewMatched,!1);this.pageContainer.addView(this.matchedFeatureList);this._updateNode(this.submitButton,0<this.matchedList.length);this._matchedListView=this.pageContainer.getViewByTitle(this.matchedFeatureList.label);
this.own(k(this.matchedFeatureList,"feature-list-updated",g.hitch(this,function(a){this.matchedCount.innerHTML=a;this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount);this._updateNode(this.submitButton,0<this.matchedList.length)})))},_addUnmatchedFeatureList:function(){this.unMatchedFeatureList=this._initFeatureList(this.unMatchedList,this.unMatchedLayer,"UnMatchedFeatures",this.nls.review.reviewUnMatched,!1);this.pageContainer.addView(this.unMatchedFeatureList);
this._unMatchedListView=this.pageContainer.getViewByTitle(this.unMatchedFeatureList.label);this.own(k(this.unMatchedFeatureList,"feature-list-updated",g.hitch(this,function(a){this.unMatchedCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._unMatchedListView)})));0<this.matchedList.length&&e.add(this.unMatchedHintTd,"pad-top-10")},_addDuplicateFeatureList:function(){this.duplicateFeatureList=this._initFeatureList(this.duplicateList,this.duplicateLayer,"DuplicateFeatures",this.nls.review.reviewDuplicate,
!0);this.pageContainer.addView(this.duplicateFeatureList);this._duplicateListView=this.pageContainer.getViewByTitle(this.duplicateFeatureList.label);this.own(k(this.duplicateFeatureList,"feature-list-updated",g.hitch(this,function(a){this.duplicateCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._duplicateListView)})));(0<this.matchedList.length||0<this.unMatchedList.length)&&e.add(this.duplicateHintTd,"pad-top-10")},_initFeatureList:function(a,b,c,f,d){return new w({nls:this.nls,map:this.map,
parent:this.parent,config:this.config,appConfig:this.appConfig,hint:f,label:c,features:a,theme:this.theme,isDuplicate:d,isDarkTheme:this.isDarkTheme,layer:b,_editToolbar:this._editToolbar,csvStore:this.csvStore,_syncFields:this._syncFields})},_initReviewRows:function(){this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount);this._initReviewRow(this.unMatchedList,[this.unMatchedHintRow,this.unMatchedControlRow],this.unMatchedCount);this._initReviewRow(this.duplicateList,
[this.duplicateHintRow,this.duplicateControlRow],this.duplicateCount)},_initReviewRow:function(a,b,c){0<a.length?(h.forEach(b,function(a){e.contains(a,"display-none")&&e.remove(a,"display-none")}),c.innerHTML=a.length):h.forEach(b,function(a){e.contains(a,"display-none")||e.add(a,"display-none")})},_updateReviewRows:function(a){this._initReviewRows();(a="unmatched"===a&&this.unMatchedFeatureList?this.unMatchedFeatureList:"duplicate"===a&&this.duplicateFeatureList?this.duplicateFeatureList:void 0)&&
a.features&&0===a.features.length&&this.pageContainer.selectView(this.index,!0)},updateImageNodes:function(){var a=-1<this._darkThemes.indexOf(this.theme),b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",a=v("."+b,this.domNode);h.forEach(a,function(a){e.remove(a,b);e.add(a,c)})},_download:function(){var a;0<this.matchedList.length&&(a=this.csvStore.matchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.matchedFeatureLayer,a));0<this.unMatchedList.length&&
(a=this.csvStore.unMatchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.unMatchedFeatureLayer,a));0<this.duplicateList.length&&(a=this.csvStore.duplicateFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.duplicateFeatureLayer,a))},_export:function(a,b){var c=[];h.forEach(a.graphics,function(a){c.push(a.attributes)});var f={};f.datas=c;f.fromClient=!1;f.withGeometry=!1;f.outFields=a.fields;f.formatDate=!0;f.formatCodedValue=!0;f.formatNumber=!1;x.exportCSVFromFeatureLayer(b,
a,f)},_submit:function(){this._updateNode(this.submitButton,!1);this._updateNode(this.progressNode,!0);var a=this._getFeatures(this.csvStore.matchedFeatureLayer),b=this._getFeatures(this.csvStore.duplicateFeatureLayer);this.editLayer.applyEdits(a,b,null,g.hitch(this,function(a,b){this._validateResults(a);this._validateResults(b);this._updateNode(this.progressNode,!1);this._navigateHome();this.csvStore._zoomToData(this.editLayer.graphics,!0)}),g.hitch(this,function(){new m({type:"Error",message:this.nls.warningsAndErrors.saveError})}))},
_validateResults:function(a){var b=[],c=[];a&&a.hasOwnProperty("length")&&0<a.length&&(h.forEach(a,function(a){"undefined"!==typeof a.success&&(a.success?b.push(a):c.push(a))}),0<c.length&&(a=0===b.length?this.nls.review.noFeaturesSaved:z.substitute({num:c.length},this.nls.review.someFeaturesNotSaved),new m({message:a})))},_getFeatures:function(a){var b=[],c=this.csvStore.objectIdField;a&&a.graphics&&h.forEach(a.graphics,g.hitch(this,function(a){a.hasOwnProperty("_graphicsLayer")&&delete a._graphicsLayer;
a.hasOwnProperty("_layer")&&delete a._layer;var d=a.attributes;d.hasOwnProperty("hasDuplicateUpdates")&&d.hasOwnProperty("duplicateState")?d.hasDuplicateUpdates&&"make-change"===d.duplicateState&&(d.hasOwnProperty("DestinationOID")&&(d[this.editLayer.objectIdField]=d.DestinationOID),this._deleteProp(d,"hasDuplicateUpdates"),this._deleteProp(d,"duplicateState"),b.push(a)):b.push(a);this._deleteProp(d,"matchScore");this._deleteProp(d,c);this._deleteProp(d,"DestinationOID")}));return 0<b.length?b:null},
_deleteProp:function(a,b){a.hasOwnProperty(b)&&delete a[b]},_navigateHome:function(){var a=this.pageContainer.getViewByTitle("Home");a._clearStore();a._clearMapping();this.pageContainer.toggleController(!0);this.pageContainer.selectView(a.index)},_updateNode:function(a,b){b?e.contains(a,"display-none")&&e.remove(a,"display-none"):e.contains(a,"display-none")||e.add(a,"display-none")},setStyleColor:function(a){this.styleColor=a},updateTheme:function(a){this.theme=a},_reviewMatched:function(){this.pageContainer.selectView(this._matchedListView.index)},
_reviewUnMatched:function(){this.pageContainer.selectView(this._unMatchedListView.index)},_reviewDuplicate:function(){this.pageContainer.selectView(this._duplicateListView.index)}})});