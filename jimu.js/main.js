// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){function u(a,c){var b=f.clone(a),h=l.widgetProperties;"undefined"===typeof c&&(c=!1);delete b.mode;delete b.configWabVersion;l.visitElement(b,
function(a,e){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,e.isOnScreen&&a.panel&&l.isEqual(a.panel,b.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,delete a.isRemote,delete a.featureActions,h.forEach(function(b){delete a[b]}),
c?"undefined"===typeof a.openAtStart&&(a.openAtStart=!1):(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest,a.itemId&&delete a.uri)});delete b.rawAppConfig;delete b._ssl;delete b.getConfigElementById;delete b.getConfigElementsByName;delete b.processNoUriWidgets;delete b.addElementId;delete b.getCleanConfig;delete b.visitElement;delete b.agolConfig;delete b._itemData;delete b.oldWabVersion;
delete b.titleColor;return b}var v=null,C;C=q(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new m;this.widgetManager=g.getInstance();this.configLoader=e.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(d);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(d);l.isMobileUa()||p(window,"resize",f.hitch(this,this._onWindowResize));p(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));d.subscribe("builder/layoutDefinitionChanged",
f.hitch(this,this._onLayoutDefinitionChanged));d.subscribe("builder/onScreenGroupsChanged",f.hitch(this,this._onOnScreenGroupsChanged));d.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/onScreenOrderChanged",f.hitch(this,this._onScreenOrderChanged));d.subscribe("builder/mapContentModified",f.hitch(this,this._onMapContentModified));d.subscribe("builder/mapChanged",f.hitch(this,
this._onMapChanged));d.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/mapRefreshIntervalChanged",f.hitch(this,this._onMapRefreshIntervalChanged));d.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));d.subscribe("builder/dataSourceChanged",f.hitch(this,this._onDataSourceChanged));d.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));
d.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));d.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));d.subscribe("builder/appProxyForUrlChanged",
f.hitch(this,this._onAppProxyForUrlChanged));d.subscribe("builder/sharedThemeChanged",f.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var b=new a;b.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(a){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(a);console.timeEnd("Load Config");window.appInfo.isRunInMobile=l.inMobileSize();a=
this.getAppConfig();b.destroy();d.publish("appConfigLoaded",a);return a}),f.hitch(this,function(a){b.destroy();console.error(a);a&&a.message&&"string"===typeof a.message&&this._showErrorMessage(a.message)}))}},_showErrorMessage:function(a){k.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(a)},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=f.clone(this._getMobileConfig(this.appConfig)),a._originConfig=f.clone(this.appConfig)):a=f.clone(this.appConfig);a.getConfigElementById=
function(a){return l.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return l.getConfigElementsByName(this,a)};a.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,a):u(this,a)};a.visitElement=function(a){l.visitElement(this,a)};return a},_onOrientationChange:function(){this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var a=l.inMobileSize();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=
a,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(a){return l.mixinAppConfigPosition(a,a.mobileLayout)},_updateDataSourceForWidget:function(a){this._deleteDataSourcesFromWidget(a);this._addDataSourcesForWidget(a)},_deleteDataSourcesFromWidget:function(a){for(var b in this.appConfig.dataSource.dataSources)b.startWith("widget~"+a.id+"~")&&delete this.appConfig.dataSource.dataSources[b]},_addDataSourcesForWidget:function(a){n.forEach(a.provideDataSources,
function(b){var c="widget~"+a.id+"~"+b.id;b.id=c;this.appConfig.dataSource.dataSources[c]=b},this);delete a.provideDataSources},_addIdForWidgets:function(a){var b=0,c;this.getAppConfig().visitElement(function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var h=a.id.lastIndexOf("_");-1<h&&(c=a.id.substr(h+1),b=Math.max(b,c))}});n.forEach(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_onWidgetChanged:function(a){var b=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,
a.id);this._updateDataSourceForWidget(b);!1!==b.inPanel||a.uri||(b.closeable=!0);for(var c in b)a[c]=b[c];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",b)},_onGroupChanged:function(a){var b=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,a.id);this._handleDataSourceForWidgets(a,b);for(var c in b)a[c]=b[c];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
d.publish("appConfigChanged",this.getAppConfig(),"groupChange",b)},_handleDataSourceForWidgets:function(a,b){var c=n.filter(b.widgets,function(b){return b.id?0===n.filter(a.widgets,function(a){return b.id===a.id}).length:!0},this);this._addIdForWidgets(c);n.forEach(c,function(a){this._addDataSourcesForWidget(a)},this);c=n.filter(a.widgets,function(a){return 0===n.filter(b.widgets,function(b){return b.id===a.id}).length},this);n.forEach(c,function(a){this._deleteDataSourcesFromWidget(a)},this);n.forEach(b.widgets,
function(b){n.forEach(a.widgets,function(a){b.id===a.id&&b.provideDataSources&&this._updateDataSourceForWidget(b)},this)},this)},_onWidgetPoolChanged:function(a){var b=l.reCreateObject(a);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups):(a=l.getConfigElementById(this.appConfig,b.controllerId),n.forEach(a.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this),n.forEach(a.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups),a.controlledWidgets=n.map(b.widgets,function(a){return a.id}),a.controlledGroups=n.map(b.groups,
function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)}))},_handleDataSourceForWidgetsSection:function(a,b){var c=b.widgets;n.forEach(b.groups,function(a){c=c.concat(a.widgets)},this);var h=a.widgets;n.forEach(a.groups,function(a){h=h.concat(a.widgets)},this);
this._handleDataSourceForWidgets({widgets:h},{widgets:c})},_removeWidgetOrGroupFromPoolById:function(a,b){n.some(a.widgetPool.widgets,function(c,h){if(c.id===b)return a.widgetPool.widgets.splice(h,1),!0});n.some(a.widgetPool.groups,function(c,h){if(c.id===b)return a.widgetPool.groups.splice(h,1),!0})},_onOpenAtStartChanged:function(a){var b=l.reCreateObject(a),c=this.appConfig;a.isOnScreen?(c=c.widgetOnScreen&&c.widgetOnScreen.widgets)&&0<c.length&&n.forEach(c,f.hitch(this,function(b){b.id===a.id?
b.openAtStart=!b.openAtStart:delete b.openAtStart})):((c=c.widgetPool)&&c.groups&&0<c.groups.length&&n.forEach(c.groups,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})),c&&c.widgets&&0<c.widgets.length&&n.forEach(c.widgets,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})));d.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",b)},_onScreenOrderChanged:function(a){var b=l.reCreateObject(a);n.forEach(this.appConfig.widgetOnScreen.widgets,
function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||n.some(b,function(b){if(a.id===b.id)return a.position=b.position,!0})},this);d.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",b)},_onAppAttributeChanged:function(a){a=l.reCreateObject(a);f.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),
"attributeChange",a)},_onDataSourceChanged:function(a){var b=l.reCreateObject(a);this.appConfig.dataSource=b;d.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",a)},_onLoadingPageChanged:function(a){a=l.reCreateObject(a);var b;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(b=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=f.mixin(b,a.backgroundImage)):"loadingGif"in a&&(b=this.appConfig.loadingPage.loadingGif||
{},this.appConfig.loadingPage.loadingGif=f.mixin(b,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onAppProxyForMapChanged:function(a){a=l.reCreateObject(a);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==a.mapItemId?this.appConfig.map.appProxy=a:n.forEach(a.proxyItems,f.hitch(this,function(a){if(!n.some(this.appConfig.map.appProxy.proxyItems,function(b){if(b.sourceUrl===
a.sourceUrl)return b.useProxy=a.useProxy,b.proxyUrl=a.proxyUrl||"",b.proxyId=a.proxyId||"",isNaN(a.hitsPerInterval)||(b.hitsPerInterval=a.hitsPerInterval),isNaN(a.intervalSeconds)||(b.intervalSeconds=a.intervalSeconds),!0})&&a.useProxy&&a.proxyUrl){var b=this.appConfig.map.appProxy.proxyItems||[];b.push(a);this.appConfig.map.appProxy.proxyItems=b}})):this.appConfig.map.appProxy=a;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onAppProxyForUrlChanged:function(a){a=l.reCreateObject(a);
this.appConfig.appProxies=a;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onTemplateConfigChanged:function(a){a=l.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapContentModified:function(){d.publish("mapContentModified")},_onMapChanged:function(a){var b=l.reCreateObject(a);this.appConfig.map.mapOptions&&
l.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};f.mixin(this.appConfig.map,b);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)}))},_deleteDataSourcesFromMap:function(){n.forEach(Object.keys(this.appConfig.dataSource.dataSources),
function(a){a.startWith("map")&&delete this.appConfig.dataSource.dataSources[a]},this)},_onMapOptionsChanged:function(a){a=l.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,a);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onMapRefreshIntervalChanged:function(a){a=l.reCreateObject(a);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});f.mixin(this.appConfig.map.mapRefreshInterval,
a);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;d.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(f.hitch(this,function(b){var c=f.clone(this.appConfig.widgetOnScreen);this.appConfig=b;this._handleDataSourceForWidgetsSection(c,{});d.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=
l.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,
delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});d.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onOnScreenGroupsChanged:function(a){a=l.reCreateObject(a);this.appConfig.widgetOnScreen.groups=a.groups;d.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",a.groups)},_onLayoutDefinitionChanged:function(a){a=l.reCreateObject(a);l.isEqual(this.appConfig.layoutDefinition,
a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),d.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSharedThemeChanged:function(a){var b=this.appConfig.theme.sharedTheme;a=l.reCreateObject(a);a.useHeader&&!b.useHeader&&
(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&b.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
a.useLogo&&!b.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&b.useLogo&&
this._onAppAttributeChanged({logo:this.appConfig.logo});f.mixin(b,a);d.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){d.publish("syncExtent",a)},_genStyles:function(a,b){var c=[];c.push(b);n.forEach(a,function(a){0>c.indexOf(a)&&c.push(a)});return c},_getAppConfigFromTheme:function(a){var b=new r,c,h=[],e=this.getAppConfig().getCleanConfig();e.mode=this.urlParams.mode;n.forEach(e.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)c=
f.clone(a.appConfig),c.map=e.map,c.map.position=a.appConfig.map.position,this._copyPoolToThemePool(e,c),c.links=e.links,c.title=e.title,c.subtitle=e.subtitle,c.logo=e.logo;else{var g=a.getCurrentLayout(),h=a.getCurrentStyle();c=f.clone(e);g=f.clone(g.layoutConfig);c.widgetOnScreen=g.widgetOnScreen;g.widgetPool&&(n.forEach(g.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),n.forEach(g.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(e,g);c.widgetPool=
g.widgetPool;g.map&&g.map.position&&(c.map.position=g.map.position);c.mobileLayout=g.mobileLayout;c.layoutDefinition=g.layoutDefinition;h=this._genStyles(n.map(a.getStyles(),function(a){return a.name}),h.name);c.theme={name:a.getName(),styles:h,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(c.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},c.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(c.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},c.theme.customStyles={mainBackgroundColor:""});c.titleColor=e.titleColor;c.logoLink=e.logoLink}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(f.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._addDefaultValues(c);b.resolve(c)}));return b},_copyPoolToThemePool:function(a,b){var c=a.widgetPool;b.widgetPool||(b.widgetPool={});a=b.widgetPool;
var h=n.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!n.some(c.widgets,function(b){return b.name===a.name}))return!0}),e=n.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),g=n.filter(c.widgets,function(a){return!a.isPreconfiguredInTheme}),t=n.filter(c.groups,function(a){return!a.isPreconfiguredInTheme}),g=this._getPoolWidgetsWithoutDuplicated(g,b.widgetOnScreen.widgets||[]);a.widgets=g.concat(h);a.groups=t.concat(e)},_getPoolWidgetsWithoutDuplicated:function(a,b){for(var c=
f.clone(a),h=this.getAppConfig(),e=a.length-1;0<=e;e--)for(var g=b.length-1;0<=g;g--)if(b[g].uri){var t=b[g].name;t||(t=l.getWidgetNameFromUri(b[g].uri));var m=h.getConfigElementById(a[e].id);a[e]&&a[e].name===t&&!1===m.supportMultiInstance&&(console.log("Widget",a[e].name,"is not copied to new theme because this widget exists in new theme."),c.splice(e,1))}return c},_onAppConfigSet:function(a){a=l.reCreateObject(a);window.appInfo.isRunInMobile=l.inMobileSize();this.configLoader.processProxy(a);this.configLoader.addNeedValues(a);
this.configLoader.loadAndUpgradeAllWidgetsConfig(a).then(f.hitch(this,function(a){this._addDefaultValues(a);c.setPortalUrl(a.portalUrl);window.portalUrl=a.portalUrl;this.appConfig?(l.deleteMapOptions(a.map.mapOptions),this.appConfig=a,this._deleteDataSourcesFromMap(),d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",a)):(this.appConfig=a,h.getPortal(a.portalUrl).loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;d.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);
this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultDataSource(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===
a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultDataSource:function(a){a.dataSource?(a.dataSource.dataSources||(a.dataSource.dataSources={}),a.dataSource.settings||(a.dataSource.settings={})):a.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var c=
a&&a.geometryService,c=c&&"string"===typeof c&&f.trim(c)?f.trim(c):this.portalSelf.helperServices.geometry.url;a.geometryService=c;b.defaults.geometryService=new t(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){l.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);
this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,c;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||
(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0!==a.widgets[b].inPanel||a.widgets[b].panel||(a.widgets[b].panel=f.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++)for(a.groups[b].panel||(a.groups[b].panel=a.panel),a.groups[b].panel&&!a.groups[b].panel.position&&
(a.groups[b].panel.position={}),a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map"),a.groups[b].widgets||(a.groups[b].widgets=[]),c=0;c<a.groups[b].widgets.length;c++)a.groups[b].widgets[c].panel=a.groups[b].panel}},_addPoolDefaultPanelAndPosition:function(a){var b,c,h=a.widgetPool;if(h){b=h.panel&&h.panel.positionRelativeTo?h.panel.positionRelativeTo:"map";"undefined"===typeof h.panel||"undefined"===
typeof h.panel.uri?h.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof h.panel.position?h.panel.position={relativeTo:b}:"undefined"===typeof h.panel.position.relativeTo&&(h.panel.position.relativeTo=b);if(h.groups)for(b=0;b<h.groups.length;b++)for(h.groups[b].panel?h.groups[b].panel.position.relativeTo||(h.groups[b].panel.position.relativeTo=h.groups[b].panel.positionRelativeTo?h.groups[b].panel.positionRelativeTo:"map"):h.groups[b].panel=h.panel,h.groups[b].widgets||
(h.groups[b].widgets=[]),c=0;c<h.groups[b].widgets.length;c++)h.groups[b].widgets[c].panel=h.groups[b].panel;if(h.widgets)for(b=0;b<h.widgets.length;b++)!1===h.widgets[b].inPanel?(c=h.widgets[b].positionRelativeTo?h.widgets[b].positionRelativeTo:"map",h.widgets[b].position)?h.widgets[b].position.relativeTo||(h.widgets[b].position.relativeTo=c):h.widgets[b].position={relativeTo:c}:h.widgets[b].panel||(h.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){l.visitElement(a,f.hitch(this,
function(a,b){a.isOnScreen=b.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:window.apiNls.common.groupLabel),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:window.apiNls.common.groupLabel+" "+b.index)):a.gid=b.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var b=0,c,h;if(a.widgetPool.widgets)for(c=0;c<a.widgetPool.widgets.length;c++)a.widgetPool.widgets[c].index=b,b++;if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++)for(a.widgetPool.groups[c].index=b,b++,h=0;h<a.widgetPool.groups[c].widgets.length;h++)a.widgetPool.groups[c].widgets[h].index=h}});C.getInstance=function(a){null===v?v=new C(a):a&&(v.urlParams=a,v.configLoader&&(v.configLoader.urlParams=
a));window.getAppConfig=f.hitch(v,v.getAppConfig);return v};return C})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils ./zoomToUtils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E,G,H,L,J,K,O,N,S,Q,M,P,I){function V(a,b){a=a||"";var c=0,h=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!x.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){c++;c===h.length&&b()}}];for(a=0;a<h.length;a++)testLoad(h[a])}function U(a,b){var c=a.match(/url\([^)]+\)/gi),h,e;if(null===c||""===b)return a;for(h=0;h<c.length;h++)if(e=c[h].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),
4<=e.length){var g=e[2];/^data:image\/.*;/.test(g)||(b.endWith("/")||(b+="/"),a=a.replace(e[1]+g+e[3],e[1]+b+g+e[3]))}return a}function R(a,b){var c=Array.isArray(b),h=c&&[]||{};c?(a=a||[],h=h.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?h[c]=b:"object"===typeof b?h[c]=R(a[c],b):-1===a.indexOf(b)&&h.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){h[b]=a[b]}),Object.keys(b).forEach(function(c){h[c]="object"===typeof b[c]&&b[c]?a[c]?R(a[c],b[c]):b[c]:b[c]}));return h}
function ba(a,b){var c=a.map(function(a){return a.id});f.forEach(b,function(b){0>c.indexOf(b)&&a.push({id:b,widgets:[]})},this);var h=[];a=f.filter(a,function(a){return 0>b.indexOf(a.id)?(h.push(a),!1):!0},this);if(0===a.length)return[];var e=a[a.length-1];f.forEach(h,function(a){e.widgets=e.widgets.concat(a.widgets)},this);return a=a.sort(function(a,c){return b.indexOf(a.id)-b.indexOf(c.id)})}function W(a,b,c){function h(a,b){return q.isArray(a[b.key])?a[b.key][b.index]:a[b.key]}b=function(a){var b=
[];a.split("_").forEach(function(a){var c=!1,h;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));h=a.search(/\[[0-9]+\]/);-1===h&&(h=a.length);b.push({key:a.slice(0,h),index:Number(a.slice(h+1,-1)),deleteFlag:c})});return b}(b);for(var e=1;e<b.length-1;e++)if(a=h(a,b[e]),!a)return;if(b[b.length-1].deleteFlag)!0===c&&(q.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(q.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function X(a,b,c){function h(c){c=x.template.getSearchRange(b,c,"]");var h=b.slice(c.firstPos,c.lastPos);return-1!==c.firstPos?(h=b.slice(c.firstPos+h.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(h=x.getConfigElementById(a,h))?{object:h,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var e=a,g=b=b.replace(/\//g,"_"),t=
h("groups\\[.+\\]");if("deleted"!==t.state&&("isSection"===t.state&&(e=t.object,g=t.key),t=h("widgets\\[.+\\]"),"delete"!==t.state))return"isSection"===t.state&&(e=t.object,g=t.key),W(e,g,c)}var x={},Y={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};q.mixin(x,P);q.mixin(x,I);window.atob||(window.atob=function(a){a=u.decode(a);for(var b="",c=0,h=a.length;c<h;c++)b+=String.fromCharCode(a[c]);return b});window.btob||(window.btob=function(a){for(var b=
[],c=0,h=a.length;c<h;c++)b.push(String.charCodeAt(a[c]));return u.encode(b)});var T="unload",ga=[];require.on("error",function(a){f.forEach(ga,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});x.checkError=function(a,b){ga.push({resKey:a,def:b})};x.replacePlaceHolder=function(a,b){var h=c.stringify(a),e=h.match(/\$\{(\w)+\}/g);if(null===e)return a;for(a=0;a<e.length;a++){var g=e[a].match(/(\w)+/g)[0];b[g]&&(h=h.replace(e[a],
b[g]))}return c.parse(h)};x.changeUnit=function(a){var b=Math.abs(a),c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};x.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};x.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};x.preloadImg=function(a,b){var c=[],c="string"===typeof a?[a]:a;f.forEach(c,function(a){(new Image).src=b?b+a:a})};var aa=null;x.getImagesSize=function(a){var b=new g;if(!a||0!==a.indexOf("http"))return b.reject(),b;null===aa&&(aa=n.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var c=e(aa,"load",function(){clearTimeout(h);h=null;c.remove();var a=n.getContentBox(aa);1===a.w&&1===a.h||0===a.w||0===a.h?b.reject():
b.resolve([a.w,a.h])},{}),h=setTimeout(function(){clearTimeout(h);h=null;b.reject()},5E3);n.setAttr(aa,"src",a);return b};x.getPositionStyle=function(a){var b={};if(!a)return b;a=q.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=
a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var h=0;h<c.length;h++){var e=c[h];"number"===typeof a[e]?b[e]=a[e]+"px":"undefined"!==typeof a[e]?b[e]=a[e]:"padding"===e.substr(0,7)?b[e]=0:b[e]="auto"}b.zIndex=
"undefined"===typeof a.zIndex?"auto":a.zIndex;return b};x.isEqual=function(a,b){function c(a,b){var g;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof
RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<h.indexOf(a)||-1<e.indexOf(b))return!1;if(null!==b){for(g in b)if(b.hasOwnProperty(g)!==a.hasOwnProperty(g)||typeof b[g]!==typeof a[g])return!1;for(g in a){if(b.hasOwnProperty(g)!==a.hasOwnProperty(g)||typeof b[g]!==typeof a[g])return!1;switch(typeof a[g]){case "object":case "function":h.push(a);e.push(b);if(!c(a[g],b[g]))return!1;h.pop();e.pop();
break;default:if(isNaN(a[g])&&isNaN(b[g])&&"number"===typeof a[g]&&"number"===typeof b[g])return!0;if(a[g]!==b[g])return!1}}}return!0}var h,e;h=[];e=[];return c(a,b)?!0:!1};x.file={loadFileAPI:function(){var a=new g;if("unload"===T){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};V(b,q.hitch(this,function(){T="loaded";
a.resolve()}));T="loading"}else"loaded"===T&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return k("safari")&&6>k("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(Z){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},
containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-x.file.getNameFromPath(a).length)},readFile:function(a,b,c,h){if(this.supportHTML5()){var e=a.target.files[0];e&&(e.type.match(b)?e.size>=c?h({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){h(null,e.name,a.target.result)},a.readAsDataURL(e)):
h({errCode:"invalidType"}))}else if(this.supportFileAPI()){var g=window.FileAPI.getFiles(a);g[0].type.match(b)?g[0].size>=c?h({errCode:"exceed"}):window.FileAPI.readAsDataURL(g[0],function(a){a&&a.result?h(null,g[0].name,a.result):h({errCode:"readError"})}):h({errCode:"invalidType"})}}};x.getUriInfo=function(a){var b,c={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+1);c.folderUrl=require(x.getRequireConfig()).toUrl(b);c.amdFolder=b;c.url=c.folderUrl;if(/^http(s)?:\/\//.test(a)||
/^\/\//.test(a))c.isRemote=!0;return c};x.widgetJson=function(){var a={addManifest2WidgetJson:function(a,b){q.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b;a.isRemote=b.isRemote;a.isRemote&&(a.itemId=b.itemId);b.featureActions&&(a.featureActions=b.featureActions);a.icon||(a.icon=b.icon);a.thumbnail||(a.thumbnail=b.thumbnail);a.folderUrl=b.folderUrl;a.amdFolder=b.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=
void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(b){return b.url?a.getFolderUrlFromItem(b)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));return a}};return a}();x.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));
jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};x.getTypeByGeometryType=function(a){var b="",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),h=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?
b="polyline":0<=h.indexOf(a)&&(b="polygon");return b};x.getSymbolTypeByGeometryType=function(a){var b=null;a=x.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};x.getServices=function(){return Y};x.getArcGISDefaultGeometryService=function(){return new G(Y.geometryService)};x.restoreToDefaultWebMapExtent=function(a,b,c){var h=new g;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){h.reject("Invalid map.")},0),h;b=b&&b.itemInfo;
if(!b)return setTimeout(function(){h.reject("Invalid itemInfo")},0),h;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){h.reject("Invalid itemInfo.item.extent")}),h;var e=new B({wkid:4326}),e=new y(b[0][0],b[0][1],b[1][0],b[1][1],e);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(e);if(a.spatialReference.isWebMercator())return e=E.geographicToWebMercator(e),a.setExtent(e);b=new H;b.geometries=[e];b.outSR=a.spatialReference;e=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;
e&&"esri.tasks.GeometryService"===e.declaredClass||(c&&"string"===typeof c&&q.trim(c)?(c=q.trim(c),e=new G(c)):e=x.getArcGISDefaultGeometryService());e.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);h.reject("Invalid projected geometry.");return h},function(a){console.error(a);h.reject(a);return h});return h};x.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};x.getAncestorDom=function(a,b,c){if(a&&1===a.nodeType&&b&&"function"===typeof b){var h=
100,e=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(h=c)):1===c.nodeType&&(e=c));for(c=0;a.parentNode&&c<h&&n.isDescendant(a.parentNode,e);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;c++}}return null};x.bindClickAndDblclickEvents=function(a,b,c,h){var g=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&c&&"function"===typeof c){var t=200;h&&"number"===typeof h&&(h=parseInt(h,10),0<h&&(t=h));var m=0,g=e(a,"click",function(a){m++;1===m?setTimeout(function(){1===m&&(m=
0,b(a))},t):2===m&&(m=0,c(a))})}return g};x.isScrollToBottom=function(a){var b=n.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};x.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application",
"Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package",
"Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};x.getItemQueryStringByTypes=function(a){var b="",c=x.getAllItemTypes();if(a&&0<a.length&&0<a.length){var h="";f.forEach(a,function(b,c){h+=' type:"'+b+'" ';c!==a.length-1&&(h+=" OR ")});b=" ( "+h+" ) ";c=a.concat(c);c=f.filter(c,function(b){return f.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});
f.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};x.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};x.isNotEmptyString=function(a,b){var c=a&&"string"===typeof a;return c?b?c&&q.trim(a):!0:!1};x.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};x.isValidDate=function(a){if(a)try{return!isNaN((new Date(a)).getTime())}catch(Z){return console.error(Z),!1}else return!1};x.isObject=function(a){return a&&"object"===
typeof a};x.createWebMap=function(a,b,c,h){a=M.getStandardPortalUrl(a);a=M.getBaseItemUrl(a);C.arcgisUrl=a;return C.createMap(b,c,h)};x.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};x._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return f.map(b,q.hitch(this,function(a,h){a=b.slice(h,c);var e="",g=a.length-1;f.forEach(a,q.hitch(this,function(a,b){e+=a;b!==g&&(e+=".")}));return e}))};x.removeCookie=function(b,c){var h=this._getDomainsByServerName(window.location.hostname);
f.forEach(h,q.hitch(this,function(h){a(b,null,{expires:-1,path:c});a(b,null,{expires:-1,path:c,domain:h});a(b,null,{expires:-1,path:c,domain:"."+h})}))};x.isLocaleChanged=function(a,b){return!a.startWith(b)};x.hashToObject=function(a){a=a.replace("#","");a=r.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=c.parse(a[b])}catch(ea){}return a};x.reCreateObject=function(a){function b(a){var h=[];a.forEach(function(a){Array.isArray(a)?h.push(b(a)):"object"===typeof a?h.push(c(a)):h.push(a)});
return h}function c(a){var h={},e;for(e in a)a.hasOwnProperty(e)&&(null===a[e]?h[e]=null:Array.isArray(a[e])?h[e]=b(a[e]):h[e]="object"===typeof a[e]?c(a[e]):a[e]);return h}return Array.isArray(a)?b(a):c(a)};x.setVerticalCenter=function(a){setTimeout(function(){var b=p(".jimu-vcenter-text",a),c,h;f.forEach(b,function(a){c=n.getContentBox(a).h;n.setStyle(a,{lineHeight:c+"px"})},this);b=p(".jimu-vcenter",a);f.forEach(b,function(a){c=n.getContentBox(a).h;h=n.getContentBox(p(a).parent()[0]).h;n.setStyle(a,
{marginTop:(h-c)/2+"px"})},this)},10)};x.merge=R;x.loadStyleLink=function(a,b,c){var h=new g,t,m=require(x.getRequireConfig()).toUrl(b);if(require.cache["url:"+m]){t=require.cache["url:"+m];var l=m.split("/").pop(),m=m.substr(0,m.length-l.length);t=U(t,m);a=c?n.create("style",{id:a,type:"text/css"},n.byId(c),"before"):n.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=t:a.appendChild(n.toDom(t));h.resolve("load");return h}t=
c?n.create("link",{id:a,rel:"stylesheet",type:"text/css",href:m+"?wab_dv\x3d"+window.deployVersion},n.byId(c),"before"):n.create("link",{id:a,rel:"stylesheet",type:"text/css",href:m+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);e(t,"load",function(){h.resolve("load")});var d=setInterval(function(){var a;if(f.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(b),c.href.length)===b)return a=c,!0}))try{!h.isFulfilled()&&(a.cssRules&&a.cssRules.length||
a.rules&&a.rules.length)&&h.resolve("load"),clearInterval(d)}catch(ja){}},50);return h};x.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",encodeURI(a))};x.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=K.urlToObject(a),b.hash=null):(a=a.split("#"),b=K.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?r.queryToObject(a[1]):a[1]:null);return b};x.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});
a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&
(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],delete b["3D"],"undefined"===typeof b.properties&&(b.properties={}),P.processWidgetProperties(b))},processManifestLabel:function(a,b){var c=b.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[c]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&f.forEach(a.layouts,function(c){var h="i18nLabels_layout_"+c.name;c.label=a[h]&&(a[h][b]||a[h].defaultLabel)||c.label||
c.name});a.styles&&f.forEach(a.styles,function(c){var h="i18nLabels_style_"+c.name;c.label=a[h]&&(a[h][b]||a[h].defaultLabel)||c.label||c.name})},addI18NLabel:function(a){var b=new g;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var c;c=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(x.getRequireConfig(),["dojo/i18n!"+c],function(c){var h={};h[dojoConfig.locale]=c;P.addI18NLabelToManifest(a,null,h);
b.resolve(a)});return b}}}();x.isNumberField=function(a){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)};x.getTime=function(a){var b=a.getTimezoneOffset(),b=0>b?"+"+Math.abs(b)/60:"-"+b/60;return a.getTime()+36E5*b};x.getUniqueValues=function(a,b,c,h,e){return function(){var b=new g,c={};h?(c.layerDefinition=h,e&&(c.fieldPopupInfo=e),b.resolve(c)):b=O({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){c.layerDefinition=
a;return c},function(a){console.log("Error: ",a.message)});return b}().then(function(h){return x._getUniqueValues(a,b,c,h.layerDefinition).then(function(a){var c=h.layerDefinition,e=h.fieldPopupInfo,g=[],g=x.getFieldInfoByFieldName(c.fields,b),t=null,m=x.isNumberField(g.type),l="esriFieldTypeDate"===g.type?!0:!1;g&&(m?a=f.map(a,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a}):l&&(a=f.map(a,q.hitch(this,function(a){return x.isValidDate(a)?(a=0>(e?e.format.dateFormat:"").indexOf("Time")?a:
x.getTime(new Date(a)),x.localizeDateByFieldInfo(new Date(a),e)):a}))),g.domain&&g.domain.codedValues&&0<g.domain.codedValues.length?(t={},f.forEach(g.domain.codedValues,function(a){t[a.code]=a.name})):c.typeIdField===b&&(t={},f.forEach(c.types,function(a){t[a.id]=a.name})));return g=f.map(a,function(a){var b=null,b=null===a||void 0===a?"\x3cNull\x3e":t&&t.hasOwnProperty(a)?t[a]:m?e?x.localizeNumberByFieldInfo(a,e):x.localizeNumber(a):a;return{value:a,label:b}})})})};x._getUniqueValues=function(a,
b,c,h){var e=new g;a=a.replace(/\/*$/g,"");c||(c="1\x3d1");var e=/\/ImageServer$/gi.test(a),t=-1<a.indexOf("MapServer/dynamicLayer");e||t?e=x._getUniqueValuesByQueryTask(a,b,c):(e=x.getFieldInfoByFieldName(h.fields,b),e=0<x.getCodedValuesOrTypesCount(e,h)?x._getUniqueValuesByQueryTask(a,b,c):x._getUniqueValuesByGenerateRenderer(a,b,c));return e};x.getCodedValuesOrTypesCount=function(a,b){return a?b.typeIdField&&b.typeIdField.toUpperCase()===a.name.toUpperCase()&&b.types?b.types.length:(a=x._getAllCodedValue(b,
a))?a.length:0:0};x._getUniqueValuesByQueryTask=function(a,b,c){var h=new N;h.where=c;h.returnDistinctValues=!0;h.returnGeometry=!1;h.outFields=[b];return(new S(a)).execute(h).then(function(a){var c=[];a.features&&0<a.features.length&&f.forEach(a.features,function(a){a&&a.attributes&&c.push(a.attributes[b])});return c})};x._getUniqueValuesByGenerateRenderer=function(a,b,h){var e=new g,t=a.split("?");a=1<t.length?t[0].replace(/\/*$/g,"")+"/generateRenderer?"+t[1]:a.replace(/\/*$/g,"")+"/generateRenderer";
b=c.stringify({type:"uniqueValueDef",uniqueValueFields:[b]});O({url:a,content:{classificationDef:b,f:"json",where:h},handleAs:"json",callbackParamName:"callback"}).then(q.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=f.map(a,q.hitch(this,function(a){return a.value})));e.resolve(b)}),q.hitch(this,function(a){e.reject(a)}));return e};x.isCodedValuesSupportFilter=function(a,b){var c=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&10.1<c};x.combineRadioCheckBoxWithLabel=
function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var h=a.getAttribute("type")||"",h=h.toLowerCase();if("radio"===h||"checkbox"===h)c=!0}h=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(h=!0);c&&h&&(c=a.getAttribute("id"),c||(c="input_"+x.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),n.setStyle(b,"cursor","pointer"))};x.groupRadios=function(a,b){var c=[],h="radiogroup_"+x.getRandomString();f.forEach(a,function(a){a.name=h;b&&(a=e(a,"change",
b),c.push(a))});return c};x.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,h=a.ymin,e=a.ymax;return new F({rings:[[[b,e],[c,e],[c,h],[b,h],[b,e]]],spatialReference:a.toJson()})};x.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new w(b)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};
f.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new A(b)}function h(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=x.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new F(b)}var e=null;if(a&&0<a.length)if(1===a.length)e=a[0];else{for(var g=null,t=null,m=null,l=null,d=0;d<a.length;d++){g=a[d];switch(g.type){case "point":case "multipoint":l="point";
break;case "polyline":l="polyline";break;case "polygon":case "extent":l="polygon";break;default:return null}if(0===d)m=l;else if(m!==l)return null;if(d!==a.length-1&&(t=a[d+1],!g.spatialReference.equals(t.spatialReference)))return null}"point"===l?e=b(a):"polyline"===l?e=c(a):"polygon"===l&&(e=h(a))}return e};x.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=f.map(a,function(a){return a.geometry}),b=x.combineGeometries(a));return b};x.isFeaturelayerUrlSupportQuery=function(a,
b){var c=!1,h=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();h?c=0<=b.indexOf("query"):a&&(c=0<=b.indexOf("data"));return c};x.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};x.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};x.localizeNumber=function(a,b){var c=(a.toString().split(".")[1]||"").length,e="",e=b&&isFinite(b.places)&&b.places,e=0<e||0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:0<
e?e+1:c},"0"):"#,###,###,##0",c={locale:d.locale,pattern:e};q.mixin(c,b||{});try{return h.format(a,c)}catch(fa){return console.error(fa),a.toLocaleString()}};x.parseNumber=function(a,b){var c={locale:d.locale};q.mixin(c,b||{});try{return h.parse(a,c)}catch(ca){return console.error(ca),a}};x.localizeDate=function(a,c){var h={locale:d.locale,fullYear:!0};q.mixin(h,c||{});"ar"===d.locale&&"long"!==h.formatLength&&"full"!==h.formatLength&&(h.formatLength="long");try{return b.format(a,h)}catch(ca){return console.error(ca),
"date"===h.selector?a.toLocaleDateString():"time"===h.selector?a.toLocaleTimeString():a.toLocaleString()}};x.localizeNumberByFieldInfo=function(a,b){var c=null,c=q.exists("format.places",b)&&b.format.places,c=x.localizeNumber(a,{places:c});return q.exists("format.digitSeparator",b)&&!b.format.digitSeparator?c.toString().replace(new RegExp("\\"+t.group,"g"),""):c};x.localizeDateByFieldInfo=function(a,b){var c=null;try{var h={date:a instanceof Date?a.getTime():a},e=q.exists("format.dateFormat",b)?b.format.dateFormat:
"longMonthDayYear",c=v.substitute(h,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+D.prototype._dateFormats[e]}})}catch(da){console.error(da),c=a}return c};x.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var h=-1<a.indexOf("\r\n",b)?a.indexOf("\r\n",b):-1<a.indexOf("\n",b)?a.indexOf("\n",b):c,c=h<c?h:c,h=a.substring(b,
c);a=a.substring(0,b)+'\x3cA href\x3d"'+h+'" target\x3d"_blank"\x3e'+h+"\x3c/A\x3e"+a.substring(c,a.length)}}return null===a?"":a},getFormattedNumber:function(a,b){if("number"===typeof a){var c=(a.toString().split(".")[1]||"").length;a=x.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===
typeof a||a instanceof Date)a=x.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var c=0,h=a.codedValues.length;c<h;c++){var e=a.codedValues[c];if(v.isDefined(b)&&q.exists("code",e)&&b.toString()===e.code.toString())return e.name}return b}return b||null},getTypeName:function(a,b){for(var c=b.length,h=0;h<c;h++)if(a===b[h].id)return b[h].name;return a}};x.addRelativePathInCss=U;x.url={isAbsolute:function(a){return a?a.startWith("http")||a.startWith("/"):
!1},removeQueryParamFromUrl:function(a,b){a=K.urlToObject(a);a.query&&delete a.query[b];b=a.path;for(var c in a.query)b=b===a.path?b+"?"+c+"\x3d"+a.query[c]:b+"\x26"+c+"\x3d"+a.query[c];return b},addQueryParamToUrl:function(a,b,c){a=K.urlToObject(a);a.query||(a.query={});a.query[b]=c;b=a.path;for(var h in a.query)b=b===a.path?b+"?"+h+"\x3d"+a.query[h]:b+"\x26"+h+"\x3d"+a.query[h];return b}};x.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?
a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};x.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};x.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=K.urlToObject(a.href);a.query&&a.query.apiurl&&(b=x.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};x.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};
x.getDefaultThumnail=function(a,b,c){var h=new g;c.getItemById(b).then(function(b){b&&b.thumbnail&&b.thumbnailUrl?h.resolve(b.thumbnailUrl):a.thumbnailURL?(b=c.staticImagesUrl,(c.allSSL||"https:"===location.protocol)&&b&&(b=b.replace("http:","https:")),b+=a.thumbnailURL,c.isPortal&&a.thumbnailURL&&0!==a.thumbnailURL.indexOf("http")&&(b=window.location.protocol+"//"+window.location.host+a.thumbnailURL),h.resolve(b)):h.resolve("")});return h};x.invertColor=function(a){a=a.substring(1);3===a.length&&
(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};x.isLightColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?!0:!1};x.mixinAppConfigPosition=function(a,b){var c=q.clone(a);if(!b)return c;b=q.clone(b);var h=c.widgetOnScreen,e=b.widgetOnScreen;e&&e.widgets&&("[object Object]"===Object.prototype.toString.call(e.widgets)?
f.forEach(h.widgets,function(a,b){b=a.uri?a.uri:"ph_"+b;e.widgets[b]&&e.widgets[b].position&&(e.widgets[b].position.relativeTo||(e.widgets[b].position.relativeTo="map"),a.position=e.widgets[b].position)},this):f.forEach(e.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");h.widgets[b]&&a.position&&(h.widgets[b].position=a.position)}));e&&e.groups&&("[object Object]"===Object.prototype.toString.call(e.groups)?f.forEach(h.groups,function(a,b){b=a.label?a.label:"g_"+
b;e.groups[b]&&e.groups[b].panel&&e.groups[b].panel.position&&(e.groups[b].panel.position.relativeTo||(e.groups[b].panel.position.relativeTo="map"),a.panel.position=e.groups[b].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===a?f.forEach(e.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");h.groups[b]&&a.panel&&
a.panel.position&&(h.groups[b].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===a&&(h.groups=ba(h.groups,e.groups.map(function(a){return a.id})))));b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(c.mobileLayout=
b.mobileLayout);return c};x.handleGridLayoutOnScreenGroupChange=ba;x.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,c){var h=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),h=b+a+c.length);return{firstPos:b,lastPos:h}},setConfigValue:function(a,b,c){W(a,b,c)},getConfigValue:function(a,b){return W(a,b)},setConfigValueWithId:function(a,b,c){X(a,b,c)},getConfigValueWithId:function(a,b){return X(a,b)},getKeyInfo:function(a){var b=
this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=x.template.getSearchRange(a,x.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=x.template.getSearchRange(a,x.template.groupIdentification,"]");if(-1===b.firstPos)a=null;
else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],c=x.template.widgetIdentification+"_config",h;f.forEach(a.configurationSettings,function(a){f.forEach(a.fields,function(a){a.fieldName&&(h=x.template.getSearchRange(a.fieldName,c,"]"),0<=h.firstPos&&(a=x.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,
b,c){function h(a){var b=[];f.forEach(a,function(a){a&&b.push(a)},this);return b}var e=a.widgetOnScreen,g=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);c&&(a.map.mapOptions&&x.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=g,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var t in b.values)"webmap"!==t&&x.template.setConfigValueWithId(a,t,b.values[t]);a.widgetPool.widgets=h(a.widgetPool.widgets);e.widgets=h(e.widgets);
if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=h(a.widgetPool.groups[b].widgets);if(e.groups)for(b=0;b<e.groups.length;b++)e.groups[b].widgets=h(e.groups[b].widgets);return a}};x.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};x.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};
x.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};x.encodeHTML=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};x.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};x.getBestDisplayAttributes=function(a,b){var c={},h=null,e;for(e in a)h=x.getBestDisplayValue(e,a,b),c[e]=h;return c};x.getBestDisplayValue=function(a,b,c){var h=
"",e=null;q.isArrayLike(c)?e=x.getFieldInfoByFieldName(c,a):"object"===typeof c&&c.name===a&&(e=c);e&&(h=b[a],"esriFieldTypeDate"===e.type?h&&(a=new Date(parseInt(h,10)),h=x._tryLocaleDate(a)):"number"===typeof h&&(e.domain&&"codedValue"===e.domain.type?f.some(e.domain.codedValues,function(a){if(a.code===h)return h=a.name,!0}):h=x._tryLocaleNumber(h)));if(null===h||void 0===h)h="";return h};x._getCodedValues=function(a){var b=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&
(b=a.codedValues,b=f.map(b,q.hitch(this,function(a){return{value:a.code,label:a.name}})));return b};x._getSubTypes=function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=f.map(a.types,q.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};x._getCodedValueOrSubtypes=function(a,b,c){var h=x.getFieldInfoByFieldName(a.fields,b);return void 0!==c&&null!==c?x._getCodedValueBySubTypeId(a,b,c,h):x._getAllCodedValue(a,h)};x._getDisplayValueForCodedValueOrSubtype=function(a,b,c,
h){var e={isCodedValueOrSubtype:!1,displayValue:c};(a=x._getCodedValueOrSubtypes(a,b,h))&&0<a.length&&f.some(a,q.hitch(this,function(a){return a.value===c?(e={isCodedValueOrSubtype:!0,displayValue:a.label},!0):!1}));return e};x.getDisplayValueForCodedValueOrSubtype=function(a,b,c){var h=c[b],e,g=a.typeIdField;c.hasOwnProperty(g)&&(e=c[g]);return x._getDisplayValueForCodedValueOrSubtype(a,b,h,e)};x._getDisplayValueFromCodedValues=function(a,b){var c={isCodedValueOrSubtype:!1,displayValue:a};b&&0<b.length&&
f.some(b,q.hitch(this,function(b){return b.value===a?(c={isCodedValueOrSubtype:!0,displayValue:b.label},!0):!1}));c.value=a;return c};x.getDisplayValueForCodedValueOrSubtypeBatch=function(a,b,c){var h={},e=a.typeIdField;h.subType=x._getSubTypes(a);var g=x.getFieldInfoByFieldName(a.fields,b);if(h.subType&&0<h.subType.length){var t=h.subType,m;for(m in t){var l=t[m].value;h[l]=x._getCodedValueBySubTypeId(a,b,l,g)}}h.all=x._getAllCodedValue(a,g);t=[];a=[];for(var d in c)t=c[d],g=t[b],e===b?t=h.subType:
t.hasOwnProperty(e)?(t=t[e],t=h[t]):t=h.all,g=x._getDisplayValueFromCodedValues(g,t),a.push(g);return a};x._getUniquCodedValue=function(a,b,c){a[b]?c!==a[b]&&(a[b]=a[b]+", "+c):a[b]=c;return a};x._getAllCodedValue=function(a,b){var c=b.name,h={},e=null,g=!0;if(a.typeIdField&&a.types&&0<a.types.length)f.map(a.types,q.hitch(this,function(a){a.domains&&a.domains[c]&&(a=a.domains[c],"inherited"===a.type?g&&(g=!1,a=x._getCodedValues(b),f.map(a,q.hitch(this,function(a){h=x._getUniquCodedValue(h,a.value,
a.label)}))):a.codedValues&&0<a.codedValues.length&&f.map(a.codedValues,q.hitch(this,function(a){h=x._getUniquCodedValue(h,a.code,a.name)})))}));else return this._getCodedValues(b);a=[];var t=x.isNumberField(b.type),m;for(m in h){var l=t?parseInt(m,10):m;a.push({value:l,label:h[m]})}0<a.length&&(e=a);return e};x._getCodedValueBySubTypeId=function(a,b,c,h){var e=null;h=h?h:x.getFieldInfoByFieldName(a.fields,b);a.typeIdField&&a.types&&0<a.types.length?f.map(a.types,q.hitch(this,function(g){if(g.id===
c){if(b===a.typeIdField)return e=[{value:g.id,label:g.name}],!0;g.domains&&g.domains[b]&&(g=g.domains[b],"inherited"===g.type?e=x._getCodedValues(h):g.codedValues&&0<g.codedValues.length&&(e=f.map(g.codedValues,q.hitch(this,function(a){return{value:a.code,label:a.name}}))))}})):e=x._getCodedValues(h);return e};x.getCodedValueListForCodedValueOrSubTypes=function(a,b,c){var h=null,h=x.getFieldInfoByFieldName(a.fields,b),e;c&&(e=c[a.typeIdField]);a.typeIdField&&a.typeIdField.toUpperCase()===b.toUpperCase()?
(h=x._getSubTypes(a),c&&void 0!==e&&null!==e&&(a=x._getDisplayValueFromCodedValues(e,h),h=[{value:a.value,label:a.displayValue}])):h=c&&void 0!==e&&null!==e?x._getCodedValueBySubTypeId(a,b,e,h):x._getAllCodedValue(a,h);return h};x.getDefaultPortalFieldInfo=function(a){var b=a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format=
{places:2,digitSeparator:!0};break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};x._tryLocaleNumber=function(a){var b=x.localizeNumber(a);if(null===b||void 0===b)b=a;return b};x._tryLocaleDate=function(a){var b=x.localizeDate(a);b||(b=a.toLocaleDateString());return b};x.getFieldInfoByFieldName=function(a,b){var c=null;a&&0<a.length&&f.some(a,q.hitch(this,function(a){return a.name===b?(c=a,!0):!1}));return c};x.getDateFieldFormatByFieldName=function(a,b){if(a&&0<a.length)for(var c=
0;c<=a.length;c++){var h=a[c];if(h.fieldName===b){if(h.format&&h.format.dateFormat)return h.format.dateFormat;break}}return""};x.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};x.has=function(a){var b=k(a);if(b)return b;if("ie"===a.toLowerCase()){a=0;var c=/MSIE (\d+\.\d+);/.test(navigator.userAgent),h=!!navigator.userAgent.match(/Trident\/7.0/),e=navigator.userAgent.indexOf("rv:11.0");c&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&
(a=10);h&&-1!==e&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};x.detectUserAgent=function(){var a={},b={},c=navigator.userAgent,h=navigator.platform,e=c.match(/Web[kK]it[\/]{0,1}([\d.]+)/),g=c.match(/(Android);?[\s\/]+([\d.]+)?/),t=!!c.match(/\(Macintosh\; Intel /),m=c.match(/(iPad).*OS\s([\d_]+)/),l=c.match(/(iPod)(.*OS\s([\d_]+))?/),d=!m&&c.match(/(iPhone\sOS)\s([\d_]+)/),v=c.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),h=/Win\d{2}|Windows/.test(h),
u=c.match(/Windows Phone ([\d.]+)/),p=v&&c.match(/TouchPad/),r=c.match(/Kindle\/([\d.]+)/),f=c.match(/Silk\/([\d._]+)/),w=c.match(/(BlackBerry).*Version\/([\d.]+)/),k=c.match(/(BB10).*Version\/([\d.]+)/),C=c.match(/(RIM\sTablet\sOS)\s([\d.]+)/),B=c.match(/PlayBook/),z=c.match(/Chrome\/([\d.]+)/)||c.match(/CriOS\/([\d.]+)/),D=c.match(/Firefox\/([\d.]+)/),n=c.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),y=c.match(/MSIE\s([\d.]+)/)||c.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),A=
!z&&c.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),q=A||c.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);b.webkit=!!e;b.webkit&&(b.version=e[1]);g&&(a.android=!0,a.version=g[2]);d&&!l&&(a.ios=a.iphone=!0,a.version=d[2].replace(/_/g,"."));m&&(a.ios=a.ipad=!0,a.version=m[2].replace(/_/g,"."));l&&(a.ios=a.ipod=!0,a.version=l[3]?l[3].replace(/_/g,"."):null);u&&(a.wp=!0,a.version=u[1]);v&&(a.webos=!0,a.version=v[2]);p&&(a.touchpad=!0);w&&(a.blackberry=!0,a.version=w[2]);k&&
(a.bb10=!0,a.version=k[2]);C&&(a.rimtabletos=!0,a.version=C[2]);B&&(b.playbook=!0);r&&(a.kindle=!0,a.version=r[1]);f&&(b.silk=!0,b.version=f[1]);!f&&a.android&&c.match(/Kindle Fire/)&&(b.silk=!0);z&&(b.chrome=!0,b.version=z[1]);D&&(b.firefox=!0,b.version=D[1]);n&&(a.firefoxos=!0,a.version=n[1]);y&&(b.ie=!0,b.version=y[1]);q&&(t||a.ios||h)&&(b.safari=!0,a.ios||(b.version=q[1]));A&&(b.webview=!0);a.tablet=!!(m||B||g&&!c.match(/Mobile/)||D&&c.match(/Tablet/)||y&&!c.match(/Phone/)&&c.match(/Touch/));
a.phone=!(a.tablet||a.ipod||!(g||d||v||w||k||z&&c.match(/Android/)||z&&c.match(/CriOS\/([\d.]+)/)||D&&c.match(/Mobile/)||y&&c.match(/Touch/)));return{os:a,browser:b}};x.isMobileUa=function(){var a=x.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};x.inMobileSize=function(){var a=n.getMarginBox(document.body);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return n.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;n.removeClass(window.jimuConfig.layoutId,
"jimu-ismobile");return!1};x.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var c=a[b];if("esriFieldTypeOID"===c.type)return c.name}return null};x.isNeedHttpsButNot=function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext");return(b&&window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};x.toFeatureSet=function(a){var b=new L;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);b.features=
a;if(0<a.length){var c;f.some(a,function(a){if(a.geometry)return c=a,!0});if(c){a=c.getLayer();var h={};a&&(b.displayFieldName=a.displayField,f.forEach(a.fields,q.hitch(this,function(a){var b=a.name;h[b]=a.alias||b})),b.fieldAliases=h);b.geometryType=c.geometry.type;b.spatialReference=c.geometry.spatialReference}}return b};x.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(q.hitch(this,function(){a.focusNode.blur()}),100))}catch(Z){console.error(Z)}};
x.getFeatureLayerDefinition=function(a){var b=null,c=a.graphics;a.graphics=[];var h=a.toJson();a.graphics=c;h&&(b=h.layerDefinition);return b};x.simulateClickEvent=function(a){if(k("safari")){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else a.click()};x.getFeatureSetByLayerAndFeatures=function(a,b){var c=new L;c.fields=q.clone(a.fields);c.features=b;c.geometryType=a.geometryType;c.fieldAliases={};f.forEach(c.fields,q.hitch(this,function(a){var b=a.name;
c.fieldAliases[b]=a.alias||b}));return c};x.featureAction=function(){return{zoomTo:function(a,b,c){c||(c={});if(a&&b&&0<b.length){var h=f.every(b,function(a){return a&&a.spatialReference&&a.type});if(f.every(b,function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||h)h&&(b=f.map(b,function(a){return{geometry:a}})),x.zoomToFeatureSet(a,{features:b},c.extentFactor)}},flash:function(a,b){function c(a,b){f.forEach(e,function(c,h){c.setSymbol(b?a:g[h]||t)})}function h(a){return function(){setTimeout(function(){c(m,
!0);e[0]&&b&&b.redraw();setTimeout(function(){c(null,!1);e[0]&&b&&b.redraw();a()},200)},200)}}if(f.every(a||[],function(a){return a&&a.geometry})){var e=a;a=e[0];var g=f.map(e,function(a){return a.symbol}),t=a.symbol||q.getObject("renderer.symbol",!1,b),m=null;b&&"esriGeometryPoint"===b.geometryType?m=new J(require.toUrl("jimu")+"/images/flash.gif",20,20):(m=q.clone(t))&&(m.outline?m.outline.setColor("#ffc500"):m.setColor("#ffc500"));a&&t&&m&&b&&("esriGeometryPoint"===b.geometryType?(c(m,!0),b.redraw(),
setTimeout(function(){c(null,!1);b.redraw()},2E3)):h(h(h(function(){})))())}},panTo:function(a,b){f.every(b||[],function(a){return a&&a.geometry})&&(0<b.length?b=Q.graphicsExtent(b).getCenter():(b=b[0].geometry,b="polyline"===b.type||"polygon"===b.type?b.getExtent().getCenter():"extent"===b.type?b.getCenter():"multipoint"===b.type?1<b.points.length?b.getExtent().getCenter():b.getPoint(0):b),a.centerAt(b))},showPopup:function(a,b){f.every(b||[],function(a){return a&&a.geometry})&&(a=a.infoWindow,a.setFeatures(b),
b=b[0],"point"===b.geometry.type?a.show(b.geometry,{closetFirst:!0}):a.show(b.geometry.getExtent().getCenter(),{closetFirst:!0}))}}}();x.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(Z){a=!1}return!!a};x.getAppHref=function(){var a="";return a=x.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};x.getAppIdFromUrl=function(){var a=!0,b=x.getAppHref();if(-1!==b.indexOf("id\x3d")||
-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};x.getEditorContentHeight=function(a,b,c){var h=new g;this._content=a;this._dom=b;this._domParam=
c;var e=setTimeout(q.hitch(this,function(){clearTimeout(e);e=null;var a=0,b=this._domParam.contentWidth;try{var c=document.createElement("div");c.setAttribute("id","fakeContent");n.setStyle(c,"background-size","contain");c.innerHTML=this._content;this._dom.appendChild(c);if(c){var g=p("img",c);g&&g.length&&g.style({maxWidth:b-20+"px"});n.setStyle(c,"position","absolute");n.setStyle(c,"width",b+"px");n.setStyle(c,"left","-99999px");n.setStyle(c,"top","-99999px");n.setStyle(c,"visibility","hidden");
var t=n.getContentBox(c);t.h&&(a=t.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ha){console.error("can't getEditorContentHeight"+ha),a=200}h.resolve(a)}),1500);return h};x.getBase64Data=function(a){var b=new g;if(a&&a.startWith("data:image"))b.resolve(a);else try{O({url:a,handleAs:"arraybuffer"}).then(function(a){var c=new FileReader;c.onloadend=function(){b.resolve(c.result)};c.onerror=function(){b.resolve(null)};c.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(ea){console.warn(ea),
b.resolve(null)}return b};x.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:x.getColorRecordName(a),forceAttr:b}}};x.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:x.getColorRecordName(a)}}};x.getColorRecordName=function(a){return"wab_cr_"+(a||"")};x.b64toBlob=function(a,b,c){b=b||"";c=c||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var h=[],e=0;e<
a.length;e+=c){for(var g=a.slice(e,e+c),t=Array(g.length),m=0;m<g.length;m++)t[m]=g.charCodeAt(m);g=new Uint8Array(t);h.push(g)}return new Blob(h,{type:b})};x.subtractionArray=function(a,b){for(var c=a.length-1;0<=c;c--)for(var h=a[c],e=b.length-1;0<=e;e--)if(h===b[e]){a.splice(c,1);b.splice(e,1);break}return a};x.resourcesUrlToBlob=function(a){return O({url:a,handleAs:"blob"})};x.processItemResourceOfAppConfig=function(a,b){function c(a){var b=a.obj,c=a.key,h={obj:b,key:c};"number"===typeof a.i?
(h.i=a.i,h.value=b[c][a.i]):h.value=b[c];return h}function h(a){for(var b in a)if("object"===typeof a[b])if(Array.isArray(a[b]))for(var c=a,g=b,t=0;t<c[g].length;t++)"string"===typeof c[g][t]?e(c,g,t):"object"===typeof c[g][t]&&h(c[g][t]);else h(a[b]);else"string"===typeof a[b]&&e(a,b)}function e(a,h,e){"number"===typeof e?b.test(a[h][e])&&(l=b.func(c({obj:a,key:h,i:e})),"function"===typeof l.then?t.push(l):g.push(l)):b.test(a[h])&&(l=b.func(c({obj:a,key:h})),"function"===typeof l.then?t.push(l):
g.push(l))}var g=[],t=[],l;h(a);return 0<t.length?m(t).then(function(b){0<g.length&&(b=b.concat(g));return{appConfig:a,result:b}}):{appConfig:a,result:g}};x.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};x.uniqueArray=function(a){for(var b=[],c=0;c<a.length;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b};x.isNotEmptyObject=function(a,b){return b?x.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):x.isObject(a)&&0<Object.keys(a).length};x.getMinOfArray=
function(a){return Number(Math.min.apply(Math,a))};x.getDataSchemaFromLayerDefinition=function(a){var b=a.fields.filter(function(a){return"esriFieldTypeOID"===a.type}),b=0<b.length?b[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,objectIdField:b,typeIdField:a.typeIdField}};x.isValidPointGeometry=function(a){return a&&"point"===a.type&&x.isTrueOrZero(a.x)&&x.isTrueOrZero(a.y)};x.isVaildPointGeometry=x.isValidPointGeometry;x.isNumberOrNumberString=function(a){return/^-?[1-9]\d*$/.test(a)||
/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(a)};x.convertNumberToPercentage=function(a,b){if(!x.isNumberOrNumberString(a))return a;"undefined"===typeof b&&(b=2);var c=d.locale,c="ar"===c||"tr"===c;a=Number(a);a=(100*a).toFixed(b);a=x.localizeNumber(a);return c?"%"+a:a+"%"};x.getClientFeaturesFromMap=function(a,b,c,h){var e=[],g=!1;c?0<b.getSelectedFeatures().length?(e=b.getSelectedFeatures(),g=!0):e=b.graphics:e=b.graphics;h&&(e=x.filterFeaturesByExtent(a.extent,e));if(0<e.length){var t=x.getObjectIdField(b);
t&&(a=e[0])&&a.attributes&&a.attributes.hasOwnProperty(t)&&e.sort(function(a,b){a.attributes||(a.attributes={});b.attributes||(b.attributes={});a=a.attributes[t];b=b.attributes[t];return a<b?-1:a>b?1:0})}e.isSelectedFeatures=g;return e};x.filterFeaturesByExtent=function(a,b){var c=a.normalize();return b=f.filter(b,q.hitch(this,function(a){try{if(a.geometry){var b="point"===a.geometry.type||"multipoint"===a.geometry;return f.some(c,q.hitch(this,function(c){return b?c.contains(a.geometry):z.intersects(c,
a.geometry)}))}}catch(da){console.error(da)}return!1}))};x.upperCaseString=function(a){return a&&"string"===typeof a?a.toUpperCase():a};x.lowerCaseString=function(a){return a&&"string"===typeof a?a.toLowerCase():a};return x})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(q,f,n){var k=q.NodeList;f.extend(k,{_buildArrayFromCallback:function(d){for(var r=[],p=0;p<this.length;p++){var l=d.call(this[p],this[p],r);l&&(r=r.concat(l))}return r},_getUniqueAsNodeList:function(d){for(var r=
[],p=0,l;l=d[p];p++)1==l.nodeType&&-1==n.indexOf(r,l)&&r.push(l);return this._wrap(r,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(d,r){d=this._getUniqueAsNodeList(d);d=r?q._filterResult(d,r):d;return d._stash(this)},_getRelatedUniqueNodes:function(d,r){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(r),d)},children:function(d){return this._getRelatedUniqueNodes(d,function(d,p){return f._toArray(d.childNodes)})},closest:function(d,r){return this._getRelatedUniqueNodes(null,
function(p,l){do if(q._filterResult([p],d,r).length)return p;while(p!=r&&(p=p.parentNode)&&1==p.nodeType);return null})},parent:function(d){return this._getRelatedUniqueNodes(d,function(d,p){return d.parentNode})},parents:function(d){return this._getRelatedUniqueNodes(d,function(d,p){for(p=[];d.parentNode;)d=d.parentNode,p.push(d);return p})},siblings:function(d){return this._getRelatedUniqueNodes(d,function(d,p){p=[];for(var l=d.parentNode&&d.parentNode.childNodes,g=0;g<l.length;g++)l[g]!=d&&p.push(l[g]);
return p})},next:function(d){return this._getRelatedUniqueNodes(d,function(d,p){for(d=d.nextSibling;d&&1!=d.nodeType;)d=d.nextSibling;return d})},nextAll:function(d){return this._getRelatedUniqueNodes(d,function(d,p){for(p=[];d=d.nextSibling;)1==d.nodeType&&p.push(d);return p})},prev:function(d){return this._getRelatedUniqueNodes(d,function(d,p){for(d=d.previousSibling;d&&1!=d.nodeType;)d=d.previousSibling;return d})},prevAll:function(d){return this._getRelatedUniqueNodes(d,function(d,p){for(p=[];d=
d.previousSibling;)1==d.nodeType&&p.push(d);return p})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(d,f){return 0!=f%2})},odd:function(){return this.filter(function(d,f){return 0==f%2})}});return k})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(q){q=q.getObject("dojox.encoding.base64",
!0);q.encode=function(f){for(var n=[],k=f.length,d=k%3,k=k-d,r=0;r<k;){var p=f[r++]<<16|f[r++]<<8|f[r++];n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>18&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>12&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>6&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p&63))}switch(d){case 2:p=f[r++]<<16|
f[r++]<<8;n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>18&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>12&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>6&63));n.push("\x3d");break;case 1:p=f[r++]<<16,n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>18&63)),n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>
12&63)),n.push("\x3d"),n.push("\x3d")}return n.join("")};q.decode=function(f){f=f.split("");for(var n=[],k=f.length;"\x3d"==f[--k];);for(var d=0;d<k;){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<18;d<=k&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<12);d<=k&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++])<<6);d<=k&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d++]));
n.push(r>>>16&255);n.push(r>>>8&255);n.push(r&255)}for(;0==n[n.length-1];)n.pop();return n};return q})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(q,f,n,k,d,r,p,l){q=q(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var g=n.map(this.geometries,function(e){return e.toJson()}),
m={};m.outSR=this.outSR.wkid||k.toJson(this.outSR.toJson());m.inSR=this.geometries[0].spatialReference.wkid||k.toJson(this.geometries[0].spatialReference.toJson());m.geometries=k.toJson({geometryType:l.getJsonType(this.geometries[0]),geometries:g});this.transformation&&(m.transformation=this.transformation.wkid||k.toJson(this.transformation));p.isDefined(this.transformForward)&&(m.transformForward=this.transformForward);return m}});d("extend-esri")&&f.setObject("tasks.ProjectParameters",q,r);return q})},
"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(q,f){var n=q.clone(f);n.declaredClass="jimu.portalUrlUtils";n.getPortalUrlFromLocation=function(){return n.getPortalServerFromLocation()+n.getDeployContextFromLocation()};n.getPortalSignInUrlFromLocation=function(){var f=n.getPortalUrlFromLocation();return n.setHttpsProtocol(f+"home/signin.html")};n.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};
n.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],d=f.indexOf("/home");0>d&&(d=f.indexOf("/apps"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==f&&(f="/"+f+"/");return f};n.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+n.getDeployContextFromLocation()+"sharing/rest/"};return n})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var q={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});q.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&
(f=f.slice(2));return f.split("/")[0]};q.getServerWithProtocol=function(f){var n="";if(f=(f||"").trim()){var k=q.getServerByUrl(f);if(!k)return n;var d=q.getProtocol(f);d?n=d+"://"+k:0===f.indexOf("//")&&(n="//"+k)}return n};q.isSameServer=function(f,n){f=q.getServerByUrl(f)||"";n=q.getServerByUrl(n)||"";return f.toLowerCase()===n.toLowerCase()};q.getDomain=function(f){var n="";if(f=q.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(n=f[0],/^\d+\.\d+$/.test(n)&&(n=""));
return n};q.isSameDomain=function(f,n){f=q.getDomain(f);n=q.getDomain(n);return""!==f&&f===n};q.isOrgOnline=function(f){return 0<=q.getServerByUrl(f).toLowerCase().indexOf(".maps.arcgis.com")};q.isOnline=function(f){return 0<=q.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};q.isArcGIScom=function(f){f=q.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};q.getStandardPortalUrl=function(f){var n=q.getServerByUrl(f);if(""===n)return"";q.isOnline(n)?(q.isArcGIScom(n)&&
(n="www.arcgis.com"),f=q.addProtocol(f),f=q.getProtocol(f)+"://"+n):(f=(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=q.addProtocol(f),f.replace(new RegExp("http(s?)://"+n,"g"),"")||(f+="/arcgis"));return f};q.isSamePortalUrl=function(f,n){var k=/^http(s?):\/\//gi,d=/^\/\//gi;f=q.getStandardPortalUrl(f).toLowerCase().replace(k,"").replace(d,"");n=q.getStandardPortalUrl(n).toLowerCase().replace(k,"").replace(d,"");return f===n};q.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&
-1>=f.toLowerCase().indexOf("https://")){var n="";"undefined"!==typeof window&&window.location?(n=window.location.protocol,f=f.startWith("//")?n+f:f.startWith("/")?n+"//"+window.location.host+f:n+"//"+f):(n="http:",f=f.startWith("//")?n+f:n+"//"+f)}return f};q.getProtocol=function(f){var n="";f=f.toLowerCase();0===f.indexOf("https://")?n="https":0===f.indexOf("http://")&&(n="http");return n};q.updateUrlProtocolByOtherUrl=function(f,n){n=n.toLowerCase();0===n.indexOf("https://")?f=q.setHttpsProtocol(f):
0===n.indexOf("http://")&&(f=q.setHttpProtocol(f));return f};q.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};q.setHttpProtocol=function(f){f=q.addProtocol(f);return f.replace(/^https:\/\//,"http://")};q.setHttpsProtocol=function(f){f=q.addProtocol(f);return f.replace(/^http:\/\//,"https://")};q.setProtocol=function(f,n){return 0<=n.indexOf("https")?q.setHttpsProtocol(f):0<=n.indexOf("http")?q.setHttpProtocol(f):f};q.getSharingUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&
(n=f+"/sharing/rest");return n};q.getOAuth2Url=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/rest/oauth2");return n};q.getAppIdUrl=function(f,n){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2/apps/"+n);return k};q.getSignInUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/signin.html");return n};q.getBaseSearchUrl=function(f){var n="";f=q.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(n=f+"/sharing/rest/search");return n};q.getBaseItemUrl=
function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/rest/content/items");return n};q.getItemUrl=function(f,n){var k="";(f=q.getBaseItemUrl(f))&&n&&(k=f+"/"+n);return k};q.getItemDataUrl=function(f,n){var k="";(f=q.getItemUrl(f,n))&&(k=f+"/data");return k};q.getItemGroupsUrl=function(f,n){var k="";(f=q.getItemUrl(f,n))&&(k=f+"/groups");return k};q.getGenerateTokenUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/generateToken");return n};q.getItemDetailsPageUrl=
function(f,n){var k="";f&&n&&(f=q.getStandardPortalUrl(f),k=f+"/home/item.html?id\x3d"+n);return k};q.getUserProfilePageUrl=function(f,n){var k="";f&&n&&(f=q.getStandardPortalUrl(f),k=f+"/home/user.html?user\x3d"+n);return k};q.getBaseGroupUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/rest/community/groups");return n};q.getPortalSelfInfoUrl=function(f){var n="";(f=q.getStandardPortalUrl(f||""))&&(n=f+"/sharing/rest/portals/self");return n};q.getCommunitySelfUrl=function(f){var n=
"";(f=q.getStandardPortalUrl(f||""))&&(n=f+"/sharing/rest/community/self");return n};q.getBaseUserUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/rest/community/users");return n};q.getUserUrl=function(f,n){var k="",d=q.getBaseUserUrl(f);f&&n&&(k=d+"/"+n);return k};q.getUserTagsUrl=function(f,n){var k="",d=q.getUserUrl(f,n);f&&n&&(k=d+"/tags");return k};q.getUserThumbnailUrl=function(f,n,k){var d="";(f=q.getUserUrl(f,n))&&k&&(d=f+"/info/"+k);return d};q.getContentUrl=function(f){var n=
"";f&&(f=q.getStandardPortalUrl(f),n=f+"/sharing/rest/content");return n};q.getUserContentUrl=function(f,n,k){var d="",d="";f&&n&&(d=q.getContentUrl(f),d=k?d+"/users/"+n+"/"+k:d+"/users/"+n);return d};q.getUserContentItemUrl=function(f,n,k){var d="",d="";f&&n&&k&&(d=q.getUserContentUrl(f,n),d=d+"/items/"+k);return d};q.getItemResourceUrl=function(f,n,k){var d="",d="";f&&n&&(d=q.getContentUrl(f),d=k?d+"/items/"+n+"/resources/"+k:d+"/items/"+n+"/resources");return d};q.getAddItemUrl=function(f,n,k){var d=
"",d="";f&&n&&(d=q.getUserContentUrl(f,n,k),d+="/addItem");return d};q.getDeleteItemUrl=function(f,n,k){var d="";(f=q.getUserItemsUrl(f,n))&&(d=f+"/"+k+"/delete");return d};q.getUserItemsUrl=function(f,n,k){var d="",d="";f&&n&&(d=q.getUserContentUrl(f,n,k),d+="/items");return d};q.getUpdateItemUrl=function(f,n,k,d){var r="",r="";f&&n&&(r=q.getUserItemsUrl(f,n,d),r=r+"/"+k+"/update");return r};q.shareItemUrl=function(f,n,k,d){var r="",r="";f&&n&&(r=q.getUserItemsUrl(f,n,d),r=r+"/"+k+"/share");return r};
q.getHomeIndexUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/index.html");return n};q.getHomeMapViewerUrl=function(f,n){var k="";if(f=q.getStandardPortalUrl(f))k=f+"/home/webmap/viewer.html",k=n?k+("?webmap\x3d"+n):k+"?useExisting\x3d1";return k};q.getHomeSceneViewerUrl=function(f,n){var k="";if(f=q.getStandardPortalUrl(f))k=f+"/home/webscene/viewer.html",n&&(k+="?webscene\x3d"+n);return k};q.getHomeGalleryUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/gallery.html");
return n};q.getHomeGroupsUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/groups.html");return n};q.getHomeMyContentUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/content.html");return n};q.getHomeMyOrganizationUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/organization.html");return n};q.getHomeUserUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/home/user.html");return n};q.getPortalHelpUrl=function(f,n){var k="";(f=q.getStandardPortalUrl(f))&&
(k=f+"/portalhelp/"+(n||"en")+"/website/help/");return k};q.getPortalAdminHelpUrl=function(f,n){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/portalhelp/"+(n||"en")+"/admin/help/");return k};q.getPortalProxyUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/proxy");return n};q.getOAuth2SignOutUrl=function(f){var n="";(f=q.getStandardPortalUrl(f))&&(n=f+"/sharing/rest/oauth2/signout");return n};q.getNewPrintUrl=function(f){var n="";if(f=q.getStandardPortalUrl(f))f=q.setHttpProtocol(f),
n=f+"/sharing/tools/newPrint";return n};q.getSwitchAccoutnsUrl=function(f,n,k){var d="";if(f=q.getStandardPortalUrl(f))d=f+"/home/pages/Account/manage_accounts.html#client_id\x3d"+n,k&&(d+="\x26redirect_uri\x3d"+k);d&&(d=q.setHttpsProtocol(d));return d};return q})},"jimu/shared/utils":function(){define([],function(){function q(f,d){function r(d,l){var g,m,e,c,a="widgetOnScreen"===d;if(f[d]){if(f[d].groups)for(g=0;g<f[d].groups.length;g++)if(e=f[d].groups[g],l(e,{index:g,isWidget:!1,groupId:e.id,isThemeWidget:!1,
isOnScreen:a}),f[d].groups[g].widgets)for(m=0;m<f[d].groups[g].widgets.length;m++)c=f[d].groups[g].widgets[m],l(c,{index:m,isWidget:!0,groupId:e.id,isThemeWidget:c.uri&&-1<c.uri.indexOf("themes/"+f.theme.name),isOnScreen:a});if(f[d].widgets)for(g=0;g<f[d].widgets.length;g++)c=f[d].widgets[g],l(f[d].widgets[g],{index:g,isWidget:!0,groupId:d,isThemeWidget:c.uri&&-1<c.uri.indexOf("themes/"+f.theme.name),isOnScreen:a})}}r("widgetOnScreen",d);r("widgetPool",d)}var f={},n="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
f.visitElement=q;f.getConfigElementById=function(f,d){var r;if("map"===d)return f.map;q(f,function(p){if(p.id===d)return r=p,!0});return r};f.getConfigElementByLabel=function(f,d){var r;if("map"===d)return f.map;q(f,function(p){if(p.label||p.name===d)return r=p,!0});return r};f.getConfigElementsByName=function(f,d){var r=[];if("map"===d)return[f.map];q(f,function(p){p.name===d&&r.push(p)});return r};f.getWidgetNameFromUri=function(f){f=f.split("/");f.pop();return f.pop()};f.getAmdFolderFromUri=function(f){f=
f.split("/");f.pop();return f.join("/")+"/"};f.widgetProperties=n;f.processWidgetProperties=function(f){"undefined"===typeof f.properties.isController&&(f.properties.isController=!1);"undefined"===typeof f.properties.isThemeWidget&&(f.properties.isThemeWidget=!1);"undefined"===typeof f.properties.hasVersionManager&&(f.properties.hasVersionManager=!1);n.forEach(function(d){"undefined"===typeof f.properties[d]&&(f.properties[d]=!0)})};f.getControllerWidgets=function(f){var d=[];f.visitElement(function(f){f.isController&&
d.push(f)});return d};f.addI18NLabelToManifest=function(f,d,r){function p(g,e){e[l]&&(f.i18nLabels[g]=e[l]);"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(c){f["i18nLabels_layout_"+c.name]||(f["i18nLabels_layout_"+c.name]={});f["i18nLabels_layout_"+c.name][g]=e["_layout_"+c.name]}),f.styles&&f.styles.forEach(function(c){f["i18nLabels_style_"+c.name]||(f["i18nLabels_style_"+c.name]={});f["i18nLabels_style_"+c.name][g]=e["_style_"+c.name]}));"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(c){f["i18nLabels_featureAction_"+
c.name]||(f["i18nLabels_featureAction_"+c.name]={});f["i18nLabels_featureAction_"+c.name][g]=e["_featureAction_"+c.name]})}f.i18nLabels={};var l="widget"===f.category?"_widgetLabel":"_themeLabel";d&&d.root&&d.root[l]&&(f.i18nLabels.defaultLabel=d.root[l],"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(g){f["i18nLabels_layout_"+g.name]={};f["i18nLabels_layout_"+g.name].defaultLabel=d.root["_layout_"+g.name]}),f.styles&&f.styles.forEach(function(g){f["i18nLabels_style_"+g.name]={};f["i18nLabels_style_"+
g.name].defaultLabel=d.root["_style_"+g.name]})),"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(g){f["i18nLabels_featureAction_"+g.name]={};f["i18nLabels_featureAction_"+g.name].defaultLabel=d.root["_featureAction_"+g.name]}));for(var g in r)p(g,r[g])};f.isHostedService=function(f){if(!f)return!1;var d=-1!==f.indexOf(".arcgis.com/");f=-1!==f.indexOf("//services")||-1!==f.indexOf("//tiles")||-1!==f.indexOf("//features");return d&&f};return f})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e){var c={zoomToFeatureSet:function(a,h,b){var e=h.features&&0<h.features.length&&h.features[0].getLayer&&h.features[0].getLayer(),e=e?e.id:null;h=c.graphicsExtent(h.features,b);return c.zoomToExtent(a,h,e)},zoomToExtent:function(a,h,b){var e;if(!a||!c.isValidExtent(h))return e=new n,e.reject(),e;b?(e=new n,require(["jimu/LayerStructure"],function(g){(g=g.getInstance().getNodeById(b))?g.zoomTo(h).then(function(){e.resolve()},function(){e.reject()}):c.projectToMapSpatialReference(a,
h).then(function(b){h.isSinglePoint&&(b=c.convertSinglePointExtent(a,b));a.setExtent(b,!0);e.resolve()},function(){e.reject()})})):e=c.projectToMapSpatialReference(a,h).then(function(b){h.isSinglePoint&&(b=c.convertSinglePointExtent(a,b));return a.setExtent(b,!0)});return e},isValidExtent:function(a){return a&&c.isTrueOrZero(a.xmin)&&c.isTrueOrZero(a.ymin)&&c.isTrueOrZero(a.xmax)&&c.isTrueOrZero(a.ymax)}};c.isVaildExtent=c.isValidExtent;c.isTrueOrZero=function(a){return 0===a?!0:!!a};c.convertSinglePointExtent=
function(a,h){var b=a.getScale();if(b=c.getMedianScale(a,b,0))h=c.adjustHeightToAspectRatio(a,h),h=c.getExtentForScale(h,a.width,b);return h};c.graphicsExtent=function(a,c){var b=null;try{if(a&&1===a.length&&"esri.geometry.Multipoint"===a[0].geometry.declaredClass&&1===a[0].geometry.points.length){var h=a[0].geometry.points[0],e=new l(h[0],h[1],a[0].geometry.spatialReference);a=[new d(e)]}if(a&&1===a.length&&"esri.geometry.Point"===a[0].geometry.declaredClass){var g=a[0].geometry,b=new p(g.x-1E-4,
g.y-1E-4,g.x+1E-4,g.y+1E-4,g.spatialReference);b.isSinglePoint=!0}else a&&0<a.length&&(b=r.graphicsExtent(a))&&"number"===typeof c&&0<c&&(b=b.expand(c))}catch(C){console.error(C)}return b};c.projectToMapSpatialReference=function(a,c){var b=new n,h=c;if(a&&c)if(a.spatialReference.equals(c.spatialReference))b.resolve(h);else if(a.spatialReference.isWebMercator()&&c.spatialReference.equals(new g(4326)))h=m.geographicToWebMercator(c),h.isSinglePoint=c.isSinglePoint,b.resolve(h);else if(a.spatialReference.equals(new g(4326))&&
c.spatialReference.isWebMercator())h=m.webMercatorToGeographic(c),h.isSinglePoint=c.isSinglePoint,b.resolve(h);else{var d=k&&k.defaults&&k.defaults.geometryService;if(d&&"esri.tasks.GeometryService"===d.declaredClass){var l=new e;l.geometries=[c];l.outSR=a.spatialReference;d.project(l).then(function(a){(h=a&&0<a.length&&a[0])?(h.isSinglePoint=c.isSinglePoint,b.resolve(h)):b.reject()},function(){})}else b.reject()}else b.reject();return b};c.getMapLods=function(a){var c=null;a._params&&a._params.lods&&
(c=f.map(a._params.lods,q.hitch(this,function(a){return a.toJson()})));return c};c.getMedianScale=function(a,h,b){return c.getTargetScale(a,2,h,b)};c.getTargetScale=function(a,h,b,e){a=c.getMapLods(a);var g=1;if(a){var t=[],m=[];f.forEach(a,function(a){0<b&&a.scale>b||(a.scale<e?m.push(a.scale):t.push(a.scale))});t.reverse();1<=t.length?(g=m.length?m.length/a.length:1,h=Math.floor((t.length-1)/(h/g)),h=t[h]):h=null}else h=0===b?null:(b-e)/h;return h};c.getScaleForNextTileLevel=function(a,h,b){if(a=
c.getMapLods(a)){if(b){for(b=0;b<a.length;b++)if(a[b].scale<h)return a[b].scale-1;return a[a.length-1].scale-1}for(b=a.length-1;0<=b;b--)if(a[b].scale>h)return a[b].scale+1;return a[0].scale+1}return b?h-1:h+1};c.adjustExtentToAspectRatio=function(a,c){a=a.width/a.height;var b=c.getWidth()/c.getHeight();b>a?(a=c.getWidth()/a/2,q.mixin(c,{ymin:c.getCenter().y-a,ymax:c.getCenter().y+a})):b<a&&(a=c.getHeight()*a/2,q.mixin(c,{xmin:c.getCenter().x-a,xmax:c.getCenter().x+a}));return c};c.adjustHeightToAspectRatio=
function(a,c){a=c.getWidth()*(a.height/a.width)/5;q.mixin(c,{ymin:c.getCenter().y-a,ymax:c.getCenter().y+a});return c};c.getExtentForScale=function(a,c,b){var h=20015077/180,e=esri.config.defaults,g=esri.WKIDUnitConversion,m,d,l=a.spatialReference;l&&(m=l.wkid,d=l.wkt);l=null;m?l=g.values[g[m]]:d&&-1!==d.search(/^PROJCS/i)&&(g=/UNIT\[([^\]]+)\]\]$/i.exec(d))&&g[1]&&(l=parseFloat(g[1].split(",")[1]));return a.expand(b*c/(39.37*(l||h)*e.screenDPI)/a.getWidth())};c.getScaleForExtent=function(a,c){var b=
20015077/180,h=esri.config.defaults,e=esri.WKIDUnitConversion,g,m,d=a.spatialReference;d&&(g=d.wkid,m=d.wkt);d=null;g?d=e.values[e[g]]:m&&-1!==m.search(/^PROJCS/i)&&(e=/UNIT\[([^\]]+)\]\]$/i.exec(m))&&e[1]&&(d=parseFloat(e[1].split(",")[1]));return a.getWidth()/c*(d||b)*39.37*h.screenDPI};return c})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v){var C=null,D=q(p,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(r.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),r.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(r.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),r.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(r.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),r.subscribe("app/sceneViewChanged",
f.hitch(this,this._onSceneViewChanged))):(r.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),r.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(r.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),r.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(r.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),r.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));r.subscribe("userSignIn",
f.hitch(this,this._onUserSignIn));r.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));r.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));r.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(b){var c=new d,e;b=f.clone(b);(e=this.getWidgetById(b.id))?c.resolve(e):a([this.loadWidgetClass(b),this.loadWidgetManifest(b)]).then(f.hitch(this,function(a){var b=a[0],e=a[1];this.loadWidgetResources(e).then(f.hitch(this,function(a){try{var g=this.createWidget(e,
b,a);k.setAttr(g.domNode,"data-widget-name",e.name);console.log("widget ["+e.uri+"] created.")}catch(H){console.log("create ["+e.uri+"] error:"+H.stack),new u({message:window.jimuNls.widgetManager.createWidgetError+": "+e.uri}),h.byId(e.id)&&h.byId(e.id).destroy(),c.reject(H)}setTimeout(f.hitch(this,function(){c.resolve(g);this.emit("widget-created",g);r.publish("widgetCreated",g)}),50)}),function(a){c.reject(a)})}),function(a){c.reject(a)});return c},loadWidgetClass:function(a){var c=new d,h;h=a.isRemote?
a.uri+".js":a.uri;require(b.getRequireConfig(),[h],f.hitch(this,function(a){c.resolve(a)}));b.checkError(a.uri,c);return c},loadWidgetResources:function(b){var c=new d,h,e,g,t=[];g=f.clone(b);b=this.tryLoadWidgetConfig(g);h=this._tryLoadResource(g,"i18n");e=this._tryLoadResource(g,"style");g=this._tryLoadResource(g,"template");t.push(b);t.push(h);t.push(g);t.push(e);a(t).then(f.hitch(this,function(a){var b={};b.config=a[0];b.i18n=a[1];b.template=a[2];b.style=a[3];c.resolve(b)}),function(a){c.reject(a)});
return c},loadWidgetManifest:function(a){var h=new d,e=b.getUriInfo(a.uri),e=e.isRemote?e.folderUrl+"manifest.json?f\x3djson":e.folderUrl+"manifest.json";if(a.manifest)return h.resolve(a),h;c(e,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(c){if(c.error&&c.error.code)return h.reject(c.error);c.category="widget";f.mixin(c,b.getUriInfo(a.uri));b.manifest.addI18NLabel(c).then(f.hitch(this,function(){this._processManifest(c);b.widgetJson.addManifest2WidgetJson(a,c);h.resolve(a)}))}),
function(a){h.reject(a)});return h},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;var b={left:-9999,top:-9999,relativeTo:a.position.relativeTo};a._isTestSizeFlag=!0;a.setPosition(b);this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);"undefined"!==typeof a._isTestSizeFlag&&delete a._isTestSizeFlag;return a._marginBox},_processManifest:function(a){b.manifest.addManifestProperies(a);b.manifest.processManifestLabel(a,
window.dojoConfig.locale)},createWidget:function(a,c,h){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);h.config&&h.i18n&&(h.config=b.replacePlaceHolder(h.config,h.i18n));a.rawConfig=a.config;a.config=h.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=h.i18n||{};h.template&&(a.templateString=h.template);a["class"]="jimu-widget";a.label||(a.label=a.name);this.map&&(a.map=this.map);a.appConfig=this.appConfig;h={};for(var e in a)a.hasOwnProperty(e)&&(h[e]=a[e]);h.widgetManager=
this;a=new c(h);a.clazz=c;g.after(a,"startup",f.hitch(this,this._postWidgetStartup,a));g.before(a,"destroy",f.hitch(this,this._onDestroyWidget,a));l(a.domNode,"click",f.hitch(this,this._onClickWidget,a));this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=n.map(this.loaded,function(a){return a.id});n.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(b){var c=new d;b=f.clone(b);b.id+="_setting";
a([this.loadWidgetSettingClass(b)]).then(f.hitch(this,function(a){var e=a[0];this.loadWidgetSettingPageResources(b).then(f.hitch(this,function(a){var t;a={nls:a.i18n,templateString:a.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?a.sceneView=this.sceneView:a.map=this.map;for(var m in b)b.hasOwnProperty(m)&&(a[m]=b[m]);try{t=new e(a),k.setAttr(t.domNode,"data-widget-name-setting",a.name),g.before(t,"destroy",f.hitch(this,this._onDestroyWidgetSetting,
t)),c.resolve(t)}catch(G){new u({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+b.uri}),h.byId(a.id)&&h.byId(a.id).destroy(),c.reject(G)}}),function(a){console.log(a)})}),function(a){c.reject(a)});return c},loadWidgetSettingClass:function(a){var c=new d,h;h=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(b.getRequireConfig(),[h],f.hitch(this,function(a){c.resolve(a)}));b.checkError(a.folderUrl+"setting/Setting.js",c);return c},loadWidgetSettingPageResources:function(b){var c=
new d,h,e,g=[];b=f.clone(b);h=this._tryLoadResource(b,"settingI18n");e=this._tryLoadResource(b,"settingTemplate");b=this._tryLoadResource(b,"settingStyle");g.push(h);g.push(e);g.push(b);a(g).then(f.hitch(this,function(a){var b={};b.i18n=a[0]||{};b.template=a[1];b.style=a[2];c.resolve(b)}),function(a){console.log(a)});return c},getWidgetById:function(a){var b;n.some(this.loaded,function(c){if(c.id===a)return b=c,!0},this);return b},getWidgetByLabel:function(a){var b;n.some(this.loaded,function(c){if(c.label===
a)return b=c,!0},this);return b},getWidgetsByName:function(a){var b=[];n.some(this.loaded,function(c){c.name===a&&b.push(c)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),
this.activeWidget=null);k.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(y){console.log(console.error("fail to close widget "+a.name+". "+y.stack))}}this.appConfig.mode||this._removeDataSourceUsage(a)},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(y){console.error("fail to startup widget "+a.name+". "+y.stack)}if("closed"===a.state){k.setStyle(a.domNode,"display","");a.setState("opened");
try{a.onOpen()}catch(y){console.error("fail to open widget "+a.name+". "+y.stack)}}this.appConfig.mode||this._addDataSourceUsage(a)},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(y){console.log(console.error("fail to maximize widget "+a.name+
". "+y.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(y){console.log(console.error("fail to minimize widget "+a.name+". "+y.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(y){console.log(console.error("fail to normalize widget "+
a.name+". "+y.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(y){console.log(console.error("fail to destroy widget "+a.name+". "+y.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(f.hitch(this,function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var b=g.after(a,"onOpen",function(){b.remove();
c.resolve(a)})}var c=new d,h=this.getWidgetById(a);if(h){if("closed"!==h.state)return c.resolve(h),c;b(h)}else var e=r.subscribe("widgetCreated",f.hitch(this,function(b){b.id===a&&(e.remove(),c.resolve(b))}));r.publish("openWidget",a);return c},_tryLoadWidgetConfig:function(a){var h=new d;if(a.config&&f.isObject(a.config))return h.resolve(a.config),h;if(a.config){if(require.cache["url:"+a.config])return h.resolve(m.parse(require.cache["url:"+a.config])),h;h=b.processUrlInAppConfig(a.config);h=h.split("/");
h[h.length-1]=encodeURIComponent(h[h.length-1]);h=h.join("/");return c(h,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(a,"config").then(function(b){a.isDefaultConfig=!0;return b})},_upgradeWidgetConfig:function(a,c){var h=new d,e=a.manifest.version,g=a.version,t;if(e===g)return h.resolve(c),h;if(!1===a.hasVersionManager)return a.version=e,h.resolve(c),h;require(b.getRequireConfig(),[a.amdFolder+(a.isRemote?"VersionManager.js":"VersionManager")],f.hitch(this,function(b){b=
new b;var m=b.getVersionIndex(g),d=b.getVersionIndex(e);if(m>d)h.reject("Bad widget version number, "+a.name+","+g);else try{t=b.upgrade(c,g,e),a.version=e,h.resolve(t)}catch(L){console.log("Read widget ["+a.name+"] old config error,"+L.stack),h.resolve(c)}}));return h},loadWidgetStyle:function(a){var c=this._getStyleIdFromWidgetJson(a,!1),h=new d;return k.byId(c)?(h.resolve("load"),h):b.loadStyleLink(c,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var c=
this._getStyleIdFromWidgetJson(a,!0),h=new d;return k.byId(c)?(h.resolve("load"),h):b.loadStyleLink(c,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(b.getRequireConfig()).toUrl(a.configFile);if(require.cache["url:"+a]){var h=new d;h.resolve(m.parse(require.cache["url:"+a]));return h}return c(a,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(a){var c=new d;require(b.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){c.resolve(a)});return c},loadWidgetSettingI18n:function(a){var c=
new d;require(b.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){c.resolve(a)});return c},loadWidgetTemplate:function(a){var c=new d;require(b.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){c.resolve(a)});b.checkError(a.templateFile,c);return c},loadWidgetSettingTemplate:function(a){var c=new d;require(b.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){c.resolve(a)});b.checkError(a.settingTemplateFile,c);return c},removeWidgetStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,
!1))},removeWidgetSettingStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!0))},_removeStyle:function(a){if(k.byId(a)){var b=k.attr(a,"data-import-styles");if(b)for(var c=0;c<parseInt(b,10);c++)k.destroy(a+"_import_"+c);k.destroy(a)}},_getStyleIdFromWidgetJson:function(a,b){return this._replaceId("widget/style/"+(a.itemId?a.itemId:a.uri)+(b?"/setting":""))},getControllerWidgets:function(){return n.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return n.filter(this.loaded,
function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return n.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},
_addDataSourceUsage:function(a){n.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){v.getInstance().addDataSourceUsage(b,a.id)})},_removeDataSourceUsage:function(a){n.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){v.getInstance().removeDataSourceUsage(b,a.id)})},_getUsedDataSourceIdFromWidget:function(a){if((a=this.appConfig.getConfigElementById(a.id))&&a.config){var b=m.stringify(a.config);return n.filter(Object.keys(this.appConfig.dataSource.dataSources),function(a){return-1<
b.indexOf(a)},this)}},_mergeAgolConfig:function(a){var c=this.appConfig._appData.values,h="widgets["+a.id+"]",e;for(e in c){var g=e.replace(/\//g,"_").indexOf(h+"_config");0<=g&&b.template.setConfigValue(a,e.replace(/\//g,"_").substr(g,e.length).replace(h,"widget"),c[e])}},_onUserSignIn:function(a){n.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){n.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===
a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&k.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
k.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),r.publish("widgetActived",a))},_onClickWidget:function(a,b){var c=e(".jimu-widget",a.domNode);if(0<c.length)for(var h=0;h<c.length;h++)if(b.target===c[h]||k.isDescendant(b.target,c[h]))return;this._activeWidget(a)},_onMoveStart:function(a){n.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);t.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=
a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,b,c,h){var e=f.clone(a);this.appConfig=e;n.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(e,b,c,h),"widgetChange"===b&&this._onConfigChanged(c.id,c.config,h))},this)},_onConfigChanged:function(a,b){if(a=this.getWidgetById(a))a.onConfigChanged(b),f.mixin(a.config,b)},_onActionTriggered:function(a){if("map"!==a.elementId&&
"app"!==a.elementId){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});n.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;b.setVerticalCenter(a.domNode);g.after(a,"resize",f.hitch(this,b.setVerticalCenter,a.domNode));this.openWidget(a);var c=t.getPortalCredential(this.appConfig.portalUrl);
if(c)a.onSignIn(c);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return n.some(this.loaded,function(b,c){if(b.id===a)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(a,b){var c,h=new d;if("config"===b)c=a.amdFolder+"config.json",a.configFile=c,c="hasConfig";else if("style"===b)c=a.amdFolder+"css/style.css",a.styleFile=c,c="hasStyle";
else if("i18n"===b)c=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?c:a.amdFolder+"nls/strings",c="hasLocale";else if("template"===b)c=a.amdFolder+"Widget.html",a.templateFile=c,c="hasUIFile";else if("settingTemplate"===b)c=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===b)c=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?c:a.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===b)c=a.amdFolder+"setting/css/style.css",
a.settingStyleFile=c,c="hasSettingStyle";else return h;a[c]?function(){var c;if("config"===b)c=this.loadWidgetConfig(a);else if("style"===b)c=this.loadWidgetStyle(a);else if("i18n"===b)c=this.loadWidgetI18n(a);else if("template"===b)c=this.loadWidgetTemplate(a);else if("settingTemplate"===b)c=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)c=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)c=this.loadWidgetSettingI18n(a);else return h;c.then(function(a){h.resolve(a)},function(b){new u({message:window.jimuNls.widgetManager.loadWidgetResourceError+
": "+a.uri});h.reject(b)})}.apply(this):h.resolve(null);return h},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);r.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&
this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});D.getInstance=function(a){null===C&&(C=new D(a),window._widgetManager=C);return C};return D})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u){"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});a={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return t.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=b.getStandardPortalUrl(a))&&
(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var h=new k,e=b.getStandardPortalUrl(a);a=e+"/sharing";var t=b.setHttpsProtocol(e+"/sharing/generateToken?f\x3djson"),d=b.setHttpsProtocol(a);l.get(t,{jsonp:"callback"}).then(q.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(e),this.removeWabAuthCookie(),g.id.getCredential(d).then(q.hitch(this,function(g){function d(a){var b=a.creationTime||(new Date).getTime(),c=a.expires;0<b&&0<c&&c>
b&&setTimeout(function(){l.get(t,{jsonp:"callback"}).then(function(b){b.token&&(a.token=b.token,a.expires=b.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),d(a))},function(a){console.error(a)})},.8*(c-b))}g.token||(g.token=a.token);g.expires||(g.expires=a.expires);var u=c.canUseXhr(g.server,!0);-1<u&&m.defaults.io.corsEnabledServers.splice(u,1);this._pushCorsEnabledServerInfo({host:b.getServerByUrl(e),withCredentials:!0});h.resolve(!0);d(g)}),q.hitch(this,function(){h.resolve(!0)}))):
h.resolve(!1)}),q.hitch(this,function(a){console.error(a);h.reject(a)}));return h},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var h=m.defaults.io.corsEnabledServers,e=b.getServerByUrl(a);(a=b.getServerWithProtocol(a))||(a="http://"+e);a=c.canUseXhr(a,!0);-1<a&&h.splice(a,1);this._pushCorsEnabledServerInfo({host:e,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=
m.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var h in a.host)a[h]="function"===typeof a.host[h]?function(){return a.host[h].apply(a.host,arguments)}:a.host[h];a.length=a.host.length;f.forEach(c,function(b){"function"===
typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}b.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?f.some(g.id.credentials,q.hitch(this,function(b){return a.token===b.token}))?!1:(g.id.credentials.push(a),!0):!1},registerToken:function(a){var c=b.getSharingUrl(this.portalUrl);g.id.findCredential(c)&&f.some(g.id.credentials,q.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return g.id.credentials.splice(b,
1),!0}));return this._getTokenInfo(a).then(function(a){a&&g.id.registerToken(a)})},_getTokenInfo:function(a){var c=b.getPortalSelfInfoUrl(this.portalUrl);return l.get(c+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(q.hitch(this,function(c){return c.user?{server:b.getSharingUrl(this.portalUrl),ssl:c.allSSL,token:a,userId:c.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&
q.trim(a)},signInPortal:function(a){var c=new k;if(this._isInvalidPortalUrl(a)){a=b.getStandardPortalUrl(a);var h=b.getSharingUrl(a),e=this.getPortalCredential(a);e?setTimeout(q.hitch(this,function(){c.resolve(e)}),0):c=g.id.getCredential(h)}else setTimeout(q.hitch(this,function(){c.reject("Invalid portalurl.")}),0);return c},_loadPortalSelfInfo:function(a){a=b.getPortalSelfInfoUrl(a);return e({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||
"string"!==typeof a||!b||"string"!==typeof b)return null;var c=g.id.findOAuthInfo(a);c||(c=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",c=new h({appId:b,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:c}),g.id.registerOAuthInfos([c]));c.appId=b;return c},signOutAll:function(){var a=b.getStandardPortalUrl(this.portalUrl),c=!!g.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():
this.removeWabAuthCookie();g.id.destroyCredentials();g.id._oAuthHash=null;c&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(q.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,c=a.server,h=a.scope,b=b&&"string"===typeof b&&q.trim(b),c=c&&"string"===typeof c&&q.trim(c),h="portal"===h||"server"===h,e=!0;a.expires&&(a=parseInt(a.expires,10),e=(new Date).getTime(),e=a>e);b=b&&c&&h&&e}return b},isValidPortalCredentialOfPortalUrl:function(a,
c){var h=!1;this.isValidCredential(c)&&(h="portal"===c.scope,a=b.isSameServer(a,c.server),h=h&&a);return h},getPortalCredential:function(a){var c=null;a=q.trim(a||"");if(!a)return null;a=b.getStandardPortalUrl(a);(c=this._filterPortalCredential(a,g.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();return c},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=b.getStandardPortalUrl(a),b.isOrgOnline(a)&&!this._filterPortalCredential(a,g.id.credentials))){var c=
this._filterPortalCredential("http://www.arcgis.com",g.id.credentials);c&&g.id.registerToken({token:c.token,scope:"portal",userId:c.userId,server:a+"/sharing/rest",expires:c.expires})}},saveAndRegisterCookieToCredential:function(a){a=q.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;g.id.registerToken(a);return g.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=q.clone(a);var c=1E3*parseInt(a.expires_in,
10),c=(new Date).getTime()+c,h=b.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:h,token:a.access_token,expires:c,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",r.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");
window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,c){var h=null;a=b.getStandardPortalUrl(a);c&&0<c.length&&(c=f.filter(c,q.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)})),0<c.length&&(h=c[c.length-1]));return h},_removePortalCredential:function(a){var c=q.trim(a||"");if(c){c=b.getStandardPortalUrl(c);for(a=f.filter(g.id.credentials,q.hitch(this,
function(a){return this.isValidPortalCredentialOfPortalUrl(c,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);g.id.credentials=f.filter(g.id.credentials,q.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(c,a)}))}},getUserIdByToken:function(a,c){var h=new k;if(a&&"string"===typeof a&&c&&"string"===typeof c){var t=b.getStandardPortalUrl(c);c=f.filter(g.id.credentials,q.hitch(this,function(c){var h=c.token===a&&c.userId;c=b.isSameServer(t,c.server);return h&&c}));if(0<c.length){var m=
c[0];setTimeout(q.hitch(this,function(){h.resolve(m.userId)}),0);return h}c=b.getCommunitySelfUrl(t);e({url:c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){h.resolve(a&&a.username||"")}),q.hitch(this,function(a){console.error(a);h.reject("fail to get userId by token")}))}else setTimeout(q.hitch(this,function(){h.reject("invalid parameters")}),0);return h},xtGetCredentialFromCookie:function(a){var c=d("wab_auth"),h=null;if(c)try{h=r.parse(c)}catch(B){console.error(B)}if(!h||
"object"!==typeof h||!b.isSameServer(a,h.server)||window.location.host!==h.referer)return null;h.expires=parseInt(h.expires,10);c=(new Date).getTime();if(!(h.expires>c))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";h.server=a;(c=g.id.findCredential(a))||g.id.registerToken(h);return c=g.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();t.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return f.map(b,q.hitch(this,function(a,
h){a=b.slice(h,c);var e="",g=a.length-1;f.forEach(a,q.hitch(this,function(a,b){e+=a;b!==g&&(e+=".")}));return e}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{p.publish("userSignIn",a)}catch(C){console.error(C)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{p.publish("anyUserSignIn",a)}catch(C){console.error(C)}},_publishCurrentPortalUserSignOut:function(a){try{p.publish("userSignOut",a)}catch(C){console.error(C)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(C){console.error(C)}},_bindEvents:function(){n.after(g.id,"signIn",q.hitch(this,function(a,b){console.log(b[1]);n.after(a,"callback",q.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b._wab="builder";if(b){g.id=b;var c=window.esriConfig.defaults.io,
a=a.esriConfig.defaults.io;c.corsEnabledServers=a.corsEnabledServers;c.webTierAuthServers=a.webTierAuthServers;c._processedCorsServers=a._processedCorsServers;c.corsStatus=a.corsStatus;Object.defineProperty(u,"id",{get:function(){return b},enumerable:!0,configurable:!0})}}}this._bindEvents();this._started=!0}}};a.startup();return a})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(q,f,n,k){return function(){function d(){}
Object.defineProperty(d,"id",{get:function(){return n.id?k:null},enumerable:!0,configurable:!0});d.workerMessages={};return d}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(q,f,n){Object.defineProperty(f,"__esModule",{value:!0});f.findCredential=function(f){return n.findCredential(f)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(q,f,n,k,d,r){return q(r,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=n.create("div",{"class":"title"},this.domNode),this.titleLabeNode=n.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=n.create("div",
{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(d(this.closeBtnNode,"click",f.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:k.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){n.setStyle(this.domNode,"zIndex",501);n.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){var a=0;return q(e,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();k.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._moveToMiddle()}),50);this.own(r(window,"resize",f.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=k.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=k.create("div",{"class":"title"},this.domNode);this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=k.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?l.press:"click";this.own(r(this.closeBtnNode,
a,f.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=k.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&k.place(this.content,this.contentContainerNode));this.buttonContainer=k.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&k.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var b=k.getContentBox(this.buttonContainer),c=k.getMarginExtents(this.enabledButtons[0]),e=k.getPadBorderExtents(this.enabledButtons[0]),g=0,e=8===p("ie")?e.l+e.r:0,g=(b.w-(c.l+c.r+e)*a)/a;0<g&&(n.forEach(this.enabledButtons,f.hitch(this,
function(a){k.setStyle(a,"maxWidth",g+"px")})),n.forEach(this.disabledButtons,f.hitch(this,function(a){k.setStyle(a,"maxWidth",g+"px")})))}},_moveableNode:function(a,b){this.moveable&&(this.moveable.destroy(),this.moveable=null);var c=k.getMarginBox(this.container);c.l=c.l-a+b;c.w+=2*(a-b);this.moveable=new m.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(r(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(r(this.moveable,
"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===g("#header").length?{t:0,l:0,w:0,h:0}:k.getMarginBox("header")},_getFooterBox:function(){return 0===g(".footer",this.container).length?{t:0,l:0,w:0,h:0}:k.getMarginBox(g(".footer",this.container)[0])},_calculatePosition:function(){var a=k.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,e=0;e=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:
c;c=(c-e)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;k.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(k.setStyle(this.domNode,"height","auto"),k.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(k.setStyle(this.domNode,"height",this.height+"px"),k.addClass(this.contentContainerNode,"content-absolute"),k.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=k.getMarginBox(this.domNode),b=k.getContentBox(this.container),c=this._getHeaderBox(),e=this._getFooterBox(),e=b.h-c.h-e.h-40,g=0,g=a.h||e-200,a=(e-g)/2+c.h+20,a=a<c.h?c.h:a;k.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",a+200+1);k.setStyle(this.overlayNode,"zIndex",a+200);a++},setTitleLabel:function(a){this.titleNode.innerHTML=c.stripHTML(a)},onMoving:function(a){k.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){k.setStyle(a.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,b=f.clone(this.domNode);k.setStyle(this.domNode,"display","none");k.destroy(this.overlayNode);this.destroy();
this.moveable.destroy();k.place(b,a);d.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){k.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=a.classNames.join(" "));var c=k.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(c);
b=k.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+b,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(b);this.own(r(c,"click",f.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,b){"number"===typeof a&&isFinite(a)||(b=a,a=0);if(b&&0!==this.enabledButtons.length)for(var c in b)"title"===c?(k.setAttr(this.enabledButtons[a],"title",b[c]),
k.setAttr(this.disabledButtons[a],"title",b[c])):"label"===c&&(k.setProp(this.enabledButtons[a],"innerHTML",b[c]),k.setProp(this.disabledButtons[a],"innerHTML",b[c]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(k.setStyle(this.enabledButtons[a],"display","inline-block"),k.setStyle(this.disabledButtons[a],"display","none")):(n.forEach(this.enabledButtons[a],f.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),n.forEach(this.disabledButtons[a],
f.hitch(this,function(a){k.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],"display","inline-block"),k.setStyle(this.enabledButtons[a],"display","none")):(n.forEach(this.disabledButtons,f.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),n.forEach(this.enabledButtons,f.hitch(this,function(a){k.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],"display","none"),k.setStyle(this.enabledButtons[a],"display","none")):(n.forEach(this.disabledButtons,f.hitch(this,function(a){k.setStyle(a,"display","none")})),n.forEach(this.enabledButtons,f.hitch(this,function(a){k.setStyle(a,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._positioning();this.content&&this.content.domNode&&this.content.resize&&
this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(q,f,n,k,d,r){k=q("dojo.dnd.move.constrainedMoveable",r,{constraints:function(){},within:!1,constructor:function(d,l){l||(l={});this.constraints=l.constraints;this.within=l.within},onFirstMove:function(d){var l=this.constraintBox=this.constraints.call(this,d);l.r=l.l+l.w;l.b=l.t+l.h;this.within&&(d=f.getMarginSize(d.node),l.r-=d.w,l.b-=d.h)},
onMove:function(d,l){var g=this.constraintBox,m=d.node.style;this.onMoving(d,l);l.l=l.l<g.l?g.l:g.r<l.l?g.r:l.l;l.t=l.t<g.t?g.t:g.b<l.t?g.b:l.t;m.left=l.l+"px";m.top=l.t+"px";this.onMoved(d,l)}});d=q("dojo.dnd.move.boxConstrainedMoveable",k,{box:{},constructor:function(d,l){var g=l&&l.box;this.constraints=function(){return g}}});q=q("dojo.dnd.move.parentConstrainedMoveable",k,{area:"content",constructor:function(d,l){var g=l&&l.area;this.constraints=function(){var m=this.node.parentNode,e=n.getComputedStyle(m),
c=f.getMarginBox(m,e);if("margin"==g)return c;var a=f.getMarginExtents(m,e);c.l+=a.l;c.t+=a.t;c.w-=a.w;c.h-=a.h;if("border"==g)return c;a=f.getBorderExtents(m,e);c.l+=a.l;c.t+=a.t;c.w-=a.w;c.h-=a.h;if("padding"==g)return c;a=f.getPadExtents(m,e);c.l+=a.l;c.t+=a.t;c.w-=a.w;c.h-=a.h;return c}}});return{constrainedMoveable:k,boxConstrainedMoveable:d,parentConstrainedMoveable:q}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b){var t=null,u=q(d,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new e;window.isBuilder?(k.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?
(k.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),k.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(k.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),k.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));k.subscribe("updateDataSourceData",f.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&k.subscribe("app/dataSourceDataUpdated",f.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(a){return this._dataStore[a]},
getDataSourceConfig:function(a){return this.appConfig.dataSource.dataSources[a]},parseDataSourceId:function(a){var b=a.split("~"),c={};if(2>b.length)return console.error("Bad data source id:",a),c;switch(b[0]){case "map":return b=a.lastIndexOf("~"),c={from:"map",layerId:a.substring(4,b)};case "widget":return c={from:"widget",widgetId:b[1]};case "external":return c={from:"external"};default:console.error("Bad data source id:",a)}},addDataSourceUsage:function(a,b){this._dataSourceUsage[a]?(0>this._dataSourceUsage[a].indexOf(b)&&
this._dataSourceUsage[a].push(b),1===this._dataSourceUsage[a].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[a])):(this._dataSourceUsage[a]=[b],this._startOneDataSource(this.appConfig.dataSource.dataSources[a]))},removeDataSourceUsage:function(a,b){this._dataSourceUsage[a]&&0<=this._dataSourceUsage[a].indexOf(b)&&(this._dataSourceUsage[a]=n.filter(this._dataSourceUsage[a],function(a){return a!==b}))},_onUpdataDataSourceData:function(a,b){this.appConfig.dataSource.dataSources[a]?
"widget"!==this.parseDataSourceId(a).from?console.error("Please update data source from widget only.",a):this._updateDataSourceData(a,b):console.error("Not found data source id:",a)},_updateDataSourceData:function(a,b){this._dataStore[a]=b;k.publish("dataSourceDataUpdated",a,b);this.emit("update",a,b)},_onDataSourceDataUpdatedInApp:function(a,b){this._updateDataSourceData(a,b)},_onMapLoaded:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(a){this.appConfig=f.clone(a)},_onAppConfigChanged:function(a,b){a=f.clone(a);window.isBuilder||("dataSourceChange"===b?this._handleDataSourceConfigChange(this.appConfig,a,b):"mapChange"===b&&this._cleanForConfigChangedDataSource(this.appConfig,a));this.appConfig=a},_handleDataSourceConfigChange:function(a,b,c){a&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(a,b));n.forEach(Object.keys(b.dataSource.dataSources),function(a){b.dataSource.dataSources[a].idObj=this.parseDataSourceId(a)},this);this._listenDataSourceChange(b.dataSource.dataSources);this._startRefreshTimer(b.dataSource,c);this._initStaticDataSource(b.dataSource)},_cleanForConfigChangedDataSource:function(a,b){var c=a.dataSource.dataSources,h=b.dataSource.dataSources;n.forEach(Object.keys(c),function(a){if(!h[a]||h[a]&&!p.isEqual(h[a],
c[a]))delete this._jimuQueryObject[a],this._updateDataSourceData(a,{features:[]}),delete this._dataStore[a]},this)},_isGlobalRefresh:function(a){return a.unifiedRefreshInterval&&0<a.unifiedRefreshInterval},_startOneDataSource:function(a){var b;b=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:a.refreshInterval;if("map"===a.idObj.from)this._listenMapDataSourceChange(a);else if("external"===a.idObj.from&&a.filterByExtent){var c={};
c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c)}if("map"===a.idObj.from||"external"===a.idObj.from)this._refeshDataSource(a),a.isDynamic&&(c={},c.handle=setInterval(f.hitch(this,this._refeshDataSource,a),6E4*b),c.dsId=a.id,this._refreshTimers.push(c))},_stopAndCleanOneDataSource:function(a){this._listeners=n.filter(this._listeners,function(b){return b.dsId===a.id?(b.handle.remove(),!1):!0},this);this._refreshTimers=n.filter(this._refreshTimers,
function(b){return b.dsId===a.id?(clearInterval(b.handle),!1):!0},this);this._updateDataSourceData(a.id,{features:[]})},_listenDataSourceChange:function(a){n.forEach(Object.keys(a),function(b){b=a[b];if("map"===b.idObj.from)this._listenMapDataSourceChange(b);else if("external"===b.idObj.from&&b.filterByExtent){var c={};c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,b));c.dsId=b.id;this._listeners.push(c)}},this)},_listenMapDataSourceChange:function(a){this._getLayerObject(a.idObj.layerId).then(f.hitch(this,
function(b){if(b){var c={};c.handle=b.on("edits-complete",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c);c={};c.handle=this._getLayerInfo(a.idObj.layerId).on("filterChanged",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c);a.filterByExtent&&(c={},c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a)),c.dsId=a.id,this._listeners.push(c))}else console.error("Can not find layer that data source depends on.",a.id)}))},_onLayerDataChange:function(a){this._doQueryForDataSource(a)},
_doQueryForDataSource:function(a){("config"===this.appConfig.mode||this._dataSourceUsage[a.id]&&0!==this._dataSourceUsage[a.id].length)&&this.doQuery(a).then(f.hitch(this,function(b){this._updateDataSourceData(a.id,{features:b.features})}))},_getLayerObject:function(a){return(a=l.getInstanceSync().getLayerOrTableInfoById(a))?a.getLayerObject():r(null)},_getLayerInfo:function(a){return l.getInstanceSync().getLayerOrTableInfoById(a)},_startRefreshTimer:function(a,b){var c=a.dataSources,h=a.settings;
n.forEach(Object.keys(c),function(e){e=c[e];if("widget"!==e.idObj.from&&e.isDynamic&&e.url){var g;g=this._isGlobalRefresh(h)?h.unifiedRefreshInterval:e.refreshInterval;"dataSourceChange"===b?"external"!==e.idObj.from&&"map"!==e.idObj.from||this._refeshDataSource(e):"external"===e.idObj.from&&this._refeshDataSource(e);e={handle:setInterval(f.hitch(this,this._refeshDataSource,e),6E4*g),dsId:a.id};this._refreshTimers.push(e)}},this)},_initStaticDataSource:function(a){n.forEach(Object.keys(a.dataSources),
function(b){b=a.dataSources[b];"widget"!==b.idObj.from&&!b.isDynamic&&b.url&&this._doQueryForDataSource(b)},this)},_refeshDataSource:function(a){this._doQueryForDataSource(a)},_getDataSourceFilter:function(a){if("map"===a.idObj.from){var b=l.getInstanceSync().getLayerOrTableInfoById(a.idObj.layerId),c;b&&(c=b.getFilter());var b=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1",h;h=c?"("+c+") and ("+b+")":b;return r(h)}return"external"===a.idObj.from?a.portalUrl&&a.itemId?this._getFilterFromItem(a.portalUrl,
a.itemId,a.url).then(f.hitch(this,function(b){var c=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1";return h=b?"("+b+") and ("+c+")":c})):r(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1"):r(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1")},_getFilterExpr:function(a,b){return this.filterUtils.hasVirtualDate(a)?(this.filterUtils.isHosted=p.isHostedService(b),this.filterUtils.getExprByFilterObj(a)):a.expr},_getFilterFromItem:function(a,b,c){var h=m.getItemUrl(a,b);if(this._itemsFilter[h])return r(this._itemsFilter[h]);
var e=g.getPortal(a);return e.getItemById(b).then(f.hitch(this,function(a){return"Feature Service"!==a.type?this._itemsFilter[h]=null:e.getItemData(b).then(f.hitch(this,function(a){var b=c.split("/"),e=b.pop();e||(e=b.pop());if(!a.layers)return this._itemsFilter[h]=null;a=a.layers.filter(function(a){return a.id+""===e})[0];return a&&a.layerDefinition?this._itemsFilter[h]=a.layerDefinition.definitionExpression:this._itemsFilter[h]=null}))}))},doQuery:function(e){e.idObj||(e.idObj=this.parseDataSourceId(e.id));
this.emit("begin-update",e.id);return this._getQueryObjectFromDataSource(e).then(f.hitch(this,function(g){var t,m;if("Features"===e.type){if("serviceLimitation"===e.resultRecordType)return t=g,m=new a(e.url),m.execute(t);var d=this._jimuQueryObject[e.id];!d||d.url===e.url&&p.isEqual(d.query.toJson(),g.toJson())||(delete this._jimuQueryObject[e.id],d=null);d||(d={},d.url=e.url,d.query=g,"all"!==e.resultRecordType&&(d.pageSize=e.resultRecordCount),d=new b(d),this._jimuQueryObject[e.id]=d);return"all"===
e.resultRecordType?d.getAllFeatures():d.queryByPage(1)}m=new a(e.url);t=new c;return this._getDataSourceFilter(e).then(f.hitch(this,function(a){t.where=a;e.filterByExtent&&(t.geometry=this.map.extent);e.dataSchema.groupByFields&&0<e.dataSchema.groupByFields.length&&(t.groupByFieldsForStatistics=e.dataSchema.groupByFields);e.dataSchema.orderByFields&&0<e.dataSchema.orderByFields.length&&(t.orderByFields=e.dataSchema.orderByFields);t.outStatistics=e.dataSchema.statistics.map(function(a){var b=a.onStatisticField+
"_"+a.statisticType;"count"===a.statisticType&&(b="STAT_COUNT");var b=p.upperCaseString(b),c=new h;c.statisticType=a.statisticType;c.onStatisticField=a.onStatisticField;c.outStatisticFieldName=b;return c});return m.execute(t)}))}))},_getQueryObjectFromDataSource:function(a){return this._getDataSourceFilter(a).then(f.hitch(this,function(b){var h=new c;h.where=b;a.filterByExtent&&(h.geometry=this.map.extent);h.outFields=a.dataSchema.fields.map(function(a){return a.name});a.dataSchema.orderByFields&&
0<a.dataSchema.orderByFields.length&&(h.orderByFields=a.dataSchema.orderByFields);h.returnGeometry=!0;h.outSpatialReference=this.map.spatialReference;return r(h)}))},_removeListeners:function(){this._listeners.forEach(f.hitch(this,function(a){a.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(f.hitch(this,function(a){clearInterval(a.handle)}));this._refreshTimers=[]}});u.getInstance=function(){null===t&&(t=new u,window._datasourceManager=t);return t};return u})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(q,f,n,k,d,r,p,l,g){var m=q([p],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,constructor:function(a,c){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=
[];this._basemapLayers=c.baseMap.baseMapLayers;this._operLayers=c.operationalLayers;this._tables=c.tables;this._layerInfoFactory=new g(a,this);this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._finalLayerInfos);this._initFinalLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getLayerInfoArray(),function(c){for(var b=0;b<this._operLayers.length;b++)if(c.id===
this._operLayers[b].id){a.push(c);break}b===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(c.id)&&a.push(c)},this);return a},getTableInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getTableInfoArray(),function(c){for(var b=0;b<this._tables.length;b++)if(c.id===this._tables[b].id){a.push(c);break}},this);return a},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(a){n.getObject("_wabProperties.isTemporaryLayer",!1,a.layerObject)&&(a._flag._isTemporaryLayerInfo=
!0);return!a._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},addFeatureCollection:function(a,c){var b=this._getUniqueTopLayerInfoId(c),h={layers:[]};f.forEach(a,function(a,c){a.id=b+"_"+c;h.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var e;try{e=this._layerInfoFactory.create({featureCollection:h,title:c||b,id:b},this.map),e.init()}catch(v){console.warn(v.message),e=null}e&&(e._extraOfWebmapLayerInfo=!0,this._layerInfos.push(e),this.update(),
this._onLayersUpdated(e,e.getRootLayerInfo()))},addTable:function(a){a=this._addTables([a],this._tableInfos);return a[0]?a[0]:null},removeTable:function(a){var c=-1;f.forEach(this._tableInfos,function(b,h){a.id===b.id&&(c=h)});if(0<=c){var b=this._tableInfos[c];this._tableInfos.splice(c,1);b.destroy();this._onTableChange([a],m.REMOVED)}},_addTables:function(a,c){var b=[],h=[];f.forEach(a,function(a){var e;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),
a.selfType="table",e=this._layerInfoFactory.create(a),e.init()}catch(C){console.warn(C.message),e=null}e&&(b.push(e),c.push(e),h.push(e.getLayerObject()))},this);l(h).then(n.hitch(this,function(a){var c=[];f.forEach(a,function(a,h){h=b[h];a?c.push(h):(this.removeTable(h),h.destroy())},this);this._onTableChange(c,m.ADDED)}));return b},_getUniqueTableId:function(a){var c=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(a,c)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,
this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,c){var b=1,h;a||(a="table");for(h=a;;){for(var e=0;e<c.length&&c[e].id!==h;e++);if(e===c.length)return h;h=a+"_"+b.toString();b++}},_traversal:function(a,c){for(var b=0;b<c.length;b++)if(c[b].traversal(a))return!0;return!1},traversal:function(a){var c=this.getLayerInfoArray();return this._traversal(a,c)},traversalLayerInfosOfWebmap:function(a){var c=this.getLayerInfoArrayOfWebmap();return this._traversal(a,c)},traversalAll:function(a){var c=
this.getLayerInfoArray(),b=this.getTableInfoArray();return this._traversal(a,c.concat(b))},_traversalAllWithSpecialLayerInfo:function(a){return this._traversal(a,this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var c=null;f.some(this.getTableInfoArray(),function(b){if(b.id===a)return c=b,!0});return c},getLayerOrTableInfoById:function(a){var c=null;this.traversalAll(function(b){if(b.id===a)return c=b,!0});
return c},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},moveUpLayer:function(a,c){var b=null;c=c?c:1;a=this._getTopLayerInfoIndexById(a.id);0<=a-c&&(b=this._finalLayerInfos[a-c].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveLayerByIndex(this._finalLayerInfos[a-c].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[a-c],r.publish("layerInfos/layerReorder",a,c,"moveup"));return b},_reorderLayerInfosArray:function(a,c,b){"moveup"===b?(b=this._finalLayerInfos[a],
this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-c,0,b)):(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+c+1,0,b),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode();return b},moveDownLayer:function(a,c){var b=null;c=c?c:1;a=this._getTopLayerInfoIndexById(a.id);a+c<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[a].moveLayerByIndex(this._finalLayerInfos[a+c].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[a+c],r.publish("layerInfos/layerReorder",
a,c,"movedown"));return b},getBasemapLayers:function(){var a=[];f.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(c){c=this.map.getLayer(c);"basemap"!==c._basemapGalleryLayerType&&"reference"!==c._basemapGalleryLayerType||a.push(c)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var c=a&&a.layerOptions?a.layerOptions:
null;f.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(c)},this)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},getObjectId:function(){return this._objectId},_initLayerInfos:function(){var a;this._layerInfos=[];f.forEach(this._operLayers,function(c){try{a=this._layerInfoFactory.create(c),a.init()}catch(b){console.warn(b.message),a=null,this._unreachableLayersTitleOfWebmap.push(c.title)}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=
[];f.forEach(this._finalLayerInfos||this._layerInfos,function(a,c){var b;if(a._needToRenew()){try{b=this._layerInfoFactory.create(a.originOperLayer),b.init()}catch(u){console.warn(u.message),b=null}b&&(a.destroy(),this._finalLayerInfos[c]=b)}else if(a.originOperLayer.featureCollection){var h=[];f.forEach(a.getSubLayers(),function(a){h.push(a.id)});f.forEach(h,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(c=a.getSubLayers()[0],this.map.getLayer(c.id).title=
a.title,a.removeSubLayerById(c.id),this._removedLayerInfoIdsFromFeatureCollection.push(c.id),a.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=f.filter(this._finalLayerInfos,function(a){return!a._flag._invalid}))},_initFinalLayerInfos:function(){var a,c,b=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(a=this.map.graphicsLayerIds.length-1;0<=a;a--)c=this.map.graphicsLayerIds[a],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,
b),c,!0);for(a=this.map.layerIds.length-1;0<=a;a--)c=this.map.layerIds[a],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,b),c,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var a=this._tables&&this._tables.reverse();a&&this._addTables(a,this._tableInfos)},_isBasemap:function(a){for(var c=!1,b=this.getBasemapLayers(),e=0;e<b.length;e++)b[e].id===a&&(c=!0);return c},_addToFinalLayerInfos:function(a,c,b){var h;if(a)a._addedFlag||
a.isGraphicLayer()!==b||(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"esri.layers.LabelLayer"!==a.declaredClass){try{var e={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};n.mixin(e,n.getObject("_wabProperties.originOperLayer",!1,a));h=this._layerInfoFactory.create(e,this.map);h.init()}catch(v){console.warn(v.message),h=null}h&&(n.getObject("_wabProperties.isTemporaryLayer",!1,a)&&(h._flag._isTemporaryLayerInfo=
!0),this._finalLayerInfos.push(h))}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&h&&h._getServiceDefinition().then(n.hitch(this,function(a){var b=[];f.forEach(a.tables,function(a){a.url=h.getUrl()+"/"+a.id;a.id=h.id+"_"+a.id;a.title=this._getLayerTitle(a);b.push(a)},this);this._addTables(b,this._tableInfos)}))}},_getLayerTitle:function(a){if(a.title)return a.title;if(n.getObject("_wabProperties.originalLayerName",!1,a))return a.name||
a.id;var c=a.label||a.name||"";if(a.url){var b;b=a.url.indexOf("/FeatureServer");-1===b&&(b=a.url.indexOf("/MapServer"));-1===b&&(b=a.url.indexOf("/service"));-1<b&&(b=a.url.substring(0,b),b=b.substring(b.lastIndexOf("/")+1,b.length),c=c?b+" - "+c:b)}return c||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,c){var b,h=null;c||(c=this._finalLayerInfos);for(b=0;b<c.length;b++)if(h=c[b].findLayerInfoById(a)){h=c[b];break}return h},_findLayerInfoById:function(a,c){var b,h=null;c||(c=this._finalLayerInfos);
for(b=0;b<c.length&&!(h=c[b].findLayerInfoById(a));b++);return h},_findTopLayerInfoById:function(a){var c,b=null,e=this._finalLayerInfos.concat(this._tableInfos);for(c=0;c<e.length;c++)if(e[c].id===a){b=e[c];break}return b},_getTopLayerInfoIndexById:function(a){var c,b=-1;for(c=0;c<this._finalLayerInfos.length;c++)if(this._finalLayerInfos[c].id===a){b=c;break}return b},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=
0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,c,b){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(b,n.hitch(this,
function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var c;for(c=this._basemapLayers.length=0;c<a.layers.length;c++)this._basemapLayers.push({layerObject:a.layer[c],id:a.layers[c].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,n.hitch(this,function(a){a.destroy()}))},_bindEvents:function(){var a,c,b,e,g,l,f,p,k;a=d(this.map,"layer-add-result",n.hitch(this,this._onLayersChange,m.ADDED));
c=d(this.map,"layer-remove",n.hitch(this,this._onLayersChange,m.REMOVED));f=r.subscribe("layerInfos/layerReorder",n.hitch(this,this._onLayerReorder));e=r.subscribe("layerInfos/layerInfo/isShowInMapChanged",n.hitch(this,this._onShowInMapChanged));g=r.subscribe("layerInfos/layerInfo/visibleChanged",n.hitch(this,this._onVisibleChanged));l=r.subscribe("layerInfos/layerInfo/filterChanged",n.hitch(this,this._onFilterChanged));p=r.subscribe("layerInfos/layerInfo/rendererChanged",n.hitch(this,this._onRendererChanged));
k=r.subscribe("layerInfos/layerInfo/opacityChanged",n.hitch(this,this._onOpacityChanged));b=d(this.map,"before-unload",n.hitch(this,function(){a.remove();c.remove();f.remove();e.remove();g.remove();l.remove();p.remove();b.remove();k.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(a){console.warn(a)}},_emitEventForEveryLayerInfo:function(a,c){try{f.forEach(c,function(b){b.emitEvent(a)},this)}catch(b){console.warn(b)}},_onLayersChange:function(a,
c){var b=null;c.error||"esri.layers.GraphicsLayer"===c.layer.declaredClass||"esri.layers.LabelLayer"===c.layer.declaredClass||c.layer._basemapGalleryLayerType||(a===m.ADDED?(this.update(),b=a=this._findLayerInfoById(c.layer.id),c=m.ADDED,a&&!a.isRootLayer()&&(b=a.getRootLayerInfo(),c=m.SUBLAYER_ADDED)):(b=a=this._findLayerInfoById(c.layer.id),c=m.REMOVED,a&&!a.isRootLayer()&&(b=a.getRootLayerInfo(),c=m.SUBLAYER_REMOVED),a&&a.destroy(),this.update()),b&&this._emitEvent("layerInfosChanged",b,c,a))},
_onTableChange:function(a,c){this._emitEvent("tableInfosChanged",a,c,a)},_onLayersUpdated:function(a,c){a.isTable?this._emitEvent("tableInfosChanged",[a],m.UPDATED,[c]):this._emitEvent("layerInfosChanged",a,m.UPDATED,c)},_onShowInMapChanged:function(a){this._emitEvent("layerInfosIsShowInMapChanged",a);this._emitEventForEveryLayerInfo("isShowInMapChanged",a)},_onVisibleChanged:function(a){this._emitEvent("layerInfosIsVisibleChanged",a);this._emitEventForEveryLayerInfo("isVisibleChanged",a)},_onFilterChanged:function(a){this._emitEvent("layerInfosFilterChanged",
a);this._emitEventForEveryLayerInfo("filterChanged",a)},_onLayerReorder:function(a,c,b){a=this._reorderLayerInfosArray(a,c,b);this._emitEvent("layerInfosReorder",a,m.REORDERED,a)},_onRendererChanged:function(a){this._emitEvent("layerInfosRendererChanged",a);this._emitEventForEveryLayerInfo("rendererChanged",a)},_onOpacityChanged:function(a){this._emitEvent("layerInfosOpacityChanged",a);this._emitEventForEveryLayerInfo("opacityChanged",a)}});m.getLayerInfoArrayByType=function(a,c){var b=new k,e=[],
h=[];m.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;e.push(b)});l(e).then(function(a){f.forEach(a,function(a,b){c===a&&h.push(e[b].layerInfo)});b.resolve(h)})});return b};var e=null,c=null;m.getInstance=function(a,c){var b=new k;b.resolve(m.getInstanceSyncForInit(a,c));return b};m.getInstanceSyncForInit=function(a,h){e&&e!==a&&(c=e=null);c||(c=new m(a,h.itemData),e=a);return c};m.getInstanceSync=function(){return c};m.setInstance=function(a,
h){e=a;c=h};m.createInstance=function(a){var c=null;return c=new m(a,a.itemInfo.itemData)};n.mixin(m,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return m})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){return q(null,{constructor:function(a,c){this.map=a;this.layerInfos=c},create:function(b){var t=null;if(b.featureCollection)t=new f(b,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===b.layerObject.declaredClass)t=new k(b,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===b.layerObject.declaredClass)t=new d(b,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==b.layerObject.declaredClass||b.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
b.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.layerObject.declaredClass)t=new n(b,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===b.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.layerObject.declaredClass)t=new c(b,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===b.layerObject.declaredClass)t=new a(b,this.map,this,this.layerInfos);else switch("Table"===b.layerObject.type&&(b.selfType="table"),
b.selfType){case "mapservice_dynamic_group":case "mapservice_dynamic":t=new l(b,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":t=new g(b,this.map,this,this.layerInfos);break;case "wms":t=new m(b,this.map,this,this.layerInfos);break;case "kml":t=new h(b,this.map,this,this.layerInfos);break;case "table":t=new e(b,this.map,this,this.layerInfos);break;default:t=new r(b,this.map,this,this.layerInfos)}else t=new p(b,this.map,this,this.layerInfos);return t}})})},
"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang ./LayerInfo".split(" "),function(q,f,n,k,d,r){return q(r,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var d=null,l=[];f.forEach(this.getSubLayers(),function(g){l.push(g._getExtent())},this);return k(l).then(n.hitch(this,function(g){f.forEach(g,function(g){g&&(d=
d?d.union(g):g)},this);return d}))},_resetLayerObjectVisiblity:function(d){var l=d?d[this.id]:null;if(l){var g={},m;for(m in d)d.hasOwnProperty(m)&&"function"!==typeof d[m]&&(g[m]=d[m].visible);this._setSubLayerVisibleByCheckedInfo(g);this._setTopLayerVisible(l.visible)}},_setSubLayerVisibleByCheckedInfo:function(p){f.forEach(this.newSubLayers,function(l){d.isDefined(p[l.id])&&l.layerObject.setVisibility(p[l.id])},this)},_initVisible:function(){var d=!1,l;for(l=0;l<this.newSubLayers.length;l++)d=
d||this.newSubLayers[l].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;f.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var d=[];f.forEach(this.originOperLayer.featureCollection.layers,function(l){this._getLayerIndexesInMapByLayerId(l.layerObject.id)&&(n.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,l.layerObject),
l=this._layerInfoFactory.create({layerObject:l.layerObject,title:l.layerObject.label||l.layerObject.title||l.layerObject.name||l.layerObject.id||" ",id:l.id||"-",subId:l.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),d.push(l),l.init())},this);d.reverse();return d},_obtainLayerIndexesInMap:function(){var d=[],l,g;for(g=0;g<this.newSubLayers.length;g++)(l=this._getLayerIndexesInMapByLayerId(this.newSubLayers[g].layerObject.id))&&d.push(l);return d},moveLeftOfIndex:function(d){var l;
for(l=this.newSubLayers.length-1;0<=l;l--)this.map.reorderLayer(this.newSubLayers[l].layerObject,d)},moveRightOfIndex:function(d){var l;for(l=0;l<this.newSubLayers.length;l++)this.map.reorderLayer(this.newSubLayers[l].layerObject,d)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var d=this.getSubLayers();return d[0]?d[0].getScaleRange():{minScale:0,maxScale:0}}})})},
"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils ./RequestBuffer esri/kernel esri/request".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u){var v=q([g],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,
parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(b,c,e,h){this.originOperLayer=b;this.layerObject=b.layerObject;this.map=c;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=b.parentLayerInfo?b.parentLayerInfo:
null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=e;this._layerInfos=h;this._flag={};this._objectId=Math.random();this._adaptor=new a(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=
new b(n.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getObjectId:function(){return this._objectId},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},
setOpacity:function(a){f.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=null,c=0;if(this.id&&this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},
_setTopLayerVisible:function(a){},_setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer()&&b&&this._resetLayerObjectVisiblity(a)},_initVisible:function(){},isVisible:function(){return this._visible?!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&
a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,index:b};return null},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];
this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});p.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){p.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var a={};this.isRootLayer()&&this.traversal(function(b){b.isRootLayer()||(a[b.subId]=b)});this._subLayerInfoIndex=a},_getLayerInfosObj:function(){return this._layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return r.create("div",{"class":"legends-div"})},
drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},_needToRenew:function(){return!1},_getServiceDefinition:function(){var a=new k;a.resolve(null);return a},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},
_normalRequest:function(a,b,c){return u({url:a,content:b,handleAs:c,callbackParamName:"callback"})},getLayerObject:function(){var a=new k;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var a=0,b=this;b.parentLayerInfo;)a++,
b=b.parentLayerInfo;return a},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new k;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var a=this.getInfoTemplate(),
b=null;a&&(b=a.info);return b},loadPopupInfo:function(){var a=new k;this.loadInfoTemplate().then(n.hitch(this,function(b){var c=null;b&&(c=b.info);a.resolve(c)}));return a},loadInfoTemplate:function(){var a=new k;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=
this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new k,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),e=this.getLayerObject();d({type:c,layerObject:e}).then(n.hitch(this,function(c){var e=c.type;c=c.layerObject;b.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(b.isSupportedLayer=!0);if(!c)b.isSupportQuery=
!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=!1;else if(!c.url||c.capabilities&&c.capabilities.indexOf&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(a){a=new k;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];f.forEach(this.newSubLayers,function(c){c.id!==a?b.push(c):c.destroy()});this.newSubLayers=b},releaseResource:function(){f.forEach(this._eventHandles,
function(a){a.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?
!0:!1},_getExtent:function(){var a=new k;a.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return a},getExtent:function(){var a=new k;this._getExtent().then(n.hitch(this,function(b){h.projectToMapSpatialReference(this.map,b).then(n.hitch(this,function(b){a.resolve(b)}),n.hitch(this,function(){a.resolve(null)}))}),n.hitch(this,function(){a.resolve(null)}));return a},zoomTo:function(a){return a?h.projectToMapSpatialReference(this.map,a).then(n.hitch(this,function(a){return this._zoomTo(a)})):
this.getExtent().then(n.hitch(this,function(a){return this._zoomTo(a)}))},_zoomTo:function(a){if(h.isValidExtent(a)){a=n.clone(a);var b=this.getLayerScaleRange(),c=b.minScale,b=b.maxScale;if(a.isSinglePoint){if(c=h.getTargetScale(this.map,3,c,b))a=h.adjustHeightToAspectRatio(this.map,a),a=h.getExtentForScale(a,this.map.width,c),this.map.setExtent(a)}else{a=h.adjustExtentToAspectRatio(this.map,a);var e=h.getScaleForExtent(a,this.map.width);0<c&&e>c?(c=h.getScaleForNextTileLevel(this.map,c,!0),a=h.adjustHeightToAspectRatio(this.map,
a),a=h.getExtentForScale(a,this.map.width,c),this.map.setExtent(a)):e<b?(b=h.getScaleForNextTileLevel(this.map,b,!1),a=h.adjustHeightToAspectRatio(this.map,a),a=h.getExtentForScale(a,this.map.width,b),this.map.setExtent(a)):this.map.setExtent(a,!0)}}},mergeScale:function(a,b,c,e){var h=0,g=0;0===a&&0<c?h=c:0<a&&0===c?h=a:0<a&&0<c&&(h=Math.min(a,c));g=Math.max(b,e);return{minScale:h,maxScale:g}},unionScale:function(a,b,c,e){var h=0,g=0,h=0===a||0===c?0:Math.max(a,c),g=Math.min(b,e);return{minScale:h,
maxScale:g}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},getLayerScaleRange:function(){var a,b=this.getScaleRange();this.traversal(n.hitch(this,function(b){b.id!==this.id&&(b=b.getScaleRange(),a=a?this.unionScale(a.minScale,a.maxScale,b.minScale,b.maxScale):b)}));return a?this.mergeScale(b.minScale,b.maxScale,a.minScale,a.maxScale):b},isCurrentScaleInTheScaleRange:function(){var a=
this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>=b)&&(0===a.maxScale||b>=a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var a=
new k,b=this.getUrl()+"?f\x3djson";b?("https"===e.getProtocol(window.location.href)&&(b=e.setHttpsProtocol(b)),m.get(b,{jsonp:"callback"}).then(n.hitch(this,function(b){b&&b.error?a.resolve(!1):a.resolve(!0)}),n.hitch(this,function(){a.resolve(!1)}))):a.resolve(!0);return a},isEditable:function(){var a=!1,b=!0,e=c.getPortal(window.portalUrl),h=this.isPublicService(),g=new k,m=new k;e.getUser().then(n.hitch(this,function(a){m.resolve(a)}),n.hitch(this,function(){m.resolve(null)}));d({user:m,isPublicService:h}).then(n.hitch(this,
function(c){var e=c.user&&c.user.privileges;c=c.isPublicService;e&&-1===f.indexOf(e,"features:user:edit")&&t.id&&!c&&(b=!1);a=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&b?!0:!1:!1;g.resolve(a)}),n.hitch(this,function(){g.resolve(!1)}));return g},_getBasicItemInfo:function(){var a=null,b=this.getRootLayerInfo(),c=window.appConfig||window.getAppConfig(),h=n.getObject("_wabProperties.itemLayerInfo",!1,b.layerObject);b.originOperLayer.itemId?(a={},a.itemId=b.originOperLayer.itemId,
a.portalUrl=e.getStandardPortalUrl(c.map.portalUrl||c.portalUrl)):h&&h.portalUrl&&h.itemId&&(a={},a.itemId=h.itemId,a.portalUrl=e.getStandardPortalUrl(h.portalUrl));return a},getItemInfo:function(){var a=new k,b=this.getRootLayerInfo();b.isItemLayer()?(b._itemInfo||(b._itemInfo=new v.ItemInfo(this,b)),b._itemInfo.onLoad().then(n.hitch(this,function(){a.resolve(b._itemInfo)}),n.hitch(this,function(){a.resolve(null)}))):a.resolve(null);return a},isHostedService:function(){var a=new k;this._getServiceDefinition().then(n.hitch(this,
function(b){a.resolve(b&&b.serviceItemId?!0:!1)}));return a},isHostedLayer:function(){var a;this.isItemLayer()?a=this.isHostedService():(a=new k,a.resolve(!1));return a},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,
arguments)}catch(C){console.error(C)}},_bindEvent:function(){var a;this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",n.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(a),a=l.after(this.layerObject,"setDefinitionExpression",n.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),a=l.after(this.layerObject,"setRenderer",n.hitch(this,this._onRendererChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.layerObject.on("opacity-change",
n.hitch(this,this._onOpacityChanged)),this._eventHandles.push(a)))},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),b=b?b:null;a!==b&&(p.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=b)},_onRendererChanged:function(){p.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){p.publish("layerInfos/layerInfo/opacityChanged",
[this])}});v.ItemInfo=q(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,constructor:function(a,b){this._currentLayerInfo=a;this._rootLayerInfo=b;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new k;var a=this._rootLayerInfo.isItemLayer();if(a){this._portalUrl=a.portalUrl;this._itemId=a.itemId;var b=c.getPortal(this._portalUrl),a=b.getItemById(this._itemId),b=b.getItemData(this._itemId),
e=this._currentLayerInfo._getServiceDefinition();d({item:a,itemData:b,serviceDefinition:e}).then(n.hitch(this,function(a){this._item=a.item;this._itemData=a.itemData;this._serviceDefinition=a.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),n.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},
getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&this._serviceDefinition.serviceItemId?!0:!1}});return v})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){var b=
q([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=c.getStandardPortalUrl(a);this.selfUrl=c.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=this.selfUrl;this.isValidCredential()&&(a=-1<a.indexOf("?")?a+("\x26token\x3d"+this.credential.token):a+("?token\x3d"+this.credential.token));return h.getInstance().getServiceDefinition(a).then(f.hitch(this,function(a){var b=a.user;delete a.user;f.mixin(this,a);a.user=
b;return a}))},_checkCredential:function(){var b=a.isValidCredential(this.credential);b||this.clearCredentialAndUser();return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=a.getPortalCredential(this.portalUrl))},signIn:function(){var b=new d;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){b.resolve(this.credential)}),0):b=a.signInPortal(this.portalUrl);
return b},haveSignIn:function(){return a.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var b=new d;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();b.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(a){this.user=a;b.resolve(this.user)}),f.hitch(this,
function(a){console.error(a);b.reject(a)})):a.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(f.hitch(this,function(a){this.user=a;b.resolve(this.user)}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("credential is null.")}),0);return b},queryItems:function(a){this.updateCredential();
var b=new d,e=c.getBaseSearchUrl(this.portalUrl),h={f:"json"};a&&(h=f.mixin(h,a));this.isValidCredential()&&(h.token=this.credential.token);h.sortField||h.sortOrder||(h.sortField="title",h.sortOrder="asc");g({url:e,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=n.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));
return b},getItemData:function(a){this.updateCredential();a={url:c.getItemDataUrl(this.portalUrl,a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return g(a)},_getItemById:function(a,b){a={url:c.getItemUrl(this.portalUrl,a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};b&&(a.content.token=b);return g(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}))},getItemById:function(a,b){this.updateCredential();
return this._getItemById(a).then(f.hitch(this,function(c){return b&&c.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===c.owner?this._getItemById(a,this.credential.token):c}))},getAppById:function(a){var b=new d;this.updateCredential();this.isValidCredential()?(a=c.getAppIdUrl(this.portalUrl,a),b=g({url:a,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},queryGroups:function(a){this.updateCredential();
var b=new d,e=c.getBaseGroupUrl(this.portalUrl),h={f:"json"};a&&(h=f.mixin(h,a));this.isValidCredential()&&(h.token=this.credential.token);g({url:e,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=n.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},registerApp:function(a,b,e){var h=new d;this.updateCredential();
if(this.isValidCredential())var t=this.credential&&this.credential.token,m=c.getOAuth2Url(this.portalUrl),h=g({url:m+"/registerApp",content:{itemId:a,appType:b,redirect_uris:p.stringify(e),token:t,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},createAndRegisterApp:function(a){var b=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",
type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(a){this.updateCredential();
var b=new d;a={url:c.getUserUrl(this.portalUrl,a),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential&&this.credential.token);g(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new t(a);b.resolve(this.user)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b}}),t=q([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&
f.mixin(this,a)},_checkCredential:function(){var b=a.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new m({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateItem()},
getGroups:function(){var a=[];this.groups&&(a=n.map(this.groups,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new u(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a={url:c.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};
this.isValidCredential&&(a.content.token=this.credential.token);return g(a)},getTags:function(){this.updateCredential();var a={url:c.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential.token);return g(a)},addItem:function(a,b){this.updateCredential();var e=new d;if(this.isValidCredential()){var h={f:"json",token:this.credential.token};a&&(h=f.mixin(h,a));g({url:c.getAddItemUrl(this.portalUrl,
this.username,b),handleAs:"json",callbackParamName:"callback",content:h},{usePost:!0}).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){console.error(a);e.reject(a)}))}else setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},deleteItem:function(a){this.updateCredential();var b=new d;this.isValidCredential()?(a=c.getDeleteItemUrl(this.portalUrl,this.username,a),b=g({url:a,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,
function(){b.reject("token is null.")}),0);return b},getItemById:function(a,b){this.updateCredential();var e=new d;a={url:c.getUserItemsUrl(this.portalUrl,this.username,b)+"/"+a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};g(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new v(a);e.resolve(a)}),f.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItem:function(a,b,e){this.updateCredential();var h=new d;
this.isValidCredential()?(b={url:c.shareItemUrl(this.portalUrl,this.username,b,e),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},a&&(b.content=f.mixin(b.content,a)),g(b,{usePost:!0}).then(f.hitch(this,function(a){h.resolve(a)}),f.hitch(this,function(a){console.error(a);h.reject(a)}))):setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},updateItem:function(a,b){this.updateCredential();var e=new d;this.isValidCredential()?this.portal.getItemById(a).then(f.hitch(this,
function(h){var t={f:"json",token:this.credential.token};b&&(t=f.mixin(t,b));g({url:c.getUpdateItemUrl(this.portalUrl,h.owner,a,h.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:t},{usePost:!0}).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){console.error(a);e.reject(a)}))}),f.hitch(this,function(a){console.error(a);e.reject(a)})):setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(a,b){var e=new d;this.updateCredential();b=c.getUserItemsUrl(this.portalUrl,this.username,b);return e=g({url:b+"/"+a+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(a,
b){var e=new d;this.updateCredential();b=c.getUserItemsUrl(this.portalUrl,this.username,b);return e=l(b+"/"+a+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),u=q([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var b=a.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=q([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&f.mixin(this,a);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var b=a.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var a={url:c.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential.token);return g(a)}}),C={portals:[],webMapQueryStr:" "+
e.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+e.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var b=0;b<this.portals.length;b++){var e=this.portals[b];if(c.isSamePortalUrl(a,e.portalUrl))return e.updateCredential(),e}return null},getPortal:function(e){if(!e||"string"!==typeof e||!f.trim(e))return null;e=c.getStandardPortalUrl(e);var h=this._findPortal(e);h||(h=new b(e),h.credential=a.getPortalCredential(h.portalUrl),h.updateCredential(),this.portals.push(h));
return h},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",c="",e=new d;this.getPortal(a).getUser().then(f.hitch(this,function(a){a&&a.units?b=a.units:(c=k.locale,b=c.startWith("en")?"english":"metric");e.resolve(b)}),f.hitch(this,function(h){console.warn(h);
this.getPortalSelfInfo(a).then(f.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(c=a&&a.culture||k.locale,b=c.startWith("en")?"english":"metric");e.resolve(b)}),f.hitch(this,function(a){console.warn(a);c=k.locale;b=c.startWith("en")?"english":"metric";e.resolve(b)}))}));return e.promise},_getPortalSelfGroup:function(a,b){var c=new d,e=this.getPortal(a);e||setTimeout(f.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){e.queryGroups({f:"json",q:a[b]}).then(f.hitch(this,
function(a){0<a.results.length?(a=a.results[0],a.portalUrl=e.portalUrl,a.credential=e.credential,a.portal=e,a=new u(a),c.resolve(a)):c.reject("Can't find portal self group.")}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new d;this.getBasemapGalleryGroup(a).then(f.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,
function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var b=c.getStandardPortalUrl(a);return this._searchWABDefaultWebScene(b).then(f.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(b).then(f.hitch(this,function(a){return this.getPortal(b).getUser().then(f.hitch(this,function(b){var c=!1;b&&b.privileges&&0<b.privileges.length&&(c=n.some(b.privileges,
function(a){return 0<=a.indexOf("shareToPublic")}));return c?b.shareItem({everyone:!0},a).then(f.hitch(this,function(){return a}),f.hitch(this,function(){return a})):a}),f.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(a){var b=new d,e=c.getStandardPortalUrl(a),h=this.getPortal(e);this.getPortalSelfInfo(a).then(f.hitch(this,function(c){c&&c.livingAtlasGroupQuery?h.queryGroups({q:c.livingAtlasGroupQuery}).then(f.hitch(this,function(a){if(!a||!a.results||
!a.results.length||0>=a.results.length)return"";var b=[],b=a.results.filter(function(a){return a.title&&"Living Atlas"===a.title});return b[0]&&b[0].id})).then(f.hitch(this,function(c){c&&""!==c?h.queryItems({q:'(group:"'+c+'" AND type:"Web Scene" AND tags:"scenes" AND -tags:"mature support")',sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(c){!c||!c.results||!c.results.length||0>=c.results.length?this._searchWABCreatedWebScene(a,b):b.resolve(c.results[0].id)}),f.hitch(this,function(){this._searchWABCreatedWebScene(a,
b)})):this._searchWABCreatedWebScene(a,b)}),f.hitch(this,function(){this._searchWABCreatedWebScene(a,b)})):this._searchWABCreatedWebScene(a,b)}),f.hitch(this,function(){this._searchWABCreatedWebScene(a,b)}));return b},_searchWABCreatedWebScene:function(a,b){a=c.getStandardPortalUrl(a);a=this.getPortal(a);a.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+a.user.orgId+" access:public "+this.webSceneQueryStr}).then(f.hitch(this,function(a){a&&a.results&&0<a.results.length?b.resolve(a.results[0].id):
b.resolve(null)}),f.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);b.reject(a)}))},_createWABDefaultWebScene:function(a){var b=new d;a=c.getStandardPortalUrl(a);this.getPortal(a).getUser().then(f.hitch(this,function(a){var c={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:p.stringify({operationalLayers:[],baseMap:{id:"basemap",title:"Topographic",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
id:"worldTopoBase",layerType:"ArcGISTiledMapServiceLayer",title:"Topo"}],elevationLayers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",id:"globalElevation",listMode:"hide",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},ground:{layers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",id:"globalElevation",listMode:"hide",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},
viewingMode:"global",spatialReference:{latestWkid:3857,wkid:102100},version:"1.10",authoringApp:"WebAppBuilder",authoringAppVersion:"2.8"}),snippet:""};a.addItem(c,"").then(f.hitch(this,function(a){a.success?b.resolve(a.id):(console.error("Can't create default web scene:",a),b.reject())}))}),f.hitch(this,function(a){console.error("Can't create default web scene");b.reject(a)}));return b},getDefaultWebMap:function(a){var b=new d;this.getPortalSelfInfo(a).then(f.hitch(this,function(c){var e=c.defaultBasemap&&
c.defaultBasemap.id;e?b.resolve(e):this._getDefaultWebMapByBasemapGallery(a,c).then(f.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(f.hitch(this,function(a){a?b.resolve(a):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new d,e=this.getPortal(a),h=b.defaultBasemap&&b.defaultBasemap.title;
e.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(f.hitch(this,function(a){a=a.results;0<a.length?e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+h}).then(f.hitch(this,function(a){a=a.results;a=n.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+
h}).then(f.hitch(this,function(a){a=a.results;a=n.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];e.getItemData(b.id).then(f.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),f.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),f.hitch(this,function(a){console.error(a);c.reject(a)})))}),f.hitch(this,function(a){console.error(a);
c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new d;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(a){a=a.results;a=n.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?
b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},comparePortalVersion:function(a,b){var c=a.split(".");a=parseInt(c[0],10);var c=1<c.length?parseInt(c[1],10):0,e=b.split(".");b=parseInt(e[0],10);e=1<e.length?parseInt(e[1],10):0;return a>b?1:a<b?-1:c>e?1:c<e?-1:0},getItemResources:function(a,b,e){e||(e=100);a=c.getStandardPortalUrl(a);a=c.getItemResourceUrl(a,b);return g({url:a,content:{f:"json",num:e}}).then(function(a){if(a&&
a.resources)return a.resources})},addResource:function(a,b,e,h,t){a=c.getStandardPortalUrl(a);var m=this.getPortal(a),d=new FormData;d.append("file",e,h);d.append("fileName",h);d.append("f","json");var l="";t?(d.append("resourcesPrefix",t),l=t+"/"+h):l=h;return m.getItemById(b,!0).then(function(e){e=c.getUserContentItemUrl(a,e.owner,b);return g({url:e+"/addResources",form:d}).then(function(b){var e="";b&&b.success&&(e=c.getItemResourceUrl(a,"${itemId}",l));return e},function(a){console.error(a.message||
a);return a})})},removeResources:function(a,b,e,h){var t={resource:h?h+"/"+e:e,f:"json"};a=c.getStandardPortalUrl(a);return this.getPortal(a).getItemById(b,!0).then(function(e){e=c.getUserContentItemUrl(a,e.owner,b);return g({url:e+"/removeResources",content:t},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}};r.subscribe("userSignOut",function(a){(a=C._findPortal(a))&&a.clearCredentialAndUser()});return C})},"jimu/Role":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(q,f,n,k,d){return q(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(d){d=d||{};this.id=d.id;this.baseRole=d.role;this.name=d.name;this.description=d.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,
assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,
demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(r){d.isDefined(r)&&r instanceof Array&&n.forEach(r,f.hitch(this,function(d){this._readPrivilege(d)}))},_readPrivilege:function(d){this._applyEffectToAction(!0,d)},_applyEffectToAction:function(d,f){switch(f){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=d;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=d;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=
d;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=d;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=d;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=d;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=d;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=d;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=
d;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=d;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=d;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=d;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=d;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=d;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=
d;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=d;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=d;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=d;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=d;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=d;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=
d;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=d;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=d;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=d;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=d;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=d;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=d;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
d;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=d;break;case "features:user:edit":this.privilegeObj.features.user.edit=d;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=d;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=d;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=d;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=d;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=d;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=d;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=d;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=d;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=d;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
d;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=d;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=d}},_applyToAll:function(d){this.privilegeObj.portal.admin.inviteUsers=d;this.privilegeObj.portal.admin.disableUsers=d;this.privilegeObj.portal.admin.viewUsers=d;this.privilegeObj.portal.admin.updateUsers=d;this.privilegeObj.portal.admin.deleteUsers=d;this.privilegeObj.portal.admin.changeUserRoles=d;this.privilegeObj.portal.admin.viewGroups=
d;this.privilegeObj.portal.admin.updateGroups=d;this.privilegeObj.portal.admin.deleteGroups=d;this.privilegeObj.portal.admin.reassignGroups=d;this.privilegeObj.portal.admin.assignToGroups=d;this.privilegeObj.portal.admin.manageEnterpriseGroups=d;this.privilegeObj.portal.admin.viewItems=d;this.privilegeObj.portal.admin.updateItems=d;this.privilegeObj.portal.admin.deleteItems=d;this.privilegeObj.portal.admin.reassignItems=d;this.privilegeObj.portal.admin.manageLicenses=d;this.privilegeObj.portal.publisher.publishFeatures=
d;this.privilegeObj.portal.publisher.publishTiles=d;this.privilegeObj.portal.publisher.publishScenes=d;this.privilegeObj.portal.user.createGroup=d;this.privilegeObj.portal.user.joinGroup=d;this.privilegeObj.portal.user.joinNonOrgGroup=d;this.privilegeObj.portal.user.createItem=d;this.privilegeObj.portal.user.shareToGroup=d;this.privilegeObj.portal.user.shareToOrg=d;this.privilegeObj.portal.user.shareToPublic=d;this.privilegeObj.portal.user.shareGroupToOrg=d;this.privilegeObj.portal.user.shareGroupToPublic=
d;this.privilegeObj.features.user.edit=d;this.privilegeObj.opendata.user.openDataAdmin=d;this.privilegeObj.opendata.user.designateGroup=d;this.privilegeObj.premium.user.geocode=d;this.privilegeObj.premium.user.networkanalysis=d;this.privilegeObj.premium.user.spatialanalysis=d;this.privilegeObj.premium.user.geoenrichment=d;this.privilegeObj.premium.user.demographics=d;this.privilegeObj.premium.user.elevation=d;this.privilegeObj.marketplace.admin.purchase=d;this.privilegeObj.marketplace.admin.manage=
d;this.privilegeObj.marketplace.admin.startTrial=d},_buildPrivilegesArray:function(){var d=[];!0===this.privilegeObj.portal.admin.inviteUsers&&d.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&d.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&d.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&d.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&d.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&d.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&d.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&d.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&d.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&d.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&d.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&d.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&d.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&d.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&d.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&d.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&d.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&d.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&d.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&d.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&d.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&d.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
d.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&d.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&d.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&d.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&d.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&d.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
d.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&d.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&d.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&d.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&d.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&d.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
d.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&d.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&d.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&d.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&d.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&d.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
d.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&d.push("marketplace:admin:startTrial");return d},isUser:function(){return d.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return d.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return d.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||d.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||d.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||d.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&d.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(f){this.privileges=f;this._initPrivilegesObject();d.isDefined(f)&&this._readPrivileges(f)},stringify:function(){return k.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return k.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return k.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return k.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(q,f){var n=null,k=q(null,{cache:{},getServiceDefinition:function(d,k){k||(k="json");var p=this.cache[d];0>=this._getDefStatus(p)&&(p=f({url:d,handleAs:k,content:{f:k},callbackParamName:"callback"}),this.cache[d]=p);return p},_getDefStatus:function(d){return d?d.isFulfilled()?d.isResolved()?2:-1:1:0}});
k.getInstance=function(){n||(n=new k,window._serviceDefinitionManager=n);return n};return k})},"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(q,f,n,k,d){var r=q([d],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,title:null,id:null,subId:null,layerObject:null,constructor:function(d){this._layerInfo=d;this.map=d.map;this.title=d.title;this.id=d.id;this.subId=d.subId},isLeaf:function(){return this._layerInfo.isLeaf()},
isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},traversal:function(d){return this._layerInfo.traversal(function(l){return d(l._adaptor)})},getNodeById:function(d){var l=null;if(d=this._layerInfo.findLayerInfoById(d))l=d._adaptor;
return l},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},setOpacity:function(d){this._layerInfo.setOpacity(d)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var d=this._layerInfo.parentLayerInfo;return d?d._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},
getNodeLevel:function(){return this._layerInfo.getLayerLevel()},getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},
getFilter:function(){return this._layerInfo.getFilter()},setFilter:function(d){this._layerInfo.setFilter(d)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var d=new k;this._layerInfo.getRelatedTableInfoArray().then(n.hitch(this,function(l){d.resolve(this._getNodesArrayFromInfosArray(l))}));
return d},isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},
canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isEditable:function(d){return this._layerInfo.isEditable(d)},zoomTo:function(d){return this._layerInfo.zoomTo(d)},emitEvent:function(d){try{var l=null;switch(d){case "isVisibleChanged":l=
r.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":l=r.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":l=r.EVENT_FILTER_CHANGE;break;case "rendererChanged":l=r.EVENT_RENDERER_CHANGE;break;case "opacityChanged":l=r.EVENT_OPACITY_CHANGE}l&&this.emit(l)}catch(g){console.error(g)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(d){var l=[];f.forEach(d,function(g){l.push(g._adaptor)},this);return l}});n.mixin(r,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",
EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change"});return r})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(q,f,n){var k=q(null,{_realRequest:null,_buffer:null,constructor:function(d){this._buffer={};this._realRequest=d?d:function(){return new n}},getRequest:function(d){this._buffer[d]||(this._buffer[d]=new k.RequestProxy(this._realRequest,d));return this._buffer[d]},
request:function(d){var f=Array.prototype.slice.apply(arguments);f.splice(0,1);var p=this.getRequest(d);return p.request.apply(p,f)},setResponse:function(d,f){this.getRequest(d).setResponse(f)},isResolved:function(d){return this.getRequest(d).isResolved()}});k.RequestProxy=q(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(d,f){this._realRequest=d;this._key=f},request:function(){this._deferred||(this._deferred=new n,this._realRequest.apply(null,arguments).then(f.hitch(this,function(d){this._deferred.resolve(d)}),
f.hitch(this,function(d){d&&console.warn(d.message||d);d=this._deferred;this._deferred=null;d.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new n);return this._deferred},setResponse:function(d,f){this._deferred||(this._deferred=new n);null===d||void 0===d?(this._deferred.resolve(null),f&&(this._deferred=null)):this._deferred.resolve(d)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return k})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang".split(" "),
function(q,f,n,k,d,r,p,l,g,m){return q(l,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._needToRefresh().then(n.hitch(this,function(e){e&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_needToRefresh:function(){var e=new k;
this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(n.hitch(this,function(c){(c=(c=c.getItemData())&&c.thematicGroup)?(this.originOperLayer.thematicGroup=c,e.resolve(!0)):e.resolve(!1)})):e.resolve(!1);return e},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var e=f.filter(this.originOperLayer.layers,
function(c){return m.isDefined(c.id)&&m.isDefined(c.name)&&m.isDefined(c.minScale)&&m.isDefined(c.maxScale)&&m.isDefined(c.parentLayerId)&&m.isDefined(c.defaultVisibility)});this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?f.filter(this.layerObject.dynamicLayerInfos,function(c){return-1<this.originOperLayer.thematicGroup.layerIds.indexOf(c.id)?!0:!1},this):
this.layerObject.dynamicLayerInfos:0<e.length?e:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:n.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=n.clone(this.layerObject.infoTemplates);r.after(this.layerObject,"setInfoTemplates",n.hitch(this,function(){this.layerObject._infoTemplates=n.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=n.clone(this.layerObject.infoTemplates);this.traversal(function(e){e._afterSetInfoTemplates&&
e._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new k}},_initSubLayerVisible:function(e){this._subLayerVisible={};for(var c=0;c<this._jsapiLayerInfos.length;c++)this._subLayerVisible[this._jsapiLayerInfos[c].id]=!1;e?f.forEach(e,function(a){this._subLayerVisible[a]=!0},this):this.originOperLayer.visibleLayers?f.forEach(this.originOperLayer.visibleLayers,function(a){this._subLayerVisible[a]=!0},this):f.forEach(this._jsapiLayerInfos,
function(a){a.defaultVisibility&&(this._subLayerVisible[a.id]=!0)},this)},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(e){this.originOperLayer.layerObject.setVisibility(e);this._visible=e},_setSubLayerVisible:function(e){var c=[-1,-1,-1],a,h=[],b=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(b,function(a){if(!this._isGroupLayerBySubId(a)){var b=this._subLayerInfoIndex[a];b&&b._isAllSubLayerVisibleOnPath()&&
h.push(a)}},this);var b=h,g;for(g in e)if(e.hasOwnProperty(g)&&"function"!==typeof e[g]){var d=Number(g);e[g]?(a=f.indexOf(b,d),0>a&&b.push(d)):(a=f.indexOf(b,d),0<=a&&b.splice(a,1))}c=c.concat(b);this.originOperLayer.layerObject.setVisibleLayers(c)},_resetLayerObjectVisiblity:function(e){var c=e?e[this.id]:null,a=!1;if(e&&(c&&this.layerObject.setVisibility(c.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var c={},h;for(h in e)e.hasOwnProperty(h)&&"function"!==
typeof e[h]&&(a=!0,c[h]=e[h].visible);a&&this._setSubLayerVisibleByCheckedInfo(c)}},_setSubLayerVisibleByCheckedInfo:function(e){var c=[];f.forEach(this._jsapiLayerInfos,function(a){var b=this.id+"_"+a.id;m.isDefined(e[b])?e[b]&&c.push(a.id):this._subLayerVisible[a.id]&&c.push(a.id)},this);this._initSubLayerVisible(c);this.traversal(function(a){a._initVisible()});var a={};this.traversal(function(c){0===c.getSubLayers().length&&(a[c.originOperLayer.mapService.subId]=c._isAllSubLayerVisibleOnPath())});
this._setSubLayerVisible(a)},_subLayerVisibleChanged:function(){var e=[];this.traversal(function(c){e.push(c)});p.publish("layerInfos/layerInfo/visibleChanged",e)},obtainNewSubLayers:function(){var e=[],c=this.originOperLayer.layerObject,a=null,a="esri.layers.ArcGISDynamicMapServiceLayer"===c.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(b){var h=null,h=c.url+"/"+b.id,g=c.id+"_"+b.id;b.subLayerIds&&0<b.subLayerIds.length?(h={url:h,empty:!0},this._addNewSubLayer(e,h,g,b,
a+"_group")):(h={url:h,empty:!0},this._addNewSubLayer(e,h,g,b,a))},this);var h=[];f.forEach(this._jsapiLayerInfos,function(a,c){a=a.parentLayerId;if(-1!==a){for(var b=null,h=0;h<e.length;h++)if(e[h].mapService.subId===a){b=e[h];break}(a=b)&&a.subLayers.push(e[c])}},this);f.forEach(this._jsapiLayerInfos,function(a,c){-1===a.parentLayerId&&(a=this._layerInfoFactory.create(e[c]),h.push(a),a.init())},this);return h},_addNewSubLayer:function(e,c,a,h,b){var g=h.source&&h.source.mapLayerId;if(void 0===g||
null===g)g=h.id;e.push({layerObject:c,title:h.name||h.id||" ",id:a||"-",subId:h.id,subLayers:[],mapService:{layerInfo:this,subId:h.id,mapServiceSubId:g},selfType:"mapservice_"+b,parentLayerInfo:this})},_handleErrorSubLayer:function(e,c,a,h,b,g){e[c]={layerObject:null,title:g.name||g.id||" ",id:a||" ",subLayers:[],mapService:{layerInfo:this,subId:h}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(e){this.layerObject.setOpacity&&this.layerObject.setOpacity(e)},
getLegendInfo:function(e){var c=new k;this._legendInfo?c.resolve(this._legendInfo):this._legendRequest(e).then(n.hitch(this,function(a){this._legendInfo=a.layers;c.resolve(this._legendInfo)}),function(){c.reject()});return c},_legendRequest:function(e){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(e)},_legendRequestServer:function(){var e=this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.dynamicLayers&&(c.dynamicLayers=d.stringify(this._createDynamicLayers(this.layerObject)),
"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));return g({url:e,content:c,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(e){return g({url:e+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(e){var c=[],a;f.forEach(e.dynamicLayerInfos||e.layerInfos,function(h){a={id:h.id};a.source=h.source&&h.source.toJson();var b;e.layerDefinitions&&e.layerDefinitions[h.id]&&(b=e.layerDefinitions[h.id]);
b&&(a.definitionExpression=b);var g;e.layerDrawingOptions&&e.layerDrawingOptions[h.id]&&(g=e.layerDrawingOptions[h.id]);g&&(a.drawingInfo=g.toJson());a.minScale=h.minScale||0;a.maxScale=h.maxScale||0;c.push(a)});return c},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},_getSubserviceDefinition:function(e){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(e):this._getLayerAndTable(e)},_getAllLayerAndTable:function(e){var c=
this.layerObject.url+"/layers",a=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");a.isResolved()||a.request(c).then(n.hitch(this,function(a){a||(a={layers:[]});this.traversal(n.hitch(this,function(b){if(!b.isRootLayer()){var c=b.originOperLayer.mapService.mapServiceSubId;b=this._serviceDefinitionBuffer.getRequest(c);var e=null;f.some(a.layers,function(a){if(a.id===c)return e=a,!0},this);b.setResponse(e)}}))}));return this._serviceDefinitionBuffer.getRequest(e).fakeRequest()},
_getLayerAndTable:function(e){var c=this.layerObject.url+"/"+e;return this._serviceDefinitionBuffer.getRequest(e).request(c)},_getSublayerSettingOfWebmap:function(e){var c=f.filter(this.originOperLayer.layers,function(a){return a.id===e});return 1===c.length?c[0]:null},_getSublayerShowLegendOfWebmap:function(e){return(e=this._getSublayerSettingOfWebmap(e))?void 0!==e.showLegend?e.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(e){return null===this._getJsapiLayerInfoById(e)?!1:!0},_getJsapiLayerInfoById:function(e){for(var c=
null,a=0;a<this._jsapiLayerInfos.length;a++)if(this._jsapiLayerInfos[a].id===e){c=this._jsapiLayerInfos[a];break}return c},_isGroupLayerBySubId:function(e){return(e=this._getJsapiLayerInfoById(e))&&e.subLayerIds&&0<e.subLayerIds.length?!0:!1},_bindEvent:function(){var e;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(e=this.layerObject.on("visible-layers-change",n.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(e),e=r.after(this.layerObject,"setLayerDefinitions",
n.hitch(this,this._onFilterChanged)),this._eventHandles.push(e))},_onVisibleLayersChanged:function(e){var c=e.visibleLayers;if(-1===c[0]&&-1===c[1]&&-1===c[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{e=[];var a=[-1,-1,-1],c=this._converVisibleLayers(c);e=c.visibleLayersForUpdateSubLayerVisible;a=a.concat(c.visibleLayersForSetVisibleLayers);this._initSubLayerVisible(e);this.traversal(function(a){a._initVisible()});this.layerObject.setVisibleLayers(a)}},_converVisibleLayers:function(e){var c=
{visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(e,function(a){var c=this.findLayerInfoById(this.id+"_"+a);if(this._isGroupLayerBySubId(a))c.traversal(function(a){e.push(a.originOperLayer.mapService.subId)});else for(;c&&c.originOperLayer.mapService;)e.push(c.originOperLayer.mapService.subId),c=c.parentLayerInfo},this);f.forEach(e,function(a){0<=a&&0>c.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&c.visibleLayersForUpdateSubLayerVisible.push(a)},this);f.forEach(c.visibleLayersForUpdateSubLayerVisible,
function(a){this._isGroupLayerBySubId(a)||c.visibleLayersForSetVisibleLayers.push(a)},this);return c},_onFilterChanged:function(){for(var e,c=[],a=this.layerObject.layerDefinitions,h=a.length>this._oldFilter.length?a.length:this._oldFilter.length,b=0;b<h;b++)(a[b]?a[b]:null)!==(this._oldFilter[b]?this._oldFilter[b]:null)&&(e=this.findLayerInfoById(this.id+"_"+b))&&e.isLeaf()&&c.push(e);0<c.length&&(p.publish("layerInfos/layerInfo/filterChanged",c),this._oldFilter=a)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e){return q(p,{constructor:function(){},_getExtentAsync:function(){var c=this.layerObject.getLayers(),a=null,e=null;if(0<c.length&&"esri.layers.KMLLayer"===c[0].declaredClass){var b=[];this.traversal(n.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&b.push(a)}));f.forEach(b,function(b){e=b._getExtentAsync();a=a?a.union(e):e},this)}else f.forEach(c,function(b){e=g.graphicsExtent(b.graphics);a=a?a.union(e):e},this);return a},
_getExtent:function(){var c=new m;c.resolve(this._getExtentAsync());return c},_resetLayerObjectVisiblity:function(c){var a=c?c[this.id]:null;if(a){var e={},b;for(b in c)c.hasOwnProperty(b)&&"function"!==typeof c[b]&&(e[b]=c[b].visible);this._setSubLayerVisibleByCheckedInfo(e);this._setTopLayerVisible(a.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){this.traversal(n.hitch(this,function(a){e.isDefined(c[a.id])&&a._setTopLayerVisible(c[a.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},
_setTopLayerVisible:function(c){c?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var c=[];f.forEach(this._getOperLayerByParentFolderId(-1,this),function(a){a=this._layerInfoFactory.create(a);c.push(a);a.init()},this);return c},_getOperLayerByParentFolderId:function(c,a){var e=[],b=this.layerObject.getLayers()||[],g=f.filter(this.layerObject.folders||[],function(a){return a.parentFolderId===c?!0:!1}),d=[],d=0===g.length?f.filter(b,function(a){return this._flag.kmzSubLayersWereHandled?
!1:!0},this):g;f.forEach(d,function(b){var c;"esri.layers.KMLFolder"===b.declaredClass?c={layerObject:b,title:b.label||b.title||b.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(b),subId:b.id,kml:{layerInfo:this,currentFolder:b},selfType:"kml",parentLayerInfo:a}:"esri.layers.KMLLayer"===b.declaredClass?(c=n.getObject("linkInfo.name",!1,b),c={layerObject:b,title:b.label||b.title||c||b.name||b.id||" ",id:b.id||"-",subId:b.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",
parentLayerInfo:a},n.setObject("_wabProperties.kmllayerWasHandled",!0,b),this._flag.kmzSubLayersWereHandled=!0):(n.setObject("_wabProperties.kmllayerWasHandled",!0,b),n.setObject("_wabProperties.isTemporaryLayer",!0,b));c&&e.push(c)},this);return e},_getAllSubLayerObject:function(){var c=[];this.traversal(n.hitch(this,function(a){a.layerObject&&a.layerObject.getLayers&&(c=c.concat(a.layerObject.getLayers()))}));return c},_getSubLayerInfoIdForSubFolder:function(c){return this.id+"_folder_"+c.id},_needToRenew:function(){return f.some(this._getAllSubLayerObject(),
function(c){if(!n.getObject("_wabProperties.kmllayerWasHandled",!1,c))return!0},this)},_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=d.after(this.layerObject,"setFolderVisibility",n.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(c))},_onSubFolderVisibleChanged:function(c){c=this._getSubLayerInfoIdForSubFolder(c);(c=this.findLayerInfoById(c))&&r.publish("layerInfos/layerInfo/visibleChanged",[c])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/QueryTask".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y){return q(d,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(z){console.warn(z.message)}},_updateLayerObjectName:function(){this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!n.getObject("_wabProperties.originalLayerName",!1,this.layerObject)&&(n.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),
this.layerObject.name=this.title)},_initToShowLabels:function(){var a=n.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);a&&!this.layerObject.empty&&c.getPortal(a.portalUrl).getItemData(a.itemId).then(n.hitch(this,function(a){var b;a&&a.layers&&(f.some(a.layers,function(a){return a.id===this.layerObject.layerId?(b=a,!0):!1},this),b&&b.showLabels&&((a=n.getObject("layerDefinition.drawingInfo.labelingInfo",!1,b))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(a=f.map(a,
function(a){return new t(a)},this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),n.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var b=[],c=this.getInfoTemplate();c&&c.info&&c.info.fieldInfos?f.forEach(c.info.fieldInfos,function(a){a.visible&&
b.push(a.fieldName)},this):b=["*"];a.outFields=b;return a},_getExtent:function(){var b=new k,c;c=this.layerObject.graphics&&0<this.layerObject.graphics.length?a.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?"esri.layers.FeatureLayer"===this.layerObject.declaredClass?this.getServiceDefinition().then(n.hitch(this,function(e){var h=new y(this.layerObject.url),g=new B,d=this.getFilter();g.where=d?d:"1\x3d1";g.outSpatialReference=
this.map.spatialReference;g.returnGeometry=!0;e&&e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsReturningQueryExtent?h.executeForExtent(g,n.hitch(this,function(c){var e=c.extent;1===c.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(c=new D(c.extent.xmin,c.extent.ymin,c.extent.spatialReference),e=a.graphicsExtent([new C(c)]));b.resolve(e)}),n.hitch(this,function(){b.resolve(c);console.log("executeForExtent failed.")})):h.execute(g).then(n.hitch(this,function(c){c=a.graphicsExtent(c.features);
b.resolve(c)}),n.hitch(this,function(){b.resolve(c);console.log("query execute failed.")}))})):b.resolve(c):b.resolve(c);return b},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},_initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==
a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),
this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(a){for(var b={},c=this;c.parentLayerInfo;)b[c.id]=a,c=c.parentLayerInfo;return b},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var a=this.getRootLayerInfo();if(a._setSubLayerVisibleByCheckedInfo){var b=this._prepareCheckedInfoForShowOrHide(!0);a._setSubLayerVisibleByCheckedInfo(b);
a.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var a=m.after(this.layerObject,"setInfoTemplate",n.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}));this._eventHandles.push(a)},
_getServiceDefinition:function(){var a;(a=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?a=this._serviceDefinitionBuffer.getRequest(this.subId).request(a):(a=new k,a.resolve(null));return a},createLegendsNode:function(){var a=p.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);p.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},
drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){p.empty(a);g.remove(a,"jimu-legends-div-flag");var b=new v({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:v.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},p.create("div",{},a));b.startup();a._legendDijit=b}},_initLegendsNode:function(a){var b=
[],c=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(p.empty(a),c.renderer&&(c.renderer.infos?b=n.clone(c.renderer.infos):b.push({label:c.renderer.label,symbol:c.renderer.symbol}),c.renderer&&c.renderer.defaultSymbol&&0<b.length&&b.push({label:c.renderer.defaultLabel||"others",symbol:c.renderer.defaultSymbol}),f.forEach(b,function(b){b.legendDiv=p.create("div",{"class":"legend-div"},a);b.symbolDiv=p.create("div",
{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=p.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},b.legendDiv);if("textsymbol"===b.symbol.type)l.set(b.symbolDiv,"innerHTML",b.symbol.text);else{var c=r.createSurface(b.symbolDiv,50,50);b=h.getShapeDescriptors(b.symbol);c.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(r.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,
function(b){b.parentLayerInfo=this;b=this._layerInfoFactory.create(b);a.push(b);b.init()},this);return a},_isAllSubLayerVisibleOnPath:function(){for(var a=!0,b=this;!b.isRootLayer();)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getCustomPopupInfo:function(b,c){var e=null;b&&b.fields&&(e={title:b.name,fieldInfos:[],description:null,
showAttachments:!0,mediaInfos:[]},f.forEach(b.fields,function(b){var h=!1;c?f.some(c,n.hitch(this,function(a){return a&&b.name.toLowerCase()===a.toLowerCase()}))&&(h=!0):h=!0;h&&(h=a.getDefaultPortalFieldInfo(b),h.visible=!0,h.isEditable=b.editable,e.fieldInfos.push(h))},this));return e},_getDefaultPopupInfo:function(a){var b=this._getCustomPopupInfo(a);b&&(b.fieldInfos=f.filter(b.fieldInfos,n.hitch(this,function(b){return b.fieldName.toLowerCase()!==a.objectIdField.toLowerCase()&&"globalid"!==b.fieldName.toLowerCase()&&
"shape"!==b.fieldName.toLowerCase()?!0:!1})));return b},_getDefaultPopupTemplate:function(a){var b=null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(b=new u(a));return b},enablePopup:function(){return this.loadInfoTemplate().then(n.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=
null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},loadInfoTemplate:function(){var a=new k;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(n.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),n.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},
_getRelatedUrls:function(a,b){var c=[];if(!a||!a.url||!a.relationships)return c;var e=a.url.lastIndexOf("/"),h=a.url.slice(0,e);f.forEach(a.relationships,function(a){b&&a.role&&b!==a.role||c.push(h+"/"+a.relatedTableId.toString())},this);return c},getRelatedTableInfoArray:function(a){var b=[],c=new k;this.getLayerObject().then(n.hitch(this,function(h){var g=this._getRelatedUrls(h,a);0!==g.length&&this._getLayerInfosObj().traversalAll(n.hitch(this,function(a){var c=-1;if(0===g.length)return!0;f.forEach(g,
function(h,g){n.getObject("layerObject.url",!1,a)&&e.removeProtocol(h.toString().toLowerCase()).replace(/\/+/g,"/")===e.removeProtocol(a.layerObject.url.toString().toLowerCase()).replace(/\/+/g,"/")&&(b.push(a),c=g)},this);0<=c&&g.splice(c,1);return!1}));c.resolve(b)}),n.hitch(this,function(){c.resolve(b)}));return c},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&
!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&this.layerObject.setDefinitionExpression(a)},_isAlreadyInLabelLayerOfMap:function(a){var b=!1;a&&(b=f.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return b},_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},
_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){var a;this.map._labels?a=this.map._labels:(a=this.map.getLayer("labels"),a||(a=new b({id:"labels"}),this.map.addLayer(a)));return a},obtainLabelControl:function(){var a=this.id+"_labelLayer",c=this.map.getLayer(a);if(!c&&this._isSupportLabelControl()){var e=
this.getLabelLayerOfMap();e&&this._isAlreadyInLabelLayerOfMap(e)&&(c=new b({id:a}),c.addFeatureLayer(this.layerObject),this.map.addLayer(c),this._removeFromLabelLayerOfMap())}return c?c:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),
this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),b=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||b&&this._isAlreadyInLabelLayerOfMap(b))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},
hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../support/expressionUtils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F){function E(a){return"sizeInfo"===a.type}q=f(z,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=n.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
n.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)p.disconnect(this._mapEventHandlers[a]);this.refresh();h.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,e){if(!this.getFeatureLayer(a.layerId)){var h=[];h.push(a.on("update-end",
n.hitch(this,"refresh")));h.push(a.on("suspend",n.hitch(this,"refresh")));h.push(a.on("resume",n.hitch(this,"refresh")));h.push(a.on("edits-complete",n.hitch(this,"refresh")));h.push(a.on("labeling-info-change",n.hitch(this,"refresh")));h.push(a.on("time-extent-change",n.hitch(this,"refresh")));h.push(a.on("show-labels-change",n.hitch(this,"refresh")));h.push(a.on("feature-reduction-change",n.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:e,
LabelRenderer:b,EventHandlers:h});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=r.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)p.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)p.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=h.setTimeout(this._refreshLabels,h.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var c,e,h,g,d,m=[],l,f="DYNAMIC"===this._engineType?new b:new t;if(this._map){f.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(e=this.featureLayers[a],e.visible&&e.showLabels&&e.visibleAtMapScale&&!e._suspended)if(c=
this._featureLayerInfos[a],d=this._convertOptions(null),c.LabelRenderer){if(m=e.labelingInfo)if(l=m[0])g=this._getLabelExpression(l),d=this._convertOptions(l);h=c.LabelRenderer;c.LabelExpressionInfo&&(g=c.LabelExpressionInfo);c.LabelingOptions&&(d=this._convertOptions(null),void 0!==c.LabelingOptions.pointPriorities&&(m=c.LabelingOptions.pointPriorities,d.pointPriorities="above-center"==m||"AboveCenter"==m||"esriServerPointLabelPlacementAboveCenter"==m?"AboveCenter":"above-left"==m||"AboveLeft"==
m||"esriServerPointLabelPlacementAboveLeft"==m?"AboveLeft":"above-right"==m||"AboveRight"==m||"esriServerPointLabelPlacementAboveRight"==m?"AboveRight":"below-center"==m||"BelowCenter"==m||"esriServerPointLabelPlacementBelowCenter"==m?"BelowCenter":"below-left"==m||"BelowLeft"==m||"esriServerPointLabelPlacementBelowLeft"==m?"BelowLeft":"below-right"==m||"BelowRight"==m||"esriServerPointLabelPlacementBelowRight"==m?"BelowRight":"center-center"==m||"CenterCenter"==m||"esriServerPointLabelPlacementCenterCenter"==
m?"CenterCenter":"center-left"==m||"CenterLeft"==m||"esriServerPointLabelPlacementCenterLeft"==m?"CenterLeft":"center-right"==m||"CenterRight"==m||"esriServerPointLabelPlacementCenterRight"==m?"CenterRight":"AboveRight"),void 0!==c.LabelingOptions.lineLabelPlacement&&(d.lineLabelPlacement=c.LabelingOptions.lineLabelPlacement),void 0!==c.LabelingOptions.lineLabelPosition&&(d.lineLabelPosition=c.LabelingOptions.lineLabelPosition),void 0!==c.LabelingOptions.labelRotation&&(d.labelRotation=c.LabelingOptions.labelRotation),
void 0!==c.LabelingOptions.howManyLabels&&(d.howManyLabels=c.LabelingOptions.howManyLabels));h instanceof w&&(g=this._getLabelExpression(h),h=new A(h.symbol),d=this._convertOptions(h));this._addLabels(e,h,g,d)}else if(m=e.labelingInfo)for(c=m.length-1;0<=c;c--)if(l=m[c])h=new w(l instanceof w?l.toJson():l),g=this._getLabelExpression(l),d=this._convertOptions(l),this._addLabels(e,h,g,d);g=f._process(this._preparedLabels);this.clear();this.drawLabels(this._map,g)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var e;for(e=0;e<b.length;e++){var h=b[e],g=h.x,d=h.y,m=h.text,t=h.angle,l=h.layer.labelSymbol;"polyline"==h.layer.geometry.type&&h.layer.options.labelRotation&&l.setAngle(180/Math.PI*t);l.setText(m);h=g;l instanceof v&&(g=l.getHeight(),h-=.25*g*this._scale*Math.sin(t),d-=.33*g*this._scale);t=new c(new B(h,d,a.extent.spatialReference));t.setSymbol(l);this.add(t)}},_addLabels:function(a,b,c,e){var h,g,d,m;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var t=this._map,l=!a.url&&!t.spatialReference.equals(a.spatialReference);for(h=0;h<a.graphics.length;h++)if(g=a.graphics[h],!1!==g.visible&&!g._suspended){d=g.geometry;if(l){if(!y.canProject(d,t))continue;d=y.project(d,t)}d&&this._isWhere(b.where,g.attributes)&&this._isWithinScreenArea(d)&&(m=this._buildLabelText(c,g,a.fields,e),this._addLabel(m,b,a.renderer,g,e,d,t))}}},_isWithinScreenArea:function(a){a="point"===a.type?new D(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var e=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),h=c[3],g=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(h){case "AND":return e&&g;case "OR":return e||g}}}return!1}catch(N){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||r.filter(a.visualVariables,E)[0]:null},_addLabel:function(a,b,c,e,h,d,m){var t,l,f,u;if(a&&""!==n.trim(a)&&b){a=a.replace(/\s+/g," ");t=b.getSymbol(e);t instanceof v?(t=new v(t.toJson()),t.setVerticalAlignment("baseline"),t.setHorizontalAlignment("center")):t=t instanceof C?new C(t.toJson()):new v;t.setText(a);b.symbol=t;if(f=this._getProportionalSize(b.sizeInfo,e.attributes))t instanceof v?t.setSize(f):t instanceof
C&&(t.setWidth(f),t.setHeight(f));u=f=0;if(c){l=c.getSymbol(e);var p=this._getSizeInfo(c);if((c=p?c.getSize(e,{sizeInfo:p,resolution:m.getResolutionInMeters()}):e.size)&&null!==c)f=u=c;else if(l)if("simplemarkersymbol"==l.type)u=f=l.size;else if("picturemarkersymbol"==l.type)f=l.width,u=l.height;else if("simplelinesymbol"==l.type||"cartographiclinesymbol"==l.type)f=l.width}c={};c.graphic=e;c.options=h;c.geometry=d;c.labelRenderer=b;c.labelSymbol=t;c.labelWidth=t.getWidth()/2;c.labelHeight=t.getHeight()/
2;c.symbolWidth=g.normalizedLength(f)/2;c.symbolHeight=g.normalizedLength(u)/2;c.text=a;c.angle=t.angle;this._preparedLabels.push(c)}},_buildLabelText:function(b,c,h,g){if(g.hasExpression)return b=g.arcadeCache,c=c._getDataValue(b.attributeInfo,b,F),e.isDefined(c)?""+c:"";var m=c.attributes;return b.replace(/{[^}]*}/g,function(b){var c,t=b;for(c=0;c<h.length;c++)if("{"+h[c].name+"}"==b){var t=m[h[c].name],l=h[c].domain;if(l&&n.isObject(l)){if("codedValue"==l.type&&g.useCodedValues)for(c=t,b=0;b<l.codedValues.length;b++){if(l.codedValues[b].code==
c){t=l.codedValues[b].name;break}}else"range"==l.type&&l.minValue<=t&&t<=l.maxValue&&(t=l.name);break}l=h[c].type;if(g.fieldInfos){var f=g.fieldInfos;for(c=0;c<f.length;c++)if("{"+f[c].fieldName+"}"==b){b=f[c].format;"esriFieldTypeDate"==l?(b="DateFormat"+a.prototype._dateFormats[b.dateFormat?b.dateFormat:"shortDate"])&&(t=e.substitute({myKey:t},"${myKey:"+b+"}")):"esriFieldTypeInteger"!=l&&"esriFieldTypeSingle"!=l&&"esriFieldTypeSmallInteger"!=l&&"esriFieldTypeLong"!=l&&"esriFieldTypeDouble"!=l||
!b||(t=k.format(t,{places:b.places}),b.digitSeparator||d.group&&(t=t.replace(new RegExp("\\"+d.group,"g"),"")));break}}break}else t="";return null==t?"":t})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,
"{").replace(/\]/g,"}")},_getProportionalSize:function(a,b){if(!a)return null;b=e.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&b)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(b-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",e=null,h=null,g="",d=!0,m,t;if(a&&(a.format&&(c=a.format.dateFormat,e={places:a.format.places,digitSeparator:a.format.digitSeparator}),h=a.fieldInfos,
g=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(t=!0,m=u.createAttributeCache({valueExpression:l},!0))}if("always-horizontal"==g||"esriServerPolygonPlacementAlwaysHorizontal"==g)d=!1;return{useCodedValues:b,dateFormat:c,numberFormat:e,fieldInfos:h,pointPriorities:"above-center"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==
g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"esriServerPointLabelPlacementCenterCenter"==g?"CenterCenter":"center-left"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"esriServerPointLabelPlacementCenterRight"==
g?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==g||"below-start"==g||"center-start"==g?"PlaceAtStart":"above-end"==g||"below-end"==g||"center-end"==g?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==g||"esriServerLinePlacementAboveAfter"==g||"above-along"==g||"esriServerLinePlacementAboveAlong"==g||"above-before"==g||"esriServerLinePlacementAboveBefore"==g||"above-start"==g||"esriServerLinePlacementAboveStart"==g||"above-end"==g||"esriServerLinePlacementAboveEnd"==g?"Above":
"below-after"==g||"esriServerLinePlacementBelowAfter"==g||"below-along"==g||"esriServerLinePlacementBelowAlong"==g||"below-before"==g||"esriServerLinePlacementBelowBefore"==g||"below-start"==g||"esriServerLinePlacementBelowStart"==g||"below-end"==g||"esriServerLinePlacementBelowEnd"==g?"Below":"center-after"==g||"esriServerLinePlacementCenterAfter"==g||"center-along"==g||"esriServerLinePlacementCenterAlong"==g||"center-before"==g||"esriServerLinePlacementCenterBefore"==g||"center-start"==g||"esriServerLinePlacementCenterStart"==
g||"center-end"==g||"esriServerLinePlacementCenterEnd"==g?"OnLine":"Above",labelRotation:d,howManyLabels:"OneLabel",hasExpression:t,arcadeCache:m}}});l("extend-esri")&&n.setObject("layers.LabelLayer",q,m);return q})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(q,f,n,k,d,r){q=q(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=
[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(d,l){this._labelLayer=l;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){this._preparedLabels=d;this._placedLabels=[];var l;for(d=this._preparedLabels.length-1;0<=d;d--){var g=this._preparedLabels[d],m=Math.min(g.labelWidth,g.labelHeight),
e=g.labelWidth+0*m,m=g.labelHeight+0*m,c=(l=g.options)&&void 0!==l.lineLabelPlacement?l.lineLabelPlacement:"PlaceAtCenter",a=l&&void 0!==l.lineLabelPosition?l.lineLabelPosition:"Above",h=l&&void 0!==l.pointPriorities?l.pointPriorities:"AboveRight",b=[2,2,1,3,0,2,3,3,2];"AboveLeft"==h?b=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==h?b=[2,1,2,2,0,2,3,3,3]:"AboveRight"==h?b=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==h?b=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==h?b=[0,0,0,0,1,0,0,0,0]:"CenterRight"==h?b=[3,2,2,3,0,1,3,2,2]:
"BelowLeft"==h?b=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==h?b=[3,3,3,2,0,2,2,1,2]:"BelowRight"==h&&(b=[3,3,2,3,0,2,2,2,1]);var t=l&&void 0!==l.labelRotation?l.labelRotation:!0,h=Math.PI/180*g.angle;l=l&&void 0!==l.howManyLabels?l.howManyLabels:"OneLabel";if("point"==g.geometry.type)this._generatePointPositions(g,g.geometry.x,g.geometry.y,g.text,h,e,m,g.symbolWidth,g.symbolHeight,b);else if("multipoint"==g.geometry.type)for(c=g.geometry,a=0;a<c.points.length;a++)this._generatePointPositions(g,c.points[a][0],
c.points[a][1],g.text,h,e,m,g.symbolWidth,g.symbolHeight,b);else"polyline"==g.geometry.type?this._generateLinePositions(g,g.geometry,g.text,e,m,2*g.symbolHeight+m,c,a,t):"polygon"==g.geometry.type&&this._generatePolygonPositions(g,l,g.geometry,g.text,h,e,m)}return this._placedLabels},_generatePointPositions:function(d,l,g,m,e,c,a,h,b,t){h=(h+c)*this._scale;b=(b+a)*this._scale;var f,p;for(f=1;3>=f;f++)for(p=1;9>=p;p++)if(t[p-1]==f)switch(p){case 1:if(this._findPlace(d,m,l-h,g+b,e,c,a))return;break;
case 2:if(this._findPlace(d,m,l,g+b,e,c,a))return;break;case 3:if(this._findPlace(d,m,l+h,g+b,e,c,a))return;break;case 4:if(this._findPlace(d,m,l-h,g,e,c,a))return;break;case 5:if(this._findPlace(d,m,l,g,e,c,a))return;break;case 6:if(this._findPlace(d,m,l+h,g,e,c,a))return;break;case 7:if(this._findPlace(d,m,l-h,g-b,e,c,a))return;break;case 8:if(this._findPlace(d,m,l,g-b,e,c,a))return;break;case 9:if(this._findPlace(d,m,l+h,g-b,e,c,a))return}},_generateLinePositions:function(d,l,g,m,e,c,a,h,b){var t=
m*this._scale*m*this._scale,f,p,k;for(f=0;f<l.paths.length;f++){var r=l.paths[f],n=r.length,q=Math.floor((n-1)/2),z=0!==(n-1)%2?1:-1;"PlaceAtStart"==a&&(q=0,z=1);"PlaceAtEnd"==a&&(q=n-2,z=-1);for(;0<=q&&q<n-1;){for(p=q;p<n;p++){var w=r[q][0],A=r[q][1],F=r[p][0]-w,E=r[p][1]-A;if(F*F+E*E>t){for(var G=Math.atan2(E,F);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=Math.PI;var H=Math.sin(G),L=Math.cos(G),J=0,K=0;"Above"==h&&(J=c*H*this._scale,K=c*L*this._scale);"Below"==h&&(J=-c*H*this._scale,K=-c*L*
this._scale);if(1==p-q){if(this._clipLine(w,A,r[p][0],r[p][1])&&(w=this._x1-this._x0,k=this._y1-this._y0,w*w+k*k>t&&(p=Math.atan2(k,w),F=m/2+2*e,A=F*this._scale*Math.cos(p),F=F*this._scale*Math.sin(p),"PlaceAtStart"==a?(w=this._x0+A,k=this._y0+F):"PlaceAtEnd"==a?(w=this._x1-A,k=this._y1-F):(w=this._x0+w/2,k=this._y0+k/2),this._findPlace(d,g,w-J,k+K,b?-p:0,m,e))))return}else{var O=0;for(k=q;k<=p;k++)O=Math.max(O,Math.abs((r[k][1]-A)*L-(r[k][0]-w)*H));if(O<e&&this._findPlace(d,g,w+F/2-J,A+E/2+K,b?-G:
0,m,e))return}break}}q+=z}}},_generatePolygonPositions:function(d,l,g,m,e,c,a){var h;if("ManyLabels"==l)for(l=0;l<g.rings.length;l++)h=g.rings[l],r.prototype.isClockwise(h)&&(h=this._findCentroid(h,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(d,m,h[0],h[1],e,c,a));else{h=this._findCentroidForFeature(g,this._xmin,this._ymin,this._xmax,this._ymax);var b=h[1],t=0;for(l=0;10>l;l++){t+=a/4;h=this._findCentroidForFeature(g,this._xmin,b+(t-a/4),this._xmax,b+(t+a/4));if(this._findPlace(d,
m,h[0],h[1],e,c,a))break;h=this._findCentroidForFeature(g,this._xmin,b-(t+a/4),this._xmax,b-(t-a/4));if(this._findPlace(d,m,h[0],h[1],e,c,a))break}}},_findCentroid:function(d,l,g,m,e){var c=d.length,a=[0,0],h=0,b=d[0][0],t=d[0][1];b>m&&(b=m);b<l&&(b=l);t>e&&(t=e);t<g&&(t=g);for(var f=1;f<c-1;f++){var p=d[f][0],k=d[f][1],r=d[f+1][0],n=d[f+1][1];p>m&&(p=m);p<l&&(p=l);k>e&&(k=e);k<g&&(k=g);r>m&&(r=m);r<l&&(r=l);n>e&&(n=e);n<g&&(n=g);var q=(p-b)*(n-t)-(r-b)*(k-t);a[0]+=q*(b+p+r);a[1]+=q*(t+k+n);h+=q}a[0]/=
3*h;a[1]/=3*h;if(isNaN(a[0])||isNaN(a[1]))return a;g=[];this._fillBuffer(d,g,a);a[0]=this._sortBuffer(g,a[0],l,m);return a},_findCentroidForFeature:function(d,l,g,m,e){for(var c,a=0,h=[0,0],b=0;b<d.rings.length;b++){var t=d.rings[b],f=t.length,p=t[0][0],k=t[0][1];p>m&&(p=m);p<l&&(p=l);k>e&&(k=e);k<g&&(k=g);for(c=1;c<f-1;c++){var r=t[c][0],n=t[c][1],q=t[c+1][0],z=t[c+1][1];r>m&&(r=m);r<l&&(r=l);n>e&&(n=e);n<g&&(n=g);q>m&&(q=m);q<l&&(q=l);z>e&&(z=e);z<g&&(z=g);var w=(r-p)*(z-k)-(q-p)*(n-k);h[0]+=w*
(p+r+q);h[1]+=w*(k+n+z);a+=w}}h[0]/=3*a;h[1]/=3*a;if(isNaN(h[0])||isNaN(h[1]))return h;g=[];for(c=0;c<d.rings.length;c++)this._fillBuffer(d.rings[c],g,h);h[0]=this._sortBuffer(g,h[0],l,m);return h},_fillBuffer:function(d,l,g){for(var m=d.length-1,e=d[0][1]>=d[m][1]?1:-1,c=0;c<=m;c++){var a=c,h=c+1;c==m&&(h=0);var b=d[a][0],a=d[a][1],t=d[h][0],h=d[h][1],f=h>=a?1:-1;if(a<=g[1]&&g[1]<=h||h<=g[1]&&g[1]<=a)g[1]!=a&&g[1]!=h?(l.push((g[1]-a)*(t-b)/(h-a)+b),e=f):g[1]==a&&g[1]!=h?(e!=f&&l.push(b),e=f):g[1]!=
a&&g[1]==h?(l.push(t),e=f):g[1]==a&&g[1]==h&&(1==e&&l.push(b),l.push(t),e=f)}},_sortBuffer:function(d,l,g,m){var e=d.length;d.sort();if(0<e){for(var c=0,a=l=0;a<e-1;a+=2){var h=Math.abs(d[a+1]-d[a]);!(d[a]<=g&&d[a+1]<=g||d[a]>=m&&d[a+1]>=m)&&h>c&&(c=h,l=a)}e=d[l];d=d[l+1];e>m&&(e=m);e<g&&(e=g);d>m&&(d=m);d<g&&(d=g);l=(e+d)/2}return l},_findPlace:function(f,l,g,m,e,c,a){if(isNaN(g)||isNaN(m))return!1;for(var h=0;h<this._placedLabels.length;h++){var b=this._placedLabels[h].angle,t=this._placedLabels[h].width*
this._scale,u=this._placedLabels[h].height*this._scale,p=this._placedLabels[h].x-g,k=this._placedLabels[h].y-m;if(0===e&&0===b){if(this._findPlace2(-c*this._scale,-a*this._scale,c*this._scale,a*this._scale,p-t,k-u,p+t,k+u))return!1}else{var n=new d(-c*this._scale,-a*this._scale,c*this._scale,a*this._scale,null),q=0,y=1;0!==e&&(q=Math.sin(e),y=Math.cos(e));var z=p*y-k*q,p=p*q+k*y,b=b-e,q=Math.sin(b),y=Math.cos(b),w=-t*y- -u*q,k=-t*q+-u*y,b=+t*y- -u*q,A=+t*q+-u*y,t=z+w,u=p-k,q=z+b,y=p-A,w=z-w,k=p+k,
z=z-b,p=p+A,b=new r;b.addRing([[t,u],[q,y],[w,k],[z,p],[t,u]]);if(n.intersects(b))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;h={};h.layer=f;h.text=l;h.angle=e;h.x=g;h.y=m;h.width=c;h.height=a;this._placedLabels.push(h);return!0},_findPlace2:function(d,l,g,m,e,c,a,h){return(d>=e&&d<=a||g>=e&&g<=a||d<=e&&g>=a)&&(l>=c&&l<=h||m>=c&&m<=h||l<=c&&m>=h)?!0:!1},_clipLine:function(d,l,g,m){for(var e=this._code(d,l),c=this._code(g,m);0!==e||0!==c;){if(0!==(e&c))return!1;var a=g-d,
h=m-l;0!==e?(d<this._xmin?(l+=h*(this._xmin-d)/a,d=this._xmin):d>this._xmax?(l+=h*(this._xmax-d)/a,d=this._xmax):l<this._ymin?(d+=a*(this._ymin-l)/h,l=this._ymin):l>this._ymax&&(d+=a*(this._ymax-l)/h,l=this._ymax),e=this._code(d,l)):(g<this._xmin?(m+=h*(this._xmin-g)/a,g=this._xmin):g>this._xmax?(m+=h*(this._xmax-g)/a,g=this._xmax):m<this._ymin?(g+=a*(this._ymin-m)/h,m=this._ymin):m>this._ymax&&(g+=a*(this._ymax-m)/h,m=this._ymax),c=this._code(g,m))}this._x0=d;this._y0=l;this._x1=g;this._y1=m;return!0},
_code:function(d,l){var g=0;d<this._xmin&&(g+=8);d>this._xmax&&(g+=4);l<this._ymin&&(g+=2);l>this._ymax&&(g+=1);return g}});n("extend-esri")&&f.setObject("layers.labelLayerUtils.DynamicLabelClass",q,k);return q})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(q,f,n,k,d,r,p){return q(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",
constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(d,g){this._labelLayer=g;this._map=d;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){var g,m,e,c,a,h,b,t,l;this._preparedLabels=
d;this._placedLabels=[];for(d=this._preparedLabels.length-1;0<=d;d--){g=this._preparedLabels[d];a=g.labelWidth;h=g.labelHeight;t=(b=g.options)&&b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter";l=b&&b.lineLabelPosition?b.lineLabelPosition:"Above";m=b&&b.labelRotation?b.labelRotation:!0;e=Math.PI/180*g.angle;c=b&&b.howManyLabels?b.howManyLabels:"OneLabel";var f=[];if("point"===g.geometry.type)this._generatePointPositions(g.geometry.x,g.geometry.y,g.text,e,a,h,g.symbolWidth,g.symbolHeight,b,
f);else if("multipoint"===g.geometry.type)for(m=0;m<g.geometry.points.length;m++)this._generatePointPositions(g.geometry.points[m][0],g.geometry.points[m][1],g.text,e,a,h,g.symbolWidth,g.symbolHeight,b,f);else if("polyline"===g.geometry.type)if("PlaceAtStart"===t)this._generateLinePositionsPlaceAtStart(g.geometry,!0,g.text,a,h,2*g.symbolHeight+h,t,l,m,f);else if("PlaceAtEnd"===t)this._generateLinePositionsPlaceAtEnd(g.geometry,!0,g.text,a,h,2*g.symbolHeight+h,t,l,m,f);else{b=[];var k=g.geometry.getExtent(),
n=this._map.extent;if(k.getWidth()<a*this._scale/this._OVERRUN&&k.getHeight()<a*this._scale/this._OVERRUN)continue;else.5*k.getWidth()<n.getWidth()&&.5*k.getHeight()<n.getHeight()?this._generateLinePositionsPlaceAtCenter(g.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,g.text,a,h,2*g.symbolHeight+h,t,l,m,b):this._generateLinePositionsPlaceAtCenter(g.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,g.text,a,h,2*g.symbolHeight+h,t,l,m,b);this._postSorting(n,
b,f)}else if("polygon"===g.geometry.type){t=[];for(m=0;m<g.geometry.rings.length;m++)l=g.geometry.rings[m],1<g.geometry.rings.length&&!p.prototype.isClockwise(l)||(b=this._calcRingExtent(l),b.xmax-b.xmin<4*a*this._scale/this._OVERRUN&&b.ymax-b.ymin<4*h*this._scale/this._OVERRUN||t.push(l));t.sort(function(a,b){return b.length-a.length});for(m=0;m<t.length;m++)this._generatePolygonPositionsForManyLabels(t[m],g.geometry.spatialReference,g.text,e,a,h,f)}for(m=0;m<f.length&&(t=f[m].x,l=f[m].y,void 0!==
f[m].angle&&(e=f[m].angle),b=this._findPlace(g,g.text,t,l,e,a,h),"OneLabel"!==c||!b||!this._labelLayer._isWithinScreenArea(new r(t,l,g.geometry.spatialReference)));m++);}return this._placedLabels},_generatePointPositions:function(d,g,m,e,c,a,h,b,t,f){m=t&&t.pointPriorities?t.pointPriorities:"AboveRight";c=(h+c)*this._scale;a=(b+a)*this._scale;switch(m.toLowerCase()){case "aboveleft":d-=c;g+=a;break;case "abovecenter":g+=a;break;case "aboveright":d+=c;g+=a;break;case "centerleft":d-=c;break;case "centercenter":break;
case "centerright":d+=c;break;case "belowleft":d-=c;g-=a;break;case "belowcenter":g-=a;break;case "belowright":d+=c;g-=a;break;default:return}f.push({x:d,y:g})},_generateLinePositionsPlaceAtStart:function(d,g,m,e,c,a,h,b,t,f){h=e*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,u,p,k,r,n,w,q,F;for(u=0;u<d.paths.length;u++){var E=d.paths[u],G=h,H=0;for(p=0;p<E.length-1;p++)k=E[p][0],r=E[p][1],n=E[p+1][0],w=E[p+1][1],q=n-k,F=w-r,q=Math.sqrt(q*q+F*F),H+q>
G?(H=this._generatePositionsOnLine(d.spatialReference,g,G,l,H,k,r,n,w,m,e,c,a,b,t,f),G=l):H+=q}},_generateLinePositionsPlaceAtEnd:function(d,g,m,e,c,a,h,b,t,f){h=e*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,u,p,k,r,n,w,q,F;for(u=0;u<d.paths.length;u++){var E=d.paths[u],G=h,H=0;for(p=E.length-2;0<=p;p--)k=E[p+1][0],r=E[p+1][1],n=E[p][0],w=E[p][1],q=n-k,F=w-r,q=Math.sqrt(q*q+F*F),H+q>G?(H=this._generatePositionsOnLine(d.spatialReference,g,G,l,H,k,
r,n,w,m,e,c,a,b,t,f),G=l):H+=q}},_generateLinePositionsPlaceAtCenter:function(d,g,m,e,c,a,h,b,t,f,p){var l,u,k,r,v,w,n,q;for(b=0;b<d.paths.length;b++){var E=d.paths[b];if(!(2>E.length)){if(2==E.length){r=E[0];l=E[1];k=r[0];r=r[1];E=l[0];w=l[1];v=(E-k)*(E-k)+(w-r)*(w-r);n=Math.atan2(w-r,E-k);w=Math.cos(n);n=Math.sin(n);E=[];q=k;for(var G=r;(q-k)*(q-k)+(G-r)*(G-r)<v;)E.push([q,G]),q+=m/2*w,G+=m/2*n;E.push(l)}var H=0;for(l=0;l<E.length-1;l++)k=E[l][0],r=E[l][1],v=E[l+1][0],w=E[l+1][1],n=v-k,q=w-r,H+=
Math.sqrt(n*n+q*q);for(l=G=0;l<E.length-1;l++){k=E[l][0];r=E[l][1];v=E[l+1][0];w=E[l+1][1];n=v-k;q=w-r;n=Math.sqrt(n*n+q*q);if(G+n>H/2)break;G+=n}l==E.length-1&&l--;k=E[l][0];r=E[l][1];v=E[l+1][0];w=E[l+1][1];n=v-k;q=w-r;G=H/2-G;n=Math.atan2(q,n);q=k+G*Math.cos(n);n=r+G*Math.sin(n);k=this._angleAndShifts(k,r,v,w,h,t,f);p.push({x:q+k.shiftX,y:n+k.shiftY,angle:k.angle});var H=q,L=n,G=0;for(u=l;u<E.length-1;u++)u==l?(k=H,r=L):(k=E[u][0],r=E[u][1]),v=E[u+1][0],w=E[u+1][1],n=v-k,q=w-r,n=Math.sqrt(n*n+
q*q),G=G+n>m?this._generatePositionsOnLine(d.spatialReference,g,m,m,G,k,r,v,w,e,c,a,h,t,f,p):G+n;G=0;for(u=l;0<=u;u--)u==l?(k=H,r=L):(k=E[u+1][0],r=E[u+1][1]),v=E[u][0],w=E[u][1],n=v-k,q=w-r,n=Math.sqrt(n*n+q*q),G=G+n>m?this._generatePositionsOnLine(d.spatialReference,g,m,m,G,k,r,v,w,e,c,a,h,t,f,p):G+n}}},_generatePositionsOnLine:function(l,g,m,e,c,a,h,b,t,f,p,k,r,n,q,z){f=Math.atan2(t-h,b-a);p=a;k=h;var u=p,v=k;do if(c=m-c,p+=c*Math.cos(f),k+=c*Math.sin(f),this._belongs(p,k,a,h,b,t))c=this._angleAndShifts(a,
h,b,t,r,n,q),m=p+c.shiftX,v=k+c.shiftY,g?this._labelLayer._isWithinScreenArea(new d(m,v,m,v,l))&&z.push({x:m,y:v,angle:c.angle}):z.push({x:m,y:v,angle:c.angle}),u=p,v=k,c=0,m=e;else return l=b-u,t-=v,Math.sqrt(l*l+t*t);while(1)},_postSorting:function(d,g,m){if(d&&0<g.length){var e=.5*(d.xmin+d.xmax);d=.5*(d.ymin+d.ymax);for(var c=g[0].x,a=g[0].y,h=Math.sqrt((c-e)*(c-e)+(a-d)*(a-d)),b=g[0].angle,t=0;t<g.length;t++){var l=g[t].x,f=g[t].y,p=Math.sqrt((l-e)*(l-e)+(f-d)*(f-d));p<h&&(c=l,a=f,h=p,b=g[t].angle)}m.push({x:c,
y:a,angle:b})}},_belongs:function(d,g,m,e,c,a){if(c==m&&a==e)return!1;if(c>m){if(d>c||d<m)return!1}else if(d<c||d>m)return!1;if(a>e){if(g>a||g<e)return!1}else if(g<a||g>e)return!1;return!0},_angleAndShifts:function(d,g,m,e,c,a,h){for(d=Math.atan2(e-g,m-d);d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;e=Math.sin(d);var b=Math.cos(d);m=g=0;"Above"==a&&(g=c*e*this._scale,m=c*b*this._scale);"Below"==a&&(g=-c*e*this._scale,m=-c*b*this._scale);c=[];c.angle=h?-d:0;c.shiftX=-g;c.shiftY=m;return c},
_generatePolygonPositionsForManyLabels:function(d,g,m,e,c,a,h){c=this._findCentroidForRing(d);e=c[0];var b=c[1],t=this._calcRingExtent(d);c=t.xmin;a=t.ymin;var l=t.xmax,t=t.ymax,f=(t-a)/(this._map.height*this._scale);if(!(10<(l-c)/(this._map.width*this._scale)&&10<f)){var p=!0;if(l-c>this._map.width*this._scale||t-a>this._map.height*this._scale)p=!1;var f=this._map.width*this._scale*(p?.1875:.5),p=this._map.height*this._scale*(p?.1875:.5),k=!0,r=!0,n=0;do{b+=(n%2?-1:1)*n*p;if(this._scanRingByX(m,
g,d,e,b,c,l,f,h))break;b<a&&(k=!1);b>t&&(r=!1);n++}while(k||r)}},_scanRingByX:function(l,g,m,e,c,a,h,b,t){var f=!0,p=!0,k=0,r=1E3;do{e+=(k%2?-1:1)*k*b;var n=this._movePointInsideRing(m,e,c),q=this._labelLayer._isWithinScreenArea(new d(n,c,n,c,g)),z=this._isPointWithinRing(l,m,n,c);if(q&&z)return t.push({x:n,y:c}),!0;e<a&&(f=!1);e>h&&(p=!1);k++;r--;if(0>=r)return!0}while(f||p);return!1},_movePointInsideRing:function(d,g,m){for(var e=[],c=d.length-1,a=d[0][1]>=d[c][1]?1:-1,h=0;h<=c;h++){var b=h,t=h+
1;h==c&&(t=0);var l=d[b][0],b=d[b][1],f=d[t][0],t=d[t][1],p=t>=b?1:-1;if(b<=m&&m<=t||t<=m&&m<=b)m!=b&&m!=t?(e.push((m-b)*(f-l)/(t-b)+l),a=p):m==b&&m!=t?(a!=p&&e.push(l),a=p):m!=b&&m==t?(e.push(f),a=p):m==b&&m==t&&(1==a&&e.push(l),e.push(f),a=p)}e.sort(function(a,b){return a-b});d=e.length;if(0<d){for(h=m=g=0;h<d-1;h+=2)c=Math.abs(e[h+1]-e[h]),c>g&&(g=c,m=h);g=(e[m]+e[m+1])/2}return g},_calcRingExtent:function(l){var g,m;m=new d;for(g=0;g<l.length-1;g++){var e=l[g][0],c=l[g][1];if(void 0===m.xmin||
e<m.xmin)m.xmin=e;if(void 0===m.ymin||c<m.ymin)m.ymin=c;if(void 0===m.xmax||e>m.xmax)m.xmax=e;if(void 0===m.ymax||c>m.ymax)m.ymax=c}return m},_isPointWithinPolygon:function(d,g,m,e){var c;for(c=0;c<g.rings.length;c++)if(this._isPointWithinRing(d,g.rings[c],m,e))return!0;return!1},_isPointWithinRing:function(d,g,m,e){var c,a,h,b,t=[],l=g.length;for(d=0;d<l-1;d++)if(c=g[d][0],a=g[d][1],h=g[d+1][0],b=g[d+1][1],c!=h||a!=b){if(a==b)if(e==a)t.push(c);else continue;c==h?(a<b&&e>=a&&e<b&&t.push(c),a>b&&e<=
a&&e>b&&t.push(c)):(a=(h-c)/(b-a)*(e-a)+c,c<h&&a>=c&&a<h&&t.push(a),c>h&&a<=c&&a>h&&t.push(a))}t.sort(function(a,b){return a-b});for(d=0;d<t.length-1;d++)if(c=t[d],h=t[d+1],m>=c&&m<h)if(d%2)break;else return!0;return!1},_findCentroidForRing:function(d){for(var g=d.length,m=[0,0],e=0,c=d[0][0],a=d[0][1],h=1;h<g-1;h++){var b=d[h][0],t=d[h][1],l=d[h+1][0],f=d[h+1][1],p=(b-c)*(f-a)-(l-c)*(t-a);m[0]+=p*(c+b+l);m[1]+=p*(a+t+f);e+=p}m[0]/=3*e;m[1]/=3*e;return m},_findCentroidForFeature:function(d){for(var g=
0,m=[0,0],e=0;e<d.rings.length;e++)for(var c=d.rings[e],a=c.length,h=c[0][0],b=c[0][1],t=1;t<a-1;t++){var l=c[t][0],f=c[t][1],p=c[t+1][0],k=c[t+1][1],r=(l-h)*(k-b)-(p-h)*(f-b);m[0]+=r*(h+l+p);m[1]+=r*(b+f+k);g+=r}m[0]/=3*g;m[1]/=3*g;return m},_findPlace:function(l,g,m,e,c,a,h){if(isNaN(m)||isNaN(e))return!1;for(var b=0;b<this._placedLabels.length;b++){var t=this._placedLabels[b].angle,f=this._placedLabels[b].width*this._scale,k=this._placedLabels[b].height*this._scale,r=this._placedLabels[b].x-m,
n=this._placedLabels[b].y-e;if(0===c&&0===t){if(this._findPlace2(-a*this._scale,-h*this._scale,a*this._scale,h*this._scale,r-f,n-k,r+f,n+k))return!1}else{var q=new d(-a*this._scale,-h*this._scale,a*this._scale,h*this._scale,null),y=0,z=1;0!==c&&(y=Math.sin(c),z=Math.cos(c));var w=r*z-n*y,r=r*y+n*z,t=t-c,y=Math.sin(t),z=Math.cos(t),A=-f*z- -k*y,n=-f*y+-k*z,t=+f*z- -k*y,F=+f*y+-k*z,f=w+A,k=r-n,y=w+t,z=r-F,A=w-A,n=r+n,w=w-t,r=r+F,t=new p;t.addRing([[f,k],[y,z],[A,n],[w,r],[f,k]]);if(q.intersects(t))return!1}}for(;c>
Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;b={};b.layer=l;b.text=g;b.angle=c;b.x=m;b.y=e;b.width=a;b.height=h;this._placedLabels.push(b);return!0},_findPlace2:function(d,g,m,e,c,a,h,b){return(d>=c&&d<=h||m>=c&&m<=h||d<=c&&m>=h)&&(g>=a&&g<=b||e>=a&&e<=b||g<=a&&e>=b)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E,G,H,L,J,K,O,N,S,Q,M,P,I,V,U){var R=f([V,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new p([64,64,64]),defaultText:"Aa",sizeRampLightColor:new p([255,255,255]),sizeRampDarkColor:new p([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",
gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){n.mixin(this,U.widgets.legend);this._i18n=U.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===R.ALIGN_RIGHT?R.ALIGN_RIGHT:R.ALIGN_LEFT,this.arrangement===R.ALIGN_RIGHT&&
(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=l(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],q.locale&&-1!==q.locale.indexOf(c)&&(-1!==q.locale.indexOf("-")?-1!==q.locale.indexOf(c+
"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>g("ie")&&(this._repaintItems=n.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();
this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||k.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],k.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=
a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)b.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],k.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];var a=[],b=[];k.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var e;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(e=c.getLayers(),k.forEach(e,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(e=c.getFeatureLayers(),k.forEach(e,function(a){b.push(a.id)},this))},this);k.forEach(this.map.graphicsLayerIds,function(c){var e=
this.map.getLayer(c);-1==k.indexOf(a,c)&&-1==k.indexOf(b,c)&&this._isSupportedLayerType(e)&&this._isLayerDrawingEnabled(e)&&(e.arcgisProps&&e.arcgisProps.title&&(e._titleForLegend=e.arcgisProps.title),this.layers.push(e))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&a.isFeatureReductionActive())},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,
"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),k.forEach(this.layers,function(a){var b={};b.oarcConnect=d.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers");b.oaicConnect=d.connect(a,"onFeatureReductionChange",this,"_refreshLayers");
b.ovcConnect=d.connect(a,"onVisibilityChange",this,"_refreshLayers");b.oocConnect=d.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=d.connect(a,"_onDynamicLayersChange",n.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=d.connect(a,"onRenderingChange",n.partial(this._updateImageServiceLayers,
this,a)),b.oivrConnect=d.connect(a,"onRendererChange",n.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(b.oivrConnect=d.connect(a,"onRendererChange",n.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);this._olroConnect&&d.disconnect(this._olroConnect);this._olrConnect&&d.disconnect(this._olrConnect);
k.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.oarcConnect&&d.disconnect(a.oarcConnect);a.oaicConnect&&d.disconnect(a.oaicConnect);a.ovcConnect&&d.disconnect(a.ovcConnect);a.oocConnect&&d.disconnect(a.oocConnect);a.oscConnect&&d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect);a.oivrConnect&&d.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},
_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];k.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);k.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=
!1,e=!1;t.set(this.domNode,"position","relative");b.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var g=[];k.forEach(this.layers,function(c){if("esri.layers.KMLLayer"==c.declaredClass||"esri.layers.GeoRSSLayer"==c.declaredClass){var h;c.loaded?("esri.layers.KMLLayer"==c.declaredClass?h=c.getLayers():"esri.layers.GeoRSSLayer"==c.declaredClass&&(h=c.getFeatureLayers(),this.hideLayersInLegend[c.id]&&(h=k.filter(h,function(a){return-1==
k.indexOf(this.hideLayersInLegend[c.id],a.id)},this))),k.forEach(h,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&c._titleForLegend&&(a._titleForLegend=c._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_areas),g.push(a))},this)):d.connect(c,"onLoad",n.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===
c.declaredClass)if(!c.loaded)d.connect(c,"onLoad",n.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&c.visible)&&0<c.layerInfos.length&&k.some(c.layerInfos,function(a){return a.legendURL})){var m=!1;k.forEach(c.layerInfos,function(e){if(e.legendURL&&-1<k.indexOf(c.visibleLayers,e.name)){m||(b.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(c._titleForLegend||c.name||c.id)+"\x3c/span\x3e"},this.domNode),m=!0);
var h;e=e.legendURL;if(c.customParameters||c.customLayerParameters){var g=n.clone(c.customParameters||{});n.mixin(g,c.customLayerParameters||{});for(h in g)e+=(-1===e.indexOf("?")?"?":"\x26")+h+"\x3d"+g[h]}b.create("div",{innerHTML:"\x3cimg src\x3d'"+e+"'/\x3e"},this.domNode);a=!0}},this)}}else"esri.layers.WFSLayer"!==c.declaredClass||c.renderer?g.push(c):(h=b.create("div",{id:this.id+"_"+c.id,"class":"esriLegendService"}),b.create("span",{innerHTML:this._getServiceTitle(c),"class":"esriLegendServiceLabel"},
b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},h))))),b.place(h,this.id,"first"),h=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},h),h=b.create("tbody",{},h),"esriGeometryComplex"===c.geometryType?(this._buildRow_Renderer(c,c._pointSymbol,null,this.NLS_points,null,h),this._buildRow_Renderer(c,c._lineSymbol,null,this.NLS_lines,null,h),this._buildRow_Renderer(c,c._polygonSymbol,null,this.NLS_areas,null,h)):
"esriGeometryPoint"===c.geometryType?this._buildRow_Renderer(c,c._pointSymbol,null,"",null,h):"esriGeometryPolyline"===c.geometryType?this._buildRow_Renderer(c,c._lineSymbol,null,"",null,h):"esriGeometryPolygon"===c.geometryType&&this._buildRow_Renderer(c,c._polygonSymbol,null,"",null,h),e=!0)},this);var m=[];k.forEach(g,function(a){if(!a.loaded)var c=d.connect(a,"onLoad",this,function(a){d.disconnect(c);c=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&
(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var e=b.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},e)))));b.place(e,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass?this._createLegendForLayer(a):
this.isHostedTileService(a)?this._getLayerInfos(a).then(n.hitch(this,function(a){this._createLegendForLayer(a)}),n.hitch(this,function(a){m.push(this._legendRequest(a))})):m.push(this._legendRequest(a))}},this);0!==m.length||a||e?(new c(m)).addCallback(n.hitch(this,function(b){a||e?h.byId(this.id+"_msg").innerHTML="":h.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(h.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||
a.renderer||this.isHostedTileService(a)){var b=!1;if(a.legendResponse||this.isHostedTileService(a)){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?k.forEach(c,function(c,e){this.hideLayersInLegend[a.id]&&-1!==k.indexOf(this.hideLayersInLegend[a.id],c.id)||(c=this._buildLegendItems(a,c,e),b=b||c)},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(t.set(h.byId(this.id+"_"+a.id),"display","block"),t.set(h.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",n.hitch(this,"_legendRequest"))},_legendRequestServer:function(b){var c=b.url,e=c.indexOf("?"),c=-1<e?c.substring(0,e)+"/legend"+c.substring(e):c+"/legend";
(e=b._getToken())&&(c+="?token\x3d"+e);var h=n.hitch(this,"_processLegendResponse"),g={f:"json"};b._params.dynamicLayers&&(g.dynamicLayers=a.stringify(this._createDynamicLayers(b)),"[{}]"===g.dynamicLayers&&(g.dynamicLayers="[]"));b._params.bandIds&&(g.bandIds=b._params.bandIds);b._params.renderingRule?g.renderingRule=b._params.renderingRule:b.rasterFunctionInfos&&0<b.rasterFunctionInfos.length&&k.forEach(b.rasterFunctionInfos,function(b){b&&b.name&&"none"===b.name.toLowerCase()&&(g.renderingRule=
a.stringify({rasterFunction:b.name}))});return w({url:c,content:g,callbackParamName:"callback",load:function(a,c){h(b,a,c)},error:z.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!g("ie")||8<g("ie"))b+="\x26returnbytes\x3dtrue";var c=n.hitch(this,"_processLegendResponse");return w({url:b,content:{f:"json"},callbackParamName:"callback",
load:function(b,e){c(a,b,e)},error:z.defaults.io.errorHandler})},_processLegendResponse:function(a,c){c&&c.layers?(a.legendResponse=c,h.byId(this.id+"_"+a.id)&&b.empty(h.byId(this.id+"_"+a.id)),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},h.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+
r.toJson(c))},_buildLegendItems:function(a,c,e){var g=!1,d=h.byId(this.id+"_"+a.id),m=c.parentLayerId;if(c.subLayerIds)a=b.create("div",{id:this.id+"_"+a.id+"_"+c.id+"_group",style:{display:"none"},"class":-1==m?0<e?"esriLegendGroupLayer":"":this._legendAlign},-1==m?d:h.byId(this.id+"_"+a.id+"_"+m+"_group")),b.create("td",{innerHTML:B.encode(c.name),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&
a.visibleLayers)if(e=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===k.indexOf(a.visibleLayers,c.id))return g}else{if(e=this._getReallyVisibleLayers(e,a.visibleLayers),-1===k.indexOf(e,c.id))return g}else if(-1===k.indexOf(a.visibleLayers,c.id))return g;d=b.create("div",{id:this.id+"_"+a.id+"_"+c.id,style:{display:"none"},"class":-1<m?this._legendAlign:""},-1==m?d:h.byId(this.id+"_"+a.id+"_"+m+"_group"));b.create("td",{innerHTML:B.encode(c.name)||"",align:this._align},b.create("tr",
{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},d))));e=a.dynamicLayerInfos||a.layerInfos;m=!1;e&&e.length&&(m=k.some(e,function(a){return!!a.drawingInfo}));if(a.legendResponse)g=g||this._buildLegendItems_Tools(a,c,d);else if(a.renderer||m)g=g||this._buildLegendItems_Renderer(a,c,d)}return g},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],e=[],h;for(h=0;h<a.length;h++)if(a[h].subLayerIds){if(-1===k.indexOf(b,a[h].id)||-1<k.indexOf(e,
a[h].id))e=e.concat(a[h].subLayerIds)}else-1<k.indexOf(b,a[h].id)&&-1===k.indexOf(e,a[h].id)&&c.push(a[h].id);return c},_buildLegendItems_Tools:function(a,c,e){var g=c.parentLayerId,d=this.map.getScale(),m=!1,l=function(a,b){var c,e;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(e=0;e<b.dynamicLayerInfos[e].length;e++){if(b.dynamicLayerInfos[e].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,
c,d)){var f=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var u=this._getEffectiveScale(a,c);if(u.minScale&&u.minScale<d||u.maxScale&&u.maxScale>d)f=!1}if(f){var d=l(a.legendResponse.layers,c),p=d.legendType,r=d.layerType,w=d.legend;if(w){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,d,c);e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},e);var n=b.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,c);var v=[];k.forEach(w,function(b){if(!(10.1<=a.version&&!b.values&&1<w.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==b.label&&(b.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===r)){var e=b.label;if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)m=!0,e&&-1!==k.indexOf(v,e)||(v.push(e),this._buildRow_Tools(b,
n,a,c.id,p))}},this)}}}m&&(t.set(h.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<g&&(t.set(h.byId(this.id+"_"+a.id+"_"+g+"_group"),"display","block"),this._findParentGroup(a.id,a,g)));return m},_getLayerInfos:function(a){var b=new e,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(k.some(c,function(a){return!!a.drawingInfo}))b.resolve(a);else{var h=a.url,g=h.indexOf("?"),h=-1==g?h+"/layers":h.substring(0,g)+"/layers"+h.substring(g,h.length);w({url:h,content:{f:"json"},callbackParamName:"callback",
load:function(e,h){e.layers?(k.forEach(c,function(a){var b=k.filter(e.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});b&&b[0]&&b[0].drawingInfo&&(a.drawingInfo=b[0].drawingInfo,a.fields=b[0].fields)}),b.resolve(a)):b.reject(a)},error:function(c){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,c){var e=b.legend;if(10.1<=a.version&&1<e.length&&!b._sanitized){a=n.getObject("layerDefinition.drawingInfo.renderer",!1,c);var h,g;a||(a=n.getObject("drawingInfo.renderer",
!1,c));k.some(e,function(a){if(a.values)return!0})&&k.some(e,function(a,b){a.values||(g=b,h=a);return!!h});a?"uniqueValue"===a.type?h&&(e.splice(g,1),e.push(h)):"classBreaks"===a.type&&(h&&e.splice(g,1),e.reverse(),h&&e.push(h)):h&&(e.splice(g,1),e.push(h));b._sanitized=!0}},_buildRow_Tools:function(a,c,e,h,d){var m=b.create("tr",{},c),t;this.alignRight?(c=b.create("td",{align:this._isRightToLeft?"left":"right"},m),t=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},m)):(t=b.create("td",
{width:35,align:"center"},m),c=b.create("td",{},m));m=a.url;(!g("ie")||9<=g("ie")||9>g("ie")&&"esri.layers.ArcGISImageServiceLayer"===e.declaredClass)&&a.imageData&&0<a.imageData.length?m="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(m=e.url+"/"+h+"/images/"+a.url,(h=e._getToken())&&(m+="?token\x3d"+h));h=b.create("img",{src:m,border:0,style:"opacity:"+e.opacity},t);a=b.create("td",{innerHTML:B.encode(a.label),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",
{width:"95%",dir:"ltr"},c))));d&&"Stretched"===d&&10.3<=e.version&&"esri.layers.ArcGISImageServiceLayer"===e.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",h.style.marginBottom="-1px",h.style.display="block",c.style.verticalAlign="top");9>g("ie")&&(h.style.filter="alpha(opacity\x3d"+100*e.opacity+")")},_getVariable:function(a,b,c){var e;a&&(e=(a=a.getVisualVariablesForType(b,c))&&a[0]);return e},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,
"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?k.filter(a,function(a){return!(!a||a.field!==b||a.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var e=b.infoTemplate||(b.infoTemplates&&c&&b.infoTemplates[c.id]?b.infoTemplates[c.id].infoTemplate:null),e=e&&e.getFieldInfo&&e.getFieldInfo(a);a=n.isFunction(a)?null:this.getField(b,a,c);b=e||a;c="";b&&(c=e&&e.label||a&&a.alias||b.name||b.fieldName);return c},_getDomainName:function(a,b,c,e){var h;a&&!n.isFunction(a)&&(h=(c=(a=
this.getField(c,a,e))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null);return h},_getRampTitle:function(a,b,c){var e,h=a.field,g=a.normalizationField,d=!1,m=!1,t=!1,h=n.isFunction(h)?null:h,g=n.isFunction(g)?null:g;if(a.legendOptions&&a.legendOptions.title)e=a.legendOptions.title;else if(a.valueExpressionTitle)e=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var l=b.renderer.authoringInfo.visualVariables;for(a=
0;a<l.length;a++){var f=l[a];if("colorInfo"===f.type&&"ratio"===f.style){d=!0;break}else if("colorInfo"===f.type&&"percent"===f.style){m=!0;break}else if("colorInfo"===f.type&&"percentTotal"===f.style){t=!0;break}}}(d=t&&"showRatioPercentTotal"||m&&"showRatioPercent"||d&&"showRatio"||g&&"showNormField"||h&&"showField"||null)&&(e=A.substitute({field:h&&this._getFieldAlias(h,b,c),normField:g&&this._getFieldAlias(g,b,c)},this._i18n[d]))}return e},_getRendererTitle:function(a,b,c){var e;if(a){var h,g,
d;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(h=a.attributeField,g=a.normalizationField,d="percent-of-total"===a.normalizationType);h=n.isFunction(h)?null:h;g=n.isFunction(g)?null:g;a.legendOptions&&a.legendOptions.title?e=a.legendOptions.title:a.valueExpressionTitle?e=a.valueExpressionTitle:(a=g&&"showNormField"||(d?"showNormPct":null)||h&&"showField"||null)&&(e=A.substitute({field:h&&this._getFieldAlias(h,b,c),normField:g&&this._getFieldAlias(g,b,c)},this._i18n[a]))}return e},_buildLegendItems_Renderer:function(a,
c,e){var g=c.parentLayerId,d=this.map,m=d.getScale(),l,f=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,c,m)){var u,p,r,w,v,C,z,q;r="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:c&&c.drawingInfo?I.fromJson(n.clone(c.drawingInfo.renderer)):a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===r.declaredClass&&(r=(d="zoom"===r.rangeType?r.getRendererInfoByZoom(d.getZoom()):
r.getRendererInfoByScale(m))&&d.renderer,!r))return!1;var A=this._getVariables(r),y=k.filter(A,function(a){return!!a}).length,m=A[0],d=A[1],A=A[2],D,L,K,F,G;m&&(w=this._getMedianColor(r,m),m.field&&(C=n.isFunction(m.field)?null:this.getField(a,m.field,c)),D=!(m.legendOptions&&!1===m.legendOptions.showLegend));d&&(d.field&&(q=n.isFunction(d.field)?null:this.getField(a,d.field,c)),L=!(d.legendOptions&&!1===d.legendOptions.showLegend));A&&(A.field&&(z=n.isFunction(A.field)?null:this.getField(a,A.field,
c)),K=!(A.legendOptions&&!1===A.legendOptions.showLegend));if("esri.renderer.HeatmapRenderer"===r.declaredClass)l=f=!0,this._showHeatRamp(a,c,r,e);else if("esri.renderer.DotDensityRenderer"===r.declaredClass)l=f=!0,this._showDotDensityLegend(a,c,r,e);else if("esri.renderer.TemporalRenderer"===r.declaredClass)l=f=!0,p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),u=b.create("tbody",{},p),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,a,c),r.latestObservationRenderer&&
"esri.renderer.SimpleRenderer"===r.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(a,r.latestObservationRenderer.symbol,w,B.encode(r.latestObservationRenderer.label)||this.NLS_currentObservations,null,u),r.observationRenderer&&"esri.renderer.SimpleRenderer"===r.observationRenderer.declaredClass&&this._buildRow_Renderer(a,r.observationRenderer.symbol,w,B.encode(r.observationRenderer.label)||this.NLS_previousObservations,null,u);else if("esri.renderer.UniqueValueRenderer"===r.declaredClass){if(r.infos&&
0<r.infos.length){l=f=!0;if(r.legendOptions&&r.legendOptions.title||r.valueExpressionTitle)p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),u=b.create("tbody",{},p),y=r.legendOptions&&r.legendOptions.title?r.legendOptions.title:r.valueExpressionTitle,this._buildRow_Renderer(a,null,w,B.encode(y),null,u);p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);u=b.create("tbody",{},p);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,
a,c);r.attributeField&&A&&this._addSubHeader(u,this._getFieldAlias(r.attributeField,a,c));var E=[];k.forEach(r.infos,function(b){var e=null;a._editable&&a.types&&(e=this._getTemplateFromTypes(a.types,b.value));var h=b.label;null==h&&(h=this._getDomainName(r.attributeField,b.value,a,c)||b.value);-1===k.indexOf(E,h)&&(E.push(h),this._buildRow_Renderer(a,b.symbol,w,B.encode(h),e,u))},this)}G=this._displayDefaultSymbol(a,r,e)}else if("esri.renderer.ClassBreaksRenderer"===r.declaredClass){if(r.infos&&
0<r.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)l=f=!0,F=this._isUnclassedRenderer(r),m||1!==r.infos.length||(v=(v=r.infos[0])&&v.symbol),F||(p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),u=b.create("tbody",{},p),y=this._getRendererTitle(r,a,c),this._buildRow_Renderer(a,null,w,B.encode(y),null,u)),p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),u=b.create("tbody",{},p),(a._hoverLabel||
a._hoverLabels)&&this._createHoverAction(p,a,c),F&&A&&K||(y=r.infos.slice(0).reverse(),k.forEach(y,function(b){var c=b.label;null!=c||F||(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,w,B.encode(c),null,u)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==N.STYLE_SCALAR&&a.renderer.style!==N.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,r.defaultSymbol,null,"",null,u),a._hideDefaultSymbol=!0);F||(G=this._displayDefaultSymbol(a,r,e))}else"esri.renderer.SimpleRenderer"===
r.declaredClass&&(l=f=!0,p=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),u=b.create("tbody",{},p),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,a,c),v=null,a._editable&&a.templates&&0<a.templates.length&&(v=a.templates[0]),p=1<y?null:C&&D||q&&L||z&&K,this._buildRow_Renderer(a,r.symbol,w,B.encode(p?this._getRampTitle(1<y?null:m||d||A,a,c):r.label),v,u),v=m?null:r.symbol,p&&(C=q=z=null));l&&(m&&D&&(m.field||m.valueExpression)&&this._showGradientRamp(a,
c,r,null,e,m,C,null,A&&K?!0:!1),A&&K&&(A.field||A.valueExpression)&&(l=m&&D||"esri.renderer.UniqueValueRenderer"===r.declaredClass?!1:!0,this._showSizeLegend(a,c,r,A,w,e,z,null,l)),d&&L&&(d.field||d.valueExpression)&&this._showGradientRamp(a,c,r,v&&!v.url&&v.color?v.color:this.transparencyRampColor,e,d,q,null,!1));G||F&&!D&&!K&&!L||(G=this._displayDefaultSymbol(a,r,e));f=f||G}f&&(t.set(h.byId(this.id+"_"+a.id+"_"+c.id),"display","block"),-1<g&&(t.set(h.byId(this.id+"_"+a.id+"_"+g+"_group"),"display",
"block"),this._findParentGroup(a.id,g)));return f},_isUnclassedRenderer:function(a,b){var c;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){c=a.attributeField;var e=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,e).length}return c},_displayDefaultSymbol:function(a,c,e){var h;!a._hideDefaultSymbol&&c.defaultSymbol&&(h=!0,e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),e=b.create("tbody",{},e),this._buildRow_Renderer(a,
c.defaultSymbol,null,B.encode(c.defaultLabel)||"others",null,e));return h},_showGradientRamp:function(a,c,e,h,g,d,m,t,l){l=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(l?"":" esriLegendSubFragment")},g);g=b.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(l,a,c,t);(m||d.valueExpression||d.legendOptions&&d.legendOptions.title)&&this._addSubHeader(g,this._getRampTitle(d,a,c));m=d.field;var f;m&&(f=n.isFunction(m)?null:this.getField(a,
m,c));(c=this._getRampStops(e,d,h,f&&"esriFieldTypeDate"===f.type))&&c.length&&this._drawGradientRamp(g,c,!0,a,this._getRampBorderColor(e),!!h)},_getMedianColor:function(a,b){var c,e;b.colors?(c=b.minDataValue,e=b.maxDataValue):b.stops&&(c=b.stops[0].value,e=b.stops[b.stops.length-1].value);return a.getColor(c+(e-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,e){var h,g,d,m,t=!1;b.colors||b.opacityValues?(g=b.maxDataValue-b.minDataValue,h=k.map([0,.25,.5,.75,1],function(a){d=b.minDataValue+a*g;
return Number(d.toFixed(6))}),this._checkPrecision(0,4,h)):b.stops&&(h=k.map(b.stops,function(a){return a.value}),(t=k.some(b.stops,function(a){return!!a.label}))&&(m=k.map(b.stops,function(a){return a.label})));var l=h[0],f,u;g=h[h.length-1]-l;return k.map(h,function(d,k){c?(f=new p(c.toRgba()),u=a.getOpacity(d,{opacityInfo:b}),null!=u&&(f.a=u)):f=a.getColor(d,{colorInfo:b});var r="";if(t)r=m[k];else{var r=e?E.formatDate(d,E.timelineDateFormatOptions):F.format(d),w="";0===k?w=this._specialChars.lt+
" ":k===h.length-1&&(w=this._specialChars.gt+" ");r=w+r}return{value:d,color:f,offset:1-(d-l)/g,label:r}},this).reverse()},_checkPrecision:function(a,b,c){var e=a+(b-a)/2,h=c[a],g=c[e],d=c[b],m=Math.floor(h),t=Math.floor(g),l=Math.floor(d);m===h&&l===d&&t!==g&&m!==t&&l!==t&&(c[e]=t);a+1!==e&&this._checkPrecision(a,e,c);e+1!==b&&this._checkPrecision(e,b,c)},_getRampBorderColor:function(a){var b;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;else if("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,c,e,h,d,m){var l=b.create("tr",{},a),f,u,r,w,n,v=c.length-1,z;w=0;this.alignRight?(a=b.create("td",{align:this._isRightToLeft?"left":"right"},l),f=b.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},l)):(f=b.create("td",{width:this.gradientWidth,align:"center"},l),a=b.create("td",
{},l));l=d&&0<d.a&&!(240<=d.r&&240<=d.g&&240<=d.b);u=b.create("div",{"class":l?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},f);f=b.create("div",{"class":"esriLegendColorRamp"+(m?" esriLegendTransparencyRamp":"")},u);m=t.get(f,"width");l&&(d=9>g("ie")?d.toHex():"rgba("+d.toRgba().join(",")+")",t.set(f,"border",this.colorRampBorder+" "+d));e?(d=this.gradientHeight*v,t.set(f,"height",d+"px")):d=t.get(f,"height");t.set(u,"height",d+"px");l=C.createSurface(f,
m,d);9>g("ie")&&(w=l.getEventSource(),t.set(w,"position","relative"),t.set(w.parentNode,"position","relative"),w=1);try{e&&k.forEach(c,function(a,b){a.offset=b/v}),n=l.createRect({x:-w,y:-w,width:m+w,height:d+w}),n.setFill({type:"linear",x1:0,y1:0,x2:0,y2:d,colors:c}).setStroke(null),l.createRect({width:m,height:d}).setFill(new p([255,255,255,1-h.opacity])).setStroke(null),this._surfaceItems.push(l)}catch(ia){l.clear(),l.destroy()}k.forEach(c,function(a,e){a.label&&(z="top:"+100*a.offset+"%;",a="",
0===e&&(a+=" esriLegendColorRampTickFirst"),e===c.length-1&&(a+=" esriLegendColorRampTickLast"),b.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:z},u))});r=b.create("div",{"class":"esriLegendColorRampLabels",style:{height:d+this.gradientHeight+"px"}},a);e?k.forEach(c,function(a){b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:B.encode(a.label)||"\x26nbsp;"},r)}):(b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},r),b.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(d+this.gradientHeight-2*this.gradientHeight)+"px;"},r))},_showHeatRamp:function(a,c,e,h,g){var d,m=e.field;d=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},h);h=b.create("tbody",{},d);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(d,a,c,g);(m=m&&this.getField(a,m,c))&&this._addSubHeader(h,this._getFieldAlias(m.name,a,c));c=this._getHeatmapStops(e);c.length&&this._drawGradientRamp(h,
c,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,e,h,g;b&&b[0]?(c=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[c])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),c++):(e=b[0].value,h=b[c].value-e,b=k.map(b,function(a){return{color:a.color,ratio:(a.value-e)/h}}))):a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=k.map(a,function(a,b){return{color:a,ratio:b*g}}));b=k.map(b,function(a,b){var e="";0===b?e="Low":b===c&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});
return b.reverse()},_showDotDensityLegend:function(a,c,e,h){var g=e.legendOptions,d,m,t,l,f,u,p,r=this.dotDensitySwatchSize,w=Math.round(r/2);g&&(m=g.backgroundColor,t=g.outline,l=g.valueUnit,f=g.dotCoverage);f=(f||this.dotCoverage)/100;p=Math.round(r*r/Math.pow(e.dotSize,2)*f);h=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},h);u=b.create("tbody",{},h);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,c);this._addSubHeader(u,A.substitute({value:e.dotValue,
unit:l||""},this.NLS_dotValue));k.forEach(e.fields,function(b){b=n.mixin({},b);b.numPoints=p;d=new Q(e._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},m),t||e.outline,r,r);b=this.getField(a,b.name,c)||b;this._buildRow_Renderer(a,d,null,B.encode(this._getFieldAlias(b.name,a,c)),null,u,{type:"path",path:"M "+-w+","+-w+" L "+w+","+-w+" L "+w+","+w+" L "+-w+","+w+" L "+-w+","+-w+" E"})},this)},_showSizeLegend:function(a,c,e,h,g,d,m,t,l){var f=h.legendOptions,f=f&&f.customValues;g=this._getSizeSymbol(e,
g);if((!h.valueUnit||"unknown"===h.valueUnit)&&g&&(f||null!=h.minSize&&null!=h.maxSize&&null!=h.minDataValue&&null!=h.maxDataValue||h.stops&&!(1>=h.stops.length))){l=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(l?"":" esriLegendSubFragment")},d);d=b.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(l,a,c,t);(m||h.valueExpression||h.legendOptions&&h.legendOptions.title)&&this._addSubHeader(d,this._getRampTitle(h,a,c));m=h.field;
var u;t=n.isFunction(m);m&&(u=t?null:a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(m):this.getField(a,m,c));c=u&&"esriFieldTypeDate"===u.type;var f=f||this._getDataValues(e,g,h,c),p,k=f.length-1;for(u=k;0<=u;u--)l=f[u],g=P.fromJson(g.toJson()),this._applySize(g,e,h,l),l=c?E.formatDate(l,E.timelineDateFormatOptions):F.format(l),p="",u===k?p=this._specialChars.gt+" ":0===u&&(p=m&&!t&&"cluster_count"===m.toLowerCase()&&1===f[u]?"":this._specialChars.lt+" "),p="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+
B.encode(p+l)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,p,null,d)}},_getSizeSymbol:function(a,b){var c,e;if("esri.renderer.SimpleRenderer"===a.declaredClass)c=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)c=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)c=a.infos[0].symbol,e=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=P.fromJson(c.toJson()),b||e)-1!==c.type.indexOf("linesymbol")?
c.setColor(new p(this.sizeRampDarkColor)):(c.setColor(new p(this.sizeRampLightColor)),c.setOutline&&(a=new M,a.setColor(new p(this.sizeRampDarkColor)),a.setWidth(1.5),c.setOutline(a)));return c},_getDataValues:function(a,b,c,e,h,g){h=null==h?5:h;g=null==g?20:g;var d=a.getSizeRangeAtScale(c,this.map.getScale());h=this._interpolateSizeRange(d,h);var m=this._getDataRange(c),t=k.map(h,function(a){return this._getDataValueFromSize(a,m,d)},this);if(!e){var l,t=F.round(t);for(e=1;e<t.length-1;e++)if(l=this._roundDataValue(a,
b,c,t[e],t[e-1],g))t[e]=l[0],h[e]=l[1]}return t},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize;a=(a.maxSize-c)/(b-1);var e,h=[];for(e=0;e<b;e++)h.push(c+a*e);return h},_getDataValueFromSize:function(a,b,c){var e=c.minSize;c=c.maxSize;var h=b.min;b=b.max;return a<=e?h:a>=c?b:(a-e)/(c-e)*(b-h)+h},_roundDataValue:function(a,b,c,e,h,g){var d=this._getSize(b,a,c,e);h=
this._getSize(b,a,c,h);var m,t=F.getDigits(e),l=t.integer,t=t.fractional,f,u,p,k,r,w,n,v,C,z,q;0<e&&1>e&&(m=Math.pow(10,t),e*=m,l=F.getDigits(e).integer);for(--l;0<=l&&(f=Math.pow(10,l),t=Math.floor(e/f)*f,f*=Math.ceil(e/f),null!=m&&(t/=m,f/=m),u=(t+f)/2,u=F.round([t,u,f],{indexes:[1]})[1],p=this._getSize(b,a,c,t),k=this._getSize(b,a,c,f),r=this._getSize(b,a,c,u),w=F.getPctChange(d,p,h,null),n=F.getPctChange(d,k,h,null),v=F.getPctChange(d,r,h,null),C=w.prev<=g,z=n.prev<=g,C&&z&&(w.prev<=n.prev?(C=
!0,z=!1):(z=!0,C=!1)),C?q=[t,p]:z?q=[f,k]:v.prev<=g&&(q=[u,r]),!q);l--);return q},_applySize:function(a,b,c,e){var h=a.type;b=this._getSize(a,b,c,e);switch(h){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":h=a.width;c=a.height;a.setHeight(b);a.setWidth(h/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,e){return b.getSize(e,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==
a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,c,e,h,g,d,m){var t=b.create("tr",{},d),l;this.alignRight?(d=b.create("td",{align:this._isRightToLeft?"left":"right"},t),c&&(l=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},t))):(c&&(l=b.create("td",{width:35,align:"center"},t)),d=b.create("td",{},t));var f=t=30,u;if(c){if("simplemarkersymbol"==c.type)t=Math.min(Math.max(t,c.size+12),125),f=Math.min(Math.max(f,c.size+12),125);else if("picturemarkersymbol"==
c.type)t=Math.min(Math.max(t,c.width),125),f=Math.min(c.height||f,125);else if("textsymbol"==c.type){var p,k;c.text||(p=c.text,k=!0,c.setText(this.defaultText));t=Math.min(Math.max(t,c.getWidth()+12),125);f=Math.min(Math.max(f,c.getHeight()+12),125);k&&c.setText(p)}u=b.create("div",{style:"width:"+t+"px;height:"+f+"px;"},l)}A.isDefined(h)&&"number"===typeof h&&(h=""+h);b.create("td",{innerHTML:h||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},d))));c&&(a=
this._drawSymbol(u,c,e,t,f,g,a,m),this._surfaceItems.push(a))},_addSubHeader:function(a,c){a=b.create("tr",{},a);a=b.create("td",{align:this._align,colspan:2},a);b.create("td",{innerHTML:B.encode(c)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,c,e,h,d,m,l){b=P.fromJson(b.toJson());var f=m.opacity;c&&b.setColor(new p(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;
c=b.color.toRgba();c[3]*=f;b.color.setColor(c)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(c=b.color.toRgba(),c[3]*=f,b.color.setColor(c)),b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),c[3]*=f,b.outline.color.setColor(c))):"picturemarkersymbol"===b.type&&(a.style.opacity=f,a.style.filter="alpha(opacity\x3d("+100*f+"))");a=C.createSurface(a,e,h);9>g("ie")&&(c=a.getEventSource(),t.set(c,"position","relative"),t.set(c.parentNode,"position","relative"));d=this._getDrawingToolShape(b,
d)||P.getShapeDescriptors(b);var u,f=(c=d.defaultShape)&&"text"===c.type;try{f&&!c.text&&(c.text=this.defaultText),u=a.createShape(l||c).setFill(d.fill).setStroke(d.stroke),f&&u.setFont(d.font)}catch(fa){a.clear();a.destroy();return}var k=u.getBoundingBox();l=k.width;d=k.height;var f=-(k.x+l/2),r=-(k.y+d/2);c=a.getDimensions();f={dx:f+c.width/2,dy:r+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)e=m._getScaleMatrix(k,b.size),u.applyTransform(D.scaleAt(e.xx,e.yy,{x:c.width/2,y:c.height/
2}));else if(l>e||d>h)m=l/e>d/h,e=((m?e:h)-5)/(m?l:d),n.mixin(f,{xx:e,yy:e});u.applyTransform(f);return a},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){k.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(W){}a.children&&n.isArray(a.children)&&
k.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,c,e,g){if(g=c._hoverLabel||c._hoverLabels&&c._hoverLabels[e.id]||g)g=B.encode(g),c.mouseMoveHandler=c.mouseMoveHandler||{},c.mouseMoveHandler[e.id]=d.connect(a,"onmousemove",n.hitch(this,function(a,c){this.mouseX=c.clientX;this.mouseY=c.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(h.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(n.hitch(this,function(a,c,e){if(a==this.mouseX&&c==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,h.byId(this.id+"_hoverLabel")){var g=h.byId(this.id+"_hoverLabel");g.innerHTML="\x3cspan\x3e"+e+"\x3c/span\x3e";t.set(g,"top",c+"px");t.set(g,"left",a+15+"px");t.set(g,"display","")}else b.create("div",{innerHTML:"\x3cspan\x3e"+e+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:c+"px",left:a+15+"px"}},document.body)},c.clientX,c.clientY,a),500)},g)),c.mouseOutHandler=c.mouseOutHandler||{},c.mouseOutHandler[e.id]=d.connect(a,"onmouseout",n.hitch(this,function(a){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(h.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;k.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;k.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){c={id:e.id};c.source=e.source&&e.source.toJson();
var h;a.layerDefinitions&&a.layerDefinitions[e.id]&&(h=a.layerDefinitions[e.id]);h&&(c.definitionExpression=h);var g;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(g=a.layerDrawingOptions[e.id]);g&&(c.drawingInfo=g.toJson());c.minScale=e.minScale||0;c.maxScale=e.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var e,g=
b.dynamicLayerInfos||b.layerInfos;for(e=0;e<g.length;e++)if(c==g[e].id){-1<g[e].parentLayerId&&(t.set(h.byId(this.id+"_"+a+"_"+g[e].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,g[e].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,e){var h=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,d;for(g=0;g<h.length;g++)if(h[g].id===c&&h[g].subLayerIds)for(d=0;d<h[g].subLayerIds.length;d++){var m=h[g].subLayerIds[d];-1===k.indexOf(e,m)&&(e.push(m),b(m,e))}}a.layer.layerInfos&&
k.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var e,h=!0;if(a.legendResponse&&a.legendResponse.layers)for(e=0;e<a.legendResponse.layers.length;e++){var g=a.legendResponse.layers[e];if(b.id==g.layerId){var d,m;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(d=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(m=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(d=Math.min(a.minScale,
g.minScale)||a.minScale||g.minScale,m=Math.max(a.maxScale,g.maxScale));if(0<d&&d<c||m>c)h=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)h=!1;return h},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],A.isDefined(a)&&(b+=" ("+a+")"));return B.encode(b)},_getEffectiveScale:function(a,
b){var c=b.minScale,e=b.maxScale;if(A.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var h;for(h=a.length-1;0<=h;h--)if(a[h].id==b)if(0==c&&0<a[h].minScale?c=a[h].minScale:0<c&&0==a[h].minScale||0<c&&0<a[h].minScale&&(c=Math.min(c,a[h].minScale)),e=Math.max(e||0,a[h].maxScale||0),-1<a[h].parentLayerId)b=a[h].parentLayerId;else break}return{minScale:c,maxScale:e}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=
/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,b,c){if(a.getField)return a.getField(b);if(c&&c.fields){var e;k.forEach(c.fields,function(a){a.name===b&&(e=a)});return e}return null}});n.mixin(R,{ALIGN_LEFT:0,ALIGN_RIGHT:1});g("extend-esri")&&n.setObject("dijit.Legend",R,y);return R})},"dojo/debounce":function(){define([],function(){return function(q,f){var n;return function(){n&&clearTimeout(n);var k=
this,d=arguments;n=setTimeout(function(){q.apply(k,d)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(q,f,n,k){var d=function(d,l){return d-l},r={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var l=String(d),g=l.match(r._reNumber);d={integer:0,fractional:0};g&&g[1]?(d.integer=g[1].split("").length,d.fractional=g[3]?g[3].split("").length:0):-1<l.toLowerCase().indexOf("e")&&(g=l.split("e"),l=g[0],g=g[1],l&&g&&(l=
Number(l),g=Number(g),(d=0<g)||(g=Math.abs(g)),l=r.getDigits(l),d?(l.integer+=g,l.fractional=g>l.fractional?0:l.fractional-g):(l.fractional+=g,l.integer=g>l.integer?1:l.integer-g),d=l));return d},getFixedNumbers:function(d,l){var g;g=Number(d.toFixed(l));g<d?d=g+1/Math.pow(10,l):(d=g,g-=1/Math.pow(10,l));g=Number(g.toFixed(l));d=Number(d.toFixed(l));return[g,d]},getPctChange:function(d,l,g,m){var e={prev:null,next:null},c;null!=g&&(c=d-g,e.prev=Math.floor(Math.abs(100*(l-g-c)/c)));null!=m&&(c=m-d,
e.next=Math.floor(Math.abs(100*(m-l-c)/c)));return e},round:function(f,l){f=f.slice(0);var g,m,e,c,a,h,b,t,u=l&&null!=l.tolerance?l.tolerance:2,p=l&&l.indexes,k=l&&null!=l.strictBounds?l.strictBounds:!1;if(p)p.sort(d);else for(p=[],a=0;a<f.length;a++)p.push(a);for(a=0;a<p.length;a++)if(t=p[a],l=f[t],g=0===t?null:f[t-1],m=t===f.length-1?null:f[t+1],e=r.getDigits(l),e=e.fractional){h=0;for(b=!1;h<=e&&!b;)c=r.getFixedNumbers(l,h),c=k&&0===a?c[1]:c[0],b=r.hasMinimalChange(l,c,g,m,u),h++;b&&(f[t]=c)}return f},
hasMinimalChange:function(d,l,g,m,e){d=r.getPctChange(d,l,g,m);l=null==d.prev||d.prev<=e;g=null==d.next||d.next<=e;return l&&g||d.prev+d.next<=2*e},_reAllZeros:new RegExp("\\"+n.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(d,l){l=l||{places:20,round:-1};(d=f.format(d,l))&&(d=d.replace(r._reSomeZeros,"$1").replace(r._reAllZeros,""));return d}};q("extend-esri")&&(k.numberUtils=r);return r})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(q,f,n,k,d,r,p,l){function g(a){return a&&f.map(a,function(a){return new p(a)})}function m(a,b,e){var h="";0===b?h=c.lt+" ":b===e&&(h=c.gt+" ");return h+a}var e={},c={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},a={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},h={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},b={formatLength:"short",fullYear:!0},t={formatLength:"short"};q.mixin(e,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,c){var e=[];null==a||a instanceof Date||
(a=new Date(a));c=c||{};c=q.mixin({},c);var h=c.selector?c.selector.toLowerCase():null,g=!h||-1<h.indexOf("time"),h=!h||-1<h.indexOf("date");g&&(c.timeOptions=c.timeOptions||t,c.timeOptions&&(c.timeOptions=q.mixin({},c.timeOptions),c.timeOptions.selector=c.timeOptions.selector||"time",e.push(c.timeOptions)));h&&(c.dateOptions=c.dateOptions||b,c.dateOptions&&(c.dateOptions=q.mixin({},c.dateOptions),c.dateOptions.selector=c.dateOptions.selector||"date",e.push(c.dateOptions)));e&&e.length?(e=f.map(e,
function(b){return k.format(a,b)}),c=1==e.length?e[0]:l["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return e[b]})):c=k.format(a);return c},createColorStops:function(a){var b=a.values,c=a.colors,h=a.labelIndexes,g=a.isDate,d=a.dateFormatOptions;a=[];return a=f.map(b,function(a,t){var l=null;if(!h||-1<f.indexOf(h,t)){var u;(u=g?e.formatDate(a,d):r.format(a))&&(l=m(u,t,b.length-1))}return{value:a,color:c[t],label:l}})},updateColorStops:function(a){var b=a.stops,c=a.changes,
h=a.isDate,g=a.dateFormatOptions,d=[],t,l=f.map(b,function(a){return a.value});f.forEach(c,function(a){d.push(a.index);l[a.index]=a.value});t=r.round(l,{indexes:d});f.forEach(b,function(a,c){a.value=l[c];if(null!=a.label){var d,f=null;(d=h?e.formatDate(t[c],g):r.format(t[c]))&&(f=m(d,c,b.length-1));a.label=f}})},createClassBreakLabel:function(a){var b=a.minValue,e=a.maxValue,h=a.isFirstBreak?"":c.gt+" ";a="percent-of-total"===a.normalizationType?c.pct:"";b=null==b?"":r.format(b);e=null==e?"":r.format(e);
return h+b+a+" \u2013 "+e+a},setLabelsForClassBreaks:function(a){var b=a.classBreaks,c=a.classificationMethod,h=a.normalizationType,g=[];b&&b.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(g.push(b[0].minValue),f.forEach(b,function(a){g.push(a.maxValue)}),g=r.round(g),f.forEach(b,function(a,b){a.label=e.createClassBreakLabel({minValue:0===b?g[0]:g[b],maxValue:g[b+1],isFirstBreak:0===
b,normalizationType:h})})):f.forEach(b,function(a,b){a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:h})}))},updateClassBreak:function(a){var b=a.classBreaks,c=a.normalizationType,h=a.change,g=h.index,h=h.value,d=-1,m=-1,t=b.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===g?d=g:g===t?m=g-1:(m=g-1,d=g),-1<d&&d<t&&
(a=b[d],a.minValue=h,a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===d,normalizationType:c})),-1<m&&m<t&&(a=b[m],a.maxValue=h,a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===m,normalizationType:c})))},calculateDateFormatInterval:function(b){var c,e,h=b.length,g,d,m,t,l,u,p=Infinity,k;b=f.map(b,function(a){return new Date(a)});for(c=0;c<h-1;c++){g=b[c];m=[];l=Infinity;u="";for(e=c+1;e<h;e++)d=b[e],d=g.getFullYear()!==
d.getFullYear()&&"year"||g.getMonth()!==d.getMonth()&&"month"||g.getDate()!==d.getDate()&&"day"||g.getHours()!==d.getHours()&&"hour"||g.getMinutes()!==d.getMinutes()&&"minute"||g.getSeconds()!==d.getSeconds()&&"second"||"millisecond",t=a[d],t<l&&(l=t,u=d),m.push(d);l<p&&(p=l,k=u)}return k},createUniqueValueLabel:function(a){var b=a.value,c=a.fieldInfo,g=a.domain;a=a.dateFormatInterval;var d=String(b);(g=g&&g.codedValues?g.getName(b):null)?d=g:"number"===typeof b&&(d=c&&"esriFieldTypeDate"===c.type?
e.formatDate(b,a&&h[a]):r.format(b));return d},cloneColorInfo:function(a){var b;a&&(b=q.mixin({},a),b.colors=g(b.colors),b.stops=b.stops&&f.map(b.stops,function(a){a=q.mixin({},a);a.color&&(a.color=new p(a.color));return a}),b.legendOptions&&(b.legendOptions=q.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;if(a){b=q.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=f.map(a,function(a){return q.mixin({},a)});if(a=b.legendOptions)b.legendOptions=
q.mixin({},a)}return b},cloneSizeInfo:function(a){var b;a&&(b=q.mixin({},a),b.stops&&(b.stops=f.map(b.stops,function(a){return q.mixin({},a)})),(a=b.minSize)&&"object"===typeof a&&(b.minSize=e.cloneSizeInfo(a)),(a=b.maxSize)&&"object"===typeof a&&(b.maxSize=e.cloneSizeInfo(a)),a=b.legendOptions)&&(b.legendOptions=q.mixin({},a),a=a.customValues)&&(b.legendOptions.customValues=a.slice(0));return b}});n("extend-esri")&&q.setObject("renderer.utils",e,d);return e})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),
function(q,f,n,k,d,r){return q(r,{constructor:function(){},_getExtent:function(){var f=new n,l=this.layerObject.items,g=this.layerObject.fullExtent||this.layerObject.initialExtent;0===l.length?f.resolve(g):f.resolve(d.graphicsExtent(l));return f},_resetLayerObjectVisiblity:function(d){var l=d?d[this.id]:null;if(l){var g={},m;for(m in d)d.hasOwnProperty(m)&&"function"!==typeof d[m]&&(g[m]=d[m].visible);this._setSubLayerVisibleByCheckedInfo(g);this._setTopLayerVisible(l.visible)}},_setSubLayerVisibleByCheckedInfo:function(d){f.forEach(this.newSubLayers,
function(l){k.isDefined(d[l.id])&&l.layerObject.setVisibility(d[l.id])},this)},_initVisible:function(){var d=!1,l;for(l=0;l<this.newSubLayers.length;l++)d=d||this.newSubLayers[l].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;f.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var d=[],l=this.layerObject.getFeatureLayers();f.forEach(l,function(g){g=this._layerInfoFactory.create({layerObject:g,
title:g.label||g.title||g.name||g.id||" ",id:g.id||" ",subId:g.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});d.push(g);g.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(l);return d},_markInvalidSubLayerInfoThatAsRootLayer:function(d){var l;f.forEach(d,function(g){if(l=this._getLayerInfosObj()._findTopLayerInfoById(g.id))l._flag._invalid=!0},this)},_needToRenew:function(){var d=this.layerObject.getFeatureLayers();return(d?d.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var d=[],l,g;for(g=0;g<this.newSubLayers.length;g++)(l=this._getLayerIndexesInMapByLayerId(this.newSubLayers[g].layerObject.id))&&d.push(l);return d},moveLeftOfIndex:function(d){var l;for(l=this.newSubLayers.length-1;0<=l;l--)this.map.reorderLayer(this.newSubLayers[l].layerObject,d)},moveRightOfIndex:function(d){var l;for(l=0;l<this.newSubLayers.length;l++)this.map.reorderLayer(this.newSubLayers[l].layerObject,d)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e){return q(l,{constructor:function(c,a){},_getExtent:function(){var c=new d;c.resolve(this.layerObject.extent||this.layerObject.fullExtent);return c},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(c){this._visible=c;this.layerObject.setVisibility(c)},_setSubLayerVisible:function(c){var a=[],e,a=n.clone(this.originOperLayer.layerObject.visibleLayers),b;for(b in c)if(c.hasOwnProperty(b)&&"function"!==typeof c[b]){var g=c[b],
d=b.toString();e=f.indexOf(a,d);g?0>e&&a.push(d):0<=e&&a.splice(e,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(a)},_resetLayerObjectVisiblity:function(c){var a=c?c[this.id]:null,e=!1;if(c){a&&this.layerObject.setVisibility(a.visible);var a={},b;for(b in c)c.hasOwnProperty(b)&&"function"!==typeof c[b]&&(e=!0,a[b]=c[b].visible);e&&this._setSubLayerVisibleByCheckedInfo(a)}},_setSubLayerVisibleByCheckedInfo:function(c){var a={};this.traversal(function(a){a.isRootLayer()||e.isDefined(c[a.id])&&
a._setVisible(c[a.id])});this.traversal(function(c){0===c.getSubLayers().length&&(a[c.subId]=c._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(a)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[];f.forEach(this.layerObject.layerInfos,function(a,e){a=this._getOperLayerFromWMSLayerInfo(a,
this);a=this._layerInfoFactory.create(a);c.push(a);a.init()},this);return c},_getOperLayerFromWMSLayerInfo:function(c,a){return{layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+(c.name||"-"),subId:c.name||"-",wms:{layerInfo:this,subId:c.name||"-",wmsLayerInfo:c},selfType:"wms",parentLayerInfo:a}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&p.after(this.layerObject,"setVisibleLayers",n.hitch(this,this._onVisibleLayersChanged))},
_onVisibleLayersChanged:function(){var c=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(a){a.isRootLayer()||a._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(a){a.isRootLayer()||c.push(a)});this._setVisibleLayersBySelfFlag=!1;k.publish("layerInfos/layerInfo/visibleChanged",c);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(q,f,n,k,d,r){return q(r,{constructor:function(d,l){this.layerObject=d.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var d=!1;this.traversal(function(l){if(0<=f.indexOf(l.layerObject.visibleLayers,l.subId))return d=!0});this._visible=d},_setVisible:function(d){this._visible=d?!0:!1},_setTopLayerVisible:function(d){var l=this.originOperLayer.wms;this._visible=d?!0:!1;var g={};this.traversal(function(d){0===d.getSubLayers().length&&(g[d.subId]=d._isAllSubLayerVisibleOnPath())});
l.layerInfo._setSubLayerVisible(g)},_getServiceDefinition:function(){var d=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(d)},_serviceDefinitionRequest:function(d){return this._normalRequest(d,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var d=[],l=this.originOperLayer.wms;f.forEach(l.wmsLayerInfo.subLayers,function(g){g=l.layerInfo._getOperLayerFromWMSLayerInfo(g,this);g=this._layerInfoFactory.create(g);d.push(g);g.init()},this);
return d},drawLegends:function(d){this._initLegendsNode(d)},_initLegendsNode:function(f){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var l=k.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});d(l,"load",function(){k.empty(f);var g=k.create("div",{"class":"legend-div"},f);n.place(l,g)})}else k.empty(f)},getOpacity:function(){},setOpacity:function(d){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},
"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(q,f){return q(f,{constructor:function(f,k){},_initVisible:function(){var f=!1,k=this.originOperLayer.mapService;k&&k.layerInfo._subLayerVisible[k.subId]&&(f=!0);this._visible=f},_setTopLayerVisible:function(f){var k=this.originOperLayer.mapService;if(k){k.layerInfo._subLayerVisible[k.subId]=f?!0:!1;this._visible=f;var d={};this.traversal(function(f){0===f.getSubLayers().length&&
(d[f.originOperLayer.mapService.subId]=f._isAllSubLayerVisibleOnPath())});k.layerInfo._setSubLayerVisible(d)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory".split(" "),function(q,f,n,k,d,r,p){return q(r,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new p(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(d){var g=
new k;this.originOperLayer.mapService.layerInfo.getLegendInfo(d).then(n.hitch(this,function(d){g.resolve(d)}));return g},drawLegends:function(d,g){this._loadLegends(g).then(n.hitch(this,function(g){this._initLegendsNode(g,d)}))},_initLegendsNode:function(l,g){var m=this.originOperLayer.mapService;if(l){d.empty(g);for(var e=null,c=0;c<l.length;c++)if(l[c].layerId===m.subId){e=l[c];break}if(e){var a=d.create("table",{"class":"legend-table",style:"font-size: 12px"},g);f.forEach(e.legend,function(c){if("\x3call other values\x3e"!==
c.label){var b=d.create("tr",{"class":"legend-tr",style:"border: 1px solid"},a),e=d.create("td",{"class":"legend-symbol-td",style:""},b),h=null,h=c.imageData?"data:"+c.contentType+";base64,"+c.imageData:c.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:h},e);d.create("td",{"class":"legend-label-td",innerHTML:c.label||" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,
g=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:d.infoTemplates&&d.infoTemplates[g]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,g=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&d.infoTemplates&&delete d.infoTemplates[g]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(d){var g=new k;(d?this._layerObjectFacory.getLayerObjectWithUrl(d):this._layerObjectFacory.getLayerObject()).then(n.hitch(this,function(d){this.layerObject.empty&&d&&(this.layerObject=d);g.resolve(d)}));return g},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var d;
return this.isItemLayer()?this.getItemInfo().then(n.hitch(this,function(g){g&&g.getItemData()&&g.getItemData().layers&&f.some(g.getItemData().layers,function(g){if(g.id===this.subId)return d=g.layerUrl,!0},this);return d?this._getLayerObject(d):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var d=null,g=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(g)for(var m=0;m<g.length;m++)if(g[m].id===this.originOperLayer.mapService.subId){d=g[m].popupInfo;break}return d},
getFilterOfWebmap:function(){var d=null,g=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(g)for(var m=0;m<g.length;m++)if(g[m].id===this.originOperLayer.mapService.subId){d=g[m].layerDefinition?g[m].layerDefinition.definitionExpression:null;break}return d},getFilter:function(){var d=this.originOperLayer.mapService;return d.layerInfo.layerObject&&d.layerInfo.layerObject.layerDefinitions?d.layerInfo.layerObject.layerDefinitions[d.subId]:null},setFilter:function(d){var g,m=this.originOperLayer.mapService;
m.layerInfo.layerObject&&m.layerInfo.layerObject.setLayerDefinitions&&(g=m.layerInfo.layerObject.layerDefinitions?f.map(m.layerInfo.layerObject.layerDefinitions,function(e){return e}):[],g[m.subId]=d,m.layerInfo.layerObject.setLayerDefinitions(g))},getLayerType:function(){var d=new k;0<this.getSubLayers().length?d.resolve("GroupLayer"):this._getServiceDefinition().then(n.hitch(this,function(g){g?d.resolve(g.type.replace(/\ /g,"")):d.resolve(null)}),function(){d.resolve(null)});return d},getSupportTableInfo:function(){var d=
new k,g={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(n.hitch(this,function(m){g.layerType=m;0<=this._getLayerTypesOfSupportTable().indexOf(m)&&(g.isSupportedLayer=!0);this._getServiceDefinition().then(n.hitch(this,function(e){e&&0<=e.capabilities.indexOf("Data")&&(g.isSupportQuery=!0);d.resolve(g)}),function(){d.resolve(g)})}),function(){d.resolve(g)});return d},enablePopup:function(){var d=this.originOperLayer.mapService.layerInfo,g=d.layerObject,m=this.originOperLayer.mapService.subId;
return this.loadInfoTemplate().then(n.hitch(this,function(){return d.controlPopupInfo.infoTemplates&&d.controlPopupInfo.infoTemplates[m]?(this.controlPopupInfo.enablePopup=!0,g.infoTemplates||(g.infoTemplates={}),g.infoTemplates[m]=d.controlPopupInfo.infoTemplates[m],!0):!1}))},disablePopup:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,g=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;d.infoTemplates&&delete d.infoTemplates[g]},loadInfoTemplate:function(){var d=
new k,g=this.originOperLayer.mapService.layerInfo,m=this.originOperLayer.mapService.subId;g.controlPopupInfo.infoTemplates&&g.controlPopupInfo.infoTemplates[m]&&g.controlPopupInfo.infoTemplates[m].infoTemplate?d.resolve(g.controlPopupInfo.infoTemplates[m].infoTemplate):(g.controlPopupInfo.infoTemplates||(g.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(n.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);g.controlPopupInfo.infoTemplates[m]={infoTemplate:e,layerUrl:null};d.resolve(e)}),
n.hitch(this,function(){d.resolve(null)})));return d},getInfoTemplate:function(){var d=this.originOperLayer.mapService.layerInfo,g=this.originOperLayer.mapService.subId;return d.controlPopupInfo.infoTemplates&&d.controlPopupInfo.infoTemplates[g]&&d.controlPopupInfo.infoTemplates[g].infoTemplate?d.controlPopupInfo.infoTemplates[g].infoTemplate:null},getScaleRange:function(){var d=this.originOperLayer.mapService;return(d=d.layerInfo._getJsapiLayerInfoById(d.subId))&&0<=d.minScale&&0<=d.maxScale?{minScale:d.minScale,
maxScale:d.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),function(q,f,n,k,d,r,p,l,g,m){return q(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(e){this._layerInfo=
e;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new d(f.hitch(this,this._getLayerObject))},getLayerObject:function(){var e=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(e)},getLayerObjectWithUrl:function(e){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(e)},_getLayerObject:function(e){var c,a=new k;this._layerInfo.getLayerType().then(f.hitch(this,function(h){var b=f.mixin(this._getLayerOptionsForCreateLayerObject(),
this._layerInfo.originOperLayer.options||{})||{};switch(h){case "FeatureLayer":c=new r(e,b);break;case "RasterLayer":c=new p(e);break;case "StreamLayer":c=new l(e);break;case "ArcGISImageServiceLayer":c=new g(e);break;case "ArcGISImageServiceVectorLayer":c=new m(e);break;case "Table":if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)c=new r(e,b);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(c=new r(this._layerInfo.layerObject.featureCollectionData,
b),this._setLayerObjectProperties(c),a.resolve(c)):a.resolve(null),a;break;case "GroupLayer":return a=this._getGroupLayerObject();default:return a.resolve(null),a}var d=c.on("load",f.hitch(this,function(){this._setLayerObjectProperties(c);a.resolve(c);d.remove&&d.remove()})),u=c.on("error",f.hitch(this,function(b){a.reject(b);u.remove&&u.remove()}))}),f.hitch(this,function(){a.reject()}));return a},_getGroupLayerObject:function(){var e=new k;this._layerInfo._getServiceDefinition().then(f.hitch(this,
function(c){if(null===c)e.reject();else{var a=this._layerInfo.getUrl();c.url=a;c.id=this._layerInfo.id;e.resolve(c)}}));return e},_getLayerOptionsForCreateLayerObject:function(){var e={},c=[],a=this._layerInfo.getInfoTemplate();a&&a.info&&a.info.fieldInfos?n.forEach(a.info.fieldInfos,function(a){a.visible&&c.push(a.fieldName)},this):c=["*"];e.outFields=c;return e},_setLayerObjectProperties:function(e){e.name&&!f.getObject("_wabProperties.originalLayerName",!1,e)&&(f.setObject("_wabProperties.originalLayerName",
e.name,e),e.name=this._layerInfo.title);e.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(f.hitch(this,function(c){e.infoTemplate=c}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,
c,a,h,b){return q([e,c],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,b){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=null,this._isDefaultPixelFilter=
!1);else{var b,c;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){b=[];for(c=0;c<this.minValues.length;c++)b.push([this.minValues[c],this.maxValues[c],this.meanValues[c],this.stdvValues[c]]);this.bandCount!==b.length&&(b=null)}c=0;var e=!1;"U8"===this.pixelType?(c=5,e=b?!1:!0):b?(c=5,e=!1):(c=6,e=!0);this.renderingRule&&(c=5,e=!0);this.pixelFilter=(new a({stretchType:c,min:0,max:255,dra:e,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:b,numberOfStandardDeviations:2.5})).filter;
this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){var b=m.defaults.map.zoomDuration;return q([h],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(a,b){this.drawMode=b&&
void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&
"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;p.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var b=this._map.extent;return new a((b.xmax-b.xmin)/this._map.width,(b.ymax-b.ymin)/this._map.height,b.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var c=this._div=r.create("div",null,b),h={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(h[g._css.names.transform]=g._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;p.set(c,h);this._canvas=r.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},c);e.isDefined(this.opacity)&&p.set(c,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(n.connect(a,"onPan",this,this._panHandler));this._connects.push(n.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(n.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(n.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(n.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(n.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(n.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(n.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(n.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var d=n.connect(a,"onLoad",this,function(){n.disconnect(d);d=null;this.evaluateSuspension()});return c},_unsetMap:function(a,b){k.forEach(this._connects,n.disconnect,this);var c=this._div;c&&(b.removeChild(c),r.destroy(c));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==
a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,p.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top)),p.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&
this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());var e=this.pixelData.extent,h=this._map.extent,d=this.getCurrentResolution(),m=0,f=0;Math.abs(e.xmin-h.xmin)>d.x&&(m=Math.round((e.xmin-h.xmin)/d.x));Math.abs(h.ymax-e.ymax)>d.y&&(f=Math.round((h.ymax-e.ymax)/d.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,p.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top)),p.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top))):(p.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),p.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(c,m,f,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()},
_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,p.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))):p.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(a,c){var e={},h=g._css.names;p.set(this._canvas,h.transition,c?"none":
h.transformName+" "+b+"ms ease");this._matrix=a;a=this._multiply?l.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=l.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});e[h.transform]=g._css.matrix(a);p.set(this._canvas,e)},_onZoomHandler:function(a,b,c){var e=this._startRect;a=e.width*b;b*=e.height;var h=e.left-(a-e.width)*(c.x-e.left)/e.width;c=e.top-(b-e.height)*(c.y-e.top)/e.height;p.set(this._canvas,{left:h+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:h,top:c,
width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){p.set(this._div,{width:b+"px",height:c+"px"});p.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,b,c,e){this.suspended||b&&0===b.x&&0===b.y&&!c||("css-transforms"===this._map.navigationMode&&(b&&(this._dragOrigin.x+=b.x,this._dragOrigin.y+=b.y),c||(this._left=
this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,p.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))),c&&(p.set(this._canvas,g._css.names.transition,"none"),this._multiply=this._multiply?l.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?c.show(this._div):c.hide(this._div)},_opacityChangeHandler:function(a){p.set(this._div,"opacity",
a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E,G,H,L,J){q=q(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_rasterFunctionTemplateInfos:{},_customRenderingRuleId:{},_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],
U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=t.urlToObject(a);this.raster=new z(this._url.path);this.infoTemplate=b&&b.infoTemplate;this.format=(a=b&&b.imageServiceParameters)&&a.format;this.compressionTolerance=a&&a.compressionTolerance?a.compressionTolerance:.01;this.interpolation=
a?a.interpolation:null;this.compressionQuality=a?a.compressionQuality:null;this.bandIds=a?a.bandIds:null;this.mosaicRule=a?a.mosaicRule:null;this.renderingRule=a?a.renderingRule:null;this.renderer=a?a.renderer:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.hasImageFilter=b&&b.hasImageFilter;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,
compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},a?a.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(b=b&&b.resourceInfo)?this._initLayer(b):h({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(b,c){if(null!==b&&void 0!==b){this._findCredential();
(this.credential&&this.credential.ssl||b&&b._ssl)&&this._useSSL();c=this.minScale;var e=this.maxScale;f.mixin(this,b);this.minScale=c;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=new u(b.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var h=this.minValues,d=this.maxValues,g=this.meanValues,m=this.stdvValues,t=this.bands=[];c=0;for(e=this.bandCount;c<e;c++)t[c]={min:h[c],max:d[c],
mean:g[c],stddev:m[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new E(c):null;e=this.fields=[];if(h=b.fields)for(c=0;c<h.length;c++)e.push(new G(h[c]));this.version=b.currentVersion;this.version||(this.version="fields"in b||"objectIdField"in b||"timeInfo"in b?10:9.3);a.isDefined(b.minScale)&&!this._hasMin&&this.setMinScale(b.minScale);a.isDefined(b.maxScale)&&!this._hasMax&&this.setMaxScale(b.maxScale);c={};b.defaultMosaicMethod?(c.method=b.defaultMosaicMethod,c.operation=b.mosaicOperator,c.sortField=
b.sortField,c.sortValue=b.sortValue):c.method=D.METHOD_NONE;this.defaultMosaicRule=new D(c);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType;this._setDefaultRenderingRule(!0);this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(f.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(f.hitch(this,function(){!this.renderer||
"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}))}));this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&a.fields&&(this.rasterAttributeTable=f.clone(a)),a.features&&0<a.features.length&&
(this._rasterAttributeTableFeatures=f.clone(a.features)),a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=f.clone(a.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();10.3<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&this.getRasterFunctionInfos().then(f.hitch(this,function(a){if(a&&
a.length){this.rasterFunctionInfos=a;var b=[],c;k.forEach(a,function(a){if(a){var e=a.functionType;c=c||1===e||2===e;b.push(a.name)}},this);this._hasItemLevelRFT=c;this._rasterFunctionNames=b;c&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)}},getKeyProperties:function(a){var c=this._url.path+"/keyProperties",e=new n(b._dfdCanceller),g={f:"json"};a&&a.renderingRule&&(g.renderingRule=
d.toJson(a.renderingRule.toJson()));10<this.version?(e._pendingDfd=h({url:c,content:g,handleAs:"json",callbackParamName:"callback"}),e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})):(a=Error("Layer does not have key properties"),a.log=!!r.isDebug,e.errback(a));return e},getRasterAttributeTable:function(a){var c=this._url.path+"/rasterAttributeTable",e=new n(b._dfdCanceller),g={f:"json"},m=this.hasRasterAttributeTable;a&&a.renderingRule&&(g.renderingRule=d.toJson(a.renderingRule.toJson()),
m=!0);10<this.version&&m?(e._pendingDfd=h({url:c,content:g,handleAs:"json",callbackParamName:"callback"}),e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=!!r.isDebug,e.errback(a));return e},getRenderingRuleAttributeTable:function(a){var c=new n(b._dfdCanceller);if(!a||!a.renderingRule)return c.errback(Error("Rendering rule is not specified")),c;a=a.renderingRule;var e=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&
e&&this._renderingRuleAttributeTable.hasOwnProperty(e)?c.resolve(this._renderingRuleAttributeTable[e]):c=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,function(a){var b;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(b={features:f.clone(a.features),fields:f.clone(a.fields)},e&&(this._renderingRuleAttributeTable[e]=b));return b}));return c},_initVectorPixelFilter:function(){var b;this._hasItemLevelRFT&&this.renderingRule&&(b=this._getItemLevelRenderingRule(this.renderingRule));
if(b=b||this.renderingRule)return this.getRenderingRuleServiceInfo(b).then(f.hitch(this,function(b){b&&this._isVectorData(b)&&!a.isDefined(this.pixelFilter)&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&(this.vectorFieldPixelFilter=new A,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===b.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(b.serviceDataType))}))},
_applyVectorResamplingType:function(a){if(a){var b=this.renderingRule;b&&"Resample"===b.functionName&&((b.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new B(b.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new n;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),
a.then(f.hitch(this,function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new n,a.errback(Error("Rendering rule is not specified")),a)},getCustomRasterFields:function(b){var c=b?b.rasterAttributeTableFieldPrefix:
this._rasterFieldPrefix;b=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var e={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:b},h={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:b},d={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},g=this.fields?f.clone(this.fields):
[];b=g.length;g[b]=h;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(b++,g[b]=d);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)b++,g[b]=e;!a.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||
(e={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},h={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},b++,g[b]=e,b++,g[b]=h);b=this._rasterAttributeTableFields;(e=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(e)&&(b=this._renderingRuleAttributeTable[e].fields);b&&0<b.length&&
(b=k.filter(b,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),b=k.map(b,function(a){var b=f.clone(a);b.name=c+a.name;return b}),g=g.concat(b));var m=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&k.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:m+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},g.push(a))});return g},_prepareGetImageParameters:function(b,
c,e,h){h=a.isDefined(h)?h:this._params;if(this.renderer||this._hasItemLevelRFT&&this.renderingRule){var g=this.getExportImageRenderingRule();h.renderingRule=g?d.toJson(g.toJson()):null;g=this.getExportImageMosaicRule(h);h.mosaicRule=g?d.toJson(g.toJson()):null}g=b.spatialReference.wkid||d.toJson(b.spatialReference.toJson(!1));delete h._ts;f.mixin(h,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:g,bboxSR:g,size:c+","+e},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete h.compressionTolerance;
h.format&&"LERC"===h.format.toUpperCase()&&(h.compressionTolerance=this.compressionTolerance);h.token=this._getToken()},getImageUrl:function(b,e,d,m,l){l=a.isDefined(l)?l:this._params;this._prepareGetImageParameters(b,e,d,l);b=f.clone(l);this._cleanupRequestParams(b);e=this._url.path+"/exportImage?";d=t.addProxy(e+g.objectToQuery(f.mixin(b,{f:"image"})));var k=b.token;d.length>c.defaults.io.postLength||this.useMapImage?this._jsonRequest=h({url:e,content:f.mixin(b,{f:"json"}),callbackParamName:"callback",
load:function(a,b){a=a.href;k&&(a+=-1===a.indexOf("?")?"?token\x3d"+k:"\x26token\x3d"+k);m(t.addProxy(a))},error:this._errorHandler}):m(d)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=
a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();
b||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return h({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&
this.getRenderingRuleAttributeTable({renderingRule:a});if(c)this.onRenderingChange();this._setDefaultFilter();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;this._setDefaultFilter();b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=D.METHOD_NONE);c.where=a;a=new D(c);this.setMosaicRule(a,
b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&
(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,b;this._hasItemLevelRFT&&this.renderingRule&&(b=this._getItemLevelRenderingRule(this.renderingRule));b&&(a=a||this.defaultMosaicRule||new D,a.itemRenderingRule=b);return a},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(){var a=
new n(b._dfdCanceller);if(this.hasHistograms)a._pendingDfd=h({url:this._url.path+"/histograms",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(b){a.callback(b)},function(b){a.errback(b)});else{var c=Error("Layer does not have histograms.");c.log=!!r.isDebug;a.errback(c)}return a},computeHistograms:function(a){var c=new n(b._dfdCanceller);if(10.1<=this.currentVersion){a=a||{};var e=a.geometry||this.fullExtent,d=(a.geometry||this.fullExtent).toJson(),e=
"extent"===e.type?"esriGeometryEnvelope":"esriGeometryPolygon",g=a.renderingRule||this.renderingRule||this.defaultRenderingRule,g=g?g.toJson():null,m=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule,m=m?m.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};c._pendingDfd=h({url:this._url.path+"/computeHistograms",content:f.mixin({f:"json",geometry:JSON.stringify(d),geometryType:e,renderingRule:JSON.stringify(g),mosaicRule:JSON.stringify(m),pixelSize:JSON.stringify(a),callbackParamName:"callback"}),
handleAs:"json"});c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})}else d=Error("Layer doesn't support computeHistograms."),d.log=!!r.isDebug,c.errback(d);return c},getRenderingRuleServiceInfo:function(a){var c=new b._fixDfd(new n(b._dfdCanceller));if(!a)return c.errback(Error("Rendering rule is not specified")),c;var e=this._getRenderingRuleId(a);return e&&this._rasterFunctionTemplateInfos[e]?(c.resolve(this._rasterFunctionTemplateInfos[e]),c):h({url:this._url.path,content:f.mixin(f.mixin({f:"json",
renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:f.hitch(this,function(a){var b={};k.forEach(this._rasterFunctionServiceInfoProps,function(c){b[c]=a[c]});return this._rasterFunctionTemplateInfos[e]=b}),error:this._errorHandler})},queryVisibleRasters:function(a,c,e,h){var d=this._map,g=b._fixDfd(new n(b._dfdCanceller));this._visibleRasters=[];var m,t,l=!0,r=this.infoTemplate?this.infoTemplate.info:null,p=r?f.clone(this.infoTemplate.info.fieldInfos):null;
c=c||{};if(r&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var u=[];k.forEach(this.infoTemplate.info.mediaInfos,function(a){u=u.concat(a&&a.value&&a.value.fields||[])});u.length&&k.forEach(p,function(a){a&&-1<u.indexOf(a.fieldName)&&(a.visible=!0)})}if(p&&0<p.length)for(l=!1,m=0;m<p.length;m++)if((t=p[m])&&t.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(t.visible||r.title&&-1<r.title.toLowerCase().indexOf(t.fieldName.toLowerCase()))){l=
!0;break}var w=(t=this._removeVisualizationStretchFunction(this.renderingRule))&&t.functionName,z=[];if(10.4<=this.version){var q=!1;if(this.rasterFunctionInfos&&p){var C=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;k.forEach(this.rasterFunctionInfos,function(a){var b=C+a.name.replace(/ /gi,"_");k.some(p,function(a){return a.visible&&a.fieldName===b})&&(q=q||w&&w===a.name,z.push(new B({rasterFunction:a.name})))})}t&&!q&&z.push(t)}m=new J;m.geometry=a.geometry;m.returnGeometry=this._map.spatialReference.equals(this.spatialReference);
m.returnCatalogItems=l;m.timeExtent=a.timeExtent;this._params.time&&this.mosaicRule?(a=f.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),m.mosaicRule=a):m.mosaicRule=this.mosaicRule||null;m.renderingRule=10.4>this.version&&t||null;m.renderingRules=z||null;d&&(d=new v((d.extent.xmax-d.extent.xmin)/d.width,(d.extent.ymax-d.extent.ymin)/d.height,d.extent.spatialReference),m.pixelSize=d);c.requestParams=m;var A=this,d=new L(this.url);(g._pendingDfd=d.execute(m)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,
c,e,h,g)},function(a){A._resolve([a],null,h,g,!0)});return g},_queryVisibleRastersHandler:function(b,c,e,g,m){function t(){var b=this.getCustomRasterFields(c),h=this._getDomainFields(b),d=c?c.returnDomainValues:!1,g=c&&c.rasterAttributeTableFieldPrefix,t,v,z,q,C,A,B,y,L,F,b=(b=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[b];this.renderingRule&&(this._useRenderingRuleAttributeTable||b)?(b=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
F=l):b=this._getRasterAttributeTableFeatures();b.then(f.hitch(this,function(b){for(t=0;t<n.length;t++){N=n[t];N.setInfoTemplate(this.infoTemplate);N._layer=this;if(l){L=l.replace(/ /gi,"").split(",");v=l;z=L;r&&r.length>=t&&(v=r[t].replace(/ /gi,", "),z=r[t].split(" "));N.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=z;N.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=L;p&&(N.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=p.replace(/ /gi,"").split(","));if(this.pixelFilter){var c=
new w({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});k.forEach(z,function(a){c.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:c,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)N.attributes[this._rasterFieldPrefix+"Magnitude"]=c.pixels[0][0],N.attributes[this._rasterFieldPrefix+"Direction"]=c.pixels[1][0]}k.forEach(D,
function(a){N.attributes[a.name]=a.value});var G=F||v;if(b&&0<b.length&&(q=k.filter(b,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==G:a.attributes.VALUE==G}),0<q.length&&(C=f.clone(q[0]),g&&C))){y={};for(A in C.attributes)C.attributes.hasOwnProperty(A)&&(B=g+A,y[B]=C.attributes[A]);C.attributes=y;N.attributes=f.mixin(N.attributes,C.attributes)}}d&&h&&0<h.length&&k.forEach(h,function(b){if(b){var c=N.attributes[b.name];a.isDefined(c)&&(c=this._getDomainValue(b.domain,
c),a.isDefined(c)&&(N.attributes[b.name]=c))}},this);Q.push(N);this._visibleRasters.push(N)}this._resolve([Q,null,!0],null,e,m)}))}var l=b.value,p=b.value,r,n,v=0,z=0,q=this,A=this.objectIdField,B,y,D=[];g=c.requestParams.renderingRules;var L=b.processedValues,F=this.renderingRule&&d.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(g&&L&&g.length===L.length){var G=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;k.forEach(g,function(a,b){if(a.functionName){var c=
{name:G+a.functionName.replace(/ /gi,"_"),value:L[b].replace(/ /gi,"").split(",")};D.push(c);F&&F===d.toJson(a.toJson())&&(l=L[b])}})}g=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(b.catalogItems){var E=0,K,J,O=b.catalogItems.features.length;y=0;n=Array(O);r=Array(O);B=Array(O);for(v=0;v<O;v++)-1<b.properties.Values[v].toLowerCase().indexOf("nodata")&&
y++;K=O-y;for(v=0;v<O;v++)y=!0,-1<b.properties.Values[v].toLowerCase().indexOf("nodata")?(J=K++,g||(y=!1,n.length--,r.length--,B.length--)):J=E++,y&&(n[J]=b.catalogItems.features[v],r[J]=b.properties.Values[v],B[J]=n[J].attributes[A])}this._visibleRasters=[];var N;(b=-1<l.toLowerCase().indexOf("nodata"))&&!g&&(n=[],r=[],B=[]);!l||n||b||(A="ObjectId",n=[],N=new H(new u(this.fullExtent),null,{ObjectId:0}),n.push(N));var Q=[];n?!this._map.spatialReference.equals(this.spatialReference)&&B&&0<B.length?
h({url:this._url.path+"/query",content:{f:"json",objectIds:B.join(","),returnGeometry:!0,outSR:d.toJson(q._map.spatialReference.toJson()),outFields:A},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)q._resolve([Q,null,null],null,e,m);else{for(v=0;v<a.features.length;v++)for(z=0;z<n.length;z++)n[z].attributes[A]==a.features[v].attributes[A]&&(n[z].geometry=new C(a.features[v].geometry),n[z].geometry.setSpatialReference(q._map.spatialReference));t.call(q)}},error:function(a){q._resolve([Q,
null,null],null,e,m)}}):t.call(this):this._resolve([Q,null,null],null,e,m)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];k.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;k.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,
b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var e=a._normalize(!0);this._prepareGetImageParameters(e,b,c);b=f.clone(this._params);this._cleanupRequestParams(b);b.extent=a;b.format=b.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===b.format.toLowerCase()&&!b.lercVersion&&10.5<=this.version&&(b.lercVersion=2);c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?
f.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=
null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var e=b*c,h=0,d=0,g=new Uint8Array(e),m=new Uint8Array(e),t=new Uint8Array(e),f=new Uint8Array(e),l=Infinity,k=Infinity,r=Infinity,p=-Infinity,u=-Infinity,n=-Infinity,v,z,q,h=0;h<e;h++)v=a[d++],z=a[d++],
q=a[d++],l=l<v?l:v,p=p>v?p:v,k=k<z?k:z,u=u>z?u:z,r=r<q?r:q,n=n>q?n:q,g[h]=v,m[h]=z,t[h]=q,f[h]=a[d++]&1;return new w({width:b,height:c,pixels:[g,m,t],pixelType:"U8",mask:f,statistics:[{minValue:l,maxValue:p},{minValue:k,maxValue:u},{minValue:r,maxValue:n}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",c=new n(b._dfdCanceller);if(this._multidimensionalInfo)return c.resolve(this._multidimensionalInfo),c;10.3<=this.version&&this.hasMultidimensions?(c._pendingDfd=h({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;c.callback(a.multidimensionalInfo)}),function(a){c.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=!!r.isDebug,
c.errback(a));return c},getDefaultMultidimensionalDefinition:function(){var a,c,e,h=[],d=new n(b._dfdCanceller),g;if(this._defaultMultidimensionalDefinition)return d.resolve(f.clone(this._defaultMultidimensionalDefinition)),d;d._pendingDfd=this.getMultidimensionalInfo();d._pendingDfd.then(f.hitch(this,function(b){a=b;c=a.variables[0].dimensions;for(e in c)c.hasOwnProperty(e)&&"StdTime"!==c[e].name&&(g=c[e],h.push(new y({variableName:"",dimensionName:g.name,isSlice:!g.hasRanges,values:[this._getDefaultDimensionValue(g)]})));
this._defaultMultidimensionalDefinition=h;d.callback(f.clone(h))}),function(a){d.errback(a)});return d},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var b,c,e=Infinity,h,d;if(a.hasRanges)return a.values[0];if(a.name&&"stdz"===a.name.toLowerCase()){for(d=0;d<a.values.length&&(h=a.values[d],c=Math.abs(h-0),c<e&&(e=c,b=h),0!==c);d++);return b}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,
function(e){b=e;0<b.length&&(this.mosaicRule?(c=f.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=f.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new D({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={},c=this.renderingRule;if(!c&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=
this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!c||"Resample"!==c.functionName)){var e="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:e,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};c&&(b.rasterFunctionArguments.Raster=c.toJson())}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new B(b),this.setRenderingRule(this.defaultRenderingRule,
a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new D(d.fromJson(a.mosaicRule)),b=this._filterOutTimeDimension(b);a.mosaicRule=d.toJson(b.toJson())}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" "),c;for(c in b)a.hasOwnProperty(b[c])&&delete a[b[c]];return a},_filterOutTimeDimension:function(a){if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var b=k.filter(a.multidimensionalDefinition,
function(a){return"StdTime"!==a.dimensionName});a.multidimensionalDefinition=b}return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&k.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||
"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isRenderingRuleAProcessingTemplate:function(a){var b=a&&a.functionName;return!b||a.functionArguments?!1:k.some(b&&(this.rasterFunctionInfos||[]),function(a){return a&&a.name&&a.name.toLowerCase()===b.toLowerCase()})},_getRenderingRuleId:function(a){var b=a&&a.functionName;if(b){if(this._isRenderingRuleAProcessingTemplate(a))return b;
var c=this._customRenderingRuleId[b];if(c){if(c!==a){for(var e in this._customRenderingRuleId)if(this._customRenderingRuleId[e]===a)return e;for(c=0;this._customRenderingRuleId[h];)c+=1;var h;this._customRenderingRuleId[b+c]=a}}else this._customRenderingRuleId[b]=a;return b}},_createPixelData:function(a){a=new w({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new u(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,
extent:b}},_convertRendererToRenderingRule:function(a){var b=a&&a.declaredClass;if(!b||"esri.renderer.UniqueValueRenderer"!==b&&"esri.renderer.ClassBreaksRenderer"!==b&&"esri.renderer.StretchRenderer"!==b)return null;var c=null;"esri.renderer.StretchRenderer"===b?c=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===b?c=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===b&&(c=this._convertUniqueValueRenderer(a));return c},_getValueField:function(a){if(a&&
a.length){var b,c;k.some(a,function(a){if((c=a.name)&&"value"===c.toLowerCase())return b=c,!0});return b}},_convertClassifyRenderer:function(a){var b,c=[],e=[],h=[],d=[],g;b=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var m,t,f=this.hasRasterAttributeTable,l,r;b&&(f=this._rasterFunctionTemplateInfos[b]?this._rasterFunctionTemplateInfos[b].hasRasterAttributeTable:this.hasRasterAttributeTable,t=this._renderingRuleAttributeTable[b],r=this._rasterFunctionTemplateInfos[b]);m=t&&t.features?
t.features:this._rasterAttributeTableFeatures;l=this._getValueField(t&&t.fields?t.fields:this._rasterAttributeTableFields);f&&m?(k.forEach(a.infos,function(b,c){var e,h=b.symbol.color;h.a&&k.forEach(m,function(g){e=g.attributes[a.attributeField];(e>=b.minValue&&e<b.maxValue||c===a.infos.length-1&&e>=b.minValue)&&d.push([g.attributes[l],h.r,h.g,h.b])},this)},this),b=r&&r.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(d,b),b=new B,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=
d,b.variableName="Raster"):(k.forEach(a.infos,function(a,b){g=a.symbol&&a.symbol.color;g.a?(c.push.call(c,a.minValue,a.maxValue),e.push(b),d.push([b,g.r,g.g,g.b])):h.push(a.minValue,a.maxValue)}),b=r&&r.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(d,b),b=new B,b.functionName="Remap",b.functionArguments={InputRanges:c,OutputValues:e,NoDataRanges:h},b.variableName="Raster",t=new B,t.functionName="Colormap",t.functionArguments={Colormap:d,Raster:b},b=t);return b},_convertUniqueValueRenderer:function(a){var b=
[],c=this.renderingRule&&this._getRenderingRuleId(this.renderingRule),e,h,d,g;c&&(h=this._renderingRuleAttributeTable[c],g=this._rasterFunctionTemplateInfos[c]);e=h&&h.features?h.features:this._rasterAttributeTableFeatures;d=this._getValueField(h&&h.fields?h.fields:this._rasterAttributeTableFields);k.forEach(a.infos,function(c){var h=c.symbol.color;h.a&&(a.attributeField!==d&&e?k.forEach(e,function(e){e.attributes[a.attributeField]==c.value&&b.push([e.attributes[d],h.r,h.g,h.b])},this):b.push([c.value,
h.r,h.g,h.b]))},this);this._adjustColormapToPixelTypeRange(b,g&&g.pixelType||this.pixelType);c=new B;c.functionName="Colormap";c.functionArguments={};c.functionArguments.Colormap=b;c.variableName="Raster";return c},_adjustColormapToPixelTypeRange:function(a,b){(b=this._pixelTypeRanges[b])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a},_combineRenderingRule:function(a,b){if(!a||!b)return a||b;var c=function(a){var b=a.Raster;return b=b&&"esri.layers.RasterFunction"===b.declaredClass?
c(b.functionArguments):a};a=f.clone(a);"none"!==b.functionName.toLocaleLowerCase()&&(c(a.functionArguments).Raster=b);return a},_isItemLevelRasterFunction:function(a){var b=a&&a.functionName;if(!b||!this._hasItemLevelRFT)return!1;var c=!1;k.some(this.rasterFunctionInfos,function(a){if(a&&a.name===b){if(1===a.functionType||2===a.functionType)c=!0;return!0}});return c},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return a;a=new B(a.toJson());var b;b=a.functionArguments;for(var c;;)if((c=
b&&b.Raster)&&c.functionArguments&&c.functionArguments.Raster)b=c,b=b.functionArguments;else{this._isItemLevelRasterFunction(c)&&delete b.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;a=new B(a.toJson());for(a=a.functionArguments;;)if((a=a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,c,e,h,d){c&&this[c].apply(this,a);e&&e.apply(null,
a);h&&b._resDfd(h,a,d)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=p.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(p.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):
null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});l("extend-esri")&&f.setObject("layers.ImageServiceLayerMixin",q,e);return q})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(q,f,n,k,d,r,p){var l=q(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,
sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(d){f.isObject(d)&&(f.mixin(this,d),d.mosaicMethod&&(this.method=d.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),d.mosaicOperation&&(this.operation=d.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=
this._getOperatorEnum(this.operation)),d.fids&&(this.objectIds=d.fids),d.viewpoint&&(this.viewpoint=new r(d.viewpoint)),d.itemRenderingRule&&(this.itemRenderingRule=new p(d.itemRenderingRule)),this.multidimensionalDefinition=d.multidimensionalDefinition||[])},toJson:function(){var g=null,m=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(m)for(var g=[],e=0;e<m;e++)g.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[e].declaredClass?this.multidimensionalDefinition[e].toJson():
this.multidimensionalDefinition[e]);g={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:g,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return d.filter(g,function(c){if(null!==c)return!0})},_getMethodEnum:function(d){if(d){var g=l.METHOD_NONE;
switch(d.toLowerCase()){case "byattribute":g=l.METHOD_ATTRIBUTE;break;case "center":g=l.METHOD_CENTER;break;case "lockraster":g=l.METHOD_LOCKRASTER;break;case "nadir":g=l.METHOD_NADIR;break;case "northwest":g=l.METHOD_NORTHWEST;break;case "seamline":g=l.METHOD_SEAMLINE;break;case "viewpoint":g=l.METHOD_VIEWPOINT}return g}},_getOperatorEnum:function(d){if(d)switch(d.toLowerCase()){case "first":return l.OPERATION_FIRST;case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;
case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});f.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",
OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});n("extend-esri")&&f.setObject("layers.MosaicRule",l,k);return l})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(q,f,n,k,d){q=q(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){f.isObject(d)&&f.mixin(this,d)},toJson:function(){return d.filter({variableName:this.variableName,
dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(d){return null!==d})}});n("extend-esri")&&f.setObject("layers.DimensionalDefinition",q,k);return q})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u){var v,C,D,B,y,z;f=f(m,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,b,c){var g=this,m=new k(h._dfdCanceller);if(10>l("ie"))throw"This browser is not supported.";
if(!a.imageServiceParameters)throw"Insufficient parameters to read data";var t=n.clone(a.imageServiceParameters),f=a.pixelType;d.some(this.validPixelTypes,function(a){return a===f})||(t.pixelType="F32");d.some(this.validFormats,function(a){return a.toLowerCase()===t.format.toLowerCase()})||(t.format="lerc");var r=a.decodeFunc,p;this._prepareGetImageParameters(t);var u=t.width,w=t.height,v=t.extent;delete t.width;delete t.height;delete t.extent;m._pendingDfd=e({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:n.mixin(t,{f:"image"}),load:function(a){g.decode(a,{width:u,height:w,planes:null,pixelType:f,noDataValue:t.noData,format:t.format,decodeFunc:r}).then(function(a){p={pixelBlock:a,extent:v};g._resolve([p,t],"onRasterReadComplete",b,m)},function(a){g._resolve([a],null,c,m,!0)})},error:function(a){g._resolve([a],null,c,m,!0)}});return m.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,e;b.format&&(c=b.format.toUpperCase());"BSQ"!==
c&&"BIP"!==c&&(c=this._getFormat(a));e=b.decodeFunc;if(void 0===e||null===e)e=this._getFormatDecoderDfd(c);return e(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(b){if(b.size&&b.bbox){var e=b.size.split(",");b.width=parseFloat(e[0]);b.height=parseFloat(e[1]);b.extent||(e=b.bbox.split(","),b.extent=new c(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),new a(b.bboxSR)))}else{if(!b.width||Math.floor(b.width)!==b.width||!b.height||Math.floor(b.height)!==
b.height)throw"Incorrect Image Dimensions";if(!b.extent||"esri.geometry.Extent"!==b.extent.declaredClass)throw"Incorrect extent";var e=b.extent,h=e.spatialReference.wkid||p.toJson(e.spatialReference.toJson());delete b._ts;n.mixin(b,{bbox:e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,imageSR:h,bboxSR:h,size:b.width+","+b.height},b.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var e=a.ymax-a.ymin,h=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+h*b/c:a.xmax=a.xmin+e*c/b;return a},
_resolve:function(a,b,c,e,d){b&&this[b].apply(this,a);c&&c.apply(null,a);e&&h._resDfd(e,a,d)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=n.hitch(this,b);return function(c,
e){var h=new k;try{var d;"LERC"===a||!0===y?(d=b(c,e),h.resolve(d)):z.then(function(){d=b(c,e);h.resolve(d)})}catch(N){h.reject(N)}return h}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,c){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);a=(new v).decode(a);
if(!E(a,c))throw"The decoded image dimensions are incorrect.";c=[];var e,h;for(e=0;e<a.pixels.length;e++)h=a.pixels[e],c.push(this._calculateBandStatistics(h));return new b({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:c})},_decodePng:function(a,c){if(!C)throw"The png decoder module is not loaded.";this._validateDecodeParams(c);a=new Uint8Array(a);var e=new C(a);a=new Uint8Array(c.width*c.height*4);e.copyToImageData(a,e.decodePixels());for(var h=e=0,d,h=new Uint8Array(c.width*
c.height),e=0;e<c.width*c.height;e++)h[e]=a[4*e+3];for(var g=new b({width:c.width,height:c.height,pixels:[],pixelType:"U8",mask:h,statistics:[]}),e=0;3>e;e++){d=new Uint8Array(c.width*c.height);for(h=0;h<c.width*c.height;h++)d[h]=a[4*h+e];g.addData({pixels:d,statistics:this._calculateBandStatistics(d)})}return g},_decodeBsq:function(a,c){if(!D)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(c);A=c.noDataValue;c.pixelType=F(c.pixelType);a=D.decodeBSQ(a,{bandCount:c.planes,width:c.width,
height:c.height,pixelType:w,noDataValue:A});var e=[],h,d=null;for(h=0;h<a.pixels.length;h++)d=a.pixels[h],e.push(this._calculateBandStatistics(d));return new b({width:c.width,height:c.height,pixels:a.pixels,pixelType:c.pixelType,mask:a.maskData,statistics:e})},_decodeBip:function(a,c){this._validateDecodeParams(c);A=c.noDataValue;c.pixelType=F(c.pixelType);a=D.decodeBIP(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:w,noDataValue:A});var e=[],h,d=null;for(h=0;h<a.pixels.length;h++)d=
a.pixels[h],e.push(this._calculateBandStatistics(d));return new b({width:c.width,height:c.height,pixels:a.pixels,pixelType:c.pixelType,mask:a.maskData,statistics:e})},_decodeTiff:function(a,c){this._validateDecodeParams(c);A=c.noDataValue;c.pixelType=F(c.pixelType);a=B.decode(a);c=[];var e,h=null;for(e=0;e<a.pixels.length;e++)h=a.pixels[e],c.push(this._calculateBandStatistics(h,a.maskData));return new b({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:c})},
_decodeLerc:function(a,c){this._validateDecodeParams(c);A=c.noDataValue;c.pixelType=F(c.pixelType);for(var e=0,h,d=0,g,m=a.byteLength-10;d<m;){var f=t.decode(a,{inputOffset:d,encodedMaskData:h,returnMask:0===e?!0:!1,returnEncodedMask:0===e?!0:!1,returnFileInfo:!0,pixelType:w,noDataValue:A}),d=f.fileInfo.eofOffset;0===e&&(h=f.encodedMaskData,g=new b({width:c.width,height:c.height,pixels:[],pixelType:c.pixelType,mask:f.maskData,statistics:[]}));e++;if(!E(f,c))throw"The decoded image dimensions are incorrect";
g.addData({pixels:f.pixelData,statistics:{minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue}})}return g},_decodeLerc2:function(a,c){this._validateDecodeParams(c);A=c.noDataValue;c.pixelType=F(c.pixelType);for(var e=0,h,d,g=0,m,t=a.byteLength-10;g<t;){d=u.decode(a,{inputOffset:g,maskData:h,returnFileInfo:!0});g=d.fileInfo.eofOffset;0===e&&(h=d.maskData,m=new b({width:c.width,height:c.height,pixels:[],pixelType:d.fileInfo.pixelType,mask:d.maskData,statistics:[]}));e++;if(!E(d,c))throw"The decoded image dimensions are incorrect";
m.addData({pixels:d.pixelData,statistics:{minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue}})}return m},_calculateBandStatistics:function(a,b){var c=Infinity,e=-Infinity,h=a.length,d,g=0;if(b)for(d=0;d<h;d++)b[d]&&(g=a[d],c=g<c?g:c,e=g>e?g:e);else for(d=0;d<h;d++)g=a[d],c=g<c?g:c,e=g>e?g:e;return{minValue:c,maxValue:e}},_loadRasterFormatModules:function(){y||(z||(z=new k),10>l("ie")?z.isRejected()||z.reject("unsupported browser version"):q(["./rasterFormats/JpgPlus","./rasterFormats/Png",
"./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,c,e){v=a;C=b;D=c;B=e;y=!0;z.isResolved()||z.resolve(!0)}))}});var w=null,A=null,F=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return A=Math.pow(2,8)-1,w=Uint8Array,"U8";"U16"===a?(A=A||Math.pow(2,16)-1,w=Uint16Array):"U32"===a?(A=A||Math.pow(2,32)-1,w=Uint32Array):"S8"===a?(A=A||0-Math.pow(2,7),w=Int8Array):"S16"===a?(A=A||0-Math.pow(2,15),w=Int16Array):"S32"===a?(A=A||0-Math.pow(2,31),w=Int32Array):
w=Float32Array;return a},E=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};l("extend-esri")&&n.setObject("layers.Raster",f,g);return f})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,f,n,k){q=q([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(d){if(d){if(!d.width||Math.floor(d.width)!==d.width)throw"PixelBlock: incorrect width";
if(!d.height||Math.floor(d.height)!==d.height)throw"PixelBlock: incorrect height";if(!d.pixels||!d.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=d.width;this.height=d.height;this.pixels=d.pixels;this.pixelType=d.pixelType||null;this.statistics=d.statistics;this.mask=d.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(d){if(!d.pixels||
!d.statistics)throw"Pixel data or statistics are not present";if(d.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(d.statistics);this.pixels.push(d.pixels)},getAsRGBA:function(){var d=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)},getAsRGBAFloat:function(){var d=new Float32Array(this.width*
this.height*4);this._fillFrom32Bit(d);return d},clone:function(){var d=new this.constructor;d.width=this.width;d.height=this.height;d.pixelType=this.pixelType;this.mask&&(d.mask=new Uint8Array(this.mask));var k,p;if(this.pixels)for(d.pixels=[],p=this.pixels.length,k=0;k<p;k++)d.pixels[k]=new Float32Array(this.pixels[k]);if(this.statistics)for(d.statistics=[],p=this.statistics.length,k=0;k<p;k++)d.statistics[k]=f.clone(this.statistics[k]);return d},_fillFrom8Bit:function(d){var f=this.pixels,k=this.mask;
if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l,g,m;l=g=m=f[0];3<=f.length&&(g=f[1],m=f[2]);var f=new Uint32Array(d),e=this.width*this.height;if(l.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(k&&k.length===e)for(d=0;d<e;d++)k[d]&&(f[d]=-16777216|m[d]<<16|g[d]<<8|l[d]);else for(d=0;d<e;d++)f[d]=-16777216|m[d]<<16|g[d]<<8|l[d]},_fillFromNon8Bit:function(d){var f=this.pixels,k=this.mask,l=this.statistics;
if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var g=1,m=0;l&&0<l.length?(m=l[0].minValue,g=255/(l[0].maxValue-l[0].minValue)):(g=255,"S8"===this.pixelType?(m=-128,g=127):"U16"===this.pixelType?g=65535:"S16"===this.pixelType?(m=-32768,g=32767):"U32"===this.pixelType?g=4294967295:"S32"===this.pixelType?(m=-2147483648,g=2147483647):"F32"===this.pixelType?(m=-3.4*1E39,g=3.4*1E39):"F64"===this.pixelType&&(m=-Number.MAX_VALUE,g=Number.MAX_VALUE),
g=255/(g-m));d=new Uint32Array(d);var l=this.width*this.height,e,c,a;e=f[0];if(e.length!==l)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=f.length)if(c=f[1],a=f[2],k&&k.length===l)for(f=0;f<l;f++)k[f]&&(d[f]=-16777216|(a[f]-m)*g<<16|(c[f]-m)*g<<8|(e[f]-m)*g);else for(f=0;f<l;f++)d[f]=-16777216|(a[f]-m)*g<<16|(c[f]-m)*g<<8|(e[f]-m)*g;else if(k&&k.length===l)for(f=0;f<l;f++)c=(e[f]-m)*g,k[f]&&(d[f]=-16777216|c<<16|c<<8|c);else for(f=0;f<l;f++)c=(e[f]-m)*g,d[f]=
-16777216|c<<16|c<<8|c},_fillFrom32Bit:function(d){var f=this.pixels,k=this.mask;if(!d||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l,g,m;l=g=m=f[0];3<=f.length&&(g=f[1],m=f[2]);var e=this.width*this.height;if(l.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var c=0;if(k&&k.length===e)for(f=0;f<e;f++)d[c++]=l[f],d[c++]=g[f],d[c++]=m[f],d[c++]=k[f];else for(f=0;f<e;f++)d[c++]=l[f],d[c++]=g[f],d[c++]=
m[f],d[c++]=255}});n("extend-esri")&&f.setObject("layers.PixelBlock",q,k);return q})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var q={defaultNoDataValue:-3.4027999387901484E38,decode:function(n,k){var d;k=k||{};var r=k.inputOffset||0,p=k.encodedMaskData||null===k.encodedMaskData,l={},g=new Uint8Array(n,r,10);l.fileIdentifierString=String.fromCharCode.apply(null,g);if("CntZImage"!=l.fileIdentifierString.trim())throw"Unexpected file identifier string: "+l.fileIdentifierString;
r+=10;g=new DataView(n,r,24);l.fileVersion=g.getInt32(0,!0);l.imageType=g.getInt32(4,!0);l.height=g.getUint32(8,!0);l.width=g.getUint32(12,!0);l.maxZError=g.getFloat64(16,!0);r+=24;if(!p)if(g=new DataView(n,r,16),l.mask={},l.mask.numBlocksY=g.getUint32(0,!0),l.mask.numBlocksX=g.getUint32(4,!0),l.mask.numBytes=g.getUint32(8,!0),l.mask.maxValue=g.getFloat32(12,!0),r+=16,0<l.mask.numBytes){var p=new Uint8Array(Math.ceil(l.width*l.height/8)),g=new DataView(n,r,l.mask.numBytes),m=g.getInt16(0,!0),e=2,
c=0;do{if(0<m)for(;m--;)p[c++]=g.getUint8(e++);else for(var a=g.getUint8(e++),m=-m;m--;)p[c++]=a;m=g.getInt16(e,!0);e+=2}while(e<l.mask.numBytes);if(-32768!==m||c<p.length)throw"Unexpected end of mask RLE encoding";l.mask.bitset=p;r+=l.mask.numBytes}else 0===(l.mask.numBytes|l.mask.numBlocksY|l.mask.maxValue)&&(p=new Uint8Array(Math.ceil(l.width*l.height/8)),l.mask.bitset=p);g=new DataView(n,r,16);l.pixels={};l.pixels.numBlocksY=g.getUint32(0,!0);l.pixels.numBlocksX=g.getUint32(4,!0);l.pixels.numBytes=
g.getUint32(8,!0);l.pixels.maxValue=g.getFloat32(12,!0);r+=16;p=l.pixels.numBlocksX;g=l.pixels.numBlocksY;p+=0<l.width%p?1:0;m=g+(0<l.height%g?1:0);l.pixels.blocks=Array(p*m);for(c=e=0;c<m;c++)for(a=0;a<p;a++){var h=0,g=new DataView(n,r,Math.min(10,n.byteLength-r)),b={};l.pixels.blocks[e++]=b;var t=g.getUint8(0);h++;b.encoding=t&63;if(3<b.encoding)throw"Invalid block encoding ("+b.encoding+")";if(2===b.encoding)r++;else{if(0!==t&&2!==t){t>>=6;b.offsetType=t;if(2===t)b.offset=g.getInt8(1),h++;else if(1===
t)b.offset=g.getInt16(1,!0),h+=2;else if(0===t)b.offset=g.getFloat32(1,!0),h+=4;else throw"Invalid block offset type";if(1===b.encoding)if(t=g.getUint8(h),h++,b.bitsPerPixel=t&63,t>>=6,b.numValidPixelsType=t,2===t)b.numValidPixels=g.getUint8(h),h++;else if(1===t)b.numValidPixels=g.getUint16(h,!0),h+=2;else if(0===t)b.numValidPixels=g.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";}r+=h;if(3!=b.encoding)if(0===b.encoding){t=(l.pixels.numBytes-1)/4;if(t!==Math.floor(t))throw"uncompressed block has invalid length";
g=new ArrayBuffer(4*t);h=new Uint8Array(g);h.set(new Uint8Array(n,r,4*t));g=new Float32Array(g);b.rawData=g;r+=4*t}else 1===b.encoding&&(t=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),g=new ArrayBuffer(4*Math.ceil(t/4)),h=new Uint8Array(g),h.set(new Uint8Array(n,r,t)),b.stuffedData=new Uint32Array(g),r+=t)}}l.eofOffset=r;n=null!=k.noDataValue?k.noDataValue:q.defaultNoDataValue;var p=k.encodedMaskData,t=k.returnMask,m=0,e=l.pixels.numBlocksX,c=l.pixels.numBlocksY,a=Math.floor(l.width/e),b=Math.floor(l.height/
c),h=2*l.maxZError,r=Number.MAX_VALUE,u,p=p||(l.mask?l.mask.bitset:null),v,g=new (k.pixelType||Float32Array)(l.width*l.height);t&&p&&(v=new Uint8Array(l.width*l.height));for(var t=new Float32Array(a*b),C,D,B=0;B<=c;B++){var y=B!==c?b:l.height%c;if(0!==y)for(var z=0;z<=e;z++){var w=z!==e?a:l.width%e;if(0!==w){var A=B*l.width*b+z*a,F=l.width-w,E=l.pixels.blocks[m],G,H;if(2>E.encoding){if(0===E.encoding)G=E.rawData;else{G=E.stuffedData;H=E.bitsPerPixel;u=E.numValidPixels;C=E.offset;D=h;var L=t,J=l.pixels.maxValue,
K=(1<<H)-1,O=0,N=void 0,S=0,Q=void 0,M=void 0,P=Math.ceil((J-C)/D);G[G.length-1]<<=8*(4*G.length-Math.ceil(H*u/8));for(N=0;N<u;N++)0===S&&(M=G[O++],S=32),S>=H?(Q=M>>>S-H&K,S-=H):(S=H-S,Q=(M&K)<<S&K,M=G[O++],S=32-S,Q+=M>>>S),L[N]=Q<P?C+Q*D:J;G=t}H=0}else d=2===E.encoding?0:E.offset;var I;if(p)for(D=0;D<y;D++){A&7&&(I=p[A>>3],I<<=A&7);for(C=0;C<w;C++)A&7||(I=p[A>>3]),I&128?(v&&(v[A]=1),u=2>E.encoding?G[H++]:d,r=r>u?u:r,g[A++]=u):(v&&(v[A]=0),g[A++]=n),I<<=1;A+=F}else if(2>E.encoding)for(D=0;D<y;D++){for(C=
0;C<w;C++)u=G[H++],r=r>u?u:r,g[A++]=u;A+=F}else for(r=r>d?d:r,D=0;D<y;D++){for(C=0;C<w;C++)g[A++]=d;A+=F}if(1===E.encoding&&H!==E.numValidPixels)throw"Block and Mask do not match";m++}}}d=v;v={width:l.width,height:l.height,pixelData:g,minValue:r,maxValue:l.pixels.maxValue,noDataValue:n};d&&(v.maskData=d);k.returnEncodedMask&&l.mask&&(v.encodedMaskData=l.mask.bitset?l.mask.bitset:null);if(k.returnFileInfo&&(v.fileInfo=f(l),k.computeUsedBitDepths)){k=v.fileInfo;d=l.pixels.numBlocksX*l.pixels.numBlocksY;
I={};for(G=0;G<d;G++)H=l.pixels.blocks[G],0===H.encoding?I.float32=!0:1===H.encoding?I[H.bitsPerPixel]=!0:I[0]=!0;l=Object.keys(I);k.bitDepths=l}return v}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,
numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return q})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var q={unstuff:function(f,d,r,p,l,g,m,e){var c=(1<<r)-1,a=0,h,b=0,t,k;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*p/8));if(l)for(h=0;h<p;h++)0===b&&(k=f[a++],b=32),b>=r?(t=k>>>b-r&c,b-=r):(b=r-b,t=(k&c)<<b&c,k=f[a++],b=32-b,t+=k>>>b),d[h]=l[t];else for(l=Math.ceil((e-g)/m),h=0;h<p;h++)0===b&&(k=f[a++],
b=32),b>=r?(t=k>>>b-r&c,b-=r):(b=r-b,t=(k&c)<<b&c,k=f[a++],b=32-b,t+=k>>>b),d[h]=t<l?g+t*m:e},unstuffLUT:function(f,d,r,p,l,g){var m=(1<<d)-1,e=0,c=0,a=0,h=a=0,b,t=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(d*r/8));for(var k=Math.ceil((g-p)/l),c=0;c<r;c++)0===a&&(b=f[e++],a=32),a>=d?(h=b>>>a-d&m,a-=d):(a=d-a,h=(b&m)<<a&m,b=f[e++],a=32-a,h+=b>>>a),t[c]=h<k?p+h*l:g;t.unshift(p);return t},unstuff2:function(f,d,r,p,l,g,m,e){var c=(1<<r)-1,a=0,h,b=0,t=0,k,n,q;if(l)for(h=0;h<p;h++)0===b&&(n=f[a++],b=32,
t=0),b>=r?(k=n>>>t&c,b-=r,t+=r):(q=r-b,k=n>>>t&c,n=f[a++],b=32-q,k|=(n&(1<<q)-1)<<r-q,t=q),d[h]=l[k];else for(l=Math.ceil((e-g)/m),h=0;h<p;h++)0===b&&(n=f[a++],b=32,t=0),b>=r?(k=n>>>t&c,b-=r,t+=r):(q=r-b,k=n>>>t&c,n=f[a++],b=32-q,k|=(n&(1<<q)-1)<<r-q,t=q),d[h]=k<l?g+k*m:e;return d},unstuffLUT2:function(f,d,r,p,l,g){for(var m=(1<<d)-1,e=0,c=0,a=0,h=0,b=0,t=0,k,n=[],q=Math.ceil((g-p)/l),c=0;c<r;c++)0===h&&(k=f[e++],h=32,t=0),h>=d?(b=k>>>t&m,h-=d,t+=d):(a=d-h,b=k>>>t&m,k=f[e++],h=32-a,b|=(k&(1<<a)-1)<<
d-a,t=a),n[c]=b<q?p+b*l:g;n.unshift(p);return n},originalUnstuff:function(f,d,r,p){var l=(1<<r)-1,g=0,m,e=0,c,a;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*p/8));for(m=0;m<p;m++)0===e&&(a=f[g++],e=32),e>=r?(c=a>>>e-r&l,e-=r):(e=r-e,c=(a&l)<<e&l,a=f[g++],e=32-e,c+=a>>>e),d[m]=c;return d},originalUnstuff2:function(f,d,r,p){var l=(1<<r)-1,g=0,m,e=0,c=0,a,h,b;for(m=0;m<p;m++)0===e&&(h=f[g++],e=32,c=0),e>=r?(a=h>>>c&l,e-=r,c+=r):(b=r-e,a=h>>>c&l,h=f[g++],e=32-b,a|=(h&(1<<b)-1)<<r-b,c=b),d[m]=a;return d}},
f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var d=65535,k=65535,p=f.length,l=Math.floor(p/2),g=0;l;){var m=359<=l?359:l,l=l-m;do d+=f[g++]<<8,k+=d+=f[g++];while(--m);d=(d&65535)+(d>>>16);k=(k&65535)+(k>>>16)}p&1&&(k+=d+=f[g]<<8);return((k&65535)+(k>>>16)<<16|(d&65535)+(d>>>16))>>>0},readHeaderInfo:function(f,d){var k=d.ptr,p=new Uint8Array(f,k,6),l={};l.fileIdentifierString=String.fromCharCode.apply(null,p);if(0!==l.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+
l.fileIdentifierString;k+=6;p=new DataView(f,k,52);l.fileVersion=p.getInt32(0,!0);k+=4;3<=l.fileVersion&&(l.checksum=p.getUint32(4,!0),k+=4);p=new DataView(f,k,48);l.height=p.getUint32(0,!0);l.width=p.getUint32(4,!0);l.numValidPixel=p.getUint32(8,!0);l.microBlockSize=p.getInt32(12,!0);l.blobSize=p.getInt32(16,!0);l.imageType=p.getInt32(20,!0);l.maxZError=p.getFloat64(24,!0);l.zMin=p.getFloat64(32,!0);l.zMax=p.getFloat64(40,!0);k+=48;d.headerInfo=l;d.ptr=k;if(3<=l.fileVersion&&(f=this.computeChecksumFletcher32(new Uint8Array(f,
k-48,l.blobSize-14)),f!==l.checksum))throw"Checksum failed.";return!0},readMask:function(f,d){var k=d.ptr,p=d.headerInfo,l=p.width*p.height,g=p.numValidPixel,m=new DataView(f,k,4),p={};p.numBytes=m.getUint32(0,!0);k+=4;if((0===g||l===g)&&0!==p.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(l/8)),p.bitset=g,m=new Uint8Array(l),d.pixels.resultMask=m,k+=p.numBytes;else if(0<p.numBytes){g=new Uint8Array(Math.ceil(l/8));m=new DataView(f,k,p.numBytes);f=m.getInt16(0,!0);var e=2,c=0,a=
0;do{if(0<f)for(;f--;)g[c++]=m.getUint8(e++);else for(a=m.getUint8(e++),f=-f;f--;)g[c++]=a;f=m.getInt16(e,!0);e+=2}while(e<p.numBytes);if(-32768!==f||c<g.length)throw"Unexpected end of mask RLE encoding";m=new Uint8Array(l);for(e=e=f=0;e<l;e++)e&7?(f=g[e>>3],f<<=e&7):f=g[e>>3],f&128&&(m[e]=1);d.pixels.resultMask=m;p.bitset=g;k+=p.numBytes}d.ptr=k;d.mask=p;return!0},readDataOneSweep:function(k,d,r){var p=d.ptr,l=d.headerInfo,g=l.width*l.height,l=l.numValidPixel*f.getDateTypeSize(l.imageType);if(r===
Uint8Array)k=new Uint8Array(k,p,l);else{var m=new ArrayBuffer(l);(new Uint8Array(m)).set(new Uint8Array(k,p,l));k=new r(m)}if(k.length===g)d.pixels.resultPixels=k;else for(d.pixels.resultPixels=new r(g),m=m=r=0;m<g;m++)d.pixels.resultMask[m]&&(d.pixels.resultPixels[m]=k[r++]);d.ptr=p+l;return!0},readHuffman:function(k,d,r){var p=d.headerInfo,l=p.width*p.height,g=this.HUFFMAN_LUT_BITS_MAX,p=new DataView(k,d.ptr,16);d.ptr+=16;if(2>p.getInt32(0,!0))throw"unsupported Huffman version";var m=p.getInt32(4,
!0),e=p.getInt32(8,!0),c=p.getInt32(12,!0);if(e>=c)return!1;var a=new Uint32Array(c-e);f.decodeBits(k,d,a);for(var h=[],b,t,p=e;p<c;p++)b=p-(p<m?0:m),h[b]={first:a[p-e],second:null};p=k.byteLength-d.ptr;a=new ArrayBuffer(4*Math.ceil(p/4));(new Uint8Array(a)).set(new Uint8Array(k,d.ptr,p));k=new Uint32Array(a);var a=0,u,v=0;u=k[0];for(p=e;p<c;p++)b=p-(p<m?0:m),t=h[b].first,0<t&&(h[b].second=u<<a>>>32-t,32-a>=t?(a+=t,32===a&&(a=0,v++,u=k[v])):(a+=t-32,v++,u=k[v],h[b].second|=u>>>32-a));for(var q=0===
d.headerInfo.imageType?128:0,D=d.headerInfo.height,B=d.headerInfo.width,y=0,z=0,w=new n,p=0;p<h.length;p++)void 0!==h[p]&&(y=Math.max(y,h[p].first));z=y>=g?g:y;30<=y&&console.log("WARning, large NUM LUT BITS IS "+y);for(var g=[],A,p=e;p<c;p++)if(b=p-(p<m?0:m),t=h[b].first,0<t)if(u=[t,b],t<=z)for(b=h[b].second<<z-t,A=1<<z-t,e=0;e<A;e++)g[b|e]=u;else for(b=h[b].second,A=w,e=t-1;0<=e;e--)(t=b>>>e&1)?(A.right||(A.right=new n),A=A.right):(A.left||(A.left=new n),A=A.left),0!==e||A.val||(A.val=u[1]);var m=
d.pixels.resultMask,F,h=c=0;0<a&&(v++,a=0);u=k[v];r=new r(l);if(d.headerInfo.numValidPixel===B*D)for(p=e=0;p<D;p++)for(b=0;b<B;b++,e++){l=0;h=F=u<<a>>>32-z;32-a<z&&(h=F|=k[v+1]>>>64-a-z);if(g[h])l=g[h][1],a+=g[h][0];else for(h=F=u<<a>>>32-y,32-a<y&&(h=F|=k[v+1]>>>64-a-y),A=w,h=0;h<y;h++)if(A=(t=F>>>y-h-1&1)?A.right:A.left,!A.left&&!A.right){l=A.val;a=a+h+1;break}32<=a&&(a-=32,v++,u=k[v]);l-=q;l=0<b?l+c:0<p?l+r[e-B]:l+c;l&=255;c=r[e]=l}else for(p=e=0;p<D;p++)for(b=0;b<B;b++,e++)if(m[e]){l=0;h=F=u<<
a>>>32-z;32-a<z&&(h=F|=k[v+1]>>>64-a-z);if(g[h])l=g[h][1],a+=g[h][0];else for(h=F=u<<a>>>32-y,32-a<y&&(h=F|=k[v+1]>>>64-a-y),A=w,h=0;h<y;h++)if(A=(t=F>>>y-h-1&1)?A.right:A.left,!A.left&&!A.right){l=A.val;a=a+h+1;break}32<=a&&(a-=32,v++,u=k[v]);l-=q;l=0<b&&m[e-1]?l+c:0<p&&m[e-B]?l+r[e-B]:l+c;l&=255;c=r[e]=l}d.pixels.resultPixels=r;d.ptr=d.ptr+4*(v+1)+(0<a?4:0)},decodeBits:function(f,d,r,p){var l=d.headerInfo.fileVersion,g=0,m=new DataView(f,d.ptr,5),e=m.getUint8(0);g++;var c=e>>6,a=0===c?4:3-c,h=0<
(e&32)?!0:!1,c=e&31,e=0;if(1===a)e=m.getUint8(g),g++;else if(2===a)e=m.getUint16(g,!0),g+=2;else if(4===a)e=m.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";var a=2*d.headerInfo.maxZError,b,t,k;if(h){d.counter.lut++;k=m.getUint8(g);g++;h=Math.ceil((k-1)*c/8);b=Math.ceil(h/4);b=new ArrayBuffer(4*b);t=new Uint8Array(b);d.ptr+=g;t.set(new Uint8Array(f,d.ptr,h));g=new Uint32Array(b);d.ptr+=h;for(m=0;k-1>>>m;)m++;h=Math.ceil(e*m/8);b=Math.ceil(h/4);b=new ArrayBuffer(4*b);t=new Uint8Array(b);
t.set(new Uint8Array(f,d.ptr,h));f=new Uint32Array(b);d.ptr+=h;d=3<=l?q.unstuffLUT2(g,c,k-1,p,a,d.headerInfo.zMax):q.unstuffLUT(g,c,k-1,p,a,d.headerInfo.zMax);3<=l?q.unstuff2(f,r,m,e,d):q.unstuff(f,r,m,e,d)}else d.counter.bitstuffer++,m=c,d.ptr+=g,0<m&&(h=Math.ceil(e*m/8),b=Math.ceil(h/4),b=new ArrayBuffer(4*b),t=new Uint8Array(b),t.set(new Uint8Array(f,d.ptr,h)),f=new Uint32Array(b),d.ptr+=h,3<=l?null==p?q.originalUnstuff2(f,r,m,e):q.unstuff2(f,r,m,e,!1,p,a,d.headerInfo.zMax):null==p?q.originalUnstuff(f,
r,m,e):q.unstuff(f,r,m,e,!1,p,a,d.headerInfo.zMax))},readTiles:function(k,d,r){var p=d.headerInfo,l=p.width,g=p.height,m=p.microBlockSize,p=p.imageType,e=Math.ceil(l/m),c=Math.ceil(g/m);d.pixels.numBlocksY=c;d.pixels.numBlocksX=e;for(var a=d.pixels.ptr=0,h=0,b=0,t=0,u=0,n=0,q=0,D=0,B=a=0,y=0,z=0,q=q=a=q=0,w,A=new r(m*m),g=g%m||m,F=l%m||m,b=0;b<c;b++)for(u=b!==c-1?m:g,t=0;t<e;t++){n=t!==e-1?m:F;y=b*l*m+t*m;z=l-n;q=k.byteLength-d.ptr;h=new DataView(k,d.ptr,Math.min(10,q));w={};q=0;D=h.getUint8(0);q++;
a=D>>6&255;B=D>>2&15;if(B!==(t*m>>3&15))throw"integrity issue";D&=3;if(3<D)throw d.ptr+=q,"Invalid block encoding ("+D+")";if(2===D)d.counter.constant++,d.ptr+=q;else if(0===D){d.counter.uncompressed++;d.ptr+=q;q=u*n*f.getDateTypeSize(p);a=k.byteLength-d.ptr;q=q<a?q:a;a=new ArrayBuffer(q);h=new Uint8Array(a);h.set(new Uint8Array(k,d.ptr,q));w=new r(a);q=0;if(d.pixels.resultMask)for(a=0;a<u;a++){for(h=0;h<n;h++)d.pixels.resultMask[y]&&(d.pixels.resultPixels[y]=w[q++]),y++;y+=z}else for(a=0;a<u;a++){for(h=
0;h<n;h++)d.pixels.resultPixels[y++]=w[q++];y+=z}d.ptr+=q*f.getDateTypeSize(p)}else if(a=f.getDataTypeUsed(p,a),w=f.getOnePixel(w,q,a,h),q+=f.getDateTypeSize(a),3===D)if(d.ptr+=q,d.counter.constantoffset++,d.pixels.resultMask)for(a=0;a<u;a++){for(h=0;h<n;h++)d.pixels.resultMask[y]&&(d.pixels.resultPixels[y]=w),y++;y+=z}else for(a=0;a<u;a++){for(h=0;h<n;h++)d.pixels.resultPixels[y++]=w;y+=z}else if(d.ptr+=q,f.decodeBits(k,d,A,w),q=0,d.pixels.resultMask)for(a=0;a<u;a++){for(h=0;h<n;h++)d.pixels.resultMask[y]&&
(d.pixels.resultPixels[y]=A[q++]),y++;y+=z}else for(a=0;a<u;a++){for(h=0;h<n;h++)d.pixels.resultPixels[y++]=A[q++];y+=z}}},formatFileInfo:function(k){return{fileIdentifierString:k.headerInfo.fileIdentifierString,fileVersion:k.headerInfo.fileVersion,imageType:k.headerInfo.imageType,height:k.headerInfo.height,width:k.headerInfo.width,numValidPixel:k.headerInfo.numValidPixel,microBlockSize:k.headerInfo.microBlockSize,blobSize:k.headerInfo.blobSize,maxZError:k.headerInfo.maxZError,pixelType:f.getPixelType(k.headerInfo.imageType),
eofOffset:k.eofOffset,mask:k.mask?{numBytes:k.mask.numBytes}:null,pixels:{numBlocksX:k.pixels.numBlocksX,numBlocksY:k.pixels.numBlocksY,maxValue:k.headerInfo.zMax,minValue:k.headerInfo.zMin,noDataValue:k.noDataValue}}},constructConstantSurface:function(f){var d=f.headerInfo.zMax,k=f.headerInfo.height*f.headerInfo.width,p=0;if(f.pixels.resultMask)for(p=0;p<k;p++)f.pixels.resultMask[p]&&(f.pixels.resultPixels[p]=d);else for(p=0;p<k;p++)f.pixels.resultPixels[p]=d},getDataTypeArray:function(f){switch(f){case 0:f=
Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,d){if(null===
d||void 0===d)return!1;switch(f){case 0:f=-128<=d&&127>=d;break;case 1:f=0<=d&&255>=d;break;case 2:f=-32768<=d&&32767>=d;break;case 3:f=0<=d&&65536>=d;break;case 4:f=-2147483648<=d&&2147483647>=d;break;case 5:f=0<=d&&4294967296>=d;break;case 6:f=-3.4027999387901484E38<=d&&3.4027999387901484E38>=d;break;case 7:f=4.9E-324<=d&&1.7976931348623157E308>=d;break;default:f=!1}return f},getDateTypeSize:function(f){var d=0;switch(f){case 0:case 1:d=1;break;case 2:case 3:d=2;break;case 4:case 5:case 6:d=4;break;
case 7:d=8;break;default:d=f}return d},getDataTypeUsed:function(f,d){var k=f;switch(f){case 2:case 4:k=f-d;break;case 3:case 5:k=f-2*d;break;case 6:k=0===d?f:1===d?2:1;break;case 7:k=0===d?f:f-2*d+1;break;default:k=f}return k},getOnePixel:function(f,d,r,p){f=0;switch(r){case 0:f=p.getInt8(d);break;case 1:f=p.getUint8(d);break;case 2:f=p.getInt16(d,!0);break;case 3:f=p.getUint16(d,!0);break;case 4:f=p.getInt32(d,!0);break;case 5:f=p.getUInt32(d,!0);break;case 6:f=p.getFloat32(d,!0);break;case 7:f=
p.getFloat64(d,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},n=function(f,d,r){this.val=f;this.left=d;this.right=r};return{decode:function(k,d){d=d||{};var r=d.maskData||null===d.maskData,p=d.noDataValue,l=0,g={};g.ptr=d.inputOffset||0;g.pixels={};if(f.readHeaderInfo(k,g)){var l=g.headerInfo,m=f.getDataTypeArray(l.imageType);if(r)g.pixels.resultMask=d.maskData,g.ptr+=4;else if(!f.readMask(k,g))return;r=l.width*l.height;g.pixels.resultPixels=new m(r);g.counter=
{onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==l.numValidPixel)if(l.zMax===l.zMin)f.constructConstantSurface(g);else{var e=new DataView(k,g.ptr,2),c=e.getUint8(0,!0);g.ptr++;c?f.readDataOneSweep(k,g,m):1<l.fileVersion&&1>=l.imageType&&1E-5>Math.abs(l.maxZError-.5)?(e=e.getUint8(1,!0),g.ptr++,e?f.readHuffman(k,g,m):f.readTiles(k,g,m)):f.readTiles(k,g,m)}g.eofOffset=g.ptr;d.inputOffset?(k=g.headerInfo.blobSize+d.inputOffset-g.ptr,1<=Math.abs(k)&&(g.eofOffset=d.inputOffset+
g.headerInfo.blobSize)):(k=g.headerInfo.blobSize-g.ptr,1<=Math.abs(k)&&(g.eofOffset=g.headerInfo.blobSize));k={width:l.width,height:l.height,pixelData:g.pixels.resultPixels,minValue:l.zMin,maxValue:l.zMax,maskData:g.pixels.resultMask};if(g.pixels.resultMask&&f.isValidPixelValue(l.imageType,p)){m=g.pixels.resultMask;for(l=0;l<r;l++)m[l]||(k.pixelData[l]=p);k.noDataValue=p}g.noDataValue=p;d.returnFileInfo&&(k.fileInfo=f.formatFileInfo(g));return k}},getBandCount:function(k){for(var d=0,r=0,p={ptr:0,
pixels:{}};r<k.byteLength-58;)f.readHeaderInfo(k,p),r+=p.headerInfo.blobSize,d++,p.ptr=r;return d}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(q,f,n,k,d,r){q=q(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){f.mixin(this,
d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,f){this.inputUnit=d;this.outputUnit=f;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=r.indexOf(this.speedUnits,this.inputUnit),f=r.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=f){var g=[1,.277778,.514444,.3048,
.44704,0];this.unitConversionFactor=g[d]/g[f]}},computeMagnitudeAndDirection:function(f){if(!d.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var l=f.pixelBlock;if(!d.isDefined(l)||2!==l.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var g=f.extent,m=(g.xmax-g.xmin)/l.width,e=(g.ymax-g.ymin)/l.height,c=g.xmin+m/2,g=g.ymax-e/2;l.statistics[0].minValue=0;l.statistics[0].maxValue=0;var a=180/Math.PI,
h=[],b=0,t=0,k=0,p=!d.isDefined(l.mask),r,n,q,y,z,w,A,F;z=A=Infinity;w=F=-Infinity;for(b=0;b<l.height;b++)for(t=0;t<l.width;t++,k++)if(h.push([c+m*t,g-e*b]),p||l.mask[k])q=r=l.pixels[0][k]*this.unitConversionFactor,y=n=l.pixels[1][k],this.isDataUV&&(q=Math.sqrt(r*r+n*n),y=90-a*Math.atan2(n,r),l.pixels[0][k]=q*this.unitConversionFactor,l.pixels[1][k]=y),q>w&&(w=q),q<z&&(z=q),y>F&&(F=y),y<A&&(A=y);l.statistics[0].maxValue=w;l.statistics[0].minValue=z;l.statistics[1].maxValue=F;l.statistics[1].minValue=
A;f.locations=h;return f}});n("extend-esri")&&f.setObject("layers.pixelFilters.VectorFieldPixelFilter",q,k);return q})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(q,f,n,k){var d;return f(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},decode:function(d,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";var l=new n,g,m=new Uint8Array(d);
d=this._getFormat(d);if("error"===d)throw"invalid format";"jpeg"===d&&(g=this._getMask(m,f));var e="",c,a;for(c=0;c<m.length;c+=65535)a=m.subarray(c,c+65535>m.length-1?m.length-1:c+65535),e+=String.fromCharCode.apply(null,a);var m="data:image/"+d+";base64,"+window.btoa(e),h=new Image,b;h.src=m;var t=this;h.onload=function(){t.ctx.clearRect(0,0,f.width,f.height);t.ctx.drawImage(h,0,0);var a=t.ctx.getImageData(0,0,h.width,h.height);b=a.data;if(g)for(c=0;c<g.length;c++)b[4*c+3]=g[c]?255:0;t.ctx.putImageData(a,
0,0);l.resolve(null)};h.onerror=function(){l.reject("cannot load image")};return l},_getFormat:function(d){d=new Uint8Array(d,0,10);var f="error";255===d[0]&&216===d[1]?f="jpeg":137===d[0]&&80===d[1]&&78===d[2]&&71===d[3]&&(f="png");return f},_getMask:function(f,k){var l;try{if(!d)throw"The zlib decoder module is not loaded.";var g=0,m=0,e=Math.round(f.length/2);1===e%2&&(e+=1);for(var c=f.length-2,g=e;g<c&&(255!==f[g]||217!==f[g+1]);g++);e=g+=2;if(e<f.length-1){var a=(new d(f.subarray(e))).getBytes();
l=new Uint8Array(k.width*k.height);for(g=f=0;g<a.length;g++)for(m=7;0<=m;m--)l[f++]=a[g]>>m&1}}catch(h){}return l},_loadRasterFormatModule:function(){10>k("ie")||q(["./Zlib"],function(f){d=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(q,f,n,k,d,r,p,l){q=q(p,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(d){this._url.path+=
"/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(d,f,e,c,a){try{var h=new l(d);this._successHandler([h],"onComplete",e,a)}catch(b){this._errorHandler(b,c,a)}},execute:function(g,m,e,c){var a=c.assembly;g=this._encode(f.mixin({},this._url.query,{f:"json"},g.toJson(a&&a[0])));var h=this._handler,b=this._errorHandler;return d({url:this._url.path,content:g,callbackParamName:"callback",load:function(a,b){h(a,b,m,e,c.dfd)},
error:function(a){b(a,e,c.dfd)}})},onComplete:function(){}});r._createWrappers(q);n("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",q,k);return q})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(q,f,n,k,d,r){q=q(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(f){f.catalogItems&&(this.catalogItems=new r(f.catalogItems));f.location&&
(this.location=d.fromJson(f.location));this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}});n("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",q,k);return q})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(q,
f,n,k,d,r,p,l){q=q(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(d){var g=d&&d.geometry||this.geometry;d={geometry:g,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?
n.toJson(this.renderingRule.toJson()):null};g&&(d.geometryType=l.getJsonType(g));g=this.timeExtent;d.time=g?g.toJson().join(","):null;p.isDefined(this.pixelSizeX)&&p.isDefined(this.pixelSizeY)?d.pixelSize=n.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(d.pixelSize=this.pixelSize?n.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(d.renderingRules=n.toJson(k.map(this.renderingRules,function(e){return e.toJson()})));return d}});d("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",
q,r);return q})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(q,f,n){var k;return q(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(d){this.stretchType=d.stretchType||d.StretchType||this.stretchType;this.min=d.min||d.Min||this.min;this.max=d.max||
d.Max||this.max;this.numberOfStandardDeviations=d.numberOfStandardDeviations||d.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=d.statistics||d.Statistics||this.statistics;this.dra=d.dra||d.DRA||d.dRA||this.dra;this.minPercent=d.minPercent||d.MinPercent||this.minPercent;this.maxPercent=d.maxPercent||d.MaxPercent||this.maxPercent;this.useGamma=d.useGamma||d.UseGamma||this.useGamma;this.gamma=d.gamma||d.Gamma||this.gamma;this.computeGamma=d.computeGamma||d.ComputeGamma||
this.computeGamma;this.raster=d.raster||d.Raster||this.raster;this.outputPixelType=d.outputPixelType||d.OutputPixelType||this.outputPixelType;this.raster=d.raster||d.Raster||this.raster;k=this},filter:function(d){if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){var f=d.pixelBlock,p=f.pixels,l=f.width*f.height,g=p.length,m;(m=6===k.stretchType||3===k.stretchType&&k.dra)&&k._calculateStatisticsHistograms(d);if(k.dra)if(m)k._statistics=f.statistics,k._histograms=f.histograms;else{var e=
f.statistics;k._statistics=[];for(m=0;m<g;m++)k._statistics[m]=[e[m].minValue,e[m].maxValue,0,0]}else k._statistics=k.statistics,k._histograms=k.histograms;k.computeGamma&&(k.gamma=k._computeGammaValues(f.pixelType),k.useGamma=!0);k._createLUT(d);if(void 0===k.LUT||null===k.LUT)return k._filterNoLUT(d);var e=k.LUT,c=k.LUTOffset,a,h;for(m=0;m<g;m++)for(h=e[m],f=0;f<l;f++)a=p[m][f],p[m][f]=h[a-c];d.pixelBlock.pixelType="U8";return d}},_calculateStatisticsHistograms:function(d){d=d.pixelBlock;var k=
d.pixelType,p=d.pixels,l=d.mask,g=p.length,m,e,c,a,h=function(a){this.min=-.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},b=[],t,u,n,q,D,B;for(c=0;c<g;c++){t=new h;u=t.counts;q=p[c];if("U8"===k)if(l)for(a=0;a<d.width*d.height;a++)l[a]&&u[q[a]]++;else for(a=0;a<d.width*d.height;a++)u[q[a]]++;else{m=d.statistics[c].minValue;e=d.statistics[c].maxValue;t.min=m;t.max=e;e=(e-m)/256;n=new Uint32Array(257);if(l)for(a=0;a<d.width*d.height;a++)l[a]&&n[Math.floor((q[a]-
m)/e)]++;else for(a=0;a<d.width*d.height;a++)n[Math.floor((q[a]-m)/e)]++;for(a=0;255>a;a++)u[a]=n[a];u[255]=n[255]+n[256]}b.push(t);q=[];m=d.statistics[c].minValue;e=d.statistics[c].maxValue;for(a=B=D=n=0;a<t.size;a++)n+=u[a],D+=a*u[a];D/=n;for(a=0;a<t.size;a++)B+=u[a]*Math.pow(a-D,2);u=Math.sqrt(B/(n-1));a=(D+.5)*(t.max-t.min)/t.size+t.min;t=u*(t.max-t.min)/t.size;q.push(m);q.push(e);q.push(a);q.push(t);d.statistics[c]=q}d.histograms=b},_getCutOffPoints:function(d){d=d.pixelBlock.pixels.length;var f=
[],p=[],l,g,m,e,c,a;switch(k.stretchType){case 5:for(c=0;c<d;c++)f[c]=k._statistics[c][0],p[c]=k._statistics[c][1];break;case 3:for(c=0;c<d;c++)f[c]=k._statistics[c][2]-k.numberOfStandardDeviations*k._statistics[c][3],p[c]=k._statistics[c][2]+k.numberOfStandardDeviations*k._statistics[c][3],f[c]<k._statistics[c][0]&&(f[c]=k._statistics[c][0]),p[c]>k._statistics[c][1]&&(p[c]=k._statistics[c][1]);break;case 6:for(c=0;c<d;c++){l=k._histograms[c];e=new Uint32Array(l.size);m=l.counts;for(a=g=0;a<l.size;a++)g+=
m[a],e[a]=g;m=k.minPercent*g/100;for(a=1;a<l.size;a++)if(e[a]>m){f[c]=l.min+(l.max-l.min)/l.size*(a-.5);break}m=(1-k.maxPercent/100)*g;for(a=l.size-2;0<=a;a--)if(e[a]<m){p[c]=l.min+(l.max-l.min)/l.size*(a+.5);break}}break;default:for(c=0;c<d;c++)f[c]=0,p[c]=255}return{minCutOff:f,maxCutOff:p}},_createLUT:function(d){var f=d.pixelBlock,p=f.pixelType;if("U8"===p||"U16"===p||"S8"===p||"S16"===p){if(k._LUTSignature&&(p=k._computeLutSignature(),p.length===k._LUTSignature.length&&!p.some(function(a,b){return a!==
k._LUTSignature[b]})))return;var p=f.pixels.length,l=[],g=[],m=[],e,c,a,h=k.max,b=k.min,t=k.gamma,u=h-b,n=k._getCutOffPoints(d);d=n.minCutOff;var n=n.maxCutOff,q=0,D=256,B;"S8"===f.pixelType?q=-127:"S16"===f.pixelType&&(q=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)D=65536;for(f=0;f<p;f++)l[f]=n[f]-d[f];if(k.useGamma&&null!==t&&t.length===p)for(f=0;f<p;f++)m[f]=1<t[f]?2<t[f]?6.5+Math.pow(t[f]-2,2.5):6.5+100*Math.pow(2-t[f],4):1;if(k.useGamma)for(var y,f=0;f<p;f++){B=[];for(e=0;e<D;e++)c=e+
q,y=(c-d[f])/l[f],a=1,1<t[f]&&(a-=Math.pow(1/u,y*m[f])),c<n[f]&&c>d[f]?B[e]=Math.floor(a*u*Math.pow(y,1/t[f]))+b:c>n[f]?B[e]=h:c<d[f]&&(B[e]=b);g[f]=B}else for(f=0;f<p;f++){B=[];for(e=0;e<D;e++)c=e+q,B[e]=c<d[f]?b:c>n[f]?h:Math.floor((c-d[f])/l[f]*u)+b;g[f]=B}k.LUT=g;k.LUTOffset=q;k._LUTSignature=k._computeLutSignature()}},_computeLutSignature:function(){var d=[],f,p;d.push(k.stretchType);d.push(k.min);d.push(k.max);d.push(k.numberOfStandardDeviations);if(k._statistics)for(f=0;f<k._statistics.length;f++)for(p=
0;p<k._statistics[f].length;p++)d.push(k._statistics[f][p]);d.push(k.dra?1:0);d.push(k.minPercent);d.push(k.maxPercent);if(k.gamma)for(f=0;f<k._statistics.length;f++)d.push(k.gamma[f]);d.push(k.useGamma?1:0);return d},_filterNoLUT:function(d){if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){var f=d.pixelBlock,p=f.pixels,l=f.mask,f=f.width*f.height,g=p.length,m=[],e=[],c,a,h,b,t,u=k.max,n=k.min,q=k.gamma,D=u-n;c=k._getCutOffPoints(d);var B=c.minCutOff,y=c.maxCutOff;for(c=0;c<g;c++)m[c]=
y[c]-B[c];if(k.useGamma&&null!==q&&q.length===g)for(c=0;c<g;c++)e[c]=1<q[c]?2<q[c]?6.5+Math.pow(q[c]-2,2.5):6.5+100*Math.pow(2-q[c],4):1;if(k.useGamma)if(void 0!==l&&null!==l)for(a=0;a<f;a++){if(l[a])for(c=0;c<g;c++)h=p[c][a],t=(h-B[c])/m[c],b=1,1<q[c]&&(b-=Math.pow(1/D,t*e[c])),h<y[c]&&h>B[c]?p[c][a]=Math.floor(b*D*Math.pow(t,1/q[c]))+n:h>y[c]?p[c][a]=u:h<B[c]&&(p[c][a]=n)}else for(a=0;a<f;a++)for(c=0;c<g;c++)h=p[c][a],t=(h-B[c])/m[c],b=1,1<q[c]&&(b-=Math.pow(1/D,t*e[c])),h<y[c]&&h>B[c]?p[c][a]=
Math.floor(b*D*Math.pow(t,1/q[c]))+n:h>y[c]?p[c][a]=u:h<B[c]&&(p[c][a]=n);else if(void 0!==l&&null!==l)for(a=0;a<f;a++){if(l[a])for(c=0;c<g;c++)h=p[c][a],h<y[c]&&h>B[c]?p[c][a]=Math.floor((h-B[c])/m[c]*D)+n:h>y[c]?p[c][a]=u:h<B[c]&&(p[c][a]=n)}else for(a=0;a<f;a++)for(c=0;c<g;c++)h=p[c][a],h<y[c]&&h>B[c]?p[c][a]=Math.floor((h-B[c])/m[c]*D)+n:h>y[c]?p[c][a]=u:h<B[c]&&(p[c][a]=n);d.pixelBlock.pixelType="U8";return d}},_computeGammaValues:function(d){var f=this._statistics.length,k,l=[],g;for(k=0;k<
f;k++)g=this._statistics[k][2],"U8"!==d&&(g=255*(g-this._statistics[k][0])/(this._statistics[k][1]-this._statistics[k][0])),l.push(this._computeGammaValue(g));return l},_computeGammaValue:function(d){if(0!==d&&!(255<d||0>d)){var f=0;0<d&&150!=d&&255>d&&(f=150>=d?45*Math.cos(.01047*d):17*Math.sin(.021*d));f=Math.log((d+f)/255);if(0!==f&&(d=Math.log(d/255)/f,!isNaN(d)))return Math.min(9.9,Math.max(.01,d))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y){q=q([h],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(a,e){e=e||{};e.mode&&e.mode!==h.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=h.MODE_STREAM,this._mode=new b(this));this.purgeOptions=new y(this,e.purgeOptions||{});this.purgeInterval=e.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=d.hitch(this,this._attemptReconnect);this._purge=d.hitch(this,this._purge);this._processServiceJson=d.hitch(this,this._processServiceJson);if(d.isObject(a)&&a.layerDefinition)this._initFeatureLayer(a,e);else{var g=this;c({url:a,content:d.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){g._processServiceJson(a,e)},function(a){g._errorHandler(a)})}},_processServiceJson:function(a,
b){var e=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,c({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(c){c=c.fields||[];var h=n.map(a.fields,function(a){return a.name.toLowerCase()});n.forEach(c,function(b){-1===n.indexOf(h,b.name.toLowerCase())&&a.fields.push(b)});b.resourceInfo=a;e._initFeatureLayer(e._url,b)},
function(a){e.onError({error:a})})):(b.resourceInfo=a,this._initFeatureLayer(this._url,b))},_initLayer:function(a,b){this.inherited(arguments);if(a){var c;if(a.layerDefinition)this.purgeOptions=new y(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var e=this._getWebsocketConnectionInfo(a),h=e.urls;h&&h.length?(this._socketUrls=h,this.socketUrl=h[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=e.token,h.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=h.length)):(this.socketUrl=void 0,e="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(e+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(e)))}if(this._params.filter)try{this._filter=
c=this._makeFilter(this._params.filter)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(a){var b=this.inherited(arguments),c=this._getRenderer();this.timeInfo&&(this._trackIdField||c&&(c.latestObservationRenderer||c.trackRenderer))&&(this._trackManager=new t(this),this._trackManager.initialize(a));this.socketUrl&&!this._connected&&this._map&&this.connect();return b},_unsetMap:function(a,
b){n.forEach(this._connects,f.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(z){}this.inherited(arguments)},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},
getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=new r,c={},e=this._filter,h,d,g=this.socketUrl,f;try{this._connected||this._connecting?b.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&(c.token=this._websocketToken);this._map&&this._map.spatialReference&&
this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(e)for(d in e)null!==e[d]&&(h="geometry"===d?JSON.stringify(e[d]):e[d],c[d]=h);g+="?"+l.objectToQuery(c);f=this._createConnection(g,a);b.resolve(f)}.bind(this)).otherwise(function(a){b.reject(a)}))}catch(J){a&&(a(J,!1),b.reject(J)),this.onConnectionError({error:J})}return b.promise},disconnect:function(a){var b=this._refreshing?"Disconnecting as part of layer refresh cycle":
"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:c,message:b});a&&a(null,!0)},setFilter:function(a){var b,c;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==a.outFields)return c=Error("Outfields property cannot be changed after layer is created"),
this.onFilterChange({filter:this.getFilter(),error:c}),!1;b=this._makeFilter(a)}catch(F){return c=Error(F),this.onFilterChange({filter:this.getFilter(),error:c}),!1}if(this.socket)a={filter:b},this.socket.send(JSON.stringify(a));else g.once(this,"connect",function(a){this.setFilter(b)});return!0},getFilter:function(){var a=this._filter,b={},c=["geometry","outFields","where"];a&&n.forEach(c,function(c){var e=a[c];e&&("geometry"===c?e=u.fromJson(e):"outFields"===c&&(e=e.split(",")),b[c]=e)});return b},
setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,c={},e=[];b=this._getField(a,!0);if(!b)return e;a=b.name;n.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0===b||c[b]||(c[b]=1,e.push(b))});e.sort(function(a,b){return a<b?-1:a>b?1:0});return e},getLatestObservations:function(){var a=[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=
this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){b.updating||b.suspended||(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},
onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,b){var c=this,e=new WebSocket(a);e.onopen=function(){c.socket=e;c._connected=!0;c._connecting=!1;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();b&&b(null,!0)};e.onclose=function(a){var b,e=!0,h=c._connected,d=null;if(c._connected||c._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=
a.reason||"Service is going away.",e=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",e=!1;else if(4404===a.code)b+="Service not found",e=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",e=!1;e&&(c._reconnectAttempts+=1,c._reconnectAttempts>c.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",e=!1,h=!0));c._connected=!1;h&&(b&&(d=Error(b)),c.onDisconnect({error:d,willReconnect:e}));e?c._attemptReconnect():c.socket=null}else c.socket||
(d=Error("Could not make connection to service"),c.onConnectionError({error:d})),c.socket=null,c._connected=!1};e.onerror=function(a){console.log("Socket error")};return e},_getKeepLatestFeatures:function(){var a=new r;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?(Date.now(),this._mode._fetchArchive(this._keepLatestUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._keepLatestQueried=!0}.bind(this))):a.resolve();
return a.promise},_getRelatedFeatures:function(){var a=new r;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?(Date.now(),this._mode._fetchArchive(this._relatedUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._relatedQueried=!0}.bind(this))):a.resolve();return a.promise},_purge:function(){var a,b=[],c;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-
this.purgeOptions.displayCount;a++)c=this.graphics[a],b.push(c);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var c={create:function(a){b._create(a)},update:function(a){b._update(a)},"delete":function(a){b._delete(a)}};if(a.type)c[a.type](a.feature);else a.hasOwnProperty("filter")?b._handleFilterMessage(a):
this._create(a)},_create:function(b){function c(b){if(!e._featureHasOID(b,h)){if(!b.geometry)return!1;b.attributes=b.attributes||{};b.attributes[h]=e._nextId++}b=b.declaredClass?b:new a(b);e._mode.drawFeature(b)}var e=this,h=e.objectIdField;b.length?b.forEach(function(a){a&&c(a)}):b&&c(b)},_delete:function(a){var b=this,c=a[b.objectIdField]||a.attributes[b.objectIdField],e=!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==c&&(e=a)});e&&this.remove(e)},_update:function(a){var b=this,
c=!1;this.graphics.forEach(function(e){e.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(c=e)});c&&(a.attributes&&c.setAttributes(a.attributes),a.geometry&&c.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var b,c=null;a=a||{};if(void 0!==a.geometry)if(c=c||{},null===a.geometry)c.geometry=null;else{b="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";
"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";c.spatialRel="esriSpatialRelIntersects";c.geometryType="esriGeometryEnvelope";c.geometry=b.toJson()}void 0!==a.where&&(c=c||{},c.where=a.where);if(void 0!==a.outFields&&(c=c||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");c.outFields=a.fields?a.fields.join(","):null}return c},_makeOutFields:function(a){var b=this,c=[],e=[],h={fields:null};if(!a||0===a.length)return h;n.forEach(a,function(a){if("*"===a)return h;var d=b._getField(a,!0);d?c.push(d.name):e.push("Field named "+a+" not found in schema.")});a=b._getOutFields();n.forEach(a,function(a){b._getField(a)&&-1===n.indexOf(c,a)&&c.push(a)});h.fields=c;h.errors=e;return h},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},c,e=[],h=[],d,g,f;a.streamUrls&&n.forEach(a.streamUrls,function(a){"ws"===a.transport&&(c=a.urls,b.token=a.token)});if(!c)return b;n.forEach(c,function(a){0===a.lastIndexOf("wss",0)?h.push(a):e.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?h:0===e.length?h:e;if(1<a.length)for(d=0;d<a.length-1;d++)g=d+Math.floor(Math.random()*(a.length-d)),f=a[g],a[g]=a[d],a[d]=f;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(a){var b=this,e=b._url.path;a="function"===typeof a?a:
null;c({url:e,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(c){c=b._getWebsocketConnectionInfo(c);b._websocketToken=c.token;a&&a()},function(a){b.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new k([5,112,176,.8]),c=new k([255,255,255]),c=new C(C.STYLE_SOLID,c,1),e;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)e=new D(D.STYLE_CIRCLE,10,c,b);else if("esriGeometryPolyline"===a)e=new C(C.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)b=new k([5,112,176,.2]),c=new k([5,112,176,.8]),c=new C(C.STYLE_SOLID,c,1),e=new v(v.STYLE_SOLID,c,b);e&&this.setRenderer(new B(e))},_makeObjectIdField:function(){var a=1,b,c,e=[];if(!this.objectIdField){b=this.fields.length;for(c=0;c<b;c++)e.push(this.fields[c].name.toLowerCase());for(;-1!==n.indexOf(e,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});p("extend-esri")&&d.setObject("layers.StreamLayer",q,e);return q})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./TrackManager".split(" "),function(q,f,n,k,d,r,p,l){q=q([l],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(d){this.inherited(arguments)},
initialize:function(d){this.inherited(arguments)},addFeatures:function(d,f){function e(a,e){var h,d,g;c[a]||(c[a]=[]);a=c[a];0<b&&(e.length>b&&e.splice(0,e.length-b),d=e.length+a.length,d>b&&(h=a.splice(0,d-b)));d=e.length;for(g=0;g<d;g+=1)a.push(e[g]);return{deletes:h,adds:e}}var c,a,h,b,g={},m={},l;if(f)return this.inherited(arguments),g;c=this.trackMap;a=this.layer;h=a._trackIdField;b=a.maximumTrackPoints||0;n.forEach(d,function(a){var b=a.attributes[h];a.visible&&(m[b]||(m[b]=[]),m[b].push(a))});
for(l in m)m.hasOwnProperty(l)&&(a=e(l,m[l]),g[l]=a);return g},removeFeatures:function(d){var g=[],e=this.layer.objectIdField,c=this.layer._trackIdField;d&&(n.forEach(d,function(a){var h,b,d,f;b=a.attributes[c];h=a.attributes[e];if(d=this.trackMap[b])for(a=0;a<d.length;a+=1)if(f=d[a],f.attributes[e]===h){this.trackMap[b].splice(a,1);-1===n.indexOf(b)&&g.push(b);break}},this),0<d.length&&this.refreshTracks(g))},drawTracks:function(d){function g(d){var g=a[d],f=g&&1<g.length,m,t,l;(l=e.trackLineMap[d])&&
!f&&(c.remove(l),delete e.trackLineMap[d],l=null);if(!f)return!1;f=[];for(m=g.length-1;0<=m;--m)(t=g[m].geometry)&&f.push([t.x,t.y]);g={};g[b]=d;1<f.length&&(l?(d=l.geometry,d.removePath(0),d.addPath(f),l.setGeometry(d)):(l=new r(new p({paths:[f],spatialReference:h}),null,g),c.add(l),e.trackLineMap[d]=l))}var e=this,c=this.container,a,h,b,f;if(c)if(a=this.trackMap,h=this.map.spatialReference,b=this.layer._trackIdField,d)n.forEach(d,function(a){g(a)});else for(f in a)a.hasOwnProperty(f)&&g(f)},refreshTracks:function(d){function g(a){var b,
h;a=e[a]||[];b=a.length;for(h=0;h<b;h++)c._repaint(a[h],null,!0)}var e=this.trackMap,c=this.layer;c._getRenderer();var a;this.drawTracks(d);if(d)n.forEach(d,function(a){g(a)});else for(a in e)e.hasOwnProperty(a)&&g(a)},getLatestObservations:function(){var d,f,e=this.trackMap,c=[];for(d in e)e.hasOwnProperty(d)&&(f=e[d],c.push(f[f.length-1]));return c},destroy:function(){this.inherited(arguments);this.trackLineMap=null}});k("extend-esri")&&f.setObject("layers._StreamTrackManager",q,d);return q})},
"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(q,f,n,k,d){q=q([n],{declaredClass:"esri.layers.PurgeOptions",constructor:function(d,f){this.parent=d;for(var l in f)this[l]=f[l]},_displayCountSetter:function(d){this.displayCount=d;this.parent.refresh()}});k("extend-esri")&&f.setObject("layers.PurgeOptions",q,d);return q})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(q,f,n,k,d,r,p){q=q([r,p],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(d,g){this._initialize(d,g);this.useMapImage=g&&g.useMapImage||!1},refresh:function(d){if(d)this.inherited(arguments);else{var g=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=g}},setRenderer:function(d,g){this.renderer=d;this.onRendererChange();g||this.refresh(!0)},exportMapImage:function(l,g){var m=d.defaults.map;l=f.mixin({size:m.width+
","+m.height},this._params,l?l.toJson(this.normalization):{},{f:"json"});delete l._ts;this._exportMapImage(this._url.path+"/exportImage",l,g)}});n("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",q,k);return q})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){q=q([l,g],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,c){this.symbolTileSize=c&&c.symbolTileSize?c.symbolTileSize:50;this._maxMag=this._minMag=null;var b=f.clone(this._params);delete b.imageServiceParameters;delete b.pixelFilter;delete b.rendererStyle;delete b.symbolTileSize;this._initialize(a,c);this.renderer||this.setVectorRendererStyle(c&&c.rendererStyle?c.rendererStyle:m.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";f.mixin(this._params,b)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(a){if(10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this.setImageFormat("LERC",!0);a=this.fullExtent&&this.fullExtent.xmin;var b=this.fullExtent&&this.fullExtent.ymax,c=f.clone(this._map.extent),e=1/this.symbolTileSize*this._map.width,e=e?Math.ceil(e):50,h=1/this.symbolTileSize*this._map.height,h=h?Math.ceil(h):Math.ceil((c.ymax-c.ymin)/(c.xmax-c.xmin)*e),g=(c.xmax-c.xmin)/e,m=(c.ymax-c.ymin)/h;c.xmin=
a+Math.floor((c.xmin-a)/g)*g;c.xmax=a+Math.ceil((c.xmax-a)/g)*g;c.ymin=b+Math.floor((c.ymin-b)/m)*m;c.ymax=b+Math.ceil((c.ymax-b)/m)*m;this._requestData(c,e,h)}},_drawPixelData:function(){this.clear();if(this.pixelData){var b=this.pixelData.pixelBlock,d=this.pixelData.extent,g=this.pixelData.locations,f=p.isDefined(b.mask)&&0<b.mask.length;if(b&&d&&g){if(this.useDefaultRenderer&&this.renderer&&(!p.isDefined(this._minMag)||!p.isDefined(this._maxMag))){var m=this._getServiceMinMaxStats();m?(this._minMag=
m.min,this._maxMag=m.max):(this._minMag=b.statistics[0].minValue,this._maxMag=b.statistics[0].maxValue);var m={type:"sizeInfo",minSize:h.px2pt(.2*this.symbolTileSize),maxSize:h.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},l=[];l.push(m);l.push({type:"colorInfo"});this.renderer.setVisualVariables(l)}for(var n=l=m=0,r,q=d.spatialReference?d.spatialReference._getInfo():null,m=0;m<b.height;m++)for(l=0;l<b.width;l++,n++)if(r=g[n],(!f||b.mask[n])&&r&&2===r.length){r=
new e(r[0],r[1],d.spatialReference);q&&(r.x=c.prototype._normalizeX(r.x,q).x);var w={Magnitude:b.pixels[0][n],Direction:b.pixels[1][n],Location:k.toJson(r.toJson())};r=new a(r,null,w);this.add(r)}}}},_getServiceMinMaxStats:function(){if(!p.isDefined(this.minValues)||!p.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],c=this.maxValues[0],e=this.minValues[1],h=this.maxValues[1];if(this.pixelFilter&&a&&c&&e&&h){var d=[];d.push([a,c]);d.push([e,
h]);e=this._createPixelData(d);this.pixelFilter(e);e&&e.pixelBlock&&e.pixelBlock.pixels&&0<e.pixelBlock.pixels.length&&(a=e.pixelBlock.pixels[0][0],c=e.pixelBlock.pixels[0][1])}return a&&c?{min:a,max:c}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:h.px2pt(.2*this.symbolTileSize),maxSize:h.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},c=[];c.push(a);a=new m({style:this.rendererStyle,visualVariables:c,flowRepresentation:this._vectorFlowRepresentation});
this.setRenderer(a)},_getField:function(a,c){if(p.isDefined(a))return c&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&this.renderer&&p.isDefined(a.FlowDirection)&&(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);
this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});d("extend-esri")&&f.setObject("layers.ArcGISImageServiceVectorLayer",q,r);return q})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(q,f){return q(f,{constructor:function(f,k){this.isTiled=!0},_initVisible:function(){},_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(f){},
isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(q,f,n,k,d,r,p,l){return q(r,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new p(this)},init:function(){},_getLayerObject:function(){var d=
new k;this._layerObjectFacory.getLayerObject().then(f.hitch(this,function(g){this.layerObject.empty&&g&&(this.layerObject=g,this._bindEventAfterLayerObjectLoaded());d.resolve(g)}));return d},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var d=this.getPopupInfo();d||!this.layerObject||this.layerObject.empty||(d=this._getDefaultPopupInfo(this.layerObject));return d},loadPopupInfo:function(){var d=new k,m=this.getPopupInfo();m?d.resolve(m):this.getLayerObject().then(f.hitch(this,
function(){m=this._getDefaultPopupInfo(this.layerObject);d.resolve(m)}));return d},getLayerType:function(){var d=new k;d.resolve("Table");return d},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return n.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new l(this.originOperLayer.popupInfo):
null}},_bindEventAfterLayerObjectLoaded:function(){var g=d.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(g)},getFilter:function(){var d;this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?(d=this.layerObject.getDefinitionExpression(),void 0===d&&(d=this.getFilterOfWebmap())):d=this.getFilterOfWebmap();return d}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),
function(q,f,n,k,d,r,p,l,g){return q(g,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(d){10.2<=this.layerObject.version?this._legendRequestServer().then(k.hitch(this,
function(e){f.empty(d);n.forEach(e.layers,function(c){n.forEach(c.legend,function(a){if("\x3call other values\x3e"!==a.label){var c=f.create("div",{"class":"legend-div"},d),b=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},c),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:e},b);f.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:a.label||" "},c)}},this)},this)}),k.hitch(this,function(){f.empty(d)})):f.empty(d)},_legendRequestServer:function(){var d=this.layerObject.url+"/legend",e={f:"json"};this.layerObject._params.bandIds&&(e.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(e.renderingRule=this.layerObject._params.renderingRule);return l({url:d,content:e,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var g=
new d,e={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),a=this.getLayerObject();r({type:c,layerObject:a}).then(k.hitch(this,function(a){var b=a.type;a=a.layerObject;e.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(e.isSupportedLayer=!0);a.capabilities&&0<=a.capabilities.indexOf("Catalog")?e.isSupportQuery=!0:e.isSupportedLayer=!1;g.resolve(e)}),function(){g.resolve(e)});return g},_getServiceDefinition:function(){var d=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(d)},
_bindEvent:function(){var d;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(d=p.after(this.layerObject,"setRenderingRule",k.hitch(this,this._onRendererChanged)),this._eventHandles.push(d))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(q,f,n,k,d){return q(d,{getSupportTableInfo:function(){var d=new n,p={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,
otherReasonCanNotSupport:!0},l=this.getLayerType(),g=this.getLayerObject();k({type:l,layerObject:g}).then(f.hitch(this,function(g){var e=g.type;g=g.layerObject;p.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(p.isSupportedLayer=!0);(e=g.getLatestObservations())&&0<e.length&&(p.otherReasonCanNotSupport=!1);d.resolve(p)}),function(){d.resolve(p)});return d}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct",
"./LayerInfoForDefault"],function(q,f,n,k){return q(k,{constructor:function(d,f){this.layerObject=d.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var d=this.originOperLayer.kml,f=d.layerInfo.originOperLayer.visibleFolders;d.layerInfo.isRootLayer()&&f?-1<f.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(d){var f=this.originOperLayer.kml.currentFolder;this._visible=d;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(f,
d)},obtainNewSubLayers:function(){var d=[],k=this.originOperLayer.kml;k.currentFolder&&f.forEach(k.layerInfo._getOperLayerByParentFolderId(k.currentFolder.id,this),function(f){f=this._layerInfoFactory.create(f);d.push(f);f.init()},this);return d},getOpacity:function(){},setOpacity:function(d){},drawLegends:function(d){n.empty(d)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),
function(q,f,n,k,d,r,p,l,g){var m=q([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,MinuteInMS:59E3,SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(e){return 0===this.indexOf(e)};String.prototype.endsWith=function(e){return this.substring(this.length-
e.length)===e};String.prototype.count=function(e){return this.split(e).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",
stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",
numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",
dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",dateOperatorMinutes:"dateOperatorMinutes",dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(e,
c){this.isHosted=l.isHostedService(e);c=c||[];this.setFieldsStoreByFieldInfos(c)},isPartsObjHasError:function(e){var c=!1;e&&(c=e.parts&&0<=e.parts.length?n.every(e.parts,f.hitch(this,function(a){return a.parts?0<a.parts.length?n.every(a.parts,f.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!c},isAskForValues:function(e){return m.isAskForValues(e)},hasVirtualDate:function(e){return m.hasVirtualDate(e)},setFieldsStoreByFieldInfos:function(e){e=n.filter(e,f.hitch(this,function(c){return 0<=
this._supportFieldTypes.indexOf(c.type)}));e=n.map(e,function(c,a){var e;switch(c.type){case "esriFieldTypeString":e="string";break;case "esriFieldTypeDate":e="date";break;default:e="number"}return{id:a,label:c.name,shortType:e,alias:c.alias,editable:c.editable,name:c.name,nullable:c.nullable,type:c.type}},this);this.fieldsStore=new p({data:{identifier:"id",label:"label",items:e}});return e.length},_validatePartsObj:function(e){return e&&"object"===typeof e},_isObject:function(e){return e&&"object"===
typeof e},_isString:function(e){return e&&"string"===typeof e},containsNonLatinCharacter:function(e){for(var c=0;c<e.length;c++)if(255<e.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(e){if(!n.every(e.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(e))return e.expr="",e.displaySQL="",e.expr;this._handleVirtualDate(e);var c="",a="";if(0===e.parts.length)a=c="1\x3d1";else if(1===e.parts.length)c=this.builtFilterString(e.parts[0]),a=e.parts[0].displaySQL;else for(var h=
"",b=0;b<e.parts.length;b++){var d=this.builtFilterString(e.parts[b]),g=e.parts[b].displaySQL;if(!r.isDefined(d))return null;c+=h+"("+d+")";a+=h+"("+g+")";h=h||" "+e.logicalOperator+" "}e.expr=c;e.displaySQL=a;return c},_handleVirtualDate:function(e){this.hasVirtualDate(e)&&n.forEach(e.parts,f.hitch(this,function(c){c.parts?n.forEach(c.parts,f.hitch(this,function(a){this._updateRealDateByVirtualDate(a)})):this._updateRealDateByVirtualDate(c)}))},_updateRealDateByVirtualDate:function(e){var c;c=[this.OPERATORS.dateOperatorIsOn,
this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,this.OPERATORS.dateOperatorIsOnOrAfter];e.valueObj.virtualDate?e.operator===this.OPERATORS.dateOperatorIsIn||e.operator===this.OPERATORS.dateOperatorIsNotIn?(c=m.getRealDateByVirtualDate(e.valueObj.virtualDate),e.value1=c[0],e.value2=c[1],e.valueObj.value1=c[0].toDateString(),e.valueObj.value2=c[1].toDateString()):-1<c.indexOf(e.operator)&&(c=m.getRealDateByVirtualDate(e.valueObj.virtualDate),
e.value=c,e.valueObj.value=c.toDateString()):(e.valueObj.virtualDate1&&(c=m.getRealDateByVirtualDate(e.valueObj.virtualDate1),e.value1=c,e.valueObj.value1=c.toDateString()),e.valueObj.virtualDate2&&(c=m.getRealDateByVirtualDate(e.valueObj.virtualDate2),e.value2=c,e.valueObj.value2=c.toDateString()))},isPartsObjReadyToBuild:function(e){return n.every(e.parts,f.hitch(this,function(c){return c.parts?n.every(c.parts,f.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(c)}))},
_isPartReadyToBuild:function(e){var c=e.fieldObj.shortType,a=e.operator,h=e.valueObj;e=h.type||"value";var b=h.value,d=h.value1,h=h.value2;if("value"===e){if("string"===c)return a===this.OPERATORS.stringOperatorIsBlank||a===this.OPERATORS.stringOperatorIsNotBlank?!0:l.isNotEmptyString(b);if("number"===c)return a===this.OPERATORS.numberOperatorIsBlank||a===this.OPERATORS.numberOperatorIsNotBlank?!0:a===this.OPERATORS.numberOperatorIsBetween||a===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(d)&&
l.isValidNumber(h):l.isValidNumber(b);if("date"===c)return a===this.OPERATORS.dateOperatorIsBlank||a===this.OPERATORS.dateOperatorIsNotBlank?!0:a===this.OPERATORS.dateOperatorIsBetween||a===this.OPERATORS.dateOperatorIsNotBetween||a===this.OPERATORS.dateOperatorIsIn||a===this.OPERATORS.dateOperatorIsNotIn?l.isNotEmptyString(d)&&l.isNotEmptyString(h):a===this.OPERATORS.dateOperatorInTheLast||a===this.OPERATORS.dateOperatorNotInTheLast?void 0!==b&&null!==b:l.isNotEmptyString(b)}else{if("field"===e)return l.isNotEmptyString(b);
if("unique"===e){if("string"===c)return l.isNotEmptyString(b);if("number"===c)return l.isValidNumber(b);if("date"===c)return l.isValidDate(b)}}return!1},builtFilterString:function(e){var c="",a="";if(e.parts)for(var h="",b=0;b<e.parts.length;b++){var d=e.parts[b],g=this.builtSingleFilterString(d);d.expr=g.whereClause;if(!r.isDefined(g.whereClause))return null;c+=h+g.whereClause;a+=h+d.displaySQL;h=" "+e.logicalOperator+" "}else c=this.builtSingleFilterString(e).whereClause,a=e.displaySQL;e.expr=c;
e.displaySQL=a;return c},_preBuiltSingleFilterString:function(e){if("string"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===this.OPERATORS.stringOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:e.fieldObj.name+" IS NOT NULL"}}if("number"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===this.OPERATORS.numberOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===
this.OPERATORS.numberOperatorIsNot)return{whereClause:e.fieldObj.name+" IS NOT NULL"}}return null},builtSingleFilterString:function(e,c){this.isHosted&&(e.caseSensitive=!1);if(r.isDefined(e.valueObj.isValid)&&!e.valueObj.isValid)return{whereClause:null};var a=this._preBuiltSingleFilterString(e);if(a)return a;var h=e.valueObj.value,b=e.valueObj.value1,d=e.valueObj.value2,g=!1;e.interactiveObj&&r.isDefined(c)&&(g=!0,r.isDefined(e.valueObj.value)&&(h="{"+c+"}"),r.isDefined(e.valueObj.value1)&&(b="{"+
c+"}"),r.isDefined(e.valueObj.value2)&&(d="{"+(c+1)+"}"));var m=a="";if("string"===e.fieldObj.shortType)switch(c="",g&&this.isHosted?c="N":h&&"field"!==e.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(h)&&(c="N"),e.operator){case this.OPERATORS.stringOperatorIs:a="field"===e.valueObj.type?e.fieldObj.name+" \x3d "+h:e.caseSensitive?e.fieldObj.name+" \x3d "+c+"'"+h.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") \x3d "+c+"'"+h.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:a=
"field"===e.valueObj.type?e.fieldObj.name+" \x3c\x3e "+h:e.caseSensitive?e.fieldObj.name+" \x3c\x3e "+c+"'"+h.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") \x3d "+c+"'"+h.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorStartsWith:a=e.caseSensitive?e.fieldObj.name+" LIKE "+c+"'"+h.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") LIKE "+c+"'"+h.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:a=e.caseSensitive?e.fieldObj.name+
" LIKE "+c+"'%"+h.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") LIKE "+c+"'%"+h.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorContains:a=e.caseSensitive?e.fieldObj.name+" LIKE "+c+"'%"+h.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") LIKE "+c+"'%"+h.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:a=e.caseSensitive?e.fieldObj.name+" NOT LIKE "+c+"'%"+h.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") NOT LIKE "+
c+"'%"+h.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorIsBlank:a=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:a=e.fieldObj.name+" IS NOT NULL"}else if("number"===e.fieldObj.shortType)switch(e.operator){case this.OPERATORS.numberOperatorIs:a=e.fieldObj.name+" \x3d "+h;break;case this.OPERATORS.numberOperatorIsNot:a=e.fieldObj.name+" \x3c\x3e "+h;break;case this.OPERATORS.numberOperatorIsAtLeast:a=e.fieldObj.name+" \x3e\x3d "+h;break;
case this.OPERATORS.numberOperatorIsLessThan:a=e.fieldObj.name+" \x3c "+h;break;case this.OPERATORS.numberOperatorIsAtMost:a=e.fieldObj.name+" \x3c\x3d "+h;break;case this.OPERATORS.numberOperatorIsGreaterThan:a=e.fieldObj.name+" \x3e "+h;break;case this.OPERATORS.numberOperatorIsBetween:a=e.fieldObj.name+" BETWEEN "+b+" AND "+d;break;case this.OPERATORS.numberOperatorIsNotBetween:a=e.fieldObj.name+" NOT BETWEEN "+b+" AND "+d;break;case this.OPERATORS.numberOperatorIsBlank:a=e.fieldObj.name+" IS NULL";
break;case this.OPERATORS.numberOperatorIsNotBlank:a=e.fieldObj.name+" IS NOT NULL"}else switch(r.isDefined(h)&&"field"!==e.valueObj.type&&"string"===typeof h&&(h=new Date(h)),"field"!==e.valueObj.type&&(h&&(h=new Date(h)),b&&(b=new Date(b)),d&&(d=new Date(d))),e.operator){case this.OPERATORS.dateOperatorIsOn:a="field"===e.valueObj.type?e.fieldObj.name+" \x3d "+h:g?e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":e.fieldObj.name+
" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(h)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(h))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:a="field"===e.valueObj.type?e.fieldObj.name+" \x3c\x3e "+h:g?e.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":e.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(h)+"' AND "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(this.addDay(h))+"'";break;case this.OPERATORS.dateOperatorIsBefore:a="field"===e.valueObj.type?e.fieldObj.name+" \x3c "+h:e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(h)+"'";break;case this.OPERATORS.dateOperatorIsAfter:a="field"===e.valueObj.type?e.fieldObj.name+" \x3e "+h:e.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(h))+"'";break;case this.OPERATORS.dateOperatorIsOnOrBefore:a="field"===e.valueObj.type?
e.fieldObj.name+" \x3c\x3d "+h:e.fieldObj.name+" \x3c\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(h))+"'";break;case this.OPERATORS.dateOperatorIsOnOrAfter:a="field"===e.valueObj.type?e.fieldObj.name+" \x3e\x3d "+h:e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(h)+"'";break;case this.OPERATORS.dateOperatorInTheLast:a=e.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";
break;case this.OPERATORS.dateOperatorNotInTheLast:a=e.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:a=g?e.fieldObj.name+" BETWEEN '"+b+"' AND '"+d+"'":e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(d))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:a=
g?e.fieldObj.name+" NOT BETWEEN '"+b+"' AND '"+d+"'":e.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(d))+"'";break;case this.OPERATORS.dateOperatorIsBlank:a=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:a=e.fieldObj.name+" IS NOT NULL"}"date"===e.fieldObj.shortType?(c=f.clone(e.valueObj),c.dateFormat=e.fieldObj.dateFormat,m=this.getDisplaySQL(e.fieldObj.name,
c,e.operator)):m=a;e.displaySQL=m;return{whereClause:a}},_dateENUM:{dateOperatorIsOn:"is on ",dateOperatorIsNotOn:"is not on ",dateOperatorIsIn:"is in ",dateOperatorIsNotIn:"is not in ",dateOperatorIsBefore:"is before ",dateOperatorIsAfter:"is after ",dateOperatorIsOnOrBefore:"is on or before ",dateOperatorIsOnOrAfter:"is on or after ",dateOperatorInTheLast:["is in the last "," days from CURRENT_TIMESTAMP"],dateOperatorNotInTheLast:["is not in the last "," days from CURRENT_TIMESTAMP"],dateOperatorIsBetween:["is between ",
" and "],dateOperatorIsNotBetween:["is not between "," and "],dateOperatorIsBlank:" is blank",dateOperatorIsNotBlank:" is not blank"},_getDisplayDates:function(e){var c={value:e.virtualDate,value1:e.virtualDate1,value2:e.virtualDate2},a=""===e.dateFormat?{}:{format:{dateFormat:e.dateFormat}};if(""===e.virtualDate||void 0===e.virtualDate)c.value=l.localizeDateByFieldInfo(new Date(e.value),a);""===e.virtualDate1&&(c.value1=l.localizeDateByFieldInfo(new Date(e.value1),a));""===e.virtualDate2&&(c.value2=
l.localizeDateByFieldInfo(new Date(e.value2),a));return c},getDisplaySQL:function(e,c,a){c=this._getDisplayDates(c);var h="",h=this._dateENUM[a],h=0<a.indexOf("Between")?h[0]+c.value1+h[1]+c.value2:0<a.indexOf("InTheLast")?h[0]+c.value+h[1]:0<a.indexOf("Blank")?this._dateENUM[a]:this._dateENUM[a]+c.value;return e+" "+h},_convertRangeToDays:function(e,c){var a=e;c===this.OPERATORS.dateOperatorYears?a=365*e:c===this.OPERATORS.dateOperatorMonths?a=30*e:c===this.OPERATORS.dateOperatorWeeks?a=7*e:c===
this.OPERATORS.dateOperatorHours?a=e/24:c===this.OPERATORS.dateOperatorMinutes&&(a=e/1440);return a=Math.round(1E6*a)/1E6},formatDate:function(e){e=new Date(e);return""+e.getUTCFullYear()+"-"+d.format(e.getUTCMonth()+1,{pattern:"00"})+"-"+d.format(e.getUTCDate(),{pattern:"00"})+" "+d.format(e.getUTCHours(),{pattern:"00"})+":"+d.format(e.getUTCMinutes(),{pattern:"00"})+":"+d.format(e.getSeconds(),{pattern:"00"})},addDay:function(e){return new Date(e.getTime()+this.dayInMS)},addMinute:function(e){return new Date(e.getTime()+
this.MinuteInMS)},addSec:function(e){return new Date(e.getTime()+this.SecInMS)},getFilterObjByExpr:function(e){if(e&&this.fieldsStore){var c=this.replaceStrings(e);e=c.defExpr;var a=this.findParts(e,"AND");1===a.parts.length&&(a=this.findParts(e,"OR"),1===a.parts.length&&(a.logicalOperator="AND"));n.forEach(a.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),c=b.indexOf("("),e=b.indexOf(")");if(-1===c&&-1===e||c<e)a.expr=
b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(a);this.reReplaceStrings(c,a,f.hitch(this,function(){a&&a.parts&&n.forEach(a.parts,f.hitch(this,function(a){a&&(a.parts?n.forEach(a.parts,f.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));
this.isPartsObjHasError(a)&&(a=null);return a}},_handleParsedValuesForSinglePart:function(e){e&&e.fieldObj&&"number"===e.fieldObj.shortType&&e.valueObj&&(e.valueObj.hasOwnProperty("value")&&(e.valueObj.value=parseFloat(e.valueObj.value)),e.valueObj.hasOwnProperty("value1")&&(e.valueObj.value1=parseFloat(e.valueObj.value1)),e.valueObj.hasOwnProperty("value2")&&(e.valueObj.value2=parseFloat(e.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(e){e&&e.valueObj&&!e.valueObj.type&&(e.valueObj.type=
"value")},replaceStrings:function(e){for(var c=e,a=function(b,c,e){var h=-1,h=b.indexOf("'",e+1);return h===e+1?(h=b.indexOf("'",h+1),a(b,c,h)):e},h=[],b=e.indexOf("'");-1<b;){var d=b,b=e.indexOf("'",b+1),g=0,b=a(e,d,b);"%"===e[d+1]&&d++;"%"===e[b-1]&&(--b,g++);var f=e.substring(d+1,b);"N"===e[d-1]&&(e=e.substring(0,d-1)+e.substring(d),--d,--b);this.isDateString(f)||-1!==f.indexOf("{")?b=e.indexOf("'",b+1+g):(h.push(f),e=e.substring(0,d+1)+"#"+(h.length-1)+"#"+e.substring(b),b=e.indexOf("'",e.lastIndexOf("#")+
2+g))}return{origDefExpr:c,defExpr:e,savedStrings:h}},reReplaceStrings:function(e,c,a){var h=e.savedStrings;if(!h.length)a&&"function"===typeof a&&a();else if(h.length){var b=function(a,b){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;var c=a.valueObj.value.indexOf("#"),e=a.valueObj.value.lastIndexOf("#");return r.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,e),
10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},b=f.hitch(this,b),d=!1;n.forEach(c.parts,function(a){if(a.parts){var c=!1;n.forEach(a.parts,function(a){c=b(a,h)||c});c&&(d=c,a.expr=this.builtFilterString(a))}else(d=b(a,h)||d)&&this.builtFilterString(a)},this);a&&"function"===typeof a&&a();d&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(e){return 19===e.length&&"-"===e.charAt(4)&&"-"===e.charAt(7)&&" "===e.charAt(10)&&":"===e.charAt(13)&&":"===e.charAt(16)?!0:
!1},findParts:function(e,c){for(var a=e.toLowerCase(),h=" "+c.toLowerCase()+" ",b=[],d=0,g=a.indexOf(h);0<g;){var f=e.substring(d,g),m=f.toLowerCase(),l=f.count("("),k=f.count(")"),p=f.count("'");l!==k||1===p%2?g=a.indexOf(h,g+1):-1<m.indexOf(" between ")&&-1===m.indexOf(" and ")?g=a.indexOf(h,g+1):(b.push({expr:f}),d=g+h.length,g=a.indexOf(h,d))}b.push({expr:e.substring(d)});for(a=b.length-1;0<=a;a--)!this.hasOperator(b[a].expr)&&0<a&&(b[a-1].expr+=" "+c+" "+b[a].expr,b.splice(a,1));return{expr:e,
parts:b,logicalOperator:c}},hasOperator:function(e){e=e.toLowerCase();return-1<e.indexOf("{")&&-1<e.indexOf("}")||-1<e.indexOf(" \x3d ")||-1<e.indexOf(" \x3c ")||-1<e.indexOf(" \x3e ")||-1<e.indexOf(" \x3c\x3e ")||-1<e.indexOf(" \x3c\x3d ")||-1<e.indexOf(" \x3e\x3d ")||-1<e.indexOf(" like ")||-1<e.indexOf(" between ")||-1<e.indexOf(" date")||-1<e.indexOf(" is null")||-1<e.indexOf(" is not null")?!0:!1},parseExpr:function(e){n.forEach(e.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},
this)},_preParseSingleExpr:function(e){var c=null;try{if(c=f.clone(e),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var a=e="",h=c.expr.match(/^UPPER\((.*)\)\s+/i);if(h&&2<=h.length)e=h[1];else return null;var b=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(b&&2<=b.length)a="'"+b[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,e+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,a);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&
(c.caseSensitive=!0)}catch(t){return console.log(t),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},_removeOperator:function(e,c,a){c=c.substring(a).trim();"date"===e&&!this.isHosted&&c.toLowerCase().startsWith("timestamp ")&&(c=c.substring(10).trim());return c},parseSingleExpr:function(e){var c=this._preParseSingleExpr(e);c&&(e=f.mixin(e,c));var c=e.expr.trim(),a=c.indexOf(" "),h=c.substring(0,a);e.fieldObj={name:h};e.valueObj={};this.getFieldItemByName({name:h},function(a){e.fieldObj.shortType=
a.shortType[0];e.fieldObj.label=a.label[0]},function(){e.error={msg:"unknown field name ("+h+")",code:1}});c=c.substring(a+1).trim();a=c.toLowerCase();a.startsWith("\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):a.startsWith("\x3c ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,
e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsBefore:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsLessThan:e.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3e ")?(c=this._removeOperator(e.fieldObj.shortType,c,2),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsAfter:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsGreaterThan:e.error={msg:"operator ("+
a+") not supported for string",code:3}):a.startsWith("\x3c\x3e ")?(c=this._removeOperator(e.fieldObj.shortType,c,3),this.storeValue(c,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):a.startsWith("\x3c\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,3),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===
e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtMost:e.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3e\x3d ")?(c=this._removeOperator(e.fieldObj.shortType,c,3),this.storeValue(c,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtLeast:e.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("like ")?(c=c.substring(5).trim(),
c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),e),e.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),e),e.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),e),e.operator=this.OPERATORS.stringOperatorStartsWith):e.error={msg:"value ("+a+") not supported for LIKE",code:3}):
a.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),e),e.operator=this.OPERATORS.stringOperatorDoesNotContain):e.error={msg:"value ("+a+") not supported for NOT LIKE",code:3}):a.startsWith("between ")?this._updatePartForBetween(c,!0,e):a.startsWith("not between ")?this._updatePartForBetween(c,!1,e):"is null"===a?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?
this.OPERATORS.dateOperatorIsBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===a?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):e.error={msg:"unknown operator ("+a+")",code:2};if(r.isDefined(e.valueObj.value)&&"string"===typeof e.valueObj.value&&e.valueObj.value.startsWith("{")&&
e.valueObj.value.endsWith("}")||r.isDefined(e.valueObj.value1)&&"string"===typeof e.valueObj.value1&&e.valueObj.value1.startsWith("{")&&e.valueObj.value1.endsWith("}"))e.isInteractive=!0},getFieldItemByName:function(e,c,a){this.fieldsStore.fetch({query:e,onComplete:f.hitch(this,function(e){e&&e.length?c(e[0]):a()})})},subtractDay:function(e){return new Date(e.getTime()-this.dayInMS)},_updatePartForBetween:function(e,c,a){var h,b,d,g,f;e=this._removeOperator(a.fieldObj.shortType,e,(c?"between ":"not between ").length);
h=e.toLowerCase().indexOf(" and ");if(-1<h)if(b=e.substring(0,h).trim(),b.startsWith("CURRENT_TIMESTAMP "))if(b=b.substring(18).trim(),b.startsWith("-")){a.operator=c?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{f=parseFloat(b.substring(1).trim()),1<=f?(d=this.OPERATORS.dateOperatorDays,g=f/365,1E-4>Math.abs(g-Math.round(g))?(f=Math.round(g),d=this.OPERATORS.dateOperatorYears):(g=f/30,1E-4>Math.abs(g-Math.round(g))?(f=Math.round(g),d=this.OPERATORS.dateOperatorMonths):
(g=f/7,1E-4>Math.abs(g-Math.round(g))&&(f=Math.round(g),d=this.OPERATORS.dateOperatorWeeks)))):(d=this.OPERATORS.dateOperatorMinutes,f*=24,1E-4>Math.abs(f-Math.round(f))?d=this.OPERATORS.dateOperatorHours:f*=60),a.valueObj.value=f,a.valueObj.range=d}catch(C){a.error={msg:"missing count for '"+(c?"":"not ")+"in the last'",code:3}}}else a.error={msg:"'"+(c?"":"not ")+"in the next' not supported",code:3};else if(e=this._removeOperator(a.fieldObj.shortType,e.substring(h),5),this.storeValue1(b,a),this.storeValue2(e,
a),"date"===a.fieldObj.shortType){if(a.operator=c?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,"object"===typeof a.valueObj.value1&&"object"===typeof a.valueObj.value2)try{1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())&&(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=c?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(C){}}else"number"===a.fieldObj.shortType||
"oid"===a.fieldObj.shortType?a.operator=c?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:a.error={msg:a.fieldObj.shortType+" field not supported for "+(c?"":"NOT ")+"BETWEEN",code:3};else a.error={msg:"missing AND operator for "+(c?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(e,c){if(e.startsWith("{")&&e.endsWith("}"))c.valueObj.value=e;else if(e.startsWith("'{")&&e.endsWith("}'"))c.valueObj.value=e.substring(1,e.length-1);else if("date"===c.fieldObj.shortType)if(e.startsWith("'")&&
e.endsWith("'")){var a=e.substring(1,e.length-1);c.valueObj.value=this.parseDate(a)}else c.valueObj.value=e,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(e.startsWith("#")||e.startsWith("%#"))&&(e.endsWith("#")||e.endsWith("#%"))?c.valueObj.value=e:e.startsWith("'")&&e.endsWith("'")?c.valueObj.value=e.substring(1,e.length-1).replace(/\'\'/g,"'"):(c.valueObj.value=e,c.valueObj.type="field",this.getFieldItemByName({name:e},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+
e+")",code:1}})):(c.valueObj.value=e,isNaN(e)&&(c.valueObj.type="field",this.getFieldItemByName({name:e},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+e+")",code:1}})))},storeValue1:function(e,c){e.startsWith("{")&&e.endsWith("}")?c.valueObj.value1=e:e.startsWith("'{")&&e.endsWith("}'")?c.valueObj.value1=e.substring(1,e.length-1):"date"===c.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),c.valueObj.value1=this.parseDate(e)):
(c.valueObj.value1=e,c.valueObj.type="field"):(c.valueObj.value1=e,isNaN(e)&&(c.valueObj.type="field"))},storeValue2:function(e,c){e.startsWith("{")&&e.endsWith("}")?c.valueObj.value2=e:e.startsWith("'{")&&e.endsWith("}'")?c.valueObj.value2=e.substring(1,e.length-1):"date"===c.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),c.valueObj.value2=this.parseDate(e)):(c.valueObj.value2=e,c.valueObj.type="field"):(c.valueObj.value2=e,isNaN(e)&&(c.valueObj.type="field"))},
parseDate:function(e){var c=k.parse(e,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=k.parse(e.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=k.parse(e.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}});m.VIRTUAL_DATE_TODAY="today";m.VIRTUAL_DATE_YESTERDAY="yesterday";m.VIRTUAL_DATE_TOMORROW="tomorrow";m.VIRTUAL_DATE_THIS_WEEK="thisWeek";m.VIRTUAL_DATE_THIS_MONTH="thisMonth";m.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";m.VIRTUAL_DATE_THIS_YEAR=
"thisYear";m.isAskForValues=function(e){var c=!1;return c=n.some(e.parts,function(a){return a.parts?n.some(a.parts,function(a){return!!a.interactiveObj}):!!a.interactiveObj})};m.hasVirtualDate=function(e){var c=!1;return c=n.some(e.parts,function(a){return a.parts?n.some(a.parts,function(a){return!!a.valueObj.virtualDate||!!a.valueObj.virtualDate1||!!a.valueObj.virtualDate2}):!!a.valueObj.virtualDate||!!a.valueObj.virtualDate1||!!a.valueObj.virtualDate2})};m.getRealDateByVirtualDate=function(e){var c=
null,a=new Date,h=a.getTime();switch(e){case m.VIRTUAL_DATE_TODAY:c=a;break;case m.VIRTUAL_DATE_YESTERDAY:c=new Date(h-864E5);break;case m.VIRTUAL_DATE_TOMORROW:c=new Date(h+864E5);break;case m.VIRTUAL_DATE_THIS_WEEK:c=[g().startOf("week").toDate(),g().endOf("week").toDate()];break;case m.VIRTUAL_DATE_THIS_MONTH:c=[g().startOf("month").toDate(),g().endOf("month").toDate()];break;case m.VIRTUAL_DATE_THIS_QUARTER:c=[g().startOf("quarter").toDate(),g().endOf("quarter").toDate()];break;case m.VIRTUAL_DATE_THIS_YEAR:c=
[g().startOf("year").toDate(),g().endOf("year").toDate()]}return c};return m})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(q,f,n,k,d,r,p){return f("dojo.data.ItemFileWriteStore",r,{constructor:function(d){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||
(this._datatypeMap.Date.serialize=function(d){return p.toISOString(d,{zulu:!0})});d&&!1===d.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(d){if(!d)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(d,g){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof d&&"undefined"!=typeof d)throw Error("newItem() was passed something other than an object");
var f=null,e=this._getIdentifierAttribute();if(e===Number)f=this._arrayOfAllItems.length;else{f=d[e];if("undefined"===typeof f)throw Error("newItem() was not passed an identity for the new item");if(q.isArray(f))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[f]);this._assert("undefined"===typeof this._pending._newItems[f]);this._assert("undefined"===typeof this._pending._deletedItems[f]);var c={};c[this._storeRefPropName]=
this;c[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[f]=c,c[e]=[f]);this._arrayOfAllItems.push(c);e=null;if(g&&g.parent&&g.attribute){var e={item:g.parent,attribute:g.attribute,oldValue:void 0},a=this.getValues(g.parent,g.attribute);if(a&&0<a.length){var h=a.slice(0,a.length);e.oldValue=1===a.length?a[0]:a.slice(0,a.length);h.push(c);this._setValueOrValues(g.parent,g.attribute,h,!1);e.newValue=this.getValues(g.parent,g.attribute)}else this._setValueOrValues(g.parent,
g.attribute,c,!1),e.newValue=c}else c[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(c);this._pending._newItems[f]=c;for(var b in d){if(b===this._storeRefPropName||b===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");g=d[b];q.isArray(g)||(g=[g]);c[b]=g;if(this.referenceIntegrity)for(f=0;f<g.length;f++)a=g[f],this.isItem(a)&&this._addReferenceToMap(a,c,b)}this.onNew(c,e);return c},_removeArrayElement:function(d,g){g=n.indexOf(d,g);return-1!=g?(d.splice(g,
1),!0):!1},deleteItem:function(d){this._assert(!this._saveInProgress);this._assertIsItem(d);var g=d[this._itemNumPropName],f=this.getIdentity(d);if(this.referenceIntegrity){var e=this.getAttributes(d);d[this._reverseRefMap]&&(d["backup_"+this._reverseRefMap]=q.clone(d[this._reverseRefMap]));n.forEach(e,function(a){n.forEach(this.getValues(d,a),function(b){this.isItem(b)&&(d["backupRefs_"+this._reverseRefMap]||(d["backupRefs_"+this._reverseRefMap]=[]),d["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(b),
attr:a}),this._removeReferenceFromMap(b,d,a))},this)},this);if(e=d[this._reverseRefMap])for(var c in e){var a=null;if(a=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c])for(var h in e[c]){var b=this.getValues(a,h)||[],t=n.filter(b,function(a){return!(this.isItem(a)&&this.getIdentity(a)==f)},this);this._removeReferenceFromMap(d,a,h);t.length<b.length&&this._setValueOrValues(a,h,t,!0)}}}this._arrayOfAllItems[g]=null;d[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[f];
this._pending._deletedItems[f]=d;d[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,d);this.onDelete(d);return!0},setValue:function(d,g,f){return this._setValueOrValues(d,g,f,!0)},setValues:function(d,g,f){return this._setValueOrValues(d,g,f,!0)},unsetAttribute:function(d,g){return this._setValueOrValues(d,g,[],!0)},_setValueOrValues:function(d,g,f,e){this._assert(!this._saveInProgress);this._assertIsItem(d);this._assert(q.isString(g));this._assert("undefined"!==typeof f);
var c=this._getIdentifierAttribute();if(g==c)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var c=this._getValueOrValues(d,g),a=this.getIdentity(d);if(!this._pending._modifiedItems[a]){var h={},b;for(b in d)h[b]=b===this._storeRefPropName||b===this._itemNumPropName||b===this._rootItemPropName?d[b]:b===this._reverseRefMap?q.clone(d[b]):d[b].slice(0,d[b].length);this._pending._modifiedItems[a]=h}a=!1;if(q.isArray(f)&&0===f.length){if(a=delete d[g],
f=void 0,this.referenceIntegrity&&c){b=c;q.isArray(b)||(b=[b]);for(var m=0;m<b.length;m++)h=b[m],this.isItem(h)&&this._removeReferenceFromMap(h,d,g)}}else{a=q.isArray(f)?f.slice(0,f.length):[f];if(this.referenceIntegrity)if(c){b=c;q.isArray(b)||(b=[b]);var l={};n.forEach(b,function(a){this.isItem(a)&&(a=this.getIdentity(a),l[a.toString()]=!0)},this);n.forEach(a,function(a){if(this.isItem(a)){var b=this.getIdentity(a);l[b.toString()]?delete l[b.toString()]:this._addReferenceToMap(a,d,g)}},this);for(m in l)this._removeReferenceFromMap(this._itemsByIdentity?
this._itemsByIdentity[m]:this._arrayOfAllItems[m],d,g)}else for(m=0;m<a.length;m++)h=a[m],this.isItem(h)&&this._addReferenceToMap(h,d,g);d[g]=a;a=!0}if(e)this.onSet(d,g,c,f);return a},_addReferenceToMap:function(d,g,f){g=this.getIdentity(g);var e=d[this._reverseRefMap];e||(e=d[this._reverseRefMap]={});(d=e[g])||(d=e[g]={});d[f]=!0},_removeReferenceFromMap:function(d,g,f){g=this.getIdentity(g);var e=d[this._reverseRefMap],c;if(e){for(c in e)c==g&&(delete e[c][f],this._isEmpty(e[c])&&delete e[c]);this._isEmpty(e)&&
delete d[this._reverseRefMap]}},_dumpReferenceMap:function(){var d;for(d=0;d<this._arrayOfAllItems.length;d++){var g=this._arrayOfAllItems[d];g&&g[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(g)+"] is referenced by: "+k.toJson(g[this._reverseRefMap]))}},_getValueOrValues:function(d,g){var f=void 0;this.hasAttribute(d,g)&&(d=this.getValues(d,g),f=1==d.length?d[0]:d);return f},_flatten:function(d){if(this.isItem(d))return{_reference:this.getIdentity(d)};if("object"===typeof d)for(var g in this._datatypeMap){var f=
this._datatypeMap[g];if(q.isObject(f)&&!q.isFunction(f)){if(d instanceof f.type){if(!f.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+g+"]");return{_type:g,_value:f.serialize(d)}}}else if(d instanceof f)return{_type:g,_value:d.toString()}}return d},_getNewFileContentString:function(){var d={},g=this._getIdentifierAttribute();g!==Number&&(d.identifier=g);this._labelAttr&&(d.label=this._labelAttr);d.items=[];for(g=0;g<this._arrayOfAllItems.length;++g){var f=this._arrayOfAllItems[g];
if(null!==f){var e={},c;for(c in f)if(c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._reverseRefMap&&c!==this._rootItemPropName){var a=this.getValues(f,c);if(1==a.length)e[c]=this._flatten(a[0]);else for(var h=[],b=0;b<a.length;++b)h.push(this._flatten(a[b])),e[c]=h}d.items.push(e)}}return k.toJson(d,!0)},_isEmpty:function(d){var g=!0;if(q.isObject(d))for(var f in d){g=!1;break}else q.isArray(d)&&0<d.length&&(g=!1);return g},save:function(f){this._assert(!this._saveInProgress);this._saveInProgress=
!0;var g=this,m=function(){g._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};g._saveInProgress=!1;f&&f.onComplete&&f.onComplete.call(f.scope||d.global)},e=function(a){g._saveInProgress=!1;f&&f.onError&&f.onError.call(f.scope||d.global,a)};if(this._saveEverything){var c=this._getNewFileContentString();this._saveEverything(m,e,c)}this._saveCustom&&this._saveCustom(m,e);this._saveEverything||this._saveCustom||m()},revert:function(){this._assert(!this._saveInProgress);for(var d in this._pending._modifiedItems){var g=
this._pending._modifiedItems[d],f=null,f=this._itemsByIdentity?this._itemsByIdentity[d]:this._arrayOfAllItems[d];g[this._storeRefPropName]=this;for(var e in f)delete f[e];q.mixin(f,g)}var c;for(d in this._pending._deletedItems)c=this._pending._deletedItems[d],c[this._storeRefPropName]=this,g=c[this._itemNumPropName],c["backup_"+this._reverseRefMap]&&(c[this._reverseRefMap]=c["backup_"+this._reverseRefMap],delete c["backup_"+this._reverseRefMap]),this._arrayOfAllItems[g]=c,this._itemsByIdentity&&(this._itemsByIdentity[d]=
c),c[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(c);for(d in this._pending._deletedItems)c=this._pending._deletedItems[d],c["backupRefs_"+this._reverseRefMap]&&(n.forEach(c["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],c,a.attr)},this),delete c["backupRefs_"+this._reverseRefMap]);for(d in this._pending._newItems)g=this._pending._newItems[d],g[this._storeRefPropName]=null,this._arrayOfAllItems[g[this._itemNumPropName]]=
null,g[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,g),this._itemsByIdentity&&delete this._itemsByIdentity[d];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(d){return d?(d=this.getIdentity(d),(new Boolean(this._pending._newItems[d]||this._pending._modifiedItems[d]||this._pending._deletedItems[d])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},
onSet:function(d,g,f,e){},onNew:function(d,g){},onDelete:function(d){},close:function(d){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(q,f,n,k,d,r,p,l,g){n=n("dojo.data.ItemFileReadStore",[r],{constructor:function(d){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=d.url;this._jsonData=d.data;this.data=null;this._datatypeMap=d.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(e){return g.fromISOString(e)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==d.urlPreventCache&&(this.urlPreventCache=d.urlPreventCache?!0:!1);void 0!==d.hierarchical&&(this.hierarchical=d.hierarchical?!0:!1);d.clearOnClose&&(this.clearOnClose=!0);"failOk"in d&&(this.failOk=d.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(d){if(!this.isItem(d))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(d){if("string"!==typeof d)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(d,e,c){d=this.getValues(d,e);return 0<d.length?d[0]:c},getValues:function(d,e){this._assertIsItem(d);this._assertIsAttribute(e);return(d[e]||[]).slice(0)},getAttributes:function(d){this._assertIsItem(d);var e=[],c;for(c in d)c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap&&
e.push(c);return e},hasAttribute:function(d,e){this._assertIsItem(d);this._assertIsAttribute(e);return e in d},containsValue:function(d,e,c){var a=void 0;"string"===typeof c&&(a=p.patternToRegExp(c,!1));return this._containsValue(d,e,c,a)},_containsValue:function(d,e,c,a){return k.some(this.getValues(d,e),function(e){if(null!==e&&!f.isObject(e)&&a){if(e.toString().match(a))return!0}else if(c===e)return!0})},isItem:function(d){return d&&d[this._storeRefPropName]===this&&this._arrayOfAllItems[d[this._itemNumPropName]]===
d?!0:!1},isItemLoaded:function(d){return this.isItem(d)},loadItem:function(d){this._assertIsItem(d.item)},getFeatures:function(){return this._features},getLabel:function(d){if(this._labelAttr&&this.isItem(d))return this.getValue(d,this._labelAttr)},getLabelAttributes:function(d){return this._labelAttr?[this._labelAttr]:null},filter:function(d,e,c){var a=[],h,b;if(d.query){var g;h=d.queryOptions?d.queryOptions.ignoreCase:!1;var f={};for(b in d.query)g=d.query[b],"string"===typeof g?f[b]=p.patternToRegExp(g,
h):g instanceof RegExp&&(f[b]=g);for(h=0;h<e.length;++h){var m=!0,l=e[h];if(null===l)m=!1;else for(b in d.query)g=d.query[b],this._containsValue(l,b,g,f[b])||(m=!1);m&&a.push(l)}}else for(h=0;h<e.length;++h)b=e[h],null!==b&&a.push(b);c(a,d)},_fetchItems:function(g,e,c){var a=this;if(this._loadFinished)this.filter(g,this._getItemsArray(g.queryOptions),e);else if(this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:g,filter:f.hitch(a,"filter"),findCallback:f.hitch(a,e)});else{this._loadInProgress=!0;var h=d.get({url:a._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});h.addCallback(function(b){try{a._getItemsFromLoadedData(b),
a._loadFinished=!0,a._loadInProgress=!1,a.filter(g,a._getItemsArray(g.queryOptions),e),a._handleQueuedFetches()}catch(u){a._loadFinished=!0,a._loadInProgress=!1,c(u,g)}});h.addErrback(function(b){a._loadInProgress=!1;c(b,g)});var b=null;g.abort&&(b=g.abort);g.abort=function(){var a=h;a&&-1===a.fired&&(a.cancel(),a=null);b&&b.call(g)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,a.filter(g,this._getItemsArray(g.queryOptions),e)}catch(t){c(t,
g)}else c(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),g)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var d=0;d<this._queuedFetches.length;d++){var e=this._queuedFetches[d],c=e.args,a=e.filter,e=e.findCallback;a?a(c,this._getItemsArray(c.queryOptions),e):this.fetchItemByIdentity(c)}this._queuedFetches=[]}},_getItemsArray:function(d){return d&&d.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(d){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(d){function e(b){return null!==
b&&"object"===typeof b&&(!f.isArray(b)||a)&&!f.isFunction(b)&&(b.constructor==Object||f.isArray(b))&&"undefined"===typeof b._reference&&"undefined"===typeof b._type&&"undefined"===typeof b._value&&h.hierarchical}function c(a){h._arrayOfAllItems.push(a);for(var b in a){var d=a[b];if(d)if(f.isArray(d))for(var g=0;g<d.length;++g){var m=d[g];e(m)&&c(m)}else e(d)&&c(d)}}var a=!1,h=this;this._labelAttr=d.label;var b,g;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=d.items;for(b=0;b<this._arrayOfTopLevelItems.length;++b)g=
this._arrayOfTopLevelItems[b],f.isArray(g)&&(a=!0),c(g),g[this._rootItemPropName]=!0;var m={},l;for(b=0;b<this._arrayOfAllItems.length;++b)for(l in g=this._arrayOfAllItems[b],g){if(l!==this._rootItemPropName){var k=g[l];null!==k?f.isArray(k)||(g[l]=[k]):g[l]=[null]}m[l]=l}for(;m[this._storeRefPropName];)this._storeRefPropName+="_";for(;m[this._itemNumPropName];)this._itemNumPropName+="_";for(;m[this._reverseRefMap];)this._reverseRefMap+="_";if(m=d.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
m,b=0;b<this._arrayOfAllItems.length;++b)if(g=this._arrayOfAllItems[b],d=g[m],d=d[0],Object.hasOwnProperty.call(this._itemsByIdentity,d)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+m+"].  Value collided: ["+d+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+m+"].  Value collided: ["+
d+"]");}else this._itemsByIdentity[d]=g;else this._features["dojo.data.api.Identity"]=Number;for(b=0;b<this._arrayOfAllItems.length;++b)g=this._arrayOfAllItems[b],g[this._storeRefPropName]=this,g[this._itemNumPropName]=b;for(b=0;b<this._arrayOfAllItems.length;++b)for(l in g=this._arrayOfAllItems[b],g)for(d=g[l],m=0;m<d.length;++m)if(k=d[m],null!==k&&"object"==typeof k){if("_type"in k&&"_value"in k){var p=k._type,n=this._datatypeMap[p];if(n)if(f.isFunction(n))d[m]=new n(k._value);else if(f.isFunction(n.deserialize))d[m]=
n.deserialize(k._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+p+"'");}if(k._reference){k=k._reference;if(f.isObject(k))for(p=0;p<this._arrayOfAllItems.length;++p){var n=this._arrayOfAllItems[p],r=!0,q;for(q in k)n[q]!=k[q]&&(r=!1);r&&(d[m]=n)}else d[m]=this._getItemByIdentity(k);
this.referenceIntegrity&&(k=d[m],this.isItem(k)&&this._addReferenceToMap(k,g,l))}else this.isItem(k)&&this.referenceIntegrity&&this._addReferenceToMap(k,g,l)}},_addReferenceToMap:function(d,e,c){},getIdentity:function(d){var e=this._features["dojo.data.api.Identity"];return e===Number?d[this._itemNumPropName]:(d=d[e])?d[0]:null},fetchItemByIdentity:function(g){var e,c;if(this._loadFinished)e=this._getItemByIdentity(g.identity),g.onItem&&(c=g.scope?g.scope:q.global,g.onItem.call(c,e));else{var a=this;
this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:g}):(this._loadInProgress=!0,c=d.get({url:a._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),c.addCallback(function(c){var b=g.scope?g.scope:q.global;try{a._getItemsFromLoadedData(c),a._loadFinished=!0,a._loadInProgress=!1,e=a._getItemByIdentity(g.identity),g.onItem&&g.onItem.call(b,e),a._handleQueuedFetches()}catch(t){a._loadInProgress=!1,g.onError&&g.onError.call(b,t)}}),c.addErrback(function(c){a._loadInProgress=!1;g.onError&&g.onError.call(g.scope?g.scope:q.global,c)})):this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),
a._jsonData=null,a._loadFinished=!0,e=a._getItemByIdentity(g.identity),g.onItem&&(c=g.scope?g.scope:q.global,g.onItem.call(c,e)))}},_getItemByIdentity:function(d){var e=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,d)&&(e=this._itemsByIdentity[d]):Object.hasOwnProperty.call(this._arrayOfAllItems,d)&&(e=this._arrayOfAllItems[d]);void 0===e&&(e=null);return e},getIdentityAttributes:function(d){d=this._features["dojo.data.api.Identity"];return d===Number?null:[d]},_forceLoad:function(){var g=
this;this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var e=d.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});e.addCallback(function(c){try{if(!0!==g._loadInProgress&&!g._loadFinished)g._getItemsFromLoadedData(c),g._loadFinished=!0;else if(g._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(a){throw console.log(a),a;}});e.addErrback(function(c){throw c;})}else this._jsonData&&(g._getItemsFromLoadedData(g._jsonData),g._jsonData=null,g._loadFinished=!0)}});f.extend(n,l);return n})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(q){var f={};q.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,k){for(var d="^",n=null,p=0;p<f.length;p++)switch(n=f.charAt(p),n){case "\\":d+=n;p++;d+=f.charAt(p);break;case "*":d+=".*";break;case "?":d+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":d+="\\";default:d+=n}d+="$";return k?new RegExp(d,"mi"):new RegExp(d,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(q,f,n){var k={};q.setObject("dojo.data.util.simpleFetch",k);k.errorHandler=function(d,k){k.onError&&k.onError.call(k.scope||f.global,d,k)};k.fetchHandler=function(d,k){var p=k.abort||null,l=!1,g=k.start?k.start:0,m=k.count&&Infinity!==k.count?g+k.count:d.length;k.abort=function(){l=!0;p&&p.call(k)};var e=k.scope||f.global;k.store||(k.store=this);k.onBegin&&k.onBegin.call(e,d.length,k);k.sort&&d.sort(n.createSortFunction(k.sort,this));if(k.onItem)for(var c=
g;c<d.length&&c<m;++c){var a=d[c];l||k.onItem.call(e,a,k)}k.onComplete&&!l&&(c=null,k.onItem||(c=d.slice(g,m)),k.onComplete.call(e,c,k))};k.fetch=function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,q.hitch(this,"fetchHandler"),q.hitch(this,"errorHandler"));return d};return k})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(q){var f={};q.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,k){var d=-1;null===f&&(f=void 0);null===k&&(k=void 0);if(f==
k)d=0;else if(f>k||null==f)d=1;return d};f.createSortFunction=function(n,k){function d(a,c,b,e){return function(d,h){d=e.getValue(d,a);h=e.getValue(h,a);return c*b(d,h)}}for(var r=[],p,l=k.comparatorMap,g=f.basicComparator,m=0;m<n.length;m++){p=n[m];var e=p.attribute;if(e){p=p.descending?-1:1;var c=g;l&&("string"!==typeof e&&"toString"in e&&(e=e.toString()),c=l[e]||g);r.push(d(e,p,c,k))}}return function(a,c){for(var b=0;b<r.length;){var e=r[b++](a,c);if(0!==e)return e}return 0}};return f})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),
function(q,f,n,k,d,r,p,l,g,m){var e=q(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(c){this.sdf=p.getInstance();this.url=c.url;this.query=c.query;this.pageSizeOption=c.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<c.pageSize?c.pageSize:1E3;this.getFeatureCount()},
getFeatureCount:function(){return this._getQueryType().then(f.hitch(this,function(c){return 1===c?this._getCountForQueryType1():2===c?this._getCountForQueryType2():this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(f.hitch(this,function(c){return 0===c?0:3===this.queryType?1:Math.ceil(c/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(f.hitch(this,function(c){if(0<c){for(var a=[],e=1;e<=c;e++)a.push(this.queryByPage(e));return k(a).then(f.hitch(this,
function(a){for(var b=[],c=0;c<a.length;c++)a[c].features&&0<a[c].features.length&&(b=b.concat(a[c].features));a=a[0];a.features=b;return a}))}return this._getEmptyFeatureSet()}))},_getEmptyFeatureSet:function(){var c=new m;c.features=[];c.geometryType=this.layerDefinition.geometryType;c.fields=[];var a=f.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?c.fields=a:c.fields=n.filter(a,f.hitch(this,function(a){return 0<=this.query.outFields.indexOf(a.name)}));return c},getCurrentPageIndex:function(){return this.nextPageIndex},
queryNextPage:function(){var c=this.nextPageIndex;this.nextPageIndex++;return this.queryByPage(c)},queryByPage:function(c){var a=null,e=this._getEmptyFeatureSet();0>=c?(a=new d,a.resolve(e)):a=this.getPageCount().then(f.hitch(this,function(a){return c>a?e:1===this.queryType?this._queryPageForType1(c):2===this.queryType?this._queryPageForType2(c):this._queryPageForType3(c)}));return a},_getQueryType:function(){var c=new d;if(0<this.queryType)c.resolve(this.queryType);else return this._getLayerDefinition().then(f.hitch(this,
function(a){return this.queryType=e.getQueryType(a)}));return c},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(f.hitch(this,function(c){this.layerDefinition=c;var a=c.maxRecordCount;0<a&&(!(0<this.pageSizeOption)||this.pageSize>c.maxRecordCount)&&(this.pageSize=a);return this.layerDefinition})));return this.layerDefinitionDef},
_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(c){return c.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(f.hitch(this,
function(c){return(c.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(c){return this._queryWithPaginationAndOrder((c-1)*this.pageSize)},_queryPageForType2:function(c){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(a){var e=(c-1)*this.pageSize;a=a.slice(e,e+this.pageSize);return this._queryByObjectIds(a)}))},_queryPageForType3:function(c){return this._doQueryForQueryType3().then(f.hitch(this,
function(a){var e=f.mixin({},a);e.features=[];var b=(c-1)*this.pageSize;e.features=(a.features||[]).slice(b,b+this.pageSize);return e}))},_tryLocaleNumber:function(c){var a=r.localizeNumber(c);if(null===a||void 0===a)a=c;return a},_tryLocaleDate:function(c){var a=r.localizeDate(c);a||(a=c.toLocaleDateString());return a},_getLayerIndexByLayerUrl:function(c){var a=c.lastIndexOf("/");c=c.slice(a+1,c.length);return parseInt(c,10)},_getServiceUrlByLayerUrl:function(c){var a=c.lastIndexOf("/");return c.slice(0,
a)},_isImageServiceLayer:function(c){return-1<c.indexOf("/ImageServer")},_isTable:function(c){return"Table"===c.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(c){var a=new l;a.where=c||this.query.where;a.geometry=this.query.geometry;a.outSpatialReference=this.map.spatialReference;a.returnGeometry=this.query.returnGeometry;a.spatialRelationship=this.query.spatialRelationship;a.outFields=this.query.outFields;return(new g(this.url)).execute(a)},_queryIds:function(){var c=
new l;c.where=this.query.where;c.geometry=this.query.geometry;c.returnGeometry=!1;c.spatialRelationship=this.query.spatialRelationship;c.outSpatialReference=this.query.outSpatialReference;return(new g(this.url)).executeForIds(c).then(f.hitch(this,function(a){a||(a=[]);return a}))},_queryByObjectIds:function(c){var a=new d,e=new l;e.returnGeometry=this.query.returnGeometry;e.outSpatialReference=this.query.outSpatialReference;e.spatialRelationship=this.query.spatialRelationship;e.outFields=this.query.outFields;
e.objectIds=c;(new g(this.url)).execute(e).then(f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(b){if(400===b.code){var e=this._getObjectIdField(),d="",h=c.length;n.forEach(c,f.hitch(this,function(a,b){d+=e+" \x3d "+a;b!==h-1&&(d+=" OR ")}));this._query(d).then(f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(b){a.reject(b)}))}else a.reject(b)}));return a},_queryCount:function(){var c=new l;c.where=this.query.where;c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;
c.spatialRelationship=this.query.spatialRelationship;c.returnGeometry=!1;return(new g(this.url)).executeForCount(c)},_queryWithPaginationAndOrder:function(c){var a=new l;a.where=this.query.where;a.geometry=this.query.geometry;a.outSpatialReference=this.query.outSpatialReference;a.returnGeometry=this.query.returnGeometry;a.spatialRelationship=this.query.spatialRelationship;a.outFields=this.query.outFields;a.start=c;a.num=this.pageSize;(c=this.query.orderByFields)&&0<c.length&&(a.orderByFields=c,c=
n.map(c,f.hitch(this,function(a){return a.split(" ")[0]})),n.forEach(c,f.hitch(this,function(c){0>a.outFields.indexOf(c)&&a.outFields.push(c)})));return(new g(this.url)).execute(a)}});e._isServiceSupportsOrderBy=function(c){var a=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsOrderBy&&(a=!0);return a};e._isServiceSupportsPagination=function(c){var a=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsPagination&&(a=!0);return a};e._isSupportObjectIds=function(c){var a=
0;c.currentVersion&&(a=parseFloat(c.currentVersion));return 10<=a||c.hasOwnProperty("typeIdField")};e.getQueryType=function(c){var a=-1;return a=e._isServiceSupportsOrderBy(c)&&e._isServiceSupportsPagination(c)?1:e._isSupportObjectIds(c)?2:3};return e})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(q,f){function n(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(f){return f},compatible:!0},{version:"1.1",
description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(f){f.widgetOnScreen&&f.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===f.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return f},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(f){var d=0;if(f.widgetOnScreen&&f.widgetOnScreen.widgets){for(var k=
!1,d=0;d<f.widgetOnScreen.widgets.length;d++)"widgets/Splash/Widget"===f.widgetOnScreen.widgets[d].uri&&(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});k=!1;for(d=0;d<f.widgetOnScreen.widgets.length;d++)"widgets/TimeSlider/Widget"===f.widgetOnScreen.widgets[d].uri&&(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});k=!1;for(d=0;d<f.widgetOnScreen.widgets.length;d++)"widgets/Swipe/Widget"===
f.widgetOnScreen.widgets[d].uri&&(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return f},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(k){(function(d){f.visitElement(d,function(d){d.positionRelativeTo&&(d.position?d.position.relativeTo=d.positionRelativeTo:d.position={relativeTo:d.positionRelativeTo},d.panel&&(d.panel.position?d.panel.position.relativeTo=d.panel.positionRelativeTo:
d.panel.position={relativeTo:d.panel.positionRelativeTo}))});var k=d.widgetOnScreen;k&&k.panel&&k.panel.positionRelativeTo&&(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo});(k=d.widgetPool)&&k.panel&&k.panel.positionRelativeTo&&(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo})})(k);k.widgetOnScreen&&k.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===
k.widgetOnScreen.panel.uri&&(k.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(d){if(d.widgetOnScreen&&d.widgetOnScreen.widgets&&d.theme&&"FoldableTheme"===d.theme.name){var f=null,k=null;if(f=d.widgetOnScreen.widgets[4])void 0!==f.position.top?(f={position:{left:205,top:45}},k={position:{left:255,top:45}}):(f={position:{left:205,bottom:55}},k={position:{left:255,bottom:55}}),d.widgetOnScreen.widgets.splice(7,0,f,k)}})(k);(function(){for(var d=0,f=0,p=!1,d=0;d<k.widgetOnScreen.widgets.length;d++)if("widgets/Geocoder/Widget"===
k.widgetOnScreen.widgets[d].uri){p=!0;break}for(var l=!1,f=0;f<k.widgetOnScreen.widgets.length;f++)if("widgets/Search/Widget"===k.widgetOnScreen.widgets[f].uri){l=!0;break}!l&&p&&(d=k.widgetOnScreen.widgets[d],d.uri="widgets/Search/Widget",d.name="Search")})(k);(function(d){for(var f=0,f=d.widgetOnScreen.widgets.length-1;0<=f;f--){var k=d.widgetOnScreen.widgets[f];if("widgets/Swipe/Widget"===k.uri&&!k.closeable&&(d.widgetOnScreen.widgets.splice(f,1),!1!==k.visible)){k.closeable=!0;var l;a:{for(l=
l=0;l<d.widgetOnScreen.widgets.length;l++)if(!d.widgetOnScreen.widgets[l].uri)break a;l=-1}0<=l&&(k.position=d.widgetOnScreen.widgets[l].position,d.widgetOnScreen.widgets[l]=k)}"widgets/TimeSlider/Widget"===k.uri&&(!1===k.visible?d.widgetOnScreen.widgets.splice(f,1):k.closeable=!0)}})(k);k.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});k.loadingPage||(k.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,
uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return k},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(f){if(f.theme){var d=f.theme.name;if(("FoldableTheme"===d||"JewelryBoxTheme"===d)&&f.widgetOnScreen){var k=f.widgetOnScreen.widgets;if(k&&0<k.length)for(var d="themes/"+d+"/widgets/HeaderController/Widget",p=null,l=0;l<k.length;l++)(p=k[l])&&p.uri===d&&p.position&&310===p.position.paddingRight&&(p.position.paddingRight=
275)}}return f},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){f.keepAppState=!0;return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},{version:"2.2",
description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(f){function d(f,g){if(!f||!g)return!1;for(var m in g)if(g.hasOwnProperty(m))if("object"===typeof g[m]){if(!d(f[m],g[m]))return!1}else if(f[m]!==g[m])return!1;return!0}function k(f){function g(){var c=d(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),a=d(f[12],{position:{top:10,right:195}});return c&&a}function m(){var c=
d(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),a=d(f[12],{position:{left:15,top:233}});return c&&a}function e(){var c=d(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),a=d(f[12],{position:{right:15,top:195}});return c&&a}(function(){var c=d(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),a=d(f[12],{position:{left:240,top:53}});return c&&a})()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):
g()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):m()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):e()&&f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function p(f){function g(){var e=d(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=d(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),a=d(f[4],{position:{left:7,
bottom:70}});return e&&c&&a}function m(){var e=d(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=d(f[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),a=d(f[4],{position:{left:7,bottom:70}});return e&&c&&a}(function(){var e=d(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=d(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),a=d(f[4],{position:{left:55,top:45}});return e&&c&&a}()||g()||m())&&f.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:148,left:7},version:"2.3"})}(function(f,g,m){f=f.theme&&f.theme.name;if("FoldableTheme"===f)if(d(g[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(d(g[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),m&&m.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{right:12,top:211},version:"2.3"});else{if(d(g[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(f=0;f<g.length;f++){var e=g[f];d(e,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(e.position.left=288);d(e,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(e.position.left=463)}m&&m.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===f)k(g);else if("BoxTheme"===f)g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===f)p(g);else if("LaunchpadTheme"===f){if(d(g[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||d(g[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),
m&&m.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===f?(d(g[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),d(g[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===f&&d(g[11],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(f,f.widgetOnScreen.widgets,f.mobileLayout&&f.mobileLayout.widgetOnScreen&&f.mobileLayout.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(f){return f},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(f){function d(f,k){if(!f||!k)return!1;for(var l in k)if(k.hasOwnProperty(l))if("object"===
typeof k[l]){if(!d(f[l],k[l]))return!1}else if(f[l]!==k[l])return!1;return!0}(function(f,k){f=f.theme&&f.theme.name;if("BillboardTheme"===f){f=d(k[8],{position:{left:60,top:53}});var l=d(k[8],{position:{left:15,top:53}});f||l?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===f){a:{f=0;for(l=k.length;f<l;f++){var g=k[f];if(g&&g.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===
g.uri){f=g;break a}}f=null}d(f,{position:{right:0,bottom:0}})?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===f?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===f?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===f?k.push({uri:"widgets/FullScreen/Widget",
visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===f?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===f?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===f?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===f&&(d(k[7],{position:{left:45,top:45}})?k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,
top:8},version:"2.5"}):k.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(f,f.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(f){return f},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(f){return f},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(f){function d(d){var f=[];if("object"===typeof d)for(var l in d){var g=
d[l];"FeatureStatistics"===g.type&&f.push(g)}return f}(function(f){(f=f.dataSource&&f.dataSource.dataSources)&&(f=d(f))&&f.length&&f.forEach(function(d){(d=d.dataSchema&&d.dataSchema.statistics)&&d.length&&d.forEach(function(d){if(d&&"count"===d.statisticType&&"count"===d.outStatisticFieldName)d.outStatisticFieldName="STAT_COUNT";else{var g;g=(g=d.outStatisticFieldName)&&g.toUpperCase();d.outStatisticFieldName=g}})})})(f);return f},compatible:!0}];this.isCompatible=function(f,d){f=this.getVersionIndex(f);
d=this.getVersionIndex(d);for(f+=1;f<=d;f++)if(!1===this.versions[f].compatible)return!1;return!0}}n.prototype=new q;return n.prototype.constructor=n})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(q,f,n){f=this.getVersionIndex(f);n=this.getVersionIndex(n);if(f>n)throw Error("New version should higher than old version.");for(f+=1;f<=n;f++)this.versions[f].upgrader&&(q=this.versions[f].upgrader(q));return q};this.getVersionIndex=
function(q){q=this.fixVersion(q);var f,n;for(n=0;n<this.versions.length;n++)this.versions[n].version===q&&(f=n);null===q&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(q){return q?q:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B){var y=null,z;z=q(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=e.getInstance();f.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(b){var c=this.checkConfig(b);if(c)throw Error(c);this.rawAppConfig=f.clone(b);u.getInstance().setRawAppConfig(this.rawAppConfig);
b=this._upgradeAppConfig(b);this._processAfterTryLoad(b);this.appConfig=b;if(this.urlParams.id)return this.loadWidgetsManifest(b).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(f.hitch(this,function(a){return this.updateNecessaryAttrOfResourceUrlInAppConfig(a,this.urlParams.id)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(b);this._readAndSetSharedTheme(b);return this.getAppConfig()}));a.setPortalUrl(b.portalUrl);B.arcgisUrl=t.getBaseItemUrl(b.portalUrl);
return this._proesssWebTierAndSignin(b).then(f.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(b).then(f.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(b){b.appData.appConfig&&
(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))})):this._processNotInPortalAppProtocol(b)})).then(f.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?h.getDefaultWebScene(a.portalUrl):h.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(f.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(f.hitch(this,function(a){return a._appData?a._appData.values&&
a._appData.values.webmap?h.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(f.hitch(this,function(b){return m.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):m.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(f.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?
this.updateNecessaryAttrOfResourceUrlInAppConfig(a,a.appItemId):a})).then(f.hitch(this,function(a){this.appConfig=a;this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),f.hitch(this,function(a){this.showError(a);var b=new p;b.reject(a);return b}))},processResourceInAppConfigForConfigLoader:function(a,c){var e=a.portalUrl,d=a.appItemId,g=c.appid,m=new p,t=f.clone(a);this.updateNecessaryAttrOfResourceUrlInAppConfig(t,g).then(function(){if("config"===
c.mode){var f=this.getResourceUrlsOfAppConfig(a).result;0!==f.length?h.getItemResources(e,g).then(function(a){if(0===a.length)return f=f.map(function(a){return{resUrl:a}}),b.AddResourcesToItemForAppSave(e,f,d,g).then(function(){m.resolve(t)},function(a){console.warn("Add resource to template based app error:"+a.message||a);m.resolve(t)});m.resolve(t)},function(a){console.warn("Get resource of template based item error:"+a.message||a);m.resolve(t)}):m.resolve(t)}else m.resolve(t)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+
a.message||a);m.resolve(t)});return m},getResourceUrlsOfAppConfig:function(a){var b={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)},func:f.hitch(this,function(a){return a.value})};return m.processItemResourceOfAppConfig(a,b)},updateNecessaryAttrOfResourceUrlInAppConfig:function(a,b){function c(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)}function e(a,b){a=g.processItemIDAndTokenOfResources(b.value,
a);a=g.setResouceProtocolForHttps(a);var c=b.obj,e=b.key;"number"===typeof b.i?c[e][b.i]=a:c[e]=a;return!0}var d=a.portalUrl,g=this;return h.getPortal(d).getItemById(b).then(f.hitch(this,function(h){h={test:c,func:f.hitch(this,e,{appId:b,isPublic:"public"===h.access,portalUrl:d})};return m.processItemResourceOfAppConfig(a,h).appConfig}))},setResouceProtocolForHttps:function(a){var b=a;"https:"===window.location.protocol&&(b=a.replace(/^http(s?):\/\//i,"https://"));return b},processItemIDAndTokenOfResources:function(b,
c){0<b.indexOf("${itemId}")&&(b=b.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(b)&&(b=b.replace(/(\?|\&)token=.+/,""));c.isPublic||(c=a.getPortalCredential(c.portalUrl))&&(b+="?token\x3d"+c.token);return b},_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=m.stripHTML(a.title))},getAppConfig:function(){var a=f.clone(this.appConfig);a.getConfigElementById=function(a){return m.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return m.getConfigElementsByName(this,
a)};a.visitElement=function(a){m.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(b,c){b&&b.authorizedCrossOriginDomains&&a.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&a.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(a){C.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;
C.defaults.io.proxyUrl="";C.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(C.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&n.forEach(a.httpProxy.rules,function(a){D.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._fixRepeatedId(a)},showError:function(a){a&&a.message&&k.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(a.message)},document.body)},
_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,g(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(b){a.setPortalUrl(b.portalUrl);b.portalUrl&&(window.portalUrl=b.portalUrl);return this.urlParams.token?a.registerToken(this.urlParams.token).then(function(){return b}):b}));if(this.urlParams.id){window.appInfo.isRunInPortal=
!0;var b=t.getPortalUrlFromLocation(),c=new p;a.setPortalUrl(b);window.portalUrl=b;B.arcgisUrl=t.getBaseItemUrl(b);var e;this.urlParams.token?e=a.registerToken(this.urlParams.token):(e=new p,e.resolve());e.then(f.hitch(this,function(){h.getPortal(b).loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;a.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(b).then(f.hitch(this,
function(){this._getAppConfigFromAppId(b,this.urlParams.id).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){c.resolve(a)},function(a){c.reject(a)})}))}))}),f.hitch(this,function(a){this.showError(a)}));return c}this.configFile="config.json";return g(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(b){a.setPortalUrl(b.portalUrl);b.portalUrl&&(window.portalUrl=b.portalUrl);return this.urlParams.token?
a.registerToken(this.urlParams.token).then(function(){return b}):b}))},_upgradeAppConfig:function(a){var b=window.wabVersion,c=a.wabVersion;a.configWabVersion=a.wabVersion;if(b===c)return a;var e=this.versionManager.getVersionIndex(c),d=this.versionManager.getVersionIndex(b);if(e>d)throw Error("Bad version number, "+c);a=this.versionManager.upgrade(a,c,b);a.wabVersion=b;return a},loadAndUpgradeAllWidgetsConfig:function(a){var b=new p,e=[];c.visitElement(a,f.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),
e.push(a))}));l(e).then(f.hitch(this,function(){b.resolve(a)}),function(a){b.reject(a)});return b},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);v.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?
this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var b=t.getPortalUrlFromLocation(),
b=t.getStandardPortalUrl(b);t.isOnline(b)&&(b=t.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&t.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=t.getPortalProxyUrl(b)))}},_processWidgetJsons:function(a){c.visitElement(a,function(a,b){b.isWidget&&a.uri&&m.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(a){var b=0;c.visitElement(a,function(a,c){c.isWidget&&!a.uri&&(b++,a.placeholderIndex=b)})},
_processEmptyGroups:function(a){var b=0;a.widgetOnScreen.groups&&n.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)b++,a.placeholderIndex=b})},_addElementId:function(a){var b=0,e;c.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var c=a.id.lastIndexOf("_");-1<c&&(e=a.id.substr(c+1),b=Math.max(b,e))}});c.visitElement(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_setPortalUrl:function(a){if(a.portalUrl){var b=
t.getPortalUrlFromLocation(),c=t.isOnline(b);t.isSamePortalUrl(a.portalUrl,b)||c||(window.appInfo.isRunInPortal=!1)}else window.isXT&&r("wab_portalurl")?a.portalUrl=r("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=t.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=t.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=t.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=t.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&
n.forEach(a.httpProxy.rules,f.hitch(this,function(a){a.proxyUrl=t.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new p,c=h.getPortal(a.portalUrl),e=f.hitch(this,function(c){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(c){console.log("redirect from http to https");window.location.href=t.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});c.loadSelfInfo().then(f.hitch(this,
function(b){this.portalSelf=b;"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),e(b)):e(b.allSSL)}),f.hitch(this,function(a){b.reject(a)}));return b},_processNotInPortalAppProtocol:function(b){var c=new p;b.portalUrl?h.getPortal(b.portalUrl).loadSelfInfo().then(f.hitch(this,function(e){this.portalSelf=e;var d="https:"===window.location.protocol;(e.allSSL||d)&&this._changePortalUrlProtocol(b,"https");0!==b.portalUrl.toLowerCase().indexOf("https://")||d||a.isInConfigOrPreviewWindow()?
c.resolve(b):(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),c.reject())}),f.hitch(this,function(a){c.reject(a)})):c.resolve(b);return c},_proesssWebTierAndSignin:function(a){var b=new p,c=!1,e=a.portalUrl;this._processWebTier(a).then(f.hitch(this,function(a){c=a;return h.getPortal(e).loadSelfInfo()})).then(f.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(e,c)})).then(f.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});
return b},_processWebTier:function(b){var c=new p,e=b.portalUrl;b.isWebTier?(a.addAuthorizedCrossOriginDomains([e]),a.isWebTierPortal(e).then(f.hitch(this,function(){var d=a.getPortalCredential(e);d&&d.ssl&&"http:"===window.location.protocol&&!a.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href)):c.resolve(b.isWebTier)}),f.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(b,c){var e=
new p,d=h.getPortal(b),g=t.getSharingUrl(b);window.appInfo.isRunInPortal?(c=v.checkSignInStatus(g),c.promise.always(f.hitch(this,function(){e.resolve()}))):(!a.isInBuilderWindow()&&!a.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!c&&a.registerOAuthInfo(b,this.rawAppConfig.appId),c=v.checkSignInStatus(g),c.promise.always(f.hitch(this,function(){a.xtGetCredentialFromCookie(b);d.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;
this._checkLocale();e.resolve()}))})));return e},_checkLocale:function(){if(!a.isInConfigOrPreviewWindow()){var b=this.portalSelf.user&&this.portalSelf.user.culture||d.locale,b=b.toLowerCase();!this.urlParams.locale&&m.isLocaleChanged(d.locale,b)&&(r("wab_app_locale",b),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,b){var c=h.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,b).then(f.hitch(this,function(b){var e=b.appId,d=b.appData;return l([this._getAppConfigFromAppId(a,
e),c.getItemData(d.source)]).then(f.hitch(this,function(a){var b;d.appConfig?(b=d.appConfig,delete d.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=d;b._wabAppId=e;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var c=h.getPortal(a);return c.getItemData(b).then(function(a){return c.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var c=new p,
e=h.getPortal(a);e.getItemData(b).then(f.hitch(this,function(a){e.getItemById(a.source).then(f.hitch(this,function(b){b=D.urlToObject(b.url);c.resolve({appId:b.query.id,appData:a})}))}),function(a){c.reject(a)});return c},_getAppConfigFromAppId:function(a,b){return h.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(a){function b(b,c,d){function g(c){return b.loadWidgetManifest(c).then(function(a){return a},function(b){console.log("Widget failed to load, it is removed.",
c.name);b.stack?console.error(b.stack):console.log(b);e(a,c)})}return c.itemId?h.getPortal(d).getItemById(c.itemId).then(function(a){c.uri=m.widgetJson.getUriFromItem(a);return g(c)},function(b){console.log("Widget is not loaded, it is removed.",c.name,b);e(a,c)}):g(c)}function e(a,b){function c(c){a[c]&&a[c].widgets&&(a[c].widgets=a[c].widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));
a[c]&&a[c].groups&&a[c].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}c("widgetOnScreen");c("widgetPool")}var d=[],g=new p;this.urlParams.manifest&&a._buildInfo&&a._buildInfo.widgetManifestsMerged&&delete a._buildInfo.widgetManifestsMerged;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,
function(e){c.visitElement(a,f.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||(c.uri&&e[c.uri]?(this._addNeedValuesForManifest(e[c.uri],c.uri),m.widgetJson.addManifest2WidgetJson(c,e[c.uri])):d.push(b(this.widgetManager,c,a.portalUrl)))}));l(d).then(function(){g.resolve(a)})})):(c.visitElement(a,f.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||d.push(b(this.widgetManager,c,a.portalUrl))})),l(d).then(function(){g.resolve(a)}));setTimeout(function(){g.isResolved()||(e(a),g.resolve(a))},
6E4);return g},_addNeedValuesForManifest:function(a,b){f.mixin(a,m.getUriInfo(b));m.manifest.addManifestProperies(a);m.manifest.processManifestLabel(a,d.locale)},_loadMergedWidgetManifests:function(){return g(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(a){var b=[];c.visitElement(a,function(a){0<=b.indexOf(a.id)&&(a.id+="_");b.push(a.id)})},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&
m.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});z.getInstance=function(a,b){null===y?y=new z(a,b):(y.urlParams=a,y.options=b);return y};return z})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all",
"jimu/portalUtils","jimu/utils"],function(q,f,n,k){return{AddResourcesToItemForAppSave:function(d,r,p,l){r=r||[];if(0===r.length){var g=new q;g.resolve(r);return g}r=r.map(function(d){var e=d.resUrl.split("resources/")[1],c=new q;d.b64?(d=k.b64toBlob(d.b64),c.resolve({blob:d,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(d=d.resUrl,0<d.indexOf("${itemId}")&&(d=d.replace("${itemId}",p)),k.resourcesUrlToBlob(d).then(function(a){c.resolve({blob:a,fileName:e.split("/")[1],prefixName:e.split("/")[0]},
function(a){console.error(a.message||a);c.reject(a)})}));return c});return f(r).then(function(g){if(g instanceof Array&&0<g.length)return g=g.map(function(e){var c=p;l&&(c=l);return n.addResource(d,c,e.blob,e.fileName,e.prefixName)}.bind(this)),f(g).then(function(e){return e})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(q,
f,n,k,d,r,p,l,g){var m=null,e=q(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(c){this.rawAppConfig=c},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var c=k.stringify(this.rawAppConfig.map);this.mapMd5=l(c)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var c=new n,a={};if(g.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return c.resolve(a),c;var e=this._getAppStateKey(),b=p.get(e);b&&b.appStateMd5===this._getAppStateMd5()?(e=b.map&&b.map.extent,b=b.map&&b.map.layers,e&&(a.extent=new d(e.xmin,e.ymin,e.xmax,e.ymax,new r(e.spatialReference))),b&&(a.layers=b)):p.remove(e);c.resolve(a);return c},saveWabAppState:function(c,a){if(c&&!g.isInConfigOrPreviewWindow()){var e=this._getAppStateKey(),b={extent:{xmin:c.extent.xmin,xmax:c.extent.xmax,ymin:c.extent.ymin,ymax:c.extent.ymax,
spatialReference:{wkid:c.extent.spatialReference.wkid,wkt:c.extent.spatialReference.wkt}},layers:{}};a&&a.traversal&&a.traversal(f.hitch(this,function(a){b.layers[a.id]={visible:a.isVisible()}}));p.set(e,{map:b,appStateMd5:this._getAppStateMd5()})}}});e.getInstance=function(c){null===m&&(m=new e);m.urlParams=c;return m};return e})},"jimu/dijit/AGOLLoading":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AGOLLoading.html","dojo/_base/html"],
function(q,f,n,k,d){return q([f,n],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:k,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||d.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){var h=null,b;b=q([k],{constructor:function(b,c){this.own(d.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)));this.own(d.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this.own(d.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)));this.own(d.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));this.own(d.subscribe("beforeMapDestory",f.hitch(this,this._onBeforeMapDestory)));this.own(d.subscribe("preloadModulesLoaded",
f.hitch(this,this._onPreloadModulesLoaded)));this.own(d.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.own(d.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered)));a.isMobileUa()||this.own(r(window,"resize",m(f.hitch(this,this.resize),200)));this.id=c;this.preloadModulesLoadDef=new l},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=f.clone(a);this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(f.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(f.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var b=new l;e([a],f.hitch(this,function(a){a=a.getInstance();this.map&&a.setMap(this.map);b.resolve(a)}));return b},_loadMap:function(a){this.mapManager=c.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},a);this.mapManager.showMap()},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var b=
new l;e(["themes/"+a.name+"/main"],f.hitch(this,function(){g([this._loadThemeCommonStyle(a),this._loadThemeCurrentStyle(a)]).then(f.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();b.resolve()}))}));return b},_loadThemeCommonStyle:function(b){n.addClass(this.domNode,b.name);return a.loadStyleLink(this._getThemeCommonStyleId(b),"themes/"+b.name+"/common.css")},_loadThemeCurrentStyle:function(b){n.addClass(this.domNode,b.styles[0]);return a.loadStyleLink(this._getThemeCurrentStyleId(b),
"themes/"+b.name+"/styles/"+b.styles[0]+"/style.css")},_addCustomStyle:function(a){var b=f.getObject("customStyles",!1,a);if(b){var c=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(c+=a);c=f.replace(c,b,/\$\{([^\}]+)\}/g);b=n.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(c))}catch(C){b.styleSheet.cssText=c}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(b){var c=
".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(b.customStyles.mainBackgroundColor&&a.isLightColor(b.customStyles.mainBackgroundColor))var d=e.toUrl("jimu")+"/css/images/api_popup_light.png",c=c+(".esriPopup .titleButton {background: url("+d+") no-repeat}")+".esriPopup .titlePane {color: black}";"PlateauTheme"===b.name?c+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===b.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":"BoxTheme"===b.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}":
"TabTheme"===b.name?c+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===b.name?c+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===b.name&&(c+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return c},_onAppConfigChanged:function(a,b,c){a=f.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);
break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,c);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,c);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,c);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,c);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,c)}this.appConfig=a},_onMapChanged:function(a){this.map=
a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();g([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(f.hitch(this,function(b){var c=b[0];this.layoutManager.name!==c.name?
(this.layoutManager.onLeave(),c.onEnter(a,this.mapId).then(f.hitch(this,function(){this.layoutManager=c;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var b=this.appConfig;d.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._loadLayoutManager(a).then(f.hitch(this,function(a){this.layoutManager=a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();
this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){"backgroundColor"in b?n.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in b?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(n.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),n.setStyle(jimuConfig.loadingImageId,"width",a.width+"px"),n.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(n.setStyle(jimuConfig.loadingImageId,"background-image",
"url('')"),n.setStyle(jimuConfig.loadingImageId,"width","0px"),n.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(n.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),n.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),n.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):(n.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),n.setStyle(jimuConfig.loadingGifId,"width","0px"),n.setStyle(jimuConfig.loadingGifId,
"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},
_onLayoutDefinitionChange:function(a,b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_onOnScreenOrderChange:function(a,b){this.layoutManager.onOnScreenOrderChange(a,b)},_removeThemeCommonStyle:function(a){n.removeClass(this.domNode,a.name);n.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){n.removeClass(this.domNode,a.styles[0]);n.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){p('style[source\x3d"custom"]',
document.head).forEach(function(a){n.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){e(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});b.getInstance=function(a,c){null===h&&(h=new b(a,c),window._layoutManager=h);return h};return b})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E){var G=null,H=q(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=A.getInstance(this.urlParams);this.popupManager=F.getInstance(this);this.filterManager=E.getInstance();this.nls=window.jimuNls;r.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));r.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));r.subscribe("mapContentModified",f.hitch(this,this.onMapContentModified));p(window,"resize",f.hitch(this,this.onWindowResize));p(window,"beforeunload",f.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(b){b&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),d("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){k.destroy(a)}),
d("div.esriMobileNavigationBar").forEach(function(a){k.destroy(a)})),this._mapMobileInfoWindow=new a(null,k.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);D.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!D.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(a){this.map&&
(a=new u(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){n.forEach(a.map.basemaps,function(a,c){a.isOperationalLayer=!1;b(a,c)},this);n.forEach(a.map.operationallayers,function(a,c){a.isOperationalLayer=!0;b(a,c)},this)},_show3DLayersMap:function(a){C(["esri3d/Map"],f.hitch(this,function(b){var c;c=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,f.hitch(this,function(a){this.createLayer(c,"3D",a)}));c.usePlugin=b.usePlugin;this._publishMapEvent(c)}))},
_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(f.hitch(this,function(b){C(["esri3d/Map"],f.hitch(this,function(c){var e=new c(this.mapDivId,a.map.mapOptions);n.forEach(b.itemData.operationalLayers,function(a){this.createLayer(e,"3D",a)},this);n.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(e,"3D",a)},this);n.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(e,"3D",a)},this);e.toc=b.itemData.toc;e.bookmarks=
b.itemData.bookmarks;e.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;w.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),r.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=a,this.resetInfoWindow(!0),r.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(a){return b({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},
_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var b=this._processMapOptions(a.map.mapOptions)||{};b.isZoomSlider=!1;var c=a.map.portalUrl,e=a.map.itemId,b={mapOptions:b,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var d=[];n.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&d.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<d.length&&(b.layerMixins=d)}this._createWebMapRaw(c,
e,this.mapDivId,b).then(f.hitch(this,function(b){var c=b.map;c.hideZoomSlider();c.infoWindow.resize(270,316);c.itemId=a.map.itemId;c.itemInfo=b.itemInfo;c.webMapResponse=b;c.enableSnapping({snapKey:g.copyKey});k.setStyle(c.root,"zIndex",0);c._initialExtent=c.extent;this.layerInfosObj=B.getInstanceSyncForInit(c,c.itemInfo);this.layerInfosObj.traversalLayerInfosOfWebmap(f.hitch(this,function(a){a.getLayerObject().then(f.hitch(this,function(a){a&&f.setObject("_wabProperties.originalRefreshinterval",
a.refreshInterval,a)}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))}));a.map.mapRefreshInterval&&!a.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(a.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(c);setTimeout(f.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(c)}),f.hitch(this,function(a){console.error(a);this._showError(a);r.publish("mapCreatedFailed")}))},_handleRefreshLayer:function(a){var b=
a._mode._drawFeatures,c=a._mode._clearIIf,e=null;a._mode._drawFeatures=function(c,e){e&&"number"===typeof e.row&&"number"===typeof e.col&&a._mode._removeCell(e.row,e.col);b.apply(a._mode,arguments)};l.before(a,"refresh",function(){e=a._mode._cellMap;a._mode._clearIIf=function(){}});l.after(a,"refresh",function(){a._mode._cellMap=e;a._mode._clearIIf=c});p(a,"update-start",function(){a.isUpdating=!0});p(a,"update-end",function(){a.isUpdating=!1})},_showError:function(a){a&&a.message&&k.create("div",
{"class":"app-error",innerHTML:a.message},document.body)},_createWebMapRaw:function(a,b,c,d){return D.createWebMap(a,b,c,d).then(f.hitch(this,function(a){return a}),f.hitch(this,function(h){console.error(h);if(h&&h instanceof Error&&h.message){var g=f.getObject("arcgis.utils.baseLayerError",!1,m.cache["esri/nls/jsapi/"+e.locale]);if(g&&0<=h.message.indexOf(g))return new y({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),t.getItem(b).then(f.hitch(this,function(b){b.itemData.spatialReference=
{wkid:102100,latestWkid:3857};b.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return D.createWebMap(a,b,c,d)}))}throw h;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),b="",c=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";c&&
a&&0<a.length&&(n.forEach(a,f.hitch(this,function(a){b=b+a+", "})),new y({message:c.replace("${layers}",b)}))},_addDataLoadingOnMapUpdate:function(a){var b=k.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');k.place(b,a.root);a.updating&&k.addClass(b,"loading");p(a,"update-start",f.hitch(this,function(){k.addClass(b,"loading")}));p(a,"update-end",f.hitch(this,function(){k.removeClass(b,"loading")}));p(a,"unload",f.hitch(this,function(){k.destroy(b);b=null}))},_checkAppState:function(){var a=
"extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&n.forEach(a,function(a){a in this.urlParams&&(b=!1)},this);b&&this.appStateManager.getWabAppState().then(f.hitch(this,function(a){if(a.extent||a.layers){var b=new z({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});b.placeAt("main-page");p(b,"applyAppState",f.hitch(this,function(){this._applyAppState(a,this.map)}));b.startup();b.show()}}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||
null});a.extent&&b.setExtent(a.extent)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new u(a.extent)),a.center&&!f.isArrayLike(a.center)&&(a.center=new v(a.center)),a.infoWindow&&(a.infoWindow=new c(a.infoWindow,k.create("div",{},this.mapDivId))),a},createLayer:function(a,b,c){C([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer",
"2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+
"_"+c.type]],f.hitch(this,function(b){var e,d={};e="label url type icon infoTemplate isOperationalLayer".split(" ");for(var g in c)0>e.indexOf(g)&&(d[g]=c[g]);c.infoTemplate?(e=new h(c.infoTemplate.title,c.infoTemplate.content),d.infoTemplate=e,b=new b(c.url,d),c.infoTemplate.width&&c.infoTemplate.height&&l.after(b,"onClick",f.hitch(this,function(){a.infoWindow.resize(c.infoTemplate.width,c.infoTemplate.height)}),!0)):b=new b(c.url,d);b.isOperationalLayer=c.isOperationalLayer;b.label=c.label;b.icon=
c.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b?c.lods&&this._recreateMap(a):"mapRefreshIntervalChange"===b&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(c)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(a){var b=-1,b=a.useWebMapRefreshInterval?-1:a.minutes;this.layerInfosObj.traversalLayerInfosOfWebmap(f.hitch(this,
function(a){a.getLayerObject().then(f.hitch(this,function(a){if(a){var c=f.getObject("_wabProperties.originalRefreshinterval",!1,a);0<c&&"function"===typeof a.setRefreshInterval&&(0>b?a.setRefreshInterval(c):a.setRefreshInterval(b))}}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))}))},_recreateMap:function(a){this.map&&(r.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});
H.getInstance=function(a,b){null===G&&(G=new H(a,b));return G};return H})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C){var D=q([v,c,
a,h,u],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:C,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);m.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[D.ANCHOR_UPPERRIGHT,D.ANCHOR_LOWERRIGHT,D.ANCHOR_LOWERLEFT,D.ANCHOR_UPPERLEFT];if(7>r("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
e.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",b=m.create("div",null,k.body());e.set(b,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var c=setTimeout(function(){m.destroy(b);clearTimeout(c);c=b=null},100);d.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var c=e.set;c(this._topleft,{height:b+"px",marginLeft:a+"px"});c(this._topright,{width:a+"px",height:b+"px"});c(this._user,"width",a-8+"px");c(this._hide,"marginLeft",a-22+"px");c(this._title,"width",a-25+"px");c(this._content,"height",b-37+"px");c(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});c(this._bottomright,{width:a-
5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var c=e.set;c(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===D.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===D.ANCHOR_UPPERRIGHT?c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===D.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):b===D.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,c){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=null,this.coords=a);var e=this.map._getFrameWidth();if(-1!==e&&(a.x%=e,0>a.x&&(a.x+=e),this.map.width>e))for(var d=(this.map.width-
e)/2;a.x<d;)a.x+=e;b&&-1!==n.indexOf(this._ANCHORS,b)||(b=this._getAnchor(a));g.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);g.add(this._pointer,b);t.show(this.domNode);this.isShowing=!0;if(!c)this.onShow()}},hide:function(a,b){t.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){t.show(this._titlebar);t.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){t.hide(this._titlebar);t.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){t.show(this._content);t.show(this._border);this.isContentShowing=!0},hideContent:function(){t.hide(this._content);t.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));e.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"})},setFixedAnchor:function(a){a&&-1===n.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||
this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});f.mixin(D,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});r("extend-esri")&&f.setObject("dijit.InfoWindow",D,b);return D})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y){q=f([t,u],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:q.toUrl("./images/whitex.png"),dArrowIcon:q.toUrl("./images/whitedown.png"),lArrowIcon:q.toUrl("./images/whitel.png"),rArrowIcon:q.toUrl("./images/whiter.png"),constructor:function(a,b){this.initialize();n.mixin(this,a);this.domNode=m.byId(b);this._nls=n.mixin({},
y.widgets.popup);a=this.domNode;c.add(a,"esriPopupMobile");e.set(a,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
b=p.query(".titlePane",a)[0];this._arrowButton=p.query(".arrow",b)[0];this._pointerTop=p.query(".top",a)[0];this._pointerBottom=p.query(".bottom",a)[0];this._title=p.query(".title",b)[0];this._footer=p.query(".footer",b)[0];this._prev=p.query(".prev",b)[0];this._next=p.query(".next",b)[0];this._spinner=p.query(".spinner",b)[0];this._eventConnections=[k.connect(p.query(".close",b)[0],"onclick",this,this.hide),k.connect(this._arrowButton,"onclick",this,this._toggleView),k.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),k.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();B.hide(a);this.isShowing=!1},setMap:function(b){this.inherited(arguments);a.place(this.domNode,b.root);this.highlight&&this.enableHighlight(b)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(B.show(this.domNode),this.isShowing=!0,this.onShow())}else B.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(B.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);d.forEach(this._eventConnections,k.disconnect);a.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");c.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[k.connect(a,"onPanStart",this,this._onPanStart),k.connect(a,"onPan",this,this._onPan),k.connect(a,"onZoomStart",this,this._onZoomStart),k.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(d.forEach(a,k.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,c){var e=this._panOrigin;a=c.x;c=c.y;var d=e.left,h=e.top,g=e.right,e=e.bottom;d&&(d=parseFloat(d)+a+"px");h&&(h=parseFloat(h)+c+"px");g&&(g=parseFloat(g)-a+"px");e&&(e=parseFloat(e)-c+"px");b.set(this.domNode,{left:d,top:h,right:g,bottom:e})},_onZoomStart:function(){B.hide(this.domNode)},_onExtentChange:function(a,b,c){c&&(B.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var e=a.x;a=a.y;var d=
h.getContentBox(this.map.container),g=d.w,d=d.h,f=0,m=a+10,l=118,t=g-18;18<e&&e<t?(f=e-130,0>f?f=0:f>g-260&&(f=g-260)):18>=e?f=e-18:e>=t&&(f=g-260+(e-t));118<e&&e<g-130?l=118:118>=e?18<e?l=e-12:18>=e&&(l=6):e>=g-130&&(e<t?l=118+e-(g-130):e>=t&&(l=118+t-(g-130)));a<=d/2?(b.set(this.domNode,{left:f+"px",top:m+"px",bottom:null}),b.set(this._pointerTop,{left:l+"px"}),c.add(this._pointerBottom,"hidden"),c.remove(this._pointerTop,"hidden")):(b.set(this.domNode,{left:f+"px",top:m-64+"px",bottom:null}),b.set(this._pointerBottom,
{left:l+"px"}),c.add(this._pointerTop,"hidden"),c.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){d.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?p.query(".pointer."+b,this.domNode).removeClass("hidden"):p.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();B.show(this.popupNavigationBar.container);B.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":B.hide(this.popupNavigationBar.container);B.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":B.hide(this.popupNavigationBar.container);B.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var b={};b.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new C(b,a.create("div",{},r.body()));k.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});k.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);k.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();B.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},a.create("div",{},r.body()));c.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();k.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});k.connect(this.popupInfoView,"onSwipeLeft",this,function(){});k.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",e=this.selectedIndex,d=this.features,h=this.deferreds,g=this._prevFeatureButton.parentNode,f=this._nextFeatureButton.parentNode,m=this._spinner,l=this._nls;d&&1<=d.length?(a=d[e].getTitle(),b=e+1+" of "+d.length,c.remove(this._arrowButton,"hidden"),0===e?(c.add(g,"hidden"),c.add(this._prev,"hidden")):(c.remove(g,"hidden"),c.remove(this._prev,"hidden")),e===d.length-1?(c.add(f,"hidden"),
c.add(this._next,"hidden")):(c.remove(f,"hidden"),c.remove(this._next,"hidden"))):(c.add(this._arrowButton,"hidden"),c.add(g,"hidden"),c.add(f,"hidden"),c.add(this._prev,"hidden"),c.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;h&&h.length?(c.remove(m,"hidden"),this.setTitle(l.NLS_searching+"...","\x26nbsp;")):(c.add(m,"hidden"),d&&d.length||this.setTitle("No Information","\x26nbsp;"))}});l("extend-esri")&&n.setObject("dijit.PopupMobile",q,D);
return q})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a){q=q(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(c,b){this.container=l.byId(b);this._touchBase=a(this.container,null);this._slideDiv=m.create("div",
null,this.container,"first");this.events=[];this._items=c.items;c.sections&&(this._sections=c.sections);g.add(this.container,"esriMobileInfoView");if(0===this._sections.length)m.create("div",{},this._slideDiv);else for(c=0;c<this._sections.length;c++)b=m.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),m.create("div",{innerHTML:this._sections[c].title},b);for(c=0;c<this._items.length;c++){var e;b=0;this._items[c].section&&(b=this._items[c].section);switch(this._items[c].type){case "div":e=
m.create("div",{"class":"esriMobileInfoViewItem",style:this._items[c].style},this._slideDiv.childNodes[b]),e=m.create("div",{innerHTML:this._items[c].text},e)}this._items[c].className&&g.add(e,this._items[c].className);e._index=c;e._item=this._items[c];this._items[c]._node=e}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){n.forEach(this.events,k.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=null;
a._item=null;m.destroy(a);a=null});this._items=null;m.destroy(this._slideDiv);m.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(k.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(k.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(k.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){k.disconnect(this.events.pop());k.disconnect(this.events.pop());k.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(this._moveDirection=Math.abs(a.curY)>Math.abs(a.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=e.getContentBox(this.container);var c=0>this._velocity?.001:-.001;b=-(this._velocity*this._velocity)/(2*c);var d=-this._velocity/c,c=3*.6-0,g=1-c,f=0,m=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,m=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(d/20);a<b;a++)if(f=(20*g*a^3)+(20*c*a^2)+0*a+0,f=0>this._velocity?-f:f,0<this.contentOffsetY+f){m=20*a;break}0===m&&(m=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
b)+a.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=a.h-this._slideDiv.scrollHeight,a=0,b=Math.floor(d/20);a<b;a++){if(f=(20*g*a^3)+(20*c*a^2)+0*a+0,f=0>this._velocity?-f:f,Math.abs(this.contentOffsetY+f)>this._slideDiv.scrollHeight){m=20*a;break}}else m=d,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+m+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=e.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),
a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}});r("extend-esri")&&f.setObject("dijit.InfoView",q,c);return q})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(q,f,n,k,d,r){q=q(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,f){this.domNode=k.byId(d);this.events=[n.connect(this.domNode,"touchstart",this,this._touchStartHandler),n.connect(this.domNode,"touchmove",this,this._touchMoveHandler),n.connect(this.domNode,"touchend",this,this._touchEndHandler),n.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){n.disconnect(this.events.pop())},
_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-
this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}});
d("extend-esri")&&f.setObject("dijit._TouchBase",q,r);return q})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c){q=q(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(a,c){this.container=l.byId(c);this._touchBase=e(this.container,null);this._slideDiv=m.create("div",
{},this.container,"first");this.events=[n.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=a.items;g.add(this.container,"esriMobileNavigationBar");c=m.create("div",{},this._slideDiv);for(a=0;a<this._items.length;a++){var b,d;switch(this._items[a].type){case "img":d=m.create("div",{"class":"esriMobileNavigationItem"},c);b=m.create("img",{src:this._items[a].src.toString(),style:{width:"100%",height:"100%"}},d);break;case "span":d=m.create("div",{"class":"esriMobileNavigationItem"},
c);b=m.create("span",{innerHTML:this._items[a].text},d);break;case "div":d=m.create("div",{"class":"esriMobileNavigationInfoPanel"},c),b=m.create("div",{innerHTML:this._items[a].text},d)}g.add(d,this._items[a].position);this._items[a].className&&g.add(b,this._items[a].className);b._index=a;b._item=this._items[a];this._items[a]._node=b}},startup:function(){this.onCreate(this._items)},destroy:function(){k.forEach(this.events,n.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=
null;a._item=null;m.destroy(a);a=null});this._items=null;m.destroy(this._slideDiv);m.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var c=a.target,b=c._item;d.query("img",this.container).forEach(function(a){a!==c&&a._item.toggleGroup===b.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(c,b)}},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))},_markSelected:function(a,c){c.toggleState="ON";c.srcAlt&&(a.src=c.srcAlt);this.onSelect(c)},_markUnSelected:function(a,c){"ON"===c.toggleState&&(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c))}});r("extend-esri")&&f.setObject("dijit.NavigationBar",q,c);
return q})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),function(q,f,n,k,d,r,p,l){var g=1E3,m=1E4;return q([f,l],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(e){this.inherited(arguments);"animationDuration"in e&&(g=e.animationDuration);"autoCloseInterval"in e&&(m=e.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&k.addClass(this.domNode,"mobile");var e=k.create("div",{"class":"appstate-header"});k.create("div",{"class":"appstate-title",innerHTML:this.nls.title},e);var c=k.create("div",{"class":"appstate-close"},e);k.place(e,this.domNode);e=k.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});k.place(e,this.domNode);this.own(d(e,"click",n.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(d(c,"click",n.hitch(this,
function(){this.hide()})));this.own(d(this.domNode,r.enter,n.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(d(this.domNode,r.leave,n.hitch(this,function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(n.hitch(this,this.hide),m))})))},show:function(){p.animateProperty({node:this.domNode,duration:g,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:n.hitch(this,
function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(n.hitch(this,this.hide),m)},hide:function(){0!==this.currentState&&p.animateProperty({node:this.domNode,duration:g,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:n.hitch(this,function(){this.currentState=0;k.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D){function B(a,b){var c=a.center.split(";");1===c.length&&(c=a.center.split(","));if(2===c.length||3===c.length){a=parseFloat(c[0]);var e=parseFloat(c[1]);if(isNaN(a)||isNaN(e))a=parseFloat(c[0]),e=parseFloat(c[1]);if(!isNaN(a)&&!isNaN(e)){var d=4326;3!==c.length||isNaN(c[2])||(d=parseInt(c[2],10));c=new r(a,e,new g(d));K(c.spatialReference,b.spatialReference)?b.centerAt(c):J(c,b.spatialReference,function(a){b.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function y(a,b){var c=a.extent.split("wkt\x3d"),e=null;2===c.length?(e=c[1],c=c[0],c=c.split(",")):(c=a.extent.split(";"),1===c.length&&(c=a.extent.split(",")));if(4===c.length||5===c.length){a=parseFloat(c[0]);var d=parseFloat(c[1]),h=parseFloat(c[2]),f=parseFloat(c[3]);if(isNaN(a)||isNaN(a)||isNaN(a)||isNaN(a))a=parseFloat(c[0]),d=parseFloat(c[1]),h=parseFloat(c[2]),f=parseFloat(c[3]);if(isNaN(a)||isNaN(d)||isNaN(h)||isNaN(f))console.error("Wrong extent parameters.");else{var m=4326;5!==c.length||
isNaN(c[4])||(m=parseInt(c[4],10));c=null;c=e?new p(a,d,h,f,new g({wkt:e})):new p(a,d,h,f,new g({wkid:m}));K(b.spatialReference,c.spatialReference)?b.setExtent(c):J(c,b.spatialReference,function(a){b.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function z(b,c){var e=null;if(b.markertemplate){e={title:"",content:"",isIncludeShareUrl:!1};try{var d=JSON.parse(decodeURIComponent(b.markertemplate));q.mixin(e,d)}catch(X){console.error("urlParams: \x26markertemplate JSON.parse error."+
X.stack)}}d=b.marker.split(";");1===d.length&&(d=b.marker.split(","));if(2<=d.length&&6>=d.length&&d[0].length&&!isNaN(d[0])&&d[1].length&&!isNaN(d[1])){var h=parseFloat(d[0]),f=parseFloat(d[1]),m=4326;3<=d.length&&d[2].length&&!isNaN(d[2])&&(m=parseInt(d[2],10));var l="";4<=d.length&&(l=d[3]);b=null;5<=d.length&&0===d[4].indexOf("http")&&(b=d[4]);var t=null;6===d.length&&(t=d[5]);var k=a.fromJson({type:"esriPMS",url:b,contentType:"image/png"}),p=null;t&&(p=a.fromJson({color:[0,0,0,255],type:"esriTS",
verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:t}));A(k).then(function(){var a=new r(h,f,new g({wkid:m}));K(a.spatialReference,c.spatialReference)?w(a,k,p,l,e,c):J(a,c.spatialReference,function(a){w(a[0],k,p,l,e,c)},function(){console.error("Project center point error.")})})}}function w(a,c,e,d,g,f){d=new t("",d);if(g){var m=D.getXyContent(g);g.isIncludeShareUrl&&(g=D.getShareUrl(f,
g,!0),g=D.getShareUrlContent(g),m+=g);d.setContent(m)}m=new b({id:"marker-feature-action-layer"});f.addLayer(m);d=new h(a,c,null,d);m.add(d);e&&(e.xoffset=c.width/2,e.yoffset=c.height/2+c.yoffset,c=new h(new r(a.toJson()),e),m.add(c),d._textSymbol=c);f.centerAt(a)}function A(a){var b=new n;a.url?v.getImagesSize(a.url).then(function(c){a.width=c[0];a.height=c[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):
(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function F(a,b){var c=a.query.split(";");1===c.length&&(c=a.query.split(","));if(2!==c.length&&3!==c.length)console.error("query URL parameter is not correct.");else{var e=c[0];L("name",e,b).then(function(a){null===a?L("id",e,b).then(function(a){null===a?console.error("Invalid layer name or id."):E(b,a,c)}):E(b,a,c)})}}function E(a,b,c){var e=new u,d="";e.outSpatialReference=
a.spatialReference;if(2===c.length)e.where=c[1];else if(3===c.length&&(b.layerObject.url&&v.isHostedService(b.layerObject.url)&&v.containsNonLatinCharacter(c[2])&&(d="N"),f.forEach(b.layerObject.fields,function(a){if(a.alias.toLowerCase()===c[1].toLowerCase()||a.name.toLowerCase()===c[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?e.where=a.name+"\x3d"+c[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&
(e.where=c[1]+"\x3d"+d+"'"+c[2].replace(/\'/g,"''")+"'")},this),!e.where)){console.error("Invalid field name or type in query URL parameter.");return}e.maxAllowableOffset=1E-5;b.layerObject.queryFeatures(e).then(function(c){c=c.features;if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===b.layerObject.geometryType&&1===c.length)a.setExtent(l.getExtentForScale(a,1E3)),a.centerAt(c[0].geometry);else{var e=v.graphicsExtent(c);a.setExtent(e)}G(a,b,c)}},function(a){console.error(a)})}
function G(a,b,c){function e(a){f.forEach(c,function(b){b.setInfoTemplate(a)})}function d(){a.infoWindow.setFeatures(c);a.infoWindow.show(H(c[0]))}if(a.getLayer(b.layerInfo.id))d();else{var g=b.layerInfo.getInfoTemplate();g?(e(g),d()):b.layerInfo.loadInfoTemplate().then(function(a){e(a);d()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===
a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function L(a,b,c){var e=new n,g=[];C.getInstance(c,c.itemInfo).then(function(c){c.traversal(function(c){if(e.isResolved())return!0;("id"===a&&c.id.toLowerCase()===b.toLowerCase()||"name"===a&&c.title.toLowerCase()===b.toLowerCase())&&g.push(d({layerType:c.getLayerType(),layerObject:c.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&e.resolve({layerInfo:c,layerObject:a.layerObject})},
function(a){console.error("Find layer error from query URL parameter",a);e.resolve(null)}))});d(g).then(function(){e.isResolved()||e.resolve(null)})});return e}function J(a,b,d,g){var h=[102113,102100,3857],f;4326===a.spatialReference.wkid&&O(h,b.wkid)?(a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99),a=c.geographicToWebMercator(a),(g=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(h=g.valid[1]-a.xmin,f=a.xmax-g.valid[0],h>f?a.xmax=g.valid[1]+f:a.xmin=g.valid[0]-h),a.spatialReference.wkid=
b.wkid,d([a],null)):O(h,a.spatialReference.wkid)&&4326===b.wkid?(a=c.webMercatorToGeographic(a),(g=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(h=g.valid[1]-a.xmin,f=a.xmax-g.valid[0],h>f?a.xmax=g.valid[1]+f:a.xmin=g.valid[0]-h),d([a],null)):(h=new m,h.geometries=[a],h.outSR=b,e.defaults.geometryService.project(h,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&
!isNaN(a[0].y)&&d(a,null):d(a,null)},g))}function K(a,b){var c=[102113,102100,3857];return a&&b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&O(c,a.wkid)&&O(c,b.wkid)?!0:!1}function O(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return{postProcessUrlParams:function(a,b){if("extent"in a)return y(a,b);if("center"in a)return B(a,b);if("marker"in a)return z(a,b);
if("find"in a)k.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return F(a,b)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(q,f,n,k,d,r,p,l,g,m){var e={getBaseHrefUrl:function(c){var a="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",e="";window.isXT?e=window.location.protocol+
"//"+window.location.host+window.appInfo.appPath:(e=g.urlToObject(window.location.href).query||{},e=e.appid?c+"apps/"+a+"/index.html?appid\x3d"+e.appid:e.id?c+"apps/"+a+"/index.html?id\x3d"+e.id:g.getAppHref());return e},addQueryParamToUrl:function(c,a,e,b){c=m.urlToObject(c);c.query||(c.query={});c.query[a]=e;a=c.path;for(var d in c.query)e=c.query[d],!0===b&&(e=encodeURIComponent(e)),a=a===c.path?a+"?"+d+"\x3d"+e:a+"\x26"+d+"\x3d"+e;return a},removeQueryParamFromUrl:function(c,a,e){c=m.urlToObject(c);
c.query&&delete c.query[a];a=c.path;for(var b in c.query){var d=c.query[b];!0===e&&(d=encodeURIComponent(d));a=a===c.path?a+"?"+b+"\x3d"+d:a+"\x26"+b+"\x3d"+d}return a},getShareUrlContent:function(c){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+c+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},
getShareUrl:function(c,a,d){var b=e.getBaseHrefUrl(window.portalUrl),g="",h,f,m,l,k;a&&(a.longitude&&a.latitude?(h=a.longitude,f=a.latitude,g=a.longitude+","+a.latitude+","):a.x&&a.y&&a.spatialReference&&a.spatialReference.wkid&&(m=a.x,l=a.y,k=a.spatialReference.wkid,g=a.x+","+a.y+","+a.spatialReference.wkid));b=e.addQueryParamToUrl(b,"marker",g,!0);b=e.addQueryParamToUrl(b+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:a.title,x:m,y:l,wkid:k,longitude:h,latitude:f,isIncludeShareUrl:d})));
a=c.getLevel();return b="number"===typeof a&&-1!==a?e.addQueryParamToUrl(b,"level",c.getLevel(),!0):e.addQueryParamToUrl(b,"scale",c.getScale(),!0)},getXyContent:function(c){var a="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";c.longitude&&c.latitude?a+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":c.x&&c.y&&(a+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");
return a+"\x3c/div\x3e"},_isUserOwnTheApp:function(c){return c&&c.username&&c.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(c,a,e,b){var g=new d;b=k.getStandardPortalUrl(b);b=b+"/sharing/rest/content/users/"+(a?a.username?a.username:a.email:e.email);if(r.isDefined(c.folderId)&&"/"!==c.folderId||r.isDefined(c.ownerFolder)&&"/"!==c.ownerFolder)b+="/"+(c.folderId||c.ownerFolder);b+="/items/"+c.id;f({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,
function(a){g.resolve(a)}),q.hitch(this,function(a){console.error(a);g.reject(a)}));return g},_getProfile:function(c,a){var e=new d;c=k.getUserUrl(a,c.owner);f({url:c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){e.resolve(a)}),q.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_unshareItemById:function(c,a,e){var b=new d;e=k.getStandardPortalUrl(e);e+="/sharing/rest/content/items/"+a+"/unshare";a={f:"json"};a=q.mixin(a,c);f({url:e,
handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){console.error(a);b.reject(a)}));return b},canSharePublic:function(c){return!c.selfUrl||!0!==c.canSharePublic&&!1!==c.canSharePublic?!0:c.canSharePublic},unshareItemsByUser:function(c,a,e){var b=new d;e=k.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+c+"/unshareItems";c={f:"json"};c=q.mixin(c,a);f({url:e,handleAs:"json",content:c,callbackParamName:"callback"},
{usePost:!0}).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){console.error(a);b.reject(a)}));return b},unshareItems:function(c,a,e){var b=new d;e=k.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+(a.owner||c.email)+"/unshareItems";c={f:"json"};c=q.mixin(c,a);f({url:e,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){console.error(a);b.reject(a)}));return b},shareItemsByUser:function(c,
a,e){var b=new d;e=k.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+c+"/shareItems";c={f:"json"};c=q.mixin(c,a);f({url:e,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){console.error(a);b.reject(a)}));return b},shareItems:function(c,a,e){var b=new d;e=k.getStandardPortalUrl(e);e+="/sharing/rest/content/users/"+(a.owner||c.email)+"/shareItems";c={f:"json"};c=q.mixin(c,a);f({url:e,handleAs:"json",
content:c,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemsGroups:function(c,a){var e=new d;a=k.getStandardPortalUrl(a);a+="/sharing/rest/content/items/"+c.id+"/groups";f({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){e.resolve(a)}),q.hitch(this,function(a){console.error(a);e.reject(a)}));return e},isSharedToPublic:function(c){return window.isXT?
!1:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"public"===c.item.access?!0:!1},isShowSocialMediaLinks:function(c){return window.isXT?!0:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"private"===c.item.access?!1:!0},getItemShareInfo:function(c){var a=new d,e="";if(window.isXT)return a.resolve(null);e=g.urlToObject(g.getAppHref()).query||{};e=e.id||e.appid;if("undefined"===typeof e||""===
e)return a.resolve(null);p.getPortal(c).getItemById(e).then(q.hitch(this,function(b){var c={};c.item=b;c.item&&"undefined"===typeof c.item.sharing&&c.item.access&&(c.item.sharing={access:c.item.access});a.resolve(c)}),q.hitch(this,function(b){console.log(b);a.resolve(null)}));return a},getShareInfo:function(c){var a=p.getPortal(c),h=new d,b="";if(window.isXT)return h.resolve(null);b=g.urlToObject(g.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return h.resolve(null);n({getUser:a.getUser(),
loadSelfInfo:a.loadSelfInfo(),getItem:a.getItemById(b)}).then(q.hitch(this,function(a){var b={};b.item=a.getItem;b.item&&b.item.ownerFolder&&b.item.ownerFolder.length&&"/"!==b.item.ownerFolder&&(b.item.folderId=b.item.ownerFolder);"undefined"===typeof b.item.sharing&&b.item.access&&(b.item.sharing={access:b.item.access});b.user=a.getUser;e._setUserRole(a.loadSelfInfo,b);b.currentUser=b.user;b.isAdmin=!1;b.userRole&&(b.userRole.isAdmin()||b.userRole.isCustom()&&b.userRole.canUpdateOrgItems())?(b.isAdmin=
!0,b.item.owner!==b.currentUser.name?e._getProfile(b.item,c).then(q.hitch(this,function(a){b.itemUser=a;b.itemUser.orgId!==b.currentUser.orgId&&(b.isAdmin=!1);h.resolve(b)})):(b.itemUser=b.currentUser,h.resolve(b))):(b.currentUser&&(b.itemUser=b.currentUser),h.resolve(b))}),q.hitch(this,function(a){console.log(a);h.resolve(null)}));return h},_setUserRole:function(c,a){a.userPortalUrl=c.urlKey?c.urlKey+"."+c.customBaseUrl:this.portalUrl;!c||c.code||c.message||(a.organization=c);if(c&&c.user)a.userRole=
new l({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),a._isCustomRole=a.userRole.isCustom(),a._roleCanShareToGroup=a._isCustomRole&&a.userRole.canShareItemToGroup(),a._roleCanShareToOrg=a._isCustomRole&&a.userRole.canShareItemToOrg(),a._roleCanSharePublic=a._isCustomRole&&a.userRole.canShareItemToPublic(),a._roleCanShare=a._roleCanShareToGroup||a._roleCanShareToOrg||a._roleCanShareToPublic,a._roleCanUpdateItems=a._isCustomRole&&a.userRole.canUpdateOrgItems(),a._roleCanShareOthersItemsToGroup=
a._isCustomRole&&a.userRole.canShareOthersItemsToGroup(),a._roleCanShareOthersItemsToOrg=a._isCustomRole&&a.userRole.canShareOthersItemsToOrg(),a._roleCanShareOthersItemsToPublic=a._isCustomRole&&a.userRole.canShareOthersItemsToPublic(),a._roleCanShareOthersItems=a._isCustomRole&&(a.userRole.canShareOthersItemsToGroup()||a.userRole.canShareOthersItemsToOrg()||a._roleCanShareOthersItemsToPublic),a._orgUserCanSharePublicOrOverride=a.organization&&(!0===a.organization.canSharePublic&&(!a._isCustomRole||
a._roleCanSharePublic||a._roleCanShareOthersItemsToPublic)||a.userRole.isAdmin());else return!1},getItemById:function(c,a){var e=new d;a=k.getStandardPortalUrl(a);a+="/sharing/rest/content/items/"+c.id;f({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){e.resolve(a)}),q.hitch(this,function(a){console.error(a);e.reject(a)}));return e},disableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!1)},enableWebMapPopup:function(c){c&&
c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!0)}};return e})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector".split(" "),function(q,f,n,k,d,r,p,l,g,m){var e=null,c=q(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){f.mixin(this,a);this.popupMenu=g.getInstance();this.isInited=!1;this.featureActionManager=
p.getInstance();k.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));k.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));k.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));k.subscribe("widgetsActionsRegistered",f.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&
(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&n.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&n.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=n.create("span",{"class":"popup-menu-button"},r(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=r("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=n.create("div",{"class":"esriMobileInfoViewItem"},
a);this.popupMenuButtonMobile=n.create("span",{"class":"popup-menu-button"},a);d(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));d(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=n.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){d(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));d(this.popupUnion.mobile,"selection-change",f.hitch(this,
this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),a=this.selectedFeature.getLayer(),(this.selectedFeature.infoTemplate||a&&a.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){n.addClass(this.popupMenuButtonDesktop,"disabled");n.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){n.removeClass(this.popupMenuButtonDesktop,
"disabled");n.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(a){if(a){var c=l.toFeatureSet(a);this.featureActionManager.getSupportedActions(c).then(f.hitch(this,function(a){var b="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");a=a.filter(f.hitch(this,function(a){return 0>b.indexOf(a.name)}));0===a.length?this._disablePopupMenu():this._enablePopupMenu();a=a.map(f.hitch(this,function(a){a.data=
c;return a}));this.popupMenu.setActions(a)}))}else this._disablePopupMenu(),this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&
this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new m({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(h){console.warn(h.message)}}});c.getInstance=function(a){null===e&&(e=new c({mapManager:a}));return e};return c})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),
function(q,f,n,k,d,r,p,l){var g=null,m=q(null,{constructor:function(){this._actions=[];window.isBuilder?(k.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(k.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),k.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):
(k.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),k.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(e){e=this._getFeatureSet(e);var c=[];n.forEach(this._actions,function(a){var d=this.testActionSupportFeature(a,e);d.action=a;c.push(d)},this);return r(c).then(f.hitch(this,function(a){return a.map(f.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},
testActionSupportFeature:function(e,c){c=this._getFeatureSet(c);var a;c.features&&0<c.features.length&&(a=c.features[0].getLayer());e=e.isFeatureSupported(c,a);var g=new d;e&&"function"===typeof e.then?e.then(function(a){g.resolve(a)},function(a){console.error(a);g.resolve(!1)}):g.resolve(e);return g},registerAction:function(e){var c=new d;require([e.uri],f.hitch(this,function(a){var d=new a({map:this.map,appConfig:this.appConfig,label:e.label,name:e.name,widgetId:e.widgetId});n.some(this._actions,
function(a){return d.name===a.name&&d.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",d.name),c.reject("Feature/FeatureSet action has been registered.",d.name)):(this._actions.push(d),c.resolve(d))}));return c},removeActionsByWidgetId:function(e){this._actions=n.filter(this._actions,function(c){return c.widgetId!==e},this)},getActionsByWidgetId:function(e){return n.filter(this._actions,function(c){return c.widgetId===e},this)},getActionsByActionName:function(e){return n.filter(this._actions,
function(c){return c.name===e},this)},registerWidgetFeatureActions:function(e){var c=new d;if(!e.featureActions||!e.uri)return c.resolve(),c;var a=[];n.forEach(e.featureActions,function(c){a.push(this.registerAction({uri:e.isRemote?e.amdFolder+c.uri+".js":e.amdFolder+c.uri,widgetId:e.id,name:c.name,label:e.manifest["i18nLabels_featureAction_"+c.name][window.dojoConfig.locale]||e.manifest["i18nLabels_featureAction_"+c.name].defaultLabel}))},this);return r(a)},registerAllWidgetFeatureActions:function(e){var c=
[];e.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&c.push(this.registerWidgetFeatureActions(a))}));return r(c).then(function(){k.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(e){var c=[];n.forEach(this.getAllActions(),function(a){var c=e.getConfigElementById(a.widgetId);"framework"===a.widgetId||c&&c.uri&&!1!==c.visible||this.removeActionsByWidgetId(a.widgetId)},this);e.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&0===this.getActionsByWidgetId(a.id).length&&
c.push(this.registerWidgetFeatureActions(a))}));0<c.length&&r(c).then(function(){k.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){n.forEach(p,function(e){this.registerAction({uri:e.uri,widgetId:"framework",label:window.jimuNls.featureActions[e.name],name:e.name})},this)},_getFeatureSet:function(e){return"[object Object]"===Object.prototype.toString.call(e)?e.features?e:l.toFeatureSet([e]):l.toFeatureSet(e)},_onAppConfigLoaded:function(e){this.appConfig=e=f.clone(e);this._setActionsAppConfig(e);
this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(e){this.appConfig=e=f.clone(e);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(e)},_onMapLoaded:function(e){this.map=e;this._setActionsMap(e)},_onMapChanged:function(e){this.map=e;this._setActionsMap(e)},_setActionsMap:function(e){n.forEach(this._actions,function(c){c.setMap(e)},this)},_setActionsAppConfig:function(e){n.forEach(this._actions,function(c){c.setAppConfig(e)},this)}});m.getInstance=
function(){null===g&&(g=new m,window._featureActionManager=g);return g};return m})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},
{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},
"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(q,f,n){return q(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){n.featureAction.zoomTo(this.map,f.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(q,f){return q(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,
appConfig:{},widgetId:null,constructor:function(n){f.mixin(this,n)},isFeatureSupported:function(f,k){return!0},onExecute:function(f,k){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/utils"],function(q,f,n){return q(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(f){return 0<f.features.length&&f.geometryType},onExecute:function(f){n.featureAction.panTo(this.map,f.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(q,f,n,k){return q([n],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(d,k){if(1>d.features.length||!k)return!1;
d=d.features[0];var p=f.getObject("renderer.symbol",!1,k);return d&&d.geometry&&(d.symbol||p)&&this.map.getLayer(k.id)},onExecute:function(d,f){k.featureAction.flash(d&&d.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(q,f,n){return q([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(f,d){return f&&f.features&&1===f.features.length&&d&&d.infoTemplate},onExecute:function(f){n.featureAction.showPopup(this.map,
f.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,n){return q(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length},onExecute:function(f){f=n.createDataSource({type:n.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(n.FORMAT_CSV);f.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./GeojsonConverters".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){function u(a,c){var e="",d=c.length,g=a.length,h="",f="",m;try{n.forEach(a,function(a){e="string"===typeof a?e+h+a:e+h+(a.alias||a.name);h=","});for(var e=e+"\r\n",l=0;l<d;l++){h="";m=c[l];for(var t=0;t<g;t++){var k=a[t];(f=m["string"===typeof k?k:k.name])||"number"===typeof f||(f="");f&&("esriFieldTypeDate"===k.type?f=b.localizeDateByFieldInfo(f,k.fieldInfo):!k.fieldInfo||"esriFieldTypeDouble"!==k.type&&"esriFieldTypeSingle"!==k.type&&"esriFieldTypeInteger"!==
k.type&&"esriFieldTypeSmallInteger"!==k.type||(f=b.localizeNumberByFieldInfo(f,k.fieldInfo)));f&&/[",\r\n]/g.test(f)&&(f='"'+f.replace(/(")/g,'""')+'"');e=e+h+f;h=","}e+="\r\n"}return e}catch(O){return""}}var v={createDataSource:function(a){return a.type===v.TYPE_TABLE?new B(a):a.type===v.TYPE_FEATURESET?new D(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},C=q(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,
constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(f.hitch(this,function(a){var b=this.filename+this.suffix;10>dojo.isIE?saveTextAs(a,b,"utf-8"):(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,b,!0))}))},exportToPortal:function(a,b){}}),D=q(C,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;
this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===v.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===v.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new d;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV},{value:v.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},
{value:v.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var a=new d;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var b=new r;b.returnGeometry=!0;b.outFields=["*"];this.queryTask=new p(this.url);this.queryTask.execute(b,f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var b;n.some(a.features,function(a){if(a.geometry&&
a.geometry.spatialReference)return b=a.geometry.spatialReference,!0});return b},_projectToWGS84:function(h){var f=new d,t=this._getSpatialReference(h);if(t)if(4326===parseInt(t.wkid,10))f.resolve(h);else if(t.isWebMercator()){var t=new l,k=[];n.forEach(h.features,function(b){var c=new g;c.attributes=b.attributes;c.geometry=a.webMercatorToGeographic(b.geometry);k.push(c)});t.features=k;f.resolve(t)}else{t=new e;t.geometries=n.map(h.features,function(a){return a.geometry});t.outSR=new m(4326);var p=
c&&c.defaults&&c.defaults.geometryService;p&&"esri.tasks.GeometryService"===p.declaredClass||(p=b.getArcGISDefaultGeometryService());p.project(t).then(function(a){var b=new l,c=[];n.forEach(h.features,function(b,e){var d=new g;d.attributes=b.attributes;d.geometry=a[e];c.push(d)});b.features=c;f.resolve(b)},function(a){console.error(a);f.resolve([])})}else f.resolve([]);return f},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(a=a.toJson())&&
(b=k.stringify(a));return b}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){return this._projectToWGS84(a)})).then(f.hitch(this,function(a){var b="";if(a&&a.features&&0<a.features.length){var c={type:"FeatureCollection",features:[]};n.forEach(a.features,function(a){c.features.push(t.arcgisToGeoJSON(a))});b=k.stringify(c)}return b}))},_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(b=this._createCSVFromFeatureSet(a));
return b}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a),c=n.map(a.features,function(b){var c=f.clone(b.attributes);"esriGeometryPoint"!==a.geometryType&&"point"!==a.geometryType||!b.geometry||(c.x=b.geometry.x,c.y=b.geometry.y,b.geometry.spatialReference&&b.geometry.spatialReference.wkid&&(c.wkid=b.geometry.spatialReference.wkid));return c});return u(b,c)},_generateFields:function(a){var b=a.features[0],c,e,d;b._layer&&(c=b._layer.fields,d=b._layer.id);c=f.clone(c||a.fields);
if(!c||0===c.length)for(e in c=[],b=b.attributes,b)b.hasOwnProperty(e)&&c.push({name:e});if(e=h.getInstanceSync().getLayerInfoById(d)){var g=e.getPopupInfo();n.forEach(c,f.hitch(this,function(a){a.fieldInfo=this._findFieldInfo(g,a.name)}))}a.fieldAliases&&n.forEach(c,function(b){a.fieldAliases[b.name]&&(b.alias=a.fieldAliases[b.name])});if("esriGeometryPoint"===a.geometryType||"point"===a.geometryType)c.push({name:"x",type:"esriFieldTypeDouble",alias:"x"}),c.push({name:"y",type:"esriFieldTypeDouble",
alias:"y"}),c.push({name:"wkid",type:"esriFieldTypeInteger",alias:"wkid"});return c},_findFieldInfo:function(a,b){if(!a)return null;var c;n.some(a.fieldInfos,function(a){if(a.fieldName===b)return c=a,!0});return c}}),B=q(C,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var a=new d;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,
label:this.nls.toCSV}]},_getTableData:function(){var a=new d;if(this.table)a.resolve(this.table);else if(this.url){var b=new r;b.outFields=["*"];this.queryTask=new p(this.url);this.queryTask.execute(b,f.hitch(this,function(b){var c={};c.fields=b.fields;c.datas=n.map(b.features,function(a){return a.attributes});a.resolve(c)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,function(a){var b="";a&&(b=
"\ufeff"+u(a.fields,a.datas));return b}))}});return v})},"jimu/GeojsonConverters":function(){define([],function(){function q(d){var f;a:{f=d[0];for(var g=0;g<f.length;g++)if(f[g]!==d[d.length-1][g]){f=!1;break a}f=!0}f||d.push(d[0]);return d}function f(d){var f=0,g=0,m=d.length,e=d[g],c;for(g;g<m-1;g++)c=d[g+1],f+=(c[0]-e[0])*(c[1]+e[1]),e=c;return 0<=f}function n(d,f){for(var g=0;g<d.length-1;g++)for(var m=0;m<f.length-1;m++){var e;a:{var c=d[g],a=d[g+1],h=f[m],b=f[m+1],l=(b[0]-h[0])*(c[1]-h[1])-
(b[1]-h[1])*(c[0]-h[0]);e=(a[0]-c[0])*(c[1]-h[1])-(a[1]-c[1])*(c[0]-h[0]);c=(b[1]-h[1])*(a[0]-c[0])-(b[0]-h[0])*(a[1]-c[1]);if(0!==c&&(l/=c,e/=c,0<=l&&1>=l&&0<=e&&1>=e)){e=!0;break a}e=!1}if(e)return!0}return!1}function k(d){var l=[];d=d.slice(0);var g=q(d.shift().slice(0));if(4<=g.length)for(f(g)||g.reverse(),l.push(g),g=0;g<d.length;g++){var m=q(d[g].slice(0));4<=m.length&&(f(m)&&m.reverse(),l.push(m))}return l}function d(d){var f={},g;for(g in d)d.hasOwnProperty(g)&&(f[g]=d[g]);return f}var r=
{arcgisToGeoJSON:function(k,l){var g={};"number"===typeof k.x&&"number"===typeof k.y&&(g.type="Point",g.coordinates=[k.x,k.y]);k.points&&(g.type="MultiPoint",g.coordinates=k.points.slice(0));k.paths&&(1===k.paths.length?(g.type="LineString",g.coordinates=k.paths[0].slice(0)):(g.type="MultiLineString",g.coordinates=k.paths.slice(0)));if(k.rings){var m=k.rings.slice(0),g=[],e=[],c,a;for(a=0;a<m.length;a++){var h=q(m[a].slice(0));4>h.length||(f(h)?g.push([h]):e.push(h))}for(h=[];e.length;){a=e.pop();
for(var b=!1,m=g.length-1;0<=m;m--){var t=c=g[m][0],p=a;c=n(t,p);for(var p=p[0],v=!1,C=-1,D=t.length,B=D-1;++C<D;B=C)(t[C][1]<=p[1]&&p[1]<t[B][1]||t[B][1]<=p[1]&&p[1]<t[C][1])&&p[0]<(t[B][0]-t[C][0])*(p[1]-t[C][1])/(t[B][1]-t[C][1])+t[C][0]&&(v=!v);t=v;if(!c&&t){g[m].push(a);b=!0;break}}b||h.push(a)}for(;h.length;){a=h.pop();e=!1;for(m=g.length-1;0<=m;m--)if(c=g[m][0],n(c,a)){g[m].push(a);e=!0;break}e||g.push([a.reverse()])}g=1===g.length?{type:"Polygon",coordinates:g[0]}:{type:"MultiPolygon",coordinates:g}}if(k.geometry||
k.attributes)g.type="Feature",g.geometry=k.geometry?r.arcgisToGeoJSON(k.geometry):null,g.properties=k.attributes?d(k.attributes):null,k.attributes&&(g.id=k.attributes[l]||k.attributes.OBJECTID||k.attributes.FID);return g},geojsonToArcGIS:function(f,l){l=l||"OBJECTID";var g={wkid:4326},m={};switch(f.type){case "Point":m.x=f.coordinates[0];m.y=f.coordinates[1];m.spatialReference=g;break;case "MultiPoint":m.points=f.coordinates.slice(0);m.spatialReference=g;break;case "LineString":m.paths=[f.coordinates.slice(0)];
m.spatialReference=g;break;case "MultiLineString":m.paths=f.coordinates.slice(0);m.spatialReference=g;break;case "Polygon":m.rings=k(f.coordinates.slice(0));m.spatialReference=g;break;case "MultiPolygon":l=m;f=f.coordinates.slice(0);for(var e=[],c=0;c<f.length;c++)for(var a=k(f[c]),h=a.length-1;0<=h;h--){var b=a[h].slice(0);e.push(b)}l.rings=e;m.spatialReference=g;break;case "Feature":f.geometry&&(m.geometry=r.geojsonToArcGIS(f.geometry,l));m.attributes=f.properties?d(f.properties):{};f.id&&(m.attributes[l]=
f.id);break;case "FeatureCollection":m=[];for(g=0;g<f.features.length;g++)m.push(r.geojsonToArcGIS(f.features[g],l));break;case "GeometryCollection":for(m=[],g=0;g<f.geometries.length;g++)m.push(r.geojsonToArcGIS(f.geometries[g],l))}return m}};return r})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,n){return q(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(f){return 0<
f.features.length&&f.features[0].geometry},onExecute:function(f){f=n.createDataSource({type:n.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(n.FORMAT_FEATURESET);f.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,n){return q(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=n.createDataSource({type:n.TYPE_FEATURESET,
filename:"features",data:f});f.setFormat(n.FORMAT_GEOJSON);f.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(q,f,n){return q(f,{iconClass:"icon-statistics",isFeatureSupported:function(f,d){return 1<f.features.length&&d&&"esri.layers.GraphicsLayer"!==d.declaredClass&&0<this.getNumbericFields(d).length},onExecute:function(f,d){var k=new n;f={featureSet:f,layer:d,fieldNames:this.getNumbericFields(d).map(function(d){return d.name})};
k.showContentAsPopup(f)},getNumbericFields:function(f){return f.fields.filter(function(d){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(d.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b){return q([f],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;n.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=k.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new c({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(c,e){var d;b.isStatFromServer(this.statInfo)&&(d=new a,d.placeAt(e),d.show());b.getStatisticsResult(this.statInfo).then(n.hitch(this,function(a){d&&d.destroy();p(".esriAGOTableStatistics",e).remove();
a=this._createStatContent(a);k.place(a,e)}))},_getFieldAliaseFromStatInfo:function(a){var b=this.statInfo.featureSet;(b=b&&b.fieldAliases)&&"undefined"!==typeof b[a]?b=b[a]:this.statInfo.layer?(b=d.filter(this.statInfo.layer.fields,function(b){return b.name===a}),b=b[0]?b[0].alias:""):b=a;return b},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=k.create("div",{className:"header"},a);k.create("span",{innerHTML:this.nls.field+": "},b);var c=new m({options:this.statInfo.fieldNames.map(n.hitch(this,
function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"}});this.own(r(c,"change",n.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));c.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=k.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return b},
_createStatContent:function(a){var b={},c="count sum min max ave stddev".split(" "),e,g,h,f,m,l,t,n;e=k.create("div",{className:"esriAGOTableStatistics",innerHTML:""});k.create("div",{className:"hzLine",innerHTML:""},e);g=k.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},e);for(m in a)a.hasOwnProperty(m)&&(b[m.toLowerCase()]=a[m]);m=b.countfield;n=b.sumfield||"";t=b.minfield||"";l=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";h=k.create("tbody",{},g);
var p=this;d.forEach([m,n,t,l,a,b],function(a,b){""!==a&&(f=k.create("tr",{valign:"top"},h),k.create("td",{"class":"attrName",innerHTML:p.nls[c[b]]},f),k.create("td",{"class":"attrValue",innerHTML:a},f))});k.create("div",{className:"break",innerHTML:""},e);return e}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(q,f,n,k,d){function r(d){for(;d.childNodes[0]&&1==d.childNodes[0].nodeType;)d=d.childNodes[0];
return d}function p(d,f){"string"==typeof d?(d=k.toDom(d,f&&f.ownerDocument),11==d.nodeType&&(d=d.childNodes[0])):1==d.nodeType&&d.parentNode&&(d=d.cloneNode(!1));return d}var l=q.NodeList;f.extend(l,{_placeMultiple:function(d,f){d="string"==typeof d||d.nodeType?q(d):d;for(var e=[],c=0;c<d.length;c++)for(var a=d[c],g=this.length,b=g-1,m;m=this[b];b--)0<c&&(m=this._cloneNode(m),e.unshift(m)),b==g-1?k.place(m,a,f):a.parentNode.insertBefore(m,a),a=m;e.length&&(e.unshift(0),e.unshift(this.length-1),Array.prototype.splice.apply(this,
e));return this},innerHTML:function(d){return arguments.length?this.addContent(d,"only"):this[0].innerHTML},text:function(g){if(arguments.length){for(var f=0,e;e=this[f];f++)1==e.nodeType&&d.set(e,"textContent",g);return this}for(var c="",f=0;e=this[f];f++)c+=d.get(e,"textContent");return c},val:function(d){if(arguments.length){for(var g=f.isArray(d),e=0,c;c=this[e];e++){var a=c.nodeName.toUpperCase(),h=c.type,b=g?d[e]:d;if("SELECT"==a)for(a=c.options,h=0;h<a.length;h++){var l=a[h];l.selected=c.multiple?
-1!=n.indexOf(d,l.value):l.value==b}else"checkbox"==h||"radio"==h?c.checked=c.value==b:c.value=b}return this}if((c=this[0])&&1==c.nodeType){d=c.value||"";if("SELECT"==c.nodeName.toUpperCase()&&c.multiple){d=[];a=c.options;for(h=0;h<a.length;h++)l=a[h],l.selected&&d.push(l.value);d.length||(d=null)}return d}},append:function(d){return this.addContent(d,"last")},appendTo:function(d){return this._placeMultiple(d,"last")},prepend:function(d){return this.addContent(d,"first")},prependTo:function(d){return this._placeMultiple(d,
"first")},after:function(d){return this.addContent(d,"after")},insertAfter:function(d){return this._placeMultiple(d,"after")},before:function(d){return this.addContent(d,"before")},insertBefore:function(d){return this._placeMultiple(d,"before")},remove:l.prototype.orphan,wrap:function(d){if(this[0]){d=p(d,this[0]);for(var g=0,e;e=this[g];g++){var c=this._cloneNode(d);e.parentNode&&e.parentNode.replaceChild(c,e);r(c).appendChild(e)}}return this},wrapAll:function(d){if(this[0]){d=p(d,this[0]);this[0].parentNode.replaceChild(d,
this[0]);d=r(d);for(var g=0,e;e=this[g];g++)d.appendChild(e)}return this},wrapInner:function(d){if(this[0]){d=p(d,this[0]);for(var g=0;g<this.length;g++){var e=this._cloneNode(d);this._wrap(f._toArray(this[g].childNodes),null,this._NodeListCtor).wrapAll(e)}}return this},replaceWith:function(d){d=this._normalize(d,this[0]);for(var g=0,e;e=this[g];g++)this._place(d,e,"before",0<g),e.parentNode.removeChild(e);return this},replaceAll:function(d){d=q(d);for(var g=this._normalize(this,this[0]),e=0,c;c=
d[e];e++)this._place(g,c,"before",0<e),c.parentNode.removeChild(c);return this},clone:function(){for(var d=[],f=0;f<this.length;f++)d.push(this._cloneNode(this[f]));return this._wrap(d,this,this._NodeListCtor)}});l.prototype.html||(l.prototype.html=l.prototype.innerHTML);return l})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C){function D(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(l.hitch(this,a,b))}}var B=f("dijit.form._SelectMenu",a,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
l.isArray(b)&&(b=b[b.length-1]);b&&q.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,this.focusChild(c,!1))},this);a||this.inherited(arguments)}});d=f("dijit.form.Select"+(m("dojo-bidi")?"_NoBidi":""),[e,c,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:C,_buttonInputDisabled:m("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new B({id:this.id+"_menu",parentWidget:this});k.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var c=l.hitch(this,"_setValueAttr",a);a=new h({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,
onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a}return new b({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(y){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,e){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{q.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var b=new h({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);n.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?t.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=r.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[p.LEFT_ARROW];delete a[p.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
k.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
m("dojo-bidi")&&(d=f("dijit.form.Select",d,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=B;d.prototype._onContainerKeydown=D("_onContainerKeydown");d.prototype._onContainerKeypress=D("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){return d("dijit.form._FormSelectWidget",a,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(g.isArrayLike(a))return q.map(a,"return this.getOptions(item);",this);g.isString(a)&&(a={value:a});g.isObject(a)&&(q.some(b,function(b,c){for(var e in a)if(!(e in b)||b[e]!=a[e])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){q.forEach(g.isArrayLike(a)?a:[a],function(a){a&&g.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(g.isArrayLike(a)?
a:[a]);q.forEach(a,function(a){a&&(this.options=q.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){q.forEach(g.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(a,b,d){var h=this.store;d=d||{};if(h!==a){for(var m;m=this._notifyConnections.pop();)m.remove();a.get||(g.mixin(a,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var e=new f(function(){d.abort&&d.abort()});e.total=new f;var d=this.fetch(g.mixin({query:a,onBegin:function(a){e.total.resolve(a)},
onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},b));return new c(e)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[n.after(a,"onNew",g.hitch(this,"_onNewItem"),!0),n.after(a,"onDelete",g.hitch(this,"_onDeleteItem"),!0),n.after(a,"onSet",g.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=a.query(this.query,this.queryOptions),e(this._queryRes,g.hitch(this,function(c){if(this.sortByLabel&&!d.sort&&c.length)if(a.getValue)c.sort(k.createSortFunction([{attribute:a.getLabelAttributes(c[0])[0]}],a));else{var e=this.labelAttr;c.sort(function(a,b){return a[e]>b[e]?1:b[e]>
a[e]?-1:0})}d.onFetch&&(c=d.onFetch.call(this,c,d));q.forEach(c,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(g.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(c):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),g.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return h},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=g.isArrayLike(a)?q.map(a,function(a){return g.isObject(a)?a:{value:a}}):g.isObject(a)?[a]:[{value:a}];a=q.filter(this.getOptions(a),function(a){return a&&a.value});var c=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!c.length||(a[0]=
c[0]);q.forEach(c,function(b){b.selected=q.some(a,function(a){return a.value===b.value})});c=q.map(a,function(a){return a.value});if("undefined"!=typeof c&&"undefined"!=typeof c[0]){var e=q.map(a,function(a){return a.label});this._setDisplay(this.multiple?e:e[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=q.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(q.forEach(this._getChildren(),function(a){a.destroyRecursive()}),q.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;q.forEach(this._getChildren(),function(c){var e=q.some(a,function(a){return c.option&&
a===c.option.value});e&&!b.multiple&&(b.focusedChild=c);p.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),e);c.domNode.setAttribute("aria-selected",e?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=q.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?q.map(q.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);r.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?m("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+l._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);n.after(this,"onChange",g.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(q,f,n,k){return q("dijit.DropDownMenu",k,{templateString:n,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},
_onLeftArrow:function(d){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else d.stopPropagation(),d.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b){return f("dijit._MenuBase",[c,
b,h,a],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=e.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:r.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(b,p.enter),function(){a.onItemHover(e.byNode(this))}),l(this.containerNode,l.selector(b,p.leave),function(){a.onItemUnhover(e.byNode(this))}),l(this.containerNode,l.selector(b,m),function(b){a.onItemClick(e.byNode(this),b);b.stopPropagation()}),l(this.containerNode,l.selector(b,"focusin"),function(){a._onItemFocus(e.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,e){this.inherited(arguments);if(a&&(-1==e||a.popup&&1==e))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,
b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=l.once(c.domNode,"mouseover",r.hitch(this,"_onPopupHover")));var e=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&e.focusChild(a);e._cleanUp()},onExecute:r.hitch(this,
"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(k.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(q,f,n,k,d,r,p,l,g,m){return f("dijit._KeyNavContainer",[g,m,l],{connectKeyNavHandlers:function(e,c){var a=this._keyNavCodes={},g=r.hitch(this,"focusPrev"),b=r.hitch(this,"focusNext");q.forEach(e,function(b){a[b]=g});q.forEach(c,function(c){a[c]=b});a[d.HOME]=r.hitch(this,"focusFirstChild");a[d.END]=r.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){k.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);q.forEach(this.getChildren(),
r.hitch(this,"_startupChild"))},addChild:function(e,c){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=
p.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(q,f,n,k,d,r,p,l){return f("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);n.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var g=this._keyNavCodes={};g[k.HOME]=d.hitch(this,"focusFirstChild");g[k.END]=d.hitch(this,
"focusLastChild");g[this.isLeftToRight()?k.LEFT_ARROW:k.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");g[this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW]=d.hitch(this,"_onRightArrow");g[k.UP_ARROW]=d.hitch(this,"_onUpArrow");g[k.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var f=this,g="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(r(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),r(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),r(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),r(this.containerNode,r.selector(g,"focusin"),function(e){f._onChildFocus(p.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(d,f){d&&(this.focusedChild&&d!==this.focusedChild&&this._onChildBlur(this.focusedChild),d.set("tabIndex",this.tabIndex),d.focus(f?"end":"start"))},_onContainerFocus:function(d){d.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){n.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(d){n.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(d){d&&d!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),d.set("tabIndex",this.tabIndex),this.lastFocused=d,this._set("focusedChild",d))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(d,f,e,c){d&&this.focusChild(d)},_keyboardSearchCompare:function(d,f){var e=d.domNode;d=(d.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,f.length).toLowerCase();return f.length&&d==f?-1:0},_isFormElement:function(d){return"INPUT"===d.tagName||"TEXTAREA"===d.tagName||"SELECT"===d.tagName||"BUTTON"===d.tagName},_onContainerKeydown:function(d){if(!this._isFormElement(document.activeElement)){var g=this._keyNavCodes[d.keyCode];g?(g(d,this.focusedChild),d.stopPropagation(),d.preventDefault(),this._searchString=""):d.keyCode!=k.SPACE||!this._searchTimer||
d.ctrlKey||d.altKey||d.metaKey||(d.stopImmediatePropagation(),d.preventDefault(),this._keyboardSearch(d," "))}},_onContainerKeypress:function(d){this._isFormElement(document.activeElement)||d.charCode<=k.SPACE||d.ctrlKey||d.altKey||d.metaKey||(d.preventDefault(),d.stopPropagation(),this._keyboardSearch(d,String.fromCharCode(d.charCode).toLowerCase()))},_keyboardSearch:function(g,f){var e=null,c,a=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=f;var d=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;c=this._searchString.substr(0,d);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==d||!b)if(b=this._getNextFocusableChild(b,1),!b)return;d=b;do{var g=this._keyboardSearchCompare(b,c);g&&0==a++&&(e=b);if(-1==g){a=-1;break}b=this._getNextFocusableChild(b,1)}while(b&&b!=d)})();this.onKeyboardSearch(e,g,c,a)},_onChildBlur:function(){},_getNextFocusableChild:function(d,f){var e=
d;do{if(d)d=this._getNext(d,f);else if(d=this[0<f?"_getFirst":"_getLast"](),!d)break;if(null!=d&&d!=e&&d.isFocusable())return d}while(d!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(d,f){if(d)for(d=d.domNode;d;)if((d=d[0>f?"previousSibling":"nextSibling"])&&"getAttribute"in d){var e=p.byNode(d);if(e)return e}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){p=q("dijit.MenuItem"+(r("dojo-bidi")?"_NoBidi":""),[l,g,m,e],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var c="",b;b=a.search(/{\S}/);if(0<=b){var c=a.charAt(b+1),e=a.substr(0,b);a=a.substr(b+3);b=e+c+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+c+"\x3c/span\x3e"+a}else b=a;this.domNode.setAttribute("aria-label",b+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",c)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);n.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&n.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==r("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){k.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,n.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});r("dojo-bidi")&&(p=q("dijit.MenuItem",p,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return p})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(q,f){return q("dijit._Contained",null,{_getSibling:function(f){var k=this.getParent();return k&&k._getSiblingOfChild&&k._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(q,f,n,k,d,r){return q("dijit.MenuSeparator",[n,k,d],{templateString:r,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(q,f,n,k){return q(f,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&n.set(this.domNode,{display:"none"});n.set(this.domNode,
{width:"100%",height:"100%"});k.place('\x3cdiv class\x3d"jimu-loading"\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&n.set(this.domNode,"display","block")},hide:function(){this.domNode&&n.set(this.domNode,"display","none")}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(q,f,n,k,d,r,p,l,g){function m(a){var e;e=
new d;e.outFields=[a.fieldName];e.outStatistics=[];e.geometry=a.geometry;var g=c(a);q.forEach(g,function(b){var c=new n;c.statisticType=b;c.displayFeildName=a.fieldName;c.onStatisticField=a.fieldName;c.outStatisticFieldName=u[b];e.outStatistics.push(c)});e.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(e.geometry=a.geometry);return(new k(a.layer.url)).execute(e).then(function(c){return c&&c.features&&0<c.features.length?
(c=c.features[0].attributes,b(a,c),c):[]})}function e(e){var d={countField:0,sumField:0},g=c(e),f=0,h=0;e.featureSet.features.forEach(function(a){var b=a.attributes[e.fieldName];null!==b&&"undefined"!==typeof b&&g.forEach(function(a){switch(a){case "count":d.countField++;break;case "sum":d.sumField+=b;break;case "min":d.minField="undefined"===typeof d.minField?b:Math.min(d.minField,b);break;case "max":d.maxField="undefined"===typeof d.maxField?b:Math.max(d.maxField,b);break;case "avg":f++,h+=b}})});
d.avgField=0===f?0:0===f?"":h/f;var m=e.featureSet.features.filter(function(a){a=a.attributes[e.fieldName];return null===a||"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[e.fieldName]});d.stddevField=a(m);b(e,d);return d}function c(a){return a.statisticTypes&&0<a.statisticTypes.length?t.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):t}function a(a){var b=a.length;if(1>=b)return 0;var c=0;a.forEach(function(a){c+=a});var e=c/b,d=0;a.forEach(function(a){d+=Math.pow(a-
e,2)});return Math.sqrt(1/(b-1)*d)}function h(a){var b=l.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):f({})}function b(a,b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var c in b)"countField"!==c&&r.isDefined(b[c])&&(b[c]=null===b[c]||"undefined"===typeof b[c]?"":p.localizeNumberByFieldInfo(b[c],a.fieldInfos[a.fieldName]))}var t="count sum min max avg stddev".split(" "),
u={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};g.getStatisticsResult=function(a){return h(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return f(e(a));if(a.layer){if(a.layer.url)return m(a);a.featureSet=p.toFeatureSet(a.layer.graphics);return f(e(a))}})};g.isStatFromServer=function(a){return a.layer&&a.layer.url};g.getStddevVal=a;g.getStatisticsResultFromClientSync=e})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){return q(g,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a,b){return 0<a.features.length&&a.features[0].geometry&&b&&b.geometryType&&b.fields&&b.objectIdField},onExecute:function(a,b){var c;a={layerDefinition:{geometryType:b.geometryType,fields:f.clone(b.fields),objectIdField:b.objectIdField},featureSet:a.toJson()};a=new r(a);(c=b._json?k.parse(b._json):null)&&c.drawingInfo&&c.drawingInfo.renderer?(c=c.drawingInfo.renderer,c=p.fromJson(c)):
c=p.fromJson(b.renderer.toJson());a.setRenderer(c);(b=b.getSelectionSymbol())&&a.setSelectionSymbol(l.fromJson(b.toJson()));this._popupAddLayer(a)},_popupAddLayer:function(c){var b,g=n.create("div",{style:"padding: 0 10px 0 10px;"}),h=(new e({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(g);n.setStyle(h.searchBtn,"display","none");var l=new m({content:g,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,
function(){c.name=a.stripHTML(h.getValue());this._addLayerToMap(c);l.close();b&&b.remove&&b.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){l.close();b&&b.remove&&b.remove()})}]});h.inputSearch.focus();l.disableButton(0);b=d(h.inputSearch,"keyup",function(){h.getValue()?l.enableButton(0):l.disableButton(0)})},_addLayerToMap:function(a){var b=c.getInstanceSync(),e=d(b,"layerInfosChanged",f.hitch(this,function(b){a.id===b.id&&(b.enablePopup(),
e.remove())}));this.map.addLayer(a)}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(q,f,n,k,d){return q([k,d],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return n.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(d){this.doChange();13===(void 0!==d.keyCode?d.keyCode:d.which)&&this.doSearch();d.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(q,f,n,k,d,r,p){return q(f,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(d){this._getMarkerLayer();return this._isSupportType(d)&&0<d.features.length&&d.features[0]&&d.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(d)},onExecute:function(d,g){this._addMarker(d,g)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new k({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var d=this.map.snappingManager.layerInfos;d.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(d)}},_addMarker:function(f,
g){var m=f.features[0].geometry,e={};g=g.displayField||f.displayFieldName||g.objectIdField;e.title="";f.features[0].attributes&&g&&(e.title=f.features[0].attributes[g],e.title||(e.title=""));g={};if("point"===m.type)g=m;else if("polygon"===m.type||"polyline"===m.type||"multipoint"===m.type)g=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:m.getExtent().getCenter();g.getLongitude()&&g.getLatitude()?(e.longitude=g.getLongitude(),e.latitude=g.getLatitude()):g.x&&g.y&&
(e.x=g.x,e.y=g.y);var c="";m&&m.spatialReference&&m.spatialReference.wkid&&(c=m.spatialReference.wkid);e.spatialReference={wkid:c};m=p.getXyContent(e);e=p.getShareUrl(this.map,e,!0);e=p.getShareUrlContent(e);e=m+e;m=new d(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");m.width=26;m.height=26;m.setOffset(0,m.height/2);g=new n(g,m,null,null);g._markerFeatureactionGraphic=f.features[0];g.infoTemplate=this._setInfoTemplate(e);this._markerLayer.add(g);this._closePopupWindow()},_setInfoTemplate:function(d){var g=
new r;g.setContent(d);return g},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(d){return d.features[0]&&d.features[0]._graphicsLayer&&d.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===d.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(d){if(d&&d.geometryType){if(d.features&&d.features.length&&1<d.features.length)return!1;d=d.geometryType;return"point"===d||"polygon"===d||"polyline"===
d||"multipoint"===d}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(q,f,n){return q(f,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(f){this._getMarkerLayer();return 0<f.features.length&&f.geometryType&&f.features[0]&&f.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(f)},onExecute:function(f){this._removeMarker(f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new n({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var f=this.map.snappingManager.layerInfos;f.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(f)}},_removeMarker:function(f){f=f.features[0];f._textSymbol&&this._markerLayer.remove(f._textSymbol);this._markerLayer.remove(f);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(f){return f.features[0]&&
f.features[0]._graphicsLayer&&f.features[0]._graphicsLayer.id?"marker-feature-action-layer"===f.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){return q(c,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(a){return 0>=a.features.length||!a.features[0].geometry?!1:!0},onExecute:function(b,c){this.checkPrivilege().then(f.hitch(this,function(d){if(d)var g=new h({appConfig:this.appConfig}),m=new a({content:g,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){g.showBusy();m.disableButton(0);g.validate().then(f.hitch(this,function(a){a.valid?this._addItem(b,
c,g):(g.hideBusy(),m.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){m.close()})}]});else new e({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var a=g.getStandardPortalUrl(this.appConfig.portalUrl),c=l.getPortal(a);if(c){if(c.haveSignIn())return this._hasPrivilege(c);p.useSignInPage=!1;return c.signIn().then(f.hitch(this,function(){p.useSignInPage=!0;return this._hasPrivilege(c)}),f.hitch(this,function(){p.useSignInPage=
!0}))}a=new d;a.resolve(!1);return a},_hasPrivilege:function(a){return a.loadSelfInfo().then(f.hitch(this,function(a){if(a&&a.user){var b=new m({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(a,c,d){var b=d.getName(),g=d.getFolderId(),h=d.popup;c=c||{};var m={name:c.name,type:c.type||"Feature Layer",displayField:c.displayField,description:c.description,
copyrightText:c.copyright,geometryType:c.geometryType||a.geometryType,fields:c.fields||a.fields,objectIdField:c.objectIdField};a.features[0].geometry&&(c=r.graphicsExtent(a.features),m.initialExtent=c,m.fullExtent=c);!m.objectIdField&&m.fields&&n.some(m.fields,function(a){if("esriFieldTypeOID"===a.type)return m.objectIdField=a.name,!0});a={layers:[{layerDefinition:m,featureSet:a.toJson()}]};d.addItem({name:b,title:b,type:"Feature Collection",typeKeywords:"WAB_created",text:k.stringify(a)},g).then(f.hitch(this,
function(a){!0===a.success?h.close():(d.hideBusy(),h.enableButton(0),new e({message:a.error?a.error.message:""}))}),function(a){d.hideBusy();h.enableButton(0);new e({message:a.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e){return q([d,r,p],{baseClass:"jimu-item-form",templateString:l,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var c=m.getStandardPortalUrl(this.appConfig.portalUrl);g.getPortal(c).getUser().then(f.hitch(this,function(a){this.portalUser=a;return a.getContent()})).then(f.hitch(this,function(a){this.folderStore=this._createFolderStore(a.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var c=new k;this.itemForm.validate()?c.resolve({valid:!0}):
c.resolve({valid:!1,message:"param requried"});return c},addItem:function(c,a){if(this.portalUser)return this.portalUser.addItem(c,a);c=new k;c.resolve({error:{message:"portalUser is null"}});return c},_createFolderStore:function(c,a){var d=new e({data:{identifier:"id",label:"name",items:[]}});d.newItem({name:a,id:""});n.forEach(c,function(a){d.newItem({name:a.title,id:a.id})});return d}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(q,f,n,k,d){return q("dijit.form.FilteringSelect",[k,d],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(d,f,l,g){f&&f[this.searchAttr]!==this._lastQuery||!f&&d.length&&this.store.getIdentity(d[0])!=this._lastQuery||(d.length?this.set("item",d[0],g):this.set("value",
"",g||void 0===g&&!this.focused,this.textbox.value,null))},_openResultList:function(d,f,l){f[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(d,k,l,g){this._onChangeActive||(k=null);if(void 0===g){if(null===d||""===d)if(d="",!f.isString(l)){this._setDisplayedValueAttr(l||"",k);return}var m=this;this._lastQuery=d;n(this.store.get(d),
function(e){m._callbackSetLabel(e?[e]:[],void 0,void 0,k)})}else this.valueNode.value=d,this.inherited(arguments,[d,k,l,g])},_setItemAttr:function(d,f,l){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(d){return d.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(d,k){null==d&&(d="");if(!this._created){if(!("displayedValue"in this.params))return;k=!1}if(this.store){this.closeDropDown();var l=f.clone(this.query),g=this._getDisplayQueryString(d),
m;this.store._oldAPI?m=g:(m=this._patternToRegExp(g),m.toString=function(){return g});this._lastQuery=l[this.searchAttr]=m;this._lastDisplayedValue=this.textbox.value=d;this._set("displayedValue",d);var e=this,c={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};f.mixin(c,this.fetchProperties);this._fetchHandle=this.store.query(l,c);n(this._fetchHandle,function(a){e._fetchHandle=null;e._callbackSetLabel(a||[],l,c,k)},function(a){e._fetchHandle=null;e._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(q,f,n,k){return q("dijit.form.MappedTextBox",k,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(d){return d.toString?d.toString():""},toString:function(){var d=this.filter(this.get("value"));return null!=
d?"string"==typeof d?d:this.serialize(d,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=n.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(q,f,n,k,d,r,p,l,g){return q("dijit.form.ComboBoxMixin",[l,r],{dropDownClass:p,hasDownArrow:!0,templateString:g,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(d){this._set("hasDownArrow",d);this._buttonNode.style.display=d?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(g){g.get||k.mixin(g,{_oldAPI:!0,get:function(e){var c=new f;this.fetchItemByIdentity({identity:e,
onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(e,c){var a=new f(function(){g.abort&&g.abort()});a.total=new f;var g=this.fetch(k.mixin({query:e,onBegin:function(b){a.total.resolve(b)},onComplete:function(b){a.resolve(b)},onError:function(b){a.reject(b)}},c));return d(a)}});this._set("store",g)},postMixInProperties:function(){var d=this.params.store||this.store;d&&this._setStoreAttr(d);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var e=this.declaredClass;k.mixin(this.store,{getValue:function(c,a){n.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return c[a]},getLabel:function(c){n.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return c.name},fetch:function(c){n.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
k.hitch(this,function(a){(new a({objectStore:this})).fetch(c)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(q,f,n,k,d,r,p,l,g,m,e){f=f("dijit.form._AutoCompleterMixin",e,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(c){var a=0;if("number"==typeof c.selectionStart)a=c.selectionStart;else if(l("ie")){var e=c.ownerDocument.selection.createRange().duplicate();c=c.createTextRange();e.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",e),a=String(c.text).replace(/\r/g,"").length}catch(b){}}return a},_setCaretPos:function(c,a){a=parseInt(a);m.selectInputText(c,a,a)},_setDisabledAttr:function(c){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",c?"true":"false")},_onKey:function(c){if(!(32<=c.charCode)){var a=c.charCode||c.keyCode;if(a!=k.ALT&&a!=k.CTRL&&a!=k.META&&a!=k.SHIFT){var e=this.dropDown,b=null;this._abortQuery();this.inherited(arguments);if(!(c.altKey||c.ctrlKey||c.metaKey))switch(this._opened&&(b=e.getHighlightedOption()),a){case k.PAGE_DOWN:case k.DOWN_ARROW:case k.PAGE_UP:case k.UP_ARROW:this._opened&&this._announceOption(b);c.stopPropagation();c.preventDefault();break;case k.ENTER:if(b){if(b==
e.nextButton){this._nextSearch(1);c.stopPropagation();c.preventDefault();break}else if(b==e.previousButton){this._nextSearch(-1);c.stopPropagation();c.preventDefault();break}c.stopPropagation();c.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case k.TAB:a=this.get("displayedValue");if(e&&(a==e._messages.previousMessage||a==e._messages.nextMessage))break;b&&this._selectOption(b);case k.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(c){var a=this.focusNode;m.selectInputText(a,a.value.length);var e=this.ignoreCase?"toLowerCase":"substr";0==c[e](0).indexOf(this.focusNode.value[e](0))?(e=this.autoComplete?this._getCaretPos(a):a.value.length,e+1>a.value.length&&(a.value=c,m.selectInputText(a,e))):(a.value=c,m.selectInputText(a))},_openResultList:function(c,a,e){var b=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();c.length||0!=e.start?(this._nextSearch=this.dropDown.onPage=d.hitch(this,
function(a){c.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(c,e,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in e?(e.direction?this.dropDown.highlightFirstOption():e.direction||this.dropDown.highlightLastOption(),b&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(a[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var c=this.get("displayedValue"),a=this.dropDown;!a||c!=a._messages.previousMessage&&c!=a._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",c)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(c,a,e){var b="";c&&(e||(e=this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]),b=this._getValueField()!=this.searchAttr?this.store.getIdentity(c):e);this.set("value",b,a,e,c)},_announceOption:function(c){if(c){var a;
if(c==this.dropDown.nextButton||c==this.dropDown.previousButton)a=c.innerHTML,this.item=void 0,this.value="";else{var e=this.dropDown.items[c.getAttribute("item")];a=(this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]).toString();this.set("item",e,!1,a)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",n.get(c,"id"));this._autoCompleteText(a)}},_selectOption:function(c){this.closeDropDown();c&&
this._announceOption(c);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(c){if(!this.dropDown){var a=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,
this._selectOption),id:a,dir:this.dir,textDir:this.textDir})}this._lastInput=c;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new g({},this.srcNodeRef),!("value"in this.params))){var c=this.item=this.store.fetchSelectedItem();if(c){var a=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(c,a):c[a]}}},postCreate:function(){var c=r('label[for\x3d"'+
this.id+'"]');c.length&&(c[0].id||(c[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",c[0].id));this.inherited(arguments);q.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(c){c=this.labelFunc(c,this.store);var a=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(c=this.doHighlight(c,this._lastInput),a="html");return{html:"html"==a,label:c}},doHighlight:function(c,a){var e=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),b=this.queryExpr.indexOf("${0}");a=p.escapeString(a);return this._escapeHtml(c.replace(new RegExp((0==b?"^":"")+"("+a+")"+(b==this.queryExpr.length-4?"$":""),e),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(c){return c=String(c).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(c,a){return(a._oldAPI?a.getValue(c,this.labelAttr||this.searchAttr):c[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(c,a,e,b){this._set("item",b||null);null==c&&(c="");this.inherited(arguments)}});l("dojo-bidi")&&f.extend({_setTextDirAttr:function(c){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",c)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(q,f,n,k,d,r){function p(d){return{id:d.value,value:d.value,name:n.trim(d.innerText||d.textContent||"")}}return q("dijit.form.DataList",d,{constructor:function(d,g){this.domNode=f.byId(g);n.mixin(this,d);this.id&&r.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:k("option",this.domNode).map(p)}])},destroy:function(){r.remove(this.id)},fetchSelectedItem:function(){var d=k("\x3e option[selected]",this.domNode)[0]||k("\x3e option",this.domNode)[0];return d&&p(d)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(q,f,n,k,d,r,p){return q("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(d){this._set("list",d)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(d){return new RegExp("^"+d.replace(/(\\.)|(\*)|(\?)|\W/g,function(d,f,e,c){return e?".*":
c?".":f?f:"\\"+d})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(d){if(!this.disabled&&
!this.readOnly){d=d.charOrCode;this._prev_key_backspace=!1;if(d==f.DELETE||d==f.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(f){this._abortQuery();var g=this,m=n.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},c=d.substitute(this.queryExpr,
[f.replace(/([\\\*\?])/g,"\\$1")]),a,h=function(){var b=g._fetchHandle=g.store.query(m,e);g.disabled||g.readOnly||a!==g._lastQuery||r(b,function(c){g._fetchHandle=null;g.disabled||g.readOnly||a!==g._lastQuery||r(b.total,function(a){c.total=a;var b=g.pageSize;if(isNaN(b)||b>c.total)b=c.total;c.nextPage=function(a){e.direction=a=!1!==a;e.count=b;a?(e.start+=c.length,e.start>=c.total&&(e.count=0)):(e.start-=b,0>e.start&&(e.count=Math.max(b+e.start,0),e.start=0));0>=e.count?(c.length=0,g.onSearch(c,m,
e)):h()};g.onSearch(c,m,e)})},function(a){g._fetchHandle=null;g._cancelingQuery||console.error(g.declaredClass+" "+a.toString())})};n.mixin(e,this.fetchProperties);this.store._oldAPI?a=c:(a=this._patternToRegExp(c),a.toString=function(){return c});this._lastQuery=m[this.searchAttr]=a;this._queryDeferHandle=this.defer(h,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var d=this.list;d&&(this.store=p.byId(d))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(q,f,n,k,d,r,p,l){return q("dijit.form._ComboBoxMenu",[d,r,l,p],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var d=this.ownerDocument.createElement("div");d.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");d.setAttribute("role","option");return d},onHover:function(d){f.add(d,"dijitMenuItemHover")},onUnhover:function(d){f.remove(d,
"dijitMenuItemHover")},onSelect:function(d){f.add(d,"dijitMenuItemSelected")},onDeselect:function(d){f.remove(d,"dijitMenuItemSelected")},_page:function(d){var f=0,e=this.domNode.scrollTop,c=n.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();f<c;){var a=this.getHighlightedOption();if(d){if(!a.previousSibling||"none"==a.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!a.nextSibling||"none"==a.nextSibling.style.display)break;this.selectNextNode()}a=
this.domNode.scrollTop;f+=(a-e)*(d?-1:1);e=a}},handleKey:function(d){switch(d.keyCode){case k.DOWN_ARROW:return this.selectNextNode(),!1;case k.PAGE_DOWN:return this._page(!1),!1;case k.UP_ARROW:return this.selectPreviousNode(),!1;case k.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(q,f,n,k,d){var r=f("dijit.form._ComboBoxMenuMixin"+
(k("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,f){var g=this._createMenuItem();d=f(d);d.html?g.innerHTML=d.label:g.appendChild(g.ownerDocument.createTextNode(d.label));""==g.innerHTML&&(g.innerHTML="\x26#160;");return g},createOptions:function(d,f,g){this.items=d;this.previousButton.style.display=0==f.start?"none":"";n.set(this.previousButton,"id",this.id+
"_prev");q.forEach(d,function(d,c){d=this._createOption(d,g);d.setAttribute("item",c);n.set(d,"id",this.id+c);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var m=!1;d.total&&!d.total.then&&-1!=d.total?f.start+f.count<d.total?m=!0:f.start+f.count>d.total&&f.count==d.length&&(m=!0):f.count==d.length&&(m=!0);this.nextButton.style.display=m?"":"none";n.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});k("dojo-bidi")&&(r=f("dijit.form._ComboBoxMenuMixin",
r,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return r})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(q,f,n,k){return q("dijit.form._ListMouseMixin",k,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(d,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(d,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(d,f){this._isDragging=!1;var k=this.selected,l=this._hoveredNode;k&&f==k?this.defer(function(){this._onClick(d,
k)}):l&&this.defer(function(){this._onClick(d,l)})},_onMouseOut:function(d,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(d,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(q,f,n){return q("dijit.form._ListBase",null,{selected:null,_listConnect:function(k,d){var n=this;return n.own(f(n.containerNode,f.selector(function(d,f,g){return d.parentNode==g},k),function(f){n[d](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,d){if(this.selected!=f){var k=this.selected;if(k)this.onDeselect(k);
f&&(d&&n.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(q,f,n,k,d){return q([f,n],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:k,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},
postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||d.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,
"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(q,f,n,k,d,r,p,l,g,m){var e=null,c=q([p,l],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(d(this.domNode,"click",n.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this.own(d(this.closeBtn,"click",n.hitch(this,this.hide)))},setActions:function(a){this.clearActions();k.forEach(a,n.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){a=
new m({action:a});f.place(a.domNode,this.menuContent);a.startup();this.menuItems.push(a);this.own(d(a,"click",n.hitch(this,this.hide)))},markAsSelected:function(a){k.forEach(this.menuItems,function(c){c.action.label===a.label?c.setSelected(!0):c.setSelected(!1)})},prepareActions:function(a,c){return g.getInstance().getSupportedActions(a).then(n.hitch(this,function(b){!1===c&&(b=k.filter(b,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));k.forEach(b,function(b){b.data=
a},this);this.setActions(b)}))},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(a,c){if(0===this.menuItems.length)f.setStyle(this.domNode,"display","none");else{"string"===typeof c&&""!==c?(this.labelNode.innerHTML=c,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));c=a.y+a.h;var b;a=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display","");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});
b=r.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?a+b.w>window.innerWidth?window.innerWidth-b.w:0>a?0:a:0>a-b.w?0:a>window.innerWidth?window.innerWidth-b.w:a-b.w)+"px",top:(b.h>window.innerHeight?0:c+b.h>window.innerHeight?window.innerHeight-b.h:c+b.h+5<window.innerHeight?c+5:c)+"px"})}}});c.getInstance=function(){null===e&&(e=new c,f.place(e.domNode,document.body),e.startup());e.setActions([]);return e};return c})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(q,f,n,k,d,r,p,l,g){return q([l,g,p],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?
("no-icon"===this.action.iconClass&&f.addClass(this.iconContainer,"no-icon"),f.addClass(this.iconNode,this.action.iconClass)):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(d(this.domNode,r.enter,n.hitch(this,this._useHoverIcon))),this.own(d(this.domNode,r.leave,n.hitch(this,this._useNormalIcon))));this.own(d(this.domNode,"click",n.hitch(this,this._clickHandler)))},setSelected:function(d){d?f.addClass(this.domNode,"selected"):f.removeClass(this.domNode,
"selected")},_useNormalIcon:function(){this.action.iconClass?f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(d){k.stop(d);if(this.action){var e;this.action.data.features&&0<this.action.data.features.length&&(e=this.action.data.features[0].getLayer());
this.action.onExecute(this.action.data,e)}this.emit("click")}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B){var y=q([g,m],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new e;this.layerInfosObj=B.getInstanceSync();var a=f.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(a);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?k.addClass(this.previouBtn,"icon-arrow-forward"):k.addClass(this.previouBtn,
"icon-arrow-back");a=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new y.PopupUIController(this):new y.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;
var b=new l;a.getRelatedTableInfoArray().then(f.hitch(this,function(a){b.resolve(a)}));return b},_getOriRelationshipByDestLayer:function(a){var b=null;n.some(a.oriJimuLayerInfo.layerObject.relationships,function(c){if(c.relatedTableId===a.destJimuLayerInfo.layerObject.layerId)return b=c,!0},this);return b},_getRelatedRecordsByRelatedQuery:function(b){var c=new l,d=new a,e=this._getOriRelationshipByDestLayer(b);d.outFields=["*"];d.returnGeometry=!0;d.outSpatialReference=this.popupManager.mapManager.map.spatialReference;
d.relationshipId=e.id;var g=b.feature.attributes[b.oriJimuLayerInfo.layerObject.objectIdField];d.objectIds=[g];b.oriJimuLayerInfo.layerObject.queryRelatedFeatures(d,f.hitch(this,function(a){(a=a[g]&&a[g].features)?c.resolve(a):c.resolve([])}),f.hitch(this,function(){c.resolve([])}));return c},_ignoreCaseToGetFieldObject:function(a,b){var c=null;b&&a&&a.fields&&n.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return c=a,!0});return c},getLocaleDateTime:function(a){return v.localizeDate(new Date(a),
{fullYear:!0,formatLength:"medium"})},_getDisplayTitleOfRelatedRecord:function(a,b,c){var d=a.getInfoTemplate();return(a="popupTitle"===c&&d?"function"===typeof d.title?d.title(b):d.title:this._getDisplayTitleFromPopup(a,b,c))?a:""},_getDisplayTitleFromPopup:function(a,b,c){(a=this._getPopupTemplateWithOnlyDisplayField(a,c))?(b.setInfoTemplate(a),c=this.popupUIController.getDisplayTitle(b),b.setInfoTemplate(null)):c=b.attributes[c];return c},_getPopupTemplateWithOnlyDisplayField:function(a,b){a=a._getCustomPopupInfo(a.layerObject,
[b]);return new u(a)},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?a.data.relatedFeature||this.showRelatedRecords(a):this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(a){var b=a.data,c=b.oriJimuLayerInfo.layerObject,d=f.getObject("_wabProperties.originalLayerName",
!1,c)||b.oriJimuLayerInfo.title,c=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,c),e=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,c);"popupTitle"!==c&&(e=d+": "+e);this._setOperationTitle(e);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,function(c){b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(c);this.popupUIController.setFeature(a.data.feature);
b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,c=f.getObject("_wabProperties.originalLayerName",!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;this._setOperationTitle(c);this._clearPage();f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);
f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(f.hitch(this,function(c){0<c.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var e=this._showFieldSelector(b.destJimuLayerInfo);n.forEach(c,function(c,g){c._layer=
b.destJimuLayerInfo.layerObject;var h=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,c,e);g=k.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:h},this.contentBox);g.relatedRecord=c;g=d(g,"click",f.hitch(this,function(){this._addOperation(a);var d=this._createOperation({feature:c,oriJimuLayerInfo:b.destJimuLayerInfo});this.setPopupContent(d)}));this._temporaryData.eventHandles.push(g)},this);this.popupManager.initPopupMenu(c);this.popupUIController.updateZoomToBtn(c)}));
this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(a).then(f.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);n.forEach(b,function(b,c){c=k.create("div",{"class":"item table-item "+(0===c%2?"oddLine":"evenLine"),innerHTML:b.title},this.contentBox);c=d(c,"click",f.hitch(this,function(){b.getLayerObject().then(f.hitch(this,function(){this._addOperation(a);
var c=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,destJimuLayerInfo:b});this.setPopupContent(c)}))}));this._temporaryData.eventHandles.push(c)},this)}))},_createOperation:function(a){return new y.Operation({feature:a.feature||null,oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||null,relatedFeature:a.relatedFeature||null},this)},_addOperation:function(a){this.undoManager.add(a)},_onPreviouBtnClick:function(){this.undoManager.undo()},
_clearPage:function(){k.empty(this.contentBox);n.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];n.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(a,b){a&&k.create("div",{"class":"title-box "+(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){k.setAttr(this.operationTitle,"innerHTML",a);k.setAttr(this.operationTitle,"title",a)},
_showFieldSelector:function(a){var b="objecid",c=p(".title-box",this.contentBox)[0],e=a.layerObject,g=[];if(!c||!a)return b;var h=a.getPopupInfo();h&&h.title&&g.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});n.forEach(e.fields,function(a){"globalid"!==a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&g.push({label:a.alias||a.name,value:a.name})});c=(new D({items:g})).placeAt(c);c.domNode.title=window.jimuNls.popup.chooseFieldTip;var m=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",
!1,e),l=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),k=C.getInstance().getAppConfig();m?b=m:"2.3"===k.configWabVersion&&l&&l.name?b=l.name:h&&h.title?b="popupTitle":l&&l.name?b=l.name:0<g.length&&(b=g[0].value);b&&(c.setHighlightValue(b),f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e));this._temporaryData.dijits.push(c);a=d(c,"click-item",f.hitch(this,function(a,b){p(".item.record-item",this.contentBox).forEach(f.hitch(this,
function(c){f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e);var d=this._getDisplayTitleOfRelatedRecord(a,c.relatedRecord,b);c.innerHTML=d}))},a));this._temporaryData.eventHandles.push(a);return b}});y.Operation=q([c],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});y.PopupUIController=q([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();
this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new h({},k.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=new h({},k.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&k.destroy(this._zoomToBtnANode);
this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(a){setTimeout(f.hitch(this,function(){k.place(a,this._getRefDomNode(),"after")}),1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=p(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),k.place(this.rrPopupProjector.domNode,a,"after"),this._unsetScrollable()},setContent:function(a){var b=p(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);
this.popup.setContent(a);this._unsetScrollable()},_setScrollable:function(){var a=p(".contentPane",this.popup.domNode)[0];r("esri-touch")&&a&&(this.toucemoveScrollHandle=d(a,"touchmove",f.hitch(this,function(b){b.preventDefault();p(".esriViewPopup",this.popup.domNode)[0]&&(b=a.firstChild,b instanceof Text&&(b=a.childNodes[1]),this.rrPopupProjector.domNode&&k.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+b._currentX+"px, "+
b._currentY+"px)"}))})))},_unsetScrollable:function(){k.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});k.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(a){this._tempPopupForDisplayTitle.setFeatures([a]);return(a=p("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&a.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return p(".esriViewPopup",
this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=p(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=p(".action",a)[0];this._zoomToBtnANode=k.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=k.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},
_hideZoomToBtn:function(){this._zoomToBtnANode&&k.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&k.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&k.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&k.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(a){this._hideOldZoomToBtn();!a||1>a.length||!a[0].geometry?
this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=d(this._zoomToBtn,"click",f.hitch(this,function(){var b=null;try{b=t.graphicsExtent(a)}catch(A){console.error(A)}b&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(b),this.popup.hide())})))},changeRefDomNode:function(){k.setStyle(this.rrPopupProjector.operationBox,"display","block");k.addClass(this.rrPopupProjector.domNode,
"second-page-mode");var a=this._getViewPopupDomNode();a&&k.addClass(a,"second-page-mode")},revertRefDomNode:function(){k.setStyle(this.rrPopupProjector.operationBox,"display","none");k.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});y.PopupMobileUIController=q([y.PopupUIController],{initTempPopup:function(){this._tempPopup=new b({},k.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=p(".esriMobileInfoView.esriMobilePopupInfoView",
this._tempPopup.domNode)[0];if(a=p(".esriViewPopup",a)[0])this.setContent(a),k.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return p(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=p(".esriMobileInfoView.esriMobilePopupInfoView")[0];return p(".esriViewPopup",a)[0]}});return y})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),
function(q,f,n,k,d,r){q=q([r],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),k(d).then(f.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),k(d).then(f.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});n("extend-esri")&&(d.UndoManager=q);return q})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(q,f,n){q=q(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(f){f=f||{};f.label&&(this.label=f.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});
f("extend-esri")&&(n.OperationBase=q);return q})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),function(q,f,n,k,d,r,p,l,g){return q([f,n,g],{baseClass:"jimu-dijit-dropdownmenu",declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuItemClass:"dropdown-menu-item",
items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=r.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');this.itemsContainer=r.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*
this.paddingOffsetY+"px";d.forEach(this.items,k.hitch(this,function(d){var e=r.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+d.label+"\x3c/div\x3e");e.itemInfo=d;e.title=d.label;r.place(e,this.itemsContainer)}));this.own(p(this.domNode,"click",k.hitch(this,this._onIconClick)));this.own(p(this.shelter,"click",k.hitch(this,this._onShelterClick)));this.own(p(this.itemsContainer,"click",k.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},
_onIconClick:function(d){d.stopPropagation();this.isShowing()?this.hideMenu():(d=r.position(d.target||d.srcElement),this.showMenu(d))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(d){d.stopPropagation();d=d.target||d.srcElement;r.hasClass(d,this.dropdownMenuItemClass)&&(d=d.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(d),this.emit("click-item",d));this.hideMenu()},clearHighlightValue:function(){l("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},
setHighlightValue:function(d){this.clearHighlightValue();l("."+this.dropdownMenuItemClass,this.itemsContainer).some(k.hitch(this,function(e){return e.itemInfo.value===d?(r.addClass(e,"selected"),!0):!1}))},getHighlightValue:function(){var d=l("."+this.dropdownMenuItemClass+".selected",this.itemsContainer)[0];return d?d.itemInfo.value:null},isShowing:function(){return r.hasClass(this.domNode,"showing")},showMenu:function(d){this.itemsContainer.style.top=d.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===
window.isRTL?(this.itemsContainer.style.left=d.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=window.innerWidth-(d.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");r.place(this.shelter,document.body);r.place(this.itemsContainer,document.body);r.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);
r.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();r.destroy(this.itemsContainer);r.destroy(this.shelter);this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(q,f,n,k,d){var r=null,p=q(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(n.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),n.subscribe("app/mapChanged",
f.hitch(this,this._onMapChanged))):(n.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),n.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));n.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(d,g){return f.getObject(d+".filterExprs."+g,!1,this._filters)},applyWidgetFilter:function(d,f,m,e,c){this._setFilterExp(d,f,m,e,c);f=this.layerInfos.getLayerInfoById(d)||this.layerInfos.getTableInfoById(d);d=this._getFilterExp(d);null!==d&&f&&f.setFilter(d)},
_onMapLoaded:function(){this.layerInfos=d.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=d.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(d){for(var f in this._filters)if(this._filters[f]){var m=this._filters[f];if(m){var e=m.filterExprs,m=m.mapFilterControls;e&&delete e[d];m&&delete m[d]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,function(d){this._filters[d.id]||(this._filters[d.id]={definitionExpression:d.getFilter(),
filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(d){d=f.getObject(d+".mapFilterControls",!1,this._filters);var g=0,m;for(m in d){var e=d[m];e.priority>g&&(g=e.priority)}return g},_getMapFilterControl:function(d){d=f.getObject(d+".mapFilterControls",!1,this._filters);var g=0,m=null,e;for(e in d){var c=d[e];c.priority>g&&(g=c.priority,m=c)}return m},_setFilterExp:function(d,g,m,e,c){var a=d+".filterExprs."+g,h=d+".mapFilterControls."+g;m?(f.setObject(a,m,this._filters),k.isDefined(e)&&
(d=this._getPriorityOfMapFilter(d),f.setObject(h,{enable:e,useAND:c,priority:d+1},this._filters))):(f.getObject(a,!1,this._filters)&&delete this._filters[d].filterExprs[g],f.getObject(h,!1,this._filters)&&delete this._filters[d].mapFilterControls[g])},_getFilterExp:function(d){if(!this._filters[d])return null;var f=[],m=this._filters[d].definitionExpression,e=this._filters[d].filterExprs;d=this._getMapFilterControl(d);for(var c in e){var a=e[c];a&&f.push("("+a+")")}f=f.join(" AND ");return m&&d&&
d.enable||m&&null===d?f?d&&!1===d.useAND?"("+m+") OR "+f:"("+m+") AND "+f:m:f}});p.getInstance=function(){if(null===r)r=new p,window._filterManager=r;else return r};return p})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(q,f,n){var k=null,d;d=q(null,{constructor:function(d){n.subscribe("publishData",f.hitch(this,this.onDataPublished));n.subscribe("fetchData",f.hitch(this,this.onFetchData));n.subscribe("clearAllData",f.hitch(this,this.onClearAllData));
n.subscribe("removeData",f.hitch(this,this.onRemoveData));n.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=d},_dataStore:{},onDataPublished:function(d,f,l,g){"undefined"===typeof g&&(g=!1);this._dataStore[f]?(this._dataStore[f].current=l,g&&(this._dataStore[f].history?this._dataStore[f].history.push(l):this._dataStore[f].history=[l])):(this._dataStore[f]={current:l},g&&(this._dataStore[f].history=[l]))},onFetchData:function(d){var f;if(d)"framework"===d?this._dataStore[d]?
n.publish("dataFetched","framework","framework",this._dataStore[d].current,this._dataStore[d].history):n.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(d))?this._dataStore[d]?n.publish("dataFetched",f.name,d,this._dataStore[d].current,this._dataStore[d].history):n.publish("noData",f.name,d):n.publish("noData",void 0,d);else{for(var l in this._dataStore)(f=this.widgetManager.getWidgetById(l))&&n.publish("dataFetched",f.name,l,this._dataStore[l].current,this._dataStore[l].history);
f||n.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};n.publish("allDataCleared")},onRemoveData:function(d){delete this._dataStore[d];n.publish("dataRemoved",d)},onClearDataHistory:function(d){this._dataStore[d]&&(this._dataStore[d].history=[]);n.publish("dataHistoryCleared",d)}});d.getInstance=function(f){null===k&&(k=new d(f));return k};return d})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){var h=null,b=q(null,{constructor:function(){window.isBuilder?(d.subscribe("app/mapLoaded",n.hitch(this,this._onMapLoaded)),d.subscribe("app/mapChanged",n.hitch(this,this._onMapChanged))):(d.subscribe("mapLoaded",n.hitch(this,this._onMapLoaded)),d.subscribe("mapChanged",n.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(b){var d=b.geometryType,f=new e(e.STYLE_CIRCLE,16,null,m.fromArray([0,255,255])),g=new c(c.STYLE_SOLID,m.fromArray([0,
255,255]),2),h=new a(a.STYLE_SOLID,g,m.fromArray([0,255,255,.3]));"esriGeometryPoint"===d?b.setSelectionSymbol(f):"esriGeometryPolyline"===d?b.setSelectionSymbol(g):"esriGeometryPolygon"===d&&b.setSelectionSymbol(h)},updateSelectionByFeatures:function(a,b,c){0<b.length&&(b=k.map(b,n.hitch(this,function(b){var c=null,c=0<=a.graphics.indexOf(b)?new g(b.toJson()):b;c.wabIsTemp=!0;return c})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var d=new f;a._selectHandler({features:b},c,null,null,d);
this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return d},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_SUBTRACT)},
clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],r.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,c){return k.filter(a.graphics,n.hitch(this,function(a){return c?l.contains(b,a.geometry):l.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=k.map(a,n.hitch(this,function(a){return a.geometry})),b=
l.union(b));return b},_createDisplayLayer:function(a){var b=new p;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),c=this._displayLayers[a.id];this.clearDisplayLayer(a);var d=a.getSelectionSymbol();k.forEach(b,n.hitch(this,function(a){a.setSymbol(null);a=new g(a.toJson());a.setSymbol(d);c.add(a)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=
a}});b.getInstance=function(){h||(h=new b,window._selectionManager=h);return h};return b})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(q,f,n,k,d,r,p,l,g){return q([r,p],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",
started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",f.hitch(this,this._onReceiveData)));this.own(d.subscribe("noData",f.hitch(this,this._onNoData)));this.own(d.subscribe("dataSourceDataUpdated",f.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);
this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(d){},onSignOut:function(){},onPositionChange:function(d){this.setPosition(d)},setPosition:function(d,e){this.position=d;var c=l.getPositionStyle(this.position);c.position="absolute";e||(e="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);k.place(this.domNode,e);k.setStyle(this.domNode,c);this.started&&
this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return k.getMarginBox(this.domNode)},setMap:function(d){this.map=d},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){},onConfigChanged:function(d){},onAppConfigChanged:function(d,e,c){},onAction:function(d,e){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return g.getInstance().getPanelById(this.id+"_panel");
var d=g.getInstance().getPanelById(this.gid+"_panel");return d?d:g.getInstance().getPanelById(this.id+"_panel")},publishData:function(f,e){"undefined"===typeof e&&(e=!1);d.publish("publishData",this.name,this.id,f,e)},fetchData:function(f){f?d.publish("fetchData",f):0!==this.listenWidgetIds.length?n.forEach(this.listenWidgetIds,function(e){d.publish("fetchData",e)},this):d.publish("fetchData")},fetchDataByName:function(d){d=this.widgetManager.getWidgetsByName(d);n.forEach(d,function(d){this.fetchData(d.id)},
this)},openWidgetById:function(d){return this.widgetManager.triggerWidgetOpen(d)},_onReceiveData:function(d,e,c,a){if(e!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onReceiveData(d,e,c,a)},onReceiveData:function(d,e,c,a){},updateDataSourceData:function(f,e){d.publish("updateDataSourceData","widget~"+this.id+"~"+f,e)},onDataSourceDataUpdate:function(d,e){},_onNoData:function(d,e){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onNoData(d,
e)},onNoData:function(d,e){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a){var h,b=null;h=q(null,{constructor:function(){this.panels=[];this.widgetManager=a.getInstance();l(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;g.subscribe("/dnd/move/start",f.hitch(this,
this._onMoveStart));g.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(a){var b=new r,d=this.getPanelById(a.id+"_panel");d?("closed"===d.state&&this.openPanel(d),b.resolve(d)):p({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(f.hitch(this,function(d){var e=a.id+"_panel",g=this.getPanelById(e),h={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:e,
gid:a.gid,nls:d.nls};f.mixin(h,a.panel.options);try{g=new d.Panel(h),console.log("panel ["+e+"] created.")}catch(z){console.log("create panel error: "+z+", panelId: "+e);b.reject(z);return}g.setPosition(a.panel.position);c.setVerticalCenter(g.domNode);this.openPanel(g);l(g.domNode,"click",f.hitch(this,this._onPanelClick,g));b.resolve(g)}));return b},setMap:function(a){this.map=a;l(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&
(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new r;if("string"===typeof a){if(a=this.getPanelById(a),!a)return b.reject(),b}else this.panels.some(function(b){return b.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=!0,
a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return this._activePanel(a),b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){k.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new r;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(f.hitch(this,function(){this.activePanel&&
this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&k.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==
this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=n.map(this.panels,function(a){return a.id});n.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return m();var b=new r;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(k.setStyle(a.domNode,{opacity:0,display:""}),d.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return m();var b=new r;"string"===
typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?d.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=k.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,
borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(c=0,this.panels.filter(function(b){return"minimized"===b.windowState&&"closed"!==b.state&&b.id!==a.id}).some(function(a){return 0===a._mobileBottom})&&(c=a.titleHeight),a._mobileBottom=c,b.h>b.w?{left:0,right:0,top:"auto",bottom:c,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:"auto",bottom:c,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",
borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"opened"===a.state&&this._activePanel(a)},
_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&k.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),
!1===b.inPanel&&k.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&k.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=
null)},_onMoveStart:function(a){n.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new r;
e([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new r;a.startWith("themes")?(a=a.split("/"),e(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});h.getInstance=function(){null===b&&(b=new h,window._panelManager=b);return b};return h})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(q,f,n,k){return q([k],{widget:null,baseClass:"jimu-widget-frame jimu-container",
postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&f.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(d){this.loading=d;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(d){this.widget=d;this.loading&&
this.loading.destroy();n.place(d.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(q,f,n,k,d,r,p,l,g){return q([d,r],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var d=this.getAllWidgetConfigs(),d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];n.forEach(d,function(d){var c,a;!1!==d.visible&&(a=new p,c=this.createFrame(d),
this.addChild(c),c.setLoading(a),this.widgetManager.loadWidget(d).then(f.hitch(this,function(a){c.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var d=[];return d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(d){for(var e=this.getChildren(),c=0;c<e.length;c++)if(e[c].getWidget()&&e[c].getWidget().id===d)return e[c].getWidget()},getWidgets:function(){return this.getChildren().map(function(d){return d.getWidget()})},createFrame:function(d){return new l},
setPosition:function(d,e){this.position=d;var c=g.getPositionStyle(this.position);c.position="absolute";e||(e="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(c.display="none");k.place(this.domNode,e);k.setStyle(this.domNode,c)},getPosition:function(){return this.position},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){this.getChildren().forEach(function(d){d.resize()})},onPositionChange:function(d){this.setPosition(d)},
onOpen:function(){n.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.openWidget(d.getWidget())},this)},onClose:function(){n.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.closeWidget(d.getWidget())},this)},onMaximize:function(){n.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.maximizeWidget(d.getWidget())},this)},onMinimize:function(){n.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.minimizeWidget(d.getWidget())},
this)},onNormalize:function(){n.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.normalizeWidget(d.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(d){this._updateConfig(d)},reloadWidget:function(d){this.isWidgetInPanel(d)&&(this._updateConfig(d),this.getChildren().forEach(function(e){e.getWidget()&&e.getWidget().id===d.id&&(e.getWidget().destroy(),e.setLoading(new p),this.widgetManager.loadWidget(d).then(f.hitch(this,function(c){e.setWidget(c);
c.startup();"closed"===this.state&&this.widgetManager.closeWidget(c)})))},this))},isWidgetInPanel:function(d){return n.some(this.getAllWidgetConfigs(),function(e){if(d.id===e.id)return!0})?!0:!1},_updateConfig:function(d){if(Array.isArray(this.config.widgets)){for(var e=-1,c=0;c<this.config.widgets.length;c++)this.config.widgets[c].id===d.id&&(e=c);0<e&&(this.config.widgets[e]=d)}else this.config=d},destroy:function(){this.getChildren().forEach(function(d){try{d.domNode&&d.destroy()}catch(e){console.error("destroy widget frame error."+
e.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(q,f,n,k,d){return q([k,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(n(window,"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),
function(q,f,n,k,d,r){return{cloneSymbol:function(f){if(!f)return null;var l=null;try{var g=f.toJson(),l=d.fromJson(g)}catch(m){console.error(m)}return l},getDefaultMarkerSymbol:function(){return d.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return d.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return d.fromJson({tags:["opaque"],
title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return d.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return d.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",
style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return d.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var d=q.toUrl("jimu/css/images/grey_pin.png"),d=new r(d,16,16);d.setOffset(0,8);return d},createSymbolNode:function(p,l){var g=32,m=32,e=n.create("div",{},document.body);n.setStyle(e,"display","inline-block");if(l)g=l.width,m=l.height;else if(g=80,
m=30,this.isSimpleMarkerSymbol(p))m=g=Math.min(p.size+12,125);else if(this.isPictureMarkerSymbol(p)){if(!p.url||"http://"===p.url||-1===p.url.indexOf("http://")&&-1===p.url.indexOf("https://")&&-1===p.url.indexOf("data:"))return;m=g=Math.min(Math.max(p.width,p.height),125)}else if(this.isSimpleLineSymbol(p)||this.isCartographicLineSymbol(p))g=190,m=20;var c=k.createSurface(e,g,m);if("vml"===k.renderer){var a=c.getEventSource();n.setStyle(a,"position","relative");n.setStyle(a.parentNode,"position",
"relative")}var a=null,a=l?d.getShapeDescriptors(p):this.isSimpleLineSymbol(p)||this.isCartographicLineSymbol(p)?this._getLineShapeDesc(p):d.getShapeDescriptors(p),h;try{h=c.createShape(a.defaultShape),a.fill&&h.setFill(a.fill),a.stroke&&h.setStroke(a.stroke)}catch(b){c.clear();c.destroy();return}p=c.getDimensions();p={dx:p.width/2,dy:p.height/2};c=h.getBoundingBox();l=c.width;c=c.height;if(l>g||c>m)g=((g<m?g:m)-5)/(l>c?l:c),f.mixin(p,{xx:g,yy:g});h.applyTransform(p);e&&n.addClass(e,"symbol");return e},
_getLineShapeDesc:function(d){var f=null;if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))f={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:d.getStroke()};return f},isSimpleMarkerSymbol:function(d){return d&&"esri.symbol.SimpleMarkerSymbol"===d.declaredClass},isPictureMarkerSymbol:function(d){return d&&"esri.symbol.PictureMarkerSymbol"===d.declaredClass},isSimpleLineSymbol:function(d){return d&&"esri.symbol.SimpleLineSymbol"===d.declaredClass},isCartographicLineSymbol:function(d){return d&&
"esri.symbol.CartographicLineSymbol"===d.declaredClass},isSimpleFillSymbol:function(d){return d&&"esri.symbol.SimpleFillSymbol"===d.declaredClass},isPictureFillSymbol:function(d){return d&&"esri.symbol.PictureFillSymbol"===d.declaredClass},isTextSymbol:function(d){return d&&"esri.symbol.TextSymbol"===d.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(q,f,n){return q(null,{constructor:function(){this.panelManager=
n.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var d=this.getAllConfigs(),k=0;k<d.length;k++)if(d[k].id===f)return d[k]},getAllConfigs:function(){var k=[],k=k.concat(this.getWidgetConfigs(),this.getGroupConfigs()),k=f.filter(k,function(d){return d.visible});return k.sort(function(d,f){return d.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=
[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(d,f){return d.index-f.index})},isControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===k})},widgetIsControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===k?!0:f.some(d.widgets,function(d){return d.id===k})})},getGroupConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,
function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&k.push(d):"all"===this.controlledGroups&&k.push(d))},this);return k},getWidgetConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&k.push(d):"all"===this.controlledWidgets&&k.push(d))},
this);return k}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(q,f,n,k,d,r,p,l){var g=null,m=null,e=!1;q=q(null,function(){});var c=require.toUrl("jimu"),a=r(c+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),h=r(c+"/SpatialReference/transform.json",{handleAs:"json"});q.loadResource=function(){var b=new k;if(g&&m)return b.resolve(),b;
d([a,h]).then(function(a){g=a[0];m=a[1];e=!0;b.resolve()},function(a){console.error(a);e=!1;b.reject(a)});return b};q.getAllCSUnits=function(){if(e){var a=[];n.forEach(g.wkids,f.hitch(this,function(b){b=this.getCSUnit(b);-1===n.indexOf(a,b)&&a.push(b)}));return a}};q.convertUnit=function(a,c,d){if(e)return l.convertUnit(a,c,d)};q.getUnitRate=function(a,c){if(e)return l.getUnitRate(a,c)};q.isProjectUnit=function(a){if(e)return l.isProjectUnit(a)};q.isGeographicUnit=function(a){if(e)return l.isGeographicUnit(a)};
q.getGeographicUnits=function(){if(e)return l.getGeographicUnits()};q.getProjectUnits=function(){if(e)return l.getProjectUnits()};q.getCSUnit=function(a){if(e){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),c=a.indexOf(",",b);return a.slice(b+6,c-1)}};q.isSameSR=function(a,c){if(e)return a=this.indexOfWkid(a),c=this.indexOfWkid(c),g.labels[a]===g.labels[c]};q.isValidWkid=function(a){if(e)return-1<this.indexOfWkid(a)};q.getSRLabel=function(a){if(e&&this.isValidWkid(a))return a=this.indexOfWkid(a),
g.labels[a]};q.indexOfWkid=function(a){if(e)return n.indexOf(g.wkids,a)};q.isWebMercator=function(a){return p.prototype._isWebMercator?p.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new p(parseInt(a,10))).isWebMercator()};q.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};q.isValidTfWkid=function(a){if(e)return-1<this.indexOfTfWkid(a)};q.getTransformationLabel=function(a){if(e)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),m.labels[a]):""};q.indexOfTfWkid=
function(a){if(e)return n.indexOf(m.tfWkids,a)};q.isGeographicCS=function(a){if(e)return this.isValidWkid(a)?g.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};q.isProjectedCS=function(a){if(e)return this.isValidWkid(a)?g.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};q.getGeoCSByProj=function(a){if(e&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=n.indexOf(g.details,a),g.wkids[a]};q.getSpheroidStr=function(a){if(e){if(this.isGeographicCS(a))return g.details[this.indexOfWkid(a)];
if(this.isProjectedCS(a)){a=g.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};q.getCSStr=function(a){if(e)return g.details[this.indexOfWkid(a)]};q.isSameSpheroid=function(a,c){if(e)return a=this.getSpheroidStr(a),c=this.getSpheroidStr(c),a&&c&&a===c?!0:!1};return q})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(q,f){var n="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
k="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};q=q(null,function(){});q.convertUnit=function(f,k,l){return d[f.toUpperCase()]/d[k.toUpperCase()]*l};q.getUnitRate=function(f,k){return d[f.toUpperCase()]/d[k.toUpperCase()]};q.isProjectUnit=function(d){return-1<f.indexOf(n,d.toUpperCase())};q.isGeographicUnit=function(d){return-1<
f.indexOf(k,d.toUpperCase())};q.getGeographicUnits=function(){return k};q.getProjectUnits=function(){return n};return q})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(q,f,n,k,d,r,p,l){return q(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){p.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&r.add(this.domNode,"jimu-radio-checked");this.own(d(this.domNode,"click",n.hitch(this,function(){this.checked||this.check()})))},check:function(d){void 0===d&&(d=!0);this.checked=!0;r.add(this.domNode,"jimu-radio-checked");d&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(d){void 0===d&&(d=!0);this.checked=!1;r.remove(this.domNode,"jimu-radio-checked");d&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(d){null!==
this.group&&k.forEach(l.toArray(),function(f){f.id!==this.id&&f["class"]===this["class"]&&f.group===this.group&&(d?f.check(!1):f.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented dojo/keys".split(" "),function(q,f,n,k,d,r,p,l){return q([f,p],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=
k.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=k.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(k.addClass(this.checkNode,"checked"),k.addClass(this.checkNode,"jimu-icon-checked"));this.status||(k.addClass(this.domNode,"jimu-state-disabled"),k.addClass(this.checkNode,"jimu-state-disabled"));this.own(r(this.checkNode,"click",n.hitch(this,function(){this.status&&(this.checked?this.uncheck():
this.check())})));this.own(r(this.labelNode,"click",n.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass();this._initSection508()},setLabel:function(d){this.label=d;this.labelNode.innerHTML=this.label;this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?k.removeClass(this.labelNode,"not-visible"):k.addClass(this.labelNode,"not-visible"))},_initSection508:function(){"undefined"!==typeof this.tabindex&&
(k.setAttr(this.checkNode,"tabindex",this.tabindex),this.own(r(this.checkNode,"focus",n.hitch(this,function(){k.addClass(this.checkNode,"dijitCheckBoxFocused")}))),this.own(r(this.checkNode,"blur",n.hitch(this,function(){k.removeClass(this.checkNode,"dijitCheckBoxFocused")}))),this.own(r(this.checkNode,"keypress",n.hitch(this,function(d){d=d.charCode||d.keyCode;k.hasClass(this.checkNode,"dijitCheckBoxFocused")&&l.SPACE===d&&this.status&&(this.checked?this.uncheck():this.check())}))))},setValue:function(d){this.status&&
(!0===d?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(f){f=!!f;var g=this.status!==f;(this.status=f)?(d.remove(this.domNode,"jimu-state-disabled"),k.removeClass(this.checkNode,"jimu-state-disabled")):(d.add(this.domNode,"jimu-state-disabled"),k.addClass(this.checkNode,"jimu-state-disabled"));g&&this.emit("status-change",f)},getStatus:function(){return this.status},check:function(d){if(this.status&&(this.checked=!0,k.addClass(this.checkNode,"checked jimu-icon-checked"),
k.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!d))this.onStateChange()},uncheck:function(d){if(this.status&&(this.checked=!1,k.removeClass(this.checkNode,"checked"),k.removeClass(this.checkNode,"jimu-icon-checked"),k.addClass(this.checkNode,"jimu-icon-checkbox"),!d))this.onStateChange()},onStateChange:function(){if(this.onChange&&n.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()}})})},
"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator dijit/form/Select dijit/form/NumberSpinner".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E,G,H){return q([f,n,k,r],{templateString:d,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(m(document.body,"click",p.hitch(this,this._onBodyClicked)));(this._isIE8=8===e("ie"))&&l.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;
b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===
a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(a){var b=null;"marker"===this.type?b=this._getPointSymbolBySetting(a):"line"===this.type?b=this._getLineSymbolBySetting(a):"fill"===this.type?b=this._getFillSymbolBySetting(a):
"text"===this.type&&(b=this._getTextSymbolBySetting(a));a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var d=a[b];this[d]&&this[d].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(a,
b){var c=b.domNode,d=b.dropDown.domNode,c=a===c||l.isDescendant(a,c);a=a===d||l.isDescendant(a,d);if(!c&&!a)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){c(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();c("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return u.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+
"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=D.fromJson(c)}catch(O){console.error(O)}return b},_createSymbolIconTable:function(a,b,d){var e=this.type+"-icon-table";a=l.toDom('\x3ctable class\x3d"'+("icon-table "+e+" "+(e+"-"+a))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var e=c("tbody",a)[0],f=Math.ceil(b.length/8),h=0;h<f;h++)l.create("tr",{},e);var m=c("tr",a);g.forEach(b,p.hitch(this,function(a,b){var c=p.clone(a),
e=D.fromJson(a);b=l.create("td",{},m[Math.floor(b/8)]);l.addClass(b,"symbol-td-item");e=this._createSymbolNode(e);l.addClass(e,"symbol-div-item");var f=e.firstChild;l.addClass(f,"svg-node");if(this._isIE8&&"point"===d)if(window.isRTL){if("Cross"===a.name||"X"===a.name)l.setStyle(f,"right","-20px"),l.setStyle(e,"marginTop","20px")}else"Cross"!==a.name&&"X"!==a.name||l.setStyle(e,"marginTop","20px");e.symbol=c;l.place(e,b)}));return a},_updatePreview:function(a){var b=this._cloneSymbol(this.symbol);
l.empty(a);(b=v.createSymbolNode(b))||(b=l.create("div"));l.place(b,a)},_createSymbolNode:function(a){(a=v.createSymbolNode(a,{width:36,height:36}))||(a=l.create("div"));l.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||
(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new B({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(m(this.pointIconTables,
".symbol-div-item:click",p.hitch(this,this._onPointSymIconItemClick)));this.own(m(this.pointSymClassSelect,"change",p.hitch(this,this._onPointSymClassSelectChange)));this.own(m(this.pointSize,"change",p.hitch(this,this._onPointSymbolChange)));this.own(m(this.pointColor,"change",p.hitch(this,this._onPointSymbolChange)));this.own(m(this.pointAlpha,"change",p.hitch(this,this._onPointSymbolChange)));this.own(m(this.pointOutlineColor,"change",p.hitch(this,this._onPointSymbolChange)));this.own(m(this.pointOutlineWidth,
"change",p.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&
this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&
(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]?(a=this.pointSymClassSelect.getOptions(a),this.pointSymClassSelect.domNode.title=a?a.label:""):this._requestPointSymJson(a)}},_hideAllPointSymIconTable:function(){c(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();
var a=this.pointSymClassSelect.get("value"),a=c(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_getLocalSymbols:function(b){b=b||this.pointSymClassSelect.get("value");b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");return a(b,{handleAs:"json"})},_getPortalSymbolsByType:function(a){var b=new h;a?this._fetchSymbols(a).then(p.hitch(this,function(a){b.resolve(a)}),p.hitch(this,function(a){b.reject(a)})):b.reject(null);return b},_requestPointSymJson:function(a){this.pointSymClassSelect["def"+
a]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(a):this._symbolTypes?this._handleGetPointSymbols(p.hitch(this,this._getPortalSymbolsByType),a):this._initPortal().then(p.hitch(this,this._fetchSymbolTypes)).then(p.hitch(this,function(b){this._clearOptions();this._createOptions(b);this._handleGetPointSymbols(p.hitch(this,this._getPortalSymbolsByType),a)}),p.hitch(this,function(b){window.isXT?this._offLineGetSymbols(a):(this.loadingShelter.hide(),console.error("Fetching symbols failed",
b))})))},_offLineGetSymbols:function(a){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var b=[];g.forEach(this._localTypes,p.hitch(this,function(a,c){b.push({id:c,title:this.nls[a]||a})}));this._clearOptions();this._createOptions(b)}this._handleGetPointSymbols(p.hitch(this,this._getLocalSymbols),a)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(a){if(this.pointSymClassSelect){var b=
[],c="",d=!1;"[object Array]"===Object.prototype.toString.call(a)&&0<a.length&&g.forEach(a,p.hitch(this,function(a){c=a.title||a.name;d=c===this.nls.basic?!0:!1;c&&(a.id||0===a.id)&&b.push({label:c,value:a.id,selected:d})}));b.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(b)}},_initPortal:function(){var a=new h;if(this._portal)a.resolve();else{var b=C.getStandardPortalUrl(window.portalUrl),c=new E.Portal(b?b:this.DEFAULT_PORTAL_URL);if(c.loaded)return this._portal=
c,a.resolve(),a.promise;this.own(c.on("load",p.hitch(this,function(){this._portal=c;a.resolve()})));setTimeout(function(){a.reject()},this._portalLoadTimeoutInMs)}return a},_handleGetPointSymbols:function(a,b){if(this.pointSymClassSelect){var c=b||this.pointSymClassSelect.get("value");b="def"+c;a=a(c);this.pointSymClassSelect[b]=a;a.then(p.hitch(this,function(a){this.loadingShelter.hide();this._getPointSymbolsSucess(c,a)}),p.hitch(this,function(a){this.loadingShelter.hide();console.error("Fetching symbols failed",
a)}))}},_getPointSymbolsSucess:function(a,b){if(this.domNode){var c=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=c?c.label:"";a=this._createSymbolIconTable(a,b,"point");l.place(a,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(a){var b=[],c=new h,b=this._symbolTypes.filter(function(b){return b.id===a});this._getSymbolListData(b).then(p.hitch(this,function(a){c.resolve(a)}),p.hitch(this,function(a){console.warn("fetch symbols failed",
a);c.reject(a)}));return c},_getSymbolListData:function(a){a=g.filter(a,function(a){return a.dataUrl});a=g.map(a,function(a){return G({url:a.dataUrl}).promise});return t(a).then(function(a){return a[0]})},_fetchSymbolTypes:function(){var a=new h;this._symbolTypes?a.resolve(this._symbolTypes):this._getSymbolListGroupId().then(p.hitch(this,this._getSymbolListItems)).then(p.hitch(this,function(b){this._symbolTypes=b;a.resolve(b)}),p.hitch(this,function(b){console.warn("fetch symbol types failed",b);
a.reject(b)}));return a},_getSymbolListGroupId:function(){var a=new h;this._portal||a.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(b){a.resolve(b.results[0].id)},p.hitch(this,function(b){console.warn("get symbol list group id failed",b);a.reject(b)}));return a},_getSymbolListItems:function(a){var c=new h,d=this._portal;a="group:"+a+' AND type:"Symbol Set"';var e=[];this._portal||c.reject("no portal");a="vml"===b.renderer?a+' AND -typekeywords:"by value"':
a+' AND (typekeywords:"by value" AND typekeywords:"marker")';d.queryItems({q:a,num:20,sortField:"title"}).then(p.hitch(this,function(a){var b,d,f,h;g.forEach(a.results,function(a){b=a.typeKeywords.join(" ");-1<b.indexOf("marker")&&(d=a.title,f={name:d,id:a.id,title:a.title,keywords:b,dataUrl:a.itemDataUrl},(h=-1<b.indexOf("default"))?(f.defaultType=!0,e.unshift(f)):e.push(f))},this);0<e.length?c.resolve(e):c.reject()}),function(){c.reject()});return c},_onPointSymIconItemClick:function(a){if(a=this._getAncestor(a.target||
a.srcElement,function(a){return l.hasClass(a,"symbol-div-item")},5))if(c(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),l.addClass(a,"selected-symbol-div-item"),a=a.symbol){this.symbol=D.fromJson(a);a=l.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var b=l.getStyle(this.pointColorTr,"display");a!==b&&this.emit("resize")}},
_showSimpleMarkerSymSettings:function(){l.addClass(this.pointCustomImageTr,"hidden");l.removeClass(this.pointIconTablesTr,"hidden");l.removeClass(this.pointColorTr,"hidden");l.removeClass(this.pointOpacityTr,"hidden");l.removeClass(this.pointOutlineColorTr,"hidden");l.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){l.addClass(this.pointCustomImageTr,"hidden");l.removeClass(this.pointIconTablesTr,"hidden");l.addClass(this.pointColorTr,"hidden");l.addClass(this.pointOpacityTr,
"hidden");l.addClass(this.pointOutlineColorTr,"hidden");l.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){l.removeClass(this.pointCustomImageTr,"hidden");l.addClass(this.pointIconTablesTr,"hidden");l.addClass(this.pointColorTr,"hidden");l.addClass(this.pointOpacityTr,"hidden");l.addClass(this.pointOutlineColorTr,"hidden");l.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(a){if(!this.symbol||a&&!this.pointSize.validate())return null;
var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(a&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(b);a=this.pointColor.getColor();b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);a=this.pointOutlineColor.getColor();var b=parseFloat(this.pointOutlineWidth.get("value")),c=new z;c.setStyle(z.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),
this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new H({cropImage:!1,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});l.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(m(this.imageChooser,"change",p.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(a,b){this.imageNameNode.innerHTML=
b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");b=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new y({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:b,height:b,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},
_bindLineEvents:function(){this.own(m(this.lineIconTables,".symbol-div-item:click",p.hitch(this,this._onLineSymIconItemClick)));this.own(m(this.lineColor,"change",p.hitch(this,this._onLineSymbolChange)));this.own(m(this.lineStylesSelect,"change",p.hitch(this,this._onLineSymbolChange)));this.own(m(this.lineAlpha,"change",p.hitch(this,this._onLineSymbolChange)));this.own(m(this.lineWidth,"change",p.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&
(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===
a.declaredClass},_requestLineSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");a(c,{handleAs:"json"}).then(p.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,a,"line"),l.place(a,this.lineIconTables))}),p.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return l.hasClass(a,"symbol-div-item")},5))if(c(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
l.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=D.fromJson(a),this._initLineSettings(a),this._onLineSymbolChange()},_getLineSymbolBySetting:function(a){if(a&&!this.lineWidth.validate())return null;this.symbol=new z;a=this.lineColor.getColor();var b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");
this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(m(this.fillIconTables,".symbol-div-item:click",p.hitch(this,this._onFillSymIconItemClick)));this.own(m(this.fillColor,"change",p.hitch(this,this._onFillSymbolChange)));this.own(m(this.fillAlpha,"change",p.hitch(this,this._onFillSymbolChange)));this.own(m(this.fillOutlineColor,"change",p.hitch(this,
this._onFillSymbolChange)));this.own(m(this.fillOutlineWidth,"change",p.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,
10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");a(c,{handleAs:"json"}).then(p.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,a,"fill"),l.place(a,this.fillIconTables))}),p.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(a){if(a=this._getAncestor(a.target||
a.srcElement,function(a){return l.hasClass(a,"symbol-div-item")},5))if(c(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),l.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=D.fromJson(a),this._initFillSettings(a),this._onFillSymbolChange()},_getFillSymbolBySetting:function(a){if(a&&!this.fillOutlineWidth.validate())return null;this.symbol=new w;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();a=this.fillOutlineColor.getColor();
var c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(b);this.symbol.setStyle(w.STYLE_SOLID);b=new z;b.setStyle(z.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(m(this.inputText,"change",
p.hitch(this,this._onTextSymbolChange)));this.own(m(this.textColor,"change",p.hitch(this,this._onTextSymbolChange)));this.own(m(this.textFontSize,"change",p.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",
a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(a){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";l.setStyle(this.textPreview,{color:b,fontSize:c,fontFamily:a});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(a){if(a&&!this.textFontSize.validate())return null;this.symbol=new A;a=this.inputText.value;var b=this.textColor.getColor(),
c=parseInt(this.textFontSize.get("value"),10),d=new F;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview(d.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters="Disasters");"undefined"===typeof this.nls.emergencyManagement&&(this.nls.emergencyManagement="Emergency Management");"undefined"===typeof this.nls.generalInfrastructure&&
(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){var a={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},h=function(a){function b(b){a[b]||(a[b]=function(){var c=arguments;return k.when(a,function(a){Array.prototype.unshift.call(c,a.results||a);return h(d[b].apply(d,c))})})}if(!a)return a;a.then&&(a=f.delegate(a));a.total||(a.total=k.when(a,function(a){return g.isDefined(a.total)?a.total:a.length||0}));b("forEach");b("filter");b("map");b("some");b("every");return a},b={useSSL:function(c,d){var e=a&&
a.self||{};if(e&&!e.isPortal)return-1!==c.indexOf("https:")||e.allSSL?d.replace("http:","https:"):d;var f=b.getLocation(d);return-1<e.portalHostname.toLowerCase().indexOf(f.hostname.toLowerCase())&&f.port&&"80"!==f.port&&"443"!==f.port?(d=f.pathname,d=0===d.indexOf("/")?d:"/"+d,e.allSSL||-1<c.indexOf("https:")?"https://"+f.hostname+(e.httpsPort&&"443"!==e.httpsPort?":"+e.httpsPort:"")+d+f.search:"http://"+f.hostname+(e.httpPort&&"80"!==e.httpPort?":"+e.httpPort:"")+d+f.search):-1!==c.indexOf("https:")||
e.allSSL?d.replace("http:","https:"):d},formatUrl:function(c){var d=a.currentToken;return-1!==c.indexOf("null")?null:b.useSSL(window.location.protocol,d?c+(-1!==c.indexOf("?")?"\x26":"?")+("token\x3d"+d):c)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,c){c=c?c.listings||c.notifications||c.userInvitations||c.tags||c.items||
c.groups||c.comments||c.provisions||c.results||c:[];return d.map(c,function(c){c=f.mixin(c,b||{});return a?new a(c):c})},clearFieldsFromObject:function(a,b){var c,d=a.length;if(f.isArray(a))for(c=0;c<d;c++)delete b[a[c]];else for(c in a)delete b[c];return b},requestToTypedArray:function(a,c,d,e,g){return h(b.request(a,c,d).then(f.partial(b.resultsToTypedArray,e,g)))},request:function(c,d,e){var g;d&&d.portal&&delete d.portal;d&&d.form&&(g=d.form,delete d.form);d=f.mixin(f.mixin({},d||{}),a.requestParams);
e=f.mixin(e||{},a.options);return m({url:b.useSSL(window.location.protocol,c.url||c),content:d,callbackParamName:"callback",timeout:e&&e.timeout||0,form:g},e)},formatQueryParams:function(b,c,d){b=f.mixin(f.mixin({},b),f.isString(c)?{q:c}:c||{});b.q=!d&&a.extraQuery?"("+b.q+")"+a.extraQuery:b.q;return b}},t=q([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),
u=q([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),v=q([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){f.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+
(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=b.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=b.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<
d.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(a){var c=f.isString(a)?{comment:a}:a;return b.request(this.itemUrl+"/addComment",c,{usePost:!0}).then(f.hitch(this,function(a){return new t(f.mixin(c,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return b.request(a.url+"/update",{comment:a.comment},
{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return b.requestToTypedArray(this.itemUrl+"/comments",null,null,t,{item:this})},deleteComment:function(a){if(a&&a.url)return b.request(a.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var c=f.isObject(a)?a:{rating:parseFloat(a)};return b.request(this.itemUrl+"/addRating",c,{usePost:!0}).then(f.hitch(this,function(a){return new u(f.mixin(c,{id:a.ratingId,item:this}))}))},getRating:function(){return b.request(this.itemUrl+
"/rating").then(f.hitch(this,function(a){return new u(f.mixin(a,{item:this}))}))},deleteRating:function(){return b.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var a=this.type,b=this.typeKeywords||[],c=a;"Feature Service"===a||"Feature Collection"===a?c=-1<d.indexOf(b,"Table")?"Table":-1<d.indexOf(b,"Route Layer")?"Route Layer":-1<d.indexOf(b,"Markup")?"Markup":"Feature Layer":"Image Service"===a?c=-1<d.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":
"Scene Service"===a?c="Scene Layer":"Scene Package"===a?c="Scene Layer Package":"Stream Service"===a?c="Feature Layer":"Geoprocessing Service"===a&&this.portal&&this.portal.isPortal?c=-1<d.indexOf(b,"Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===a?c="Locator":"Microsoft Powerpoint"===a?c="Microsoft PowerPoint":"GeoJson"===a?this.type=c="GeoJSON":"Globe Service"===a?c="Globe Layer":"Vector Tile Service"===a?c="Tile Layer":"netCDF"===a?c="NetCDF":"Map Service"===a?c=-1===d.indexOf(b,
"Spatiotemporal")&&(-1<d.indexOf(b,"Hosted Service")||-1<d.indexOf(b,"Tiled"))?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?c=a.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===a&&(c="Big Data File Share");return c},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],c=!1,e=!1,f=!1,g=!1,h=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a||"wfs"===a?(c=-1<d.indexOf(b,"Hosted Service"),
"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(g=-1<d.indexOf(b,"Table"),e=-1<d.indexOf(b,"Route Layer"),f=-1<d.indexOf(b,"Markup"),a=(h=-1!==d.indexOf(b,"Spatiotemporal"))&&g?"spatiotemporaltable":g?"table":e?"routelayer":f?"markup":h?"spatiotemporal":c?"featureshosted":"features"):a="map service"===a||"wms"===a||"wmts"===a?c||-1<d.indexOf(b,"Tiled")||"wmts"===a?"maptiles":"mapimages":"scene service"===a?-1<d.indexOf(b,"Line")?"sceneweblayerline":-1<d.indexOf(b,"3DObject")?
"sceneweblayermultipatch":-1<d.indexOf(b,"Point")?"sceneweblayerpoint":-1<d.indexOf(b,"IntegratedMesh")?"sceneweblayermesh":-1<d.indexOf(b,"PointCloud")?"sceneweblayerpointcloud":-1<d.indexOf(b,"Polygon")?"sceneweblayerpolygon":"sceneweblayer":"image service"===a?-1<d.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===
a?-1<d.indexOf(b,"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<d.indexOf(b,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===
a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<d.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&d.indexOf(b,"Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netCDF"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===
a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===a&&-1<d.indexOf(b,"Explorer Mapping Application")||-1<d.indexOf(b,"Document")?"datafilesgray":
"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"tile package"===a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===
a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?"insightspage":"hub initiative"===a?"hubinitiative":"hub page"===a?"hubpage":"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":"image collection"===a?"imagecollection":"desktop style"===a?"desktopstyle":"style"===a?"style":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===
a?"vectortilepackage":"ortho mapping project"===a?"orthomappingproject":"ortho mapping template"===a?"orthomappingtemplate":"maps";return a?p.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<d.indexOf(a,"Requires Subscription")||-1<d.indexOf(a,"Requires Credits"))b=!0;return b},_getPremiumIconUrl:function(){var a=this.typeKeywords,b;this.isPremiumContent&&(b=-1<d.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");
return b?p.toUrl("../css/images/item_type_icons/"+b+"16.png"):null},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),C=q([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){f.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=
this.banner?b.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?b.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?b.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var c in this.listingProperties)this[c]&&
(this.listingProperties[c]=this[c]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=d.map(this.screenshots,f.hitch(this,function(a){return b.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?b.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):b.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return b.requestToTypedArray(this.commentsUrl,
null,null,t,{item:this})},getVendor:function(){return this.vendor}}),D=q([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){f.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new C(f.mixin(a.listing,{portal:this.portal})):null}}),B=q([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){f.mixin(this,
a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=b.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return b.request(this.url+"/users")},queryItems:function(a,c){a=b.formatQueryParams({},a,c);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=
(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),y=q([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return b.requestToTypedArray(this.url,null,null,v,{portal:this.portal,folderId:this.id})}}),z=q([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&
this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?b.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return h(b.request(this.url).then(f.hitch(this,function(a){return b.resultsToTypedArray(B,{portal:this.portal},a.groups)})))},getNotifications:function(){return b.requestToTypedArray(this.url+
"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return b.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return b.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return h(this.getContent(null,{num:1}).then(function(a){return a.folders}))},getItems:function(a){return h(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return b.request(this.portal.portalUrl+
"content/items/"+a).then(f.hitch(this,function(a){return new v(f.mixin(a,{portal:this.portal}))}))},getContent:function(a,c){var d=this.url.replace("community","content")+(a?"/"+a:"");return b.request(d,c).then(f.hitch(this,function(c){c.folders=b.resultsToTypedArray(y,{portal:this.portal},c.folders);c.items=b.resultsToTypedArray(v,{portal:this.portal,folderId:a},c.items);return c}))},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}});
q={Portal:q([c],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(b){b=f.isObject(b)?b:{url:b};this.registerConnectEvents();a={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};b.self?(a.self=b.self,f.mixin(this,{url:b.url||e.getProtocolForWebResource()+"//"+(b.self.urlKey?b.self.urlKey+"."+b.self.customBaseUrl:b.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",b=b.self.user?this.signIn():
this.init(this.url)):(b.url&&f.mixin(this,{url:b.url}),b=this.init(this.url));b.then(f.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(c,d){c=(c||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==c.indexOf("/sharing")?c+"/":c+"/sharing/rest/";return this._getSelf(this.portalUrl).then(f.hitch(this,function(c){a.self=f.mixin({},c);(c=c.user)&&d&&(a.currentToken=d&&d.token,a.loggedInUser=new z(f.mixin(c,{portal:this,credential:d})));a.self.id&&!1===a.self.canSearchPublic&&
(a.extraQuery=" AND orgid:"+a.self.id);f.mixin(this,a.self);this.thumbnailUrl=b.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),f.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var b=new k,c=f.hitch(this,function(){this._onSignIn().then(f.hitch(this,function(){b.resolve(a.loggedInUser)}),
f.hitch(this,function(a){b.reject(a)}))});if(a&&a.self)a&&a.loggedInUser?setTimeout(function(){b.resolve(a.loggedInUser)},0):c();else this.on("load",f.hitch(this,function(){c()}));return b},signOut:function(){a.loggedInUser.credential&&a.loggedInUser.credential.destroy();a.loggedInUser=null;a.options.disableIdentityLookup=!0;b.clearFieldsFromObject(a.self,this);a.self=null;return this.init(this.url)},getPortalUser:function(){return a.loggedInUser},addResource:function(a,c){return b.request(this.portalUrl+
"portals/self/addResource",{key:a,text:c},{usePost:!0})},update:function(a){return b.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,c){return this._queryPortal(this.portalUrl+"community/groups",b.formatQueryParams({},a,c),B)},queryItems:function(a,c){return this._queryPortal(this.portalUrl+"search",b.formatQueryParams({},a,c),v)},queryListings:function(a){a=b.formatQueryParams({},a,!0);var c="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",
""),c="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+c,a,C)},queryCustomerList:function(a,c){a=b.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",a)},getProvisions:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(f.hitch(this,
function(a){return a.trials}))},getCustomers:function(a){return b.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return b.request(this.portalUrl+"portals/self/purchases").then(f.hitch(this,function(a){a.interests=d.map(a.interests,function(a){return f.mixin(a.provision,{listing:a.listing})});
a.purchases=d.map(a.purchases,function(a){return f.mixin(a.provision,{listing:a.listing})});a.trials=d.map(a.trials,function(a){return f.mixin(a.provision,{listing:a.listing})});a.interests=b.resultsToTypedArray(D,{portal:this},a.interests);a.trials=b.resultsToTypedArray(D,{portal:this},a.trials);a.purchases=b.resultsToTypedArray(D,{portal:this},a.purchases);return a}))},queryUsers:function(a,c){return this._queryPortal(this.portalUrl+"community/users",b.formatQueryParams({sortField:"username"},a,
c),z)},_onSignIn:function(){a.options.disableIdentityLookup=!1;a.self=null;return l.id.getCredential(this.portalUrl).then(f.hitch(this,"init",this.url)).then(function(){return a.loggedInUser},f.hitch(this,function(b){a.options.disableIdentityLookup=!0;this.onError(b);throw b;}))},_getSelf:function(c){var d;c+="portals/self";a.self?(d=new k,setTimeout(function(){d.resolve(a.self)},0)):d=b.request(c,{culture:n.locale});return d},_queryPortal:function(a,c,d){var e=f.mixin({num:10,start:0,sortField:"title",
sortOrder:"asc"},c),g=["start","query","num","nextStart"];a=b.request(a,e).then(f.hitch(this,function(a){a.results=b.resultsToTypedArray(d,{portal:this},a);a.queryParams=f.mixin({},e);a.nextQueryParams=f.mixin(e,{start:a.nextStart});return b.clearFieldsFromObject(g,a)}));a=f.delegate(a);a.queryParams=f.mixin({},e);a.nextQueryParams=k.when(a,function(a){return a.nextQueryParams});return h(a)}}),PortalFolder:y,PortalGroup:B,PortalItem:v,PortalUser:z,PortalComment:t,PortalRating:u,PortalUtil:b,PortalResult:h,
PortalListing:C};r("extend-esri")&&f.mixin(f.getObject("arcgis",!0,l),q);return q})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b){var t=0;q=f([n,k,q],{templateString:l,declaredClass:"jimu.dijit.ImageChooser",
cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();e.file.supportHTML5()||g("safari")||!e.file.isEnabledFlash()||e.file.loadFileAPI().then(d.hitch(this,
function(){r.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){r.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&r.addClass(this.displayText,"disable-label");r.removeAttr(this.domNode,"title")},enableChooseImage:function(){r.setStyle(this.fileForm,"display","block");this.label&&"string"===typeof this.label&&r.removeClass(this.displayText,"disable-label");this._addTip()},
setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,r.setStyle(this.hintText,"display","block"));this.showSelfImg&&r.setStyle(this.hintImage,"display","block");!1===this.stretchImg?r.addClass(this.selfImg,
"no-stretch-img"):r.removeClass(this.selfImg,"no-stretch-img");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));r.setAttr(this.fileInput,"accept",a)}e.file.supportHTML5()||g("safari")||!e.file.isEnabledFlash()||r.setStyle(this.fileInput,{width:"100%",height:"100%",
position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_porcessMaskClick:function(){r.setAttr(this.fileInput,"id","imageChooser_"+t);r.setAttr(this.mask,"for","imageChooser_"+t);t++;p.once(this.mask,"click",d.hitch(this,function(a){a.stopPropagation();if(g("safari")&&7>g("safari"))new h({message:this.nls.unsupportReaderAPI}),a.preventDefault();else{if(!e.file.supportHTML5()){if(!e.file.isEnabledFlash()){var b=r.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,
target:"_blank"});new h({message:b});a.preventDefault();return}if(!e.file.supportFileAPI()){new h({message:this.nls.unsupportReaderAPI});a.preventDefault();return}}r.setStyle(this.fileInput,"display","none");setTimeout(d.hitch(this,function(){r.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=m.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);r.setAttr(this.domNode,"title",a)}else r.setAttr(this.domNode,"title",
"")},_onFileInputChange:function(a){var b=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(b.type))new h({message:this.nls.invalidType}),this._initFileForm();else{var c=1024*this.maxSize;e.file.readFile(a,"image/*",c,d.hitch(this,function(a,d,e){a?(d=this.nls[a.errCode],"exceed"===a.errCode&&(d=d.replace("1024",c/1024)),new h({message:d})):(this.fileProperty.fileName=d,this.cropImage&&"image/gif"!==b.type?this._cropImageByUser(e,b.type):this._readFileData(e));
this._initFileForm()}))}},_initFileForm:function(){this.mask&&r.destroy(this.mask);this.fileInput&&r.destroy(this.fileInput);this.fileForm&&r.destroy(this.fileForm);this.fileForm=r.create("form",{"data-dojo-attach-point":"fileForm"},this.domNode);this.mask=r.create("label",{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=r.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();p.once(this.fileInput,"change",d.hitch(this,this._onFileInputChange))},
_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&r.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?r.setAttr(this.selfImg,"src",a):this.selfImg.src=a,(a=r.getMarginBox(this.hintImage))&&a.w&&a.h&&(r.style(this.selfImg,"maxWidth",a.w+"px"),r.style(this.selfImg,"maxHeight",a.h+"px")))},_cropImageByUser:function(e,f){var g=new c({imageSrc:e,type:f,nls:d.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),h=new b({hidden:!0}),
m=new a({titleLabel:this.nls.cropImage,content:g,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:d.hitch(this,function(){h.show();var a=g.getData();this._readFileData(a);m.close();g.destroy();h.hide()})}]});h.placeAt(m.domNode);g.startup();r.addClass(m.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});q.GIF="image/gif";q.JPEG="image/jpeg";
q.PNG="image/png";return q})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on jimu/utils dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html dojo/NodeList-dom".split(" "),function(q,f,n,k,d,r,p,l){var g=window.Cropper;return q([r,p],{templateString:l,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,postCreate:function(){this.type||(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+
"/images/loading.gif";this.own(k(this.baseImage,"load",n.hitch(this,function(){f.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.cropper=new g(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(d){f.setAttr(this.baseImage,"src",d)},getData:function(){return this.cropper.getCroppedCanvas().toDataURL(this.type||"image/jpeg")},destroy:function(){this.cropper&&
this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)}})})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),function(q,f,n,k,d,r,p,l,g,m,e){return q([f,n],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,
color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof p||(this.color=new p(this.color)):this.color=new p("#ccc");d.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){g.close(this.tooltipDialog);this.picker.destroy();
this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(c){var a=this.tooltipDialog.domNode;return c===a||d.isDescendant(c,a)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){g.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();g.close(this.tooltipDialog)},_createTooltipDialog:function(){var c=d.create("div");
this.tooltipDialog=new l({content:c});d.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var a=new m({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:k.hitch(this,function(a){this.ensureMode||(a=new p(a),this.setColor(a))})});a.placeAt(c);a.startup();if(this.ensureMode){var e=d.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},c);this.own(r(e,"click",k.hitch(this,function(){this._hideTooltipDialog()})));
"undefined"===typeof this.showOk&&(e=d.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},c),this.own(r(e,"click",k.hitch(this,function(){var a=this.picker.get("value");this.setColor(new p(a));this._hideTooltipDialog()}))));c=d.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},c);this.own(r(c,"click",k.hitch(this,function(){var a=this.picker.get("value");this.setColor(new p(a))})))}this.own(r(this.domNode,
"click",k.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(r(document.body,"click",k.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=a},setColor:function(c,a){if(c instanceof p){var e=this.color,b="";e&&(b=e.toHex());e=c.toHex();this.color=c;d.setStyle(this.domNode,"backgroundColor",e);if(b!==e&&(this.picker.set("value",e),!1!==a))this.onChange(new p(e))}},
getColor:function(){return this.color},_changeLabel:function(c){d.empty(this.domNode);d.create("span",{innerHTML:c.toHex(),className:"color-label",style:{color:e.invertColor(c.toHex())}},this.domNode)},onChange:function(c){this.showLabel&&this._changeLabel(c)},onClose:function(){},getPopup:function(){return this.tooltipDialog||null},setLabel:function(c){d.empty(this.domNode);d.create("span",{innerHTML:c||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},
"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),function(q,f,n,k,d,r,p,l,g){return f([n,k,q],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",_setPoint:function(f){f&&d.focus(f.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var e=l.getMarginBox(this.cursorNode);e.w&&e.h&&(this._CURSOR_WIDTH=e.w/2,this._CURSOR_HEIGHT=
e.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(e=l.getBorderExtents(f.target||f.srcElement),e.w&&e.h&&(this._BORDER_WIDTH=e.w,this._BORDER_HEIGHT=e.h));var c=e=0;g("ff")||g("ie")||g("MSIE")?(e=f.offsetX,c=f.offsetY):f.offsetX&&f.offsetY&&(e=f.offsetX+this._BORDER_WIDTH,c=f.offsetY+this._BORDER_HEIGHT);f=c-this._CURSOR_HEIGHT;e-=this._CURSOR_WIDTH;this.animatePoint?r.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:e,onEnd:p.hitch(this,function(){this._updateColor(!0);d.focus(this.cursorNode)})}).play():
(l.style(this.cursorNode,{left:e+"px",top:f+"px"}),this._updateColor(!0))},_setHuePoint:function(f){f=f.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?r.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:f,left:0,onEnd:p.hitch(this,function(){this._updateColor(!0);d.focus(this.hueCursorNode)})}).play():(l.style(this.hueCursorNode,"top",f+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z){q.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",u,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:z,postMixInProperties:function(){e.contains(l.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=b.getUniqueId(this.id);n.mixin(this,D.getLocalization("dojox.widget","ColorPicker"));n.mixin(this,D.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>p("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new h.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new h.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(r.subscribe("/dnd/move/stop",n.hitch(this,"_clearTimer"))),this._subs.push(r.subscribe("/dnd/move/start",
n.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,n.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=C.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){if(a.node==this.cursorNode||a.node==this.hueCursorNode)t.focus(a.node),m.setSelectable(this.domNode,!1),this._timer=setInterval(n.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),m.setSelectable(this.domNode,!0))},_setHue:function(a){d.style(this.colorUnderlay,"backgroundColor",C.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,e){if(-1!==a){a=d.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var f=!1;e.charOrCode==c.UP_ARROW?0<a&&(--a,f=!0):e.charOrCode==c.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,f=!0);f&&d.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,e){b=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=d.style(this.cursorNode,"top");var g=d.style(this.cursorNode,"left");a+=b;var g=g+f,h=!1;e.charOrCode==c.UP_ARROW?0<a&&(--a,h=!0):e.charOrCode==c.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,h=!0):e.charOrCode==c.LEFT_ARROW?0<g&&(--g,h=!0):e.charOrCode==c.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,h=!0);h&&(g-=f,d.style(this.cursorNode,"top",a-b+"px"),d.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2,b=d.style(this.hueCursorNode,"top")+b,c=d.style(this.cursorNode,"top")+c,e=d.style(this.cursorNode,"left")+e,b=Math.round(360-b/this.PICKER_HUE_H*360),e=C.fromHsv(b,e/this.PICKER_SAT_VAL_W*100,100-c/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(e);this._updateValue(e,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
C.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=C.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=C.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){a=a.toHex();this.value=this.valueNode.value=a;if(b&&(!this._timer||this.liveUpdate))this.onChange(a)},_updatePickerLocations:function(b){var c=
this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2;b=b.toHsv();c=Math.round(this.PICKER_HUE_H-b.h/360*this.PICKER_HUE_H)-c;f=Math.round(b.s/100*this.PICKER_SAT_VAL_W)-f;e=Math.round(this.PICKER_SAT_VAL_H-b.v/100*this.PICKER_SAT_VAL_H)-e;this.animatePoint?(a.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:c,left:0}).play(),a.slideTo({node:this.cursorNode,duration:this.slideDuration,top:e,left:f}).play()):(d.style(this.hueCursorNode,"top",c+"px"),
d.style(this.cursorNode,{left:f+"px",top:e+"px"}));b.h!=this._hue&&this._setHue(b.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(b){var c=
this.PICKER_HUE_SELECTOR_H/2;b=b.layerY||b.y-b.target.getBoundingClientRect().top;b-=c;this.animatePoint?a.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0,onEnd:n.hitch(this,function(){this._updateColor(!0);t.focus(this.hueCursorNode)})}).play():(d.style(this.hueCursorNode,"top",b+"px"),this._updateColor(!0))},_setPoint:function(b){var c=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2,f=b.layerY||b.y-b.target.getBoundingClientRect().top,f=f-c,c=b.layerX||b.x-
b.target.getBoundingClientRect().left,c=c-e;b&&t.focus(b.target);this.animatePoint?a.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:c,onEnd:n.hitch(this,function(){this._updateColor(!0);t.focus(this.cursorNode)})}).play():(d.style(this.cursorNode,{left:c+"px",top:f+"px"}),this._updateColor(!0))},_handleKey:function(a){},focus:function(){this.focused||t.focus(this.focusNode)},_stopDrag:function(a){g.stop(a)},destroy:function(){this.inherited(arguments);k.forEach(this._subs,function(a){r.unsubscribe(a)});
delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(q){return q})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(q,f,n,k){q=f.getObject("color",!0,q);q.Color=n;q.blend=n.blendColors;q.fromRgb=n.fromRgb;q.fromHex=n.fromHex;q.fromArray=n.fromArray;q.fromString=n.fromString;q.greyscale=k.makeGrey;f.mixin(q,{fromCmy:function(d,k,p){f.isArray(d)?(k=d[1],p=d[2],d=d[0]):f.isObject(d)&&(k=d.m,p=d.y,d=d.c);return new n({r:Math.round(255*
(1-d/100)),g:Math.round(255*(1-k/100)),b:Math.round(255*(1-p/100))})},fromCmyk:function(d,k,p,l){f.isArray(d)?(k=d[1],p=d[2],l=d[3],d=d[0]):f.isObject(d)&&(k=d.m,p=d.y,l=d.b,d=d.c);l/=100;return new n({r:Math.round(255*(1-Math.min(1,d/100*(1-l)+l))),g:Math.round(255*(1-Math.min(1,k/100*(1-l)+l))),b:Math.round(255*(1-Math.min(1,p/100*(1-l)+l)))})},fromHsl:function(d,k,p){f.isArray(d)?(k=d[1],p=d[2],d=d[0]):f.isObject(d)&&(k=d.s,p=d.l,d=d.h);k/=100;for(p/=100;0>d;)d+=360;for(;360<=d;)d-=360;var l,g;
120>d?(l=(120-d)/60,g=d/60,d=0):240>d?(l=0,g=(240-d)/60,d=(d-120)/60):(l=(d-240)/60,g=0,d=(360-d)/60);l=2*k*Math.min(l,1)+(1-k);g=2*k*Math.min(g,1)+(1-k);d=2*k*Math.min(d,1)+(1-k);.5>p?(l*=p,g*=p,d*=p):(l=(1-p)*l+2*p-1,g=(1-p)*g+2*p-1,d=(1-p)*d+2*p-1);return new n({r:Math.round(255*l),g:Math.round(255*g),b:Math.round(255*d)})}});q.fromHsv=function(d,k,p){f.isArray(d)?(k=d[1],p=d[2],d=d[0]):f.isObject(d)&&(k=d.s,p=d.v,d=d.h);360==d&&(d=0);k/=100;p/=100;var l,g,m;if(0==k)g=m=l=p;else{var e=d/60;d=Math.floor(e);
var c=e-d,e=p*(1-k),a=p*(1-k*c);k=p*(1-k*(1-c));switch(d){case 0:l=p;g=k;m=e;break;case 1:l=a;g=p;m=e;break;case 2:l=e;g=p;m=k;break;case 3:l=e;g=a;m=p;break;case 4:l=k;g=e;m=p;break;case 5:l=p,g=e,m=a}}return new n({r:Math.round(255*l),g:Math.round(255*g),b:Math.round(255*m)})};f.extend(n,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var d,f=this.r/255,k=this.g/255,l=this.b/255;d=Math.min(1-f,1-k,1-
l);return{c:Math.round((1-f-d)/(1-d)*100),m:Math.round((1-k-d)/(1-d)*100),y:Math.round((1-l-d)/(1-d)*100),b:Math.round(100*d)}},toHsl:function(){var d=this.r/255,f=this.g/255,k=this.b/255,l=Math.min(d,k,f),g=Math.max(d,f,k),m=g-l,e=0,c=0,l=(l+g)/2;0<l&&1>l&&(c=m/(.5>l?2*l:2-2*l));0<m&&(g==d&&g!=f&&(e+=(f-k)/m),g==f&&g!=k&&(e+=2+(k-d)/m),g==k&&g!=d&&(e+=4+(d-f)/m),e*=60);return{h:e,s:Math.round(100*c),l:Math.round(100*l)}},toHsv:function(){var d=this.r/255,f=this.g/255,k=this.b/255,l=Math.max(d,f,
k),g=l-Math.min(d,k,f),m=null,e=0==l?0:g/l;0==e?m=0:(m=d==l?60*(f-k)/g:f==l?120+60*(k-d)/g:240+60*(d-f)/g,0>m&&(m+=360));return{h:m,s:Math.round(100*e),v:Math.round(100*l)}}});return q})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(q,f,n,k){var d={};f.setObject("dojo.colors",d);var r=function(d,f,m){0>m&&++m;1<m&&--m;var e=6*m;return 1>e?d+(f-d)*e:1>2*m?f:2>3*m?d+(f-d)*(2/3-m)*6:d};q.colorFromRgb=n.fromRgb=function(d,f){var g=d.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(g){d=g[2].split(/\s*,\s*/);var e=d.length,g=g[1];if("rgb"==g&&3==e||"rgba"==g&&4==e)return g=d[0],"%"==g.charAt(g.length-1)?(g=k.map(d,function(a){return 2.56*parseFloat(a)}),4==e&&(g[3]=d[3]),n.fromArray(g,f)):n.fromArray(d,f);if("hsl"==g&&3==e||"hsla"==g&&4==e){var g=(parseFloat(d[0])%360+360)%360/360,c=parseFloat(d[1])/100,a=parseFloat(d[2])/100,c=.5>=a?a*(c+1):a+c-a*c,a=2*a-c,g=[256*r(a,c,g+1/3),256*r(a,c,g),256*r(a,c,g-1/3),1];4==e&&(g[3]=d[3]);return n.fromArray(g,f)}}return null};var p=
function(d,f,m){d=Number(d);return isNaN(d)?m:d<f?f:d>m?m:d};n.prototype.sanitize=function(){this.r=Math.round(p(this.r,0,255));this.g=Math.round(p(this.g,0,255));this.b=Math.round(p(this.b,0,255));this.a=p(this.a,0,1);return this};d.makeGrey=n.makeGrey=function(d,f){return n.fromArray([d,d,d,f])};f.mixin(n.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,
226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,
150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],
navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,
87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return n})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){return q([n,k,d,r],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:p,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var a=f.locale||"",a=a.toLowerCase();"ar"===a?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===a&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){this.opacitySlider.set("value",Math.round(100-100*a))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B){var y=f("dijit.form._SliderMover",e,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=d.position(b.sliderBarContainer,!0),b._setPixelValue_=l.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){e.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,
!0)}});n=f("dijit.form.HorizontalSlider",[C,D],{templateString:B,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:b.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case p.HOME:this._setValueAttr(this.minimum,!1);break;case p.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?p.RIGHT_ARROW:p.LEFT_ARROW:case !1===this._descending?p.DOWN_ARROW:p.UP_ARROW:case !1===this._descending?p.PAGE_DOWN:p.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?p.LEFT_ARROW:p.RIGHT_ARROW:case !1===this._descending?p.UP_ARROW:p.DOWN_ARROW:case !1===this._descending?p.PAGE_UP:p.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(g("ie")||t.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){t.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=d.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(d.style[this._progressPixelSize]),m=this.slideDuration*(c-h/100);0!=m&&(0>m&&(m=0-m),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=k.animateProperty({node:d,duration:m,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=r.getComputedStyle(this.sliderBarContainer),e=d.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=e[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==p.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==p.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(q.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=c('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(h(this.domNode,
a.wheel,l.hitch(this,"_mouseWheeled")));var b=f(y,{widget:this});this._movable=new m(this.sliderHandle,{mover:b});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});n._Mover=y;return n})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(q,f,n,k,d,r){q=q("dijit.form.HorizontalRuleLabels",
r,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,f){f=
this.labels[f];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(f)+this._labelPrefix+f+this._suffix},_genDirectionHTML:function(d){return""},getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=k("\x3e li",this.srcNodeRef).map(function(d){return String(d.innerHTML)}));if(!d.length&&1<this.count)for(var d=[],f=this.minimum,g=(this.maximum-f)/(this.count-1),m=0;m<this.count;m++)d.push(m<this.numericMargin||m>=this.count-this.numericMargin?
"":n.format(f,this.constraints)),f+=g;return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});f("dojo-bidi")&&q.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),k(".dijitRuleLabelContainer",this.domNode).forEach(d.hitch(this,function(d){d.style.direction=this.getTextDir(d.innerText||d.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});
return q})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(q,f,n){return q("dijit.form.HorizontalRule",[f,n],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+
this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var d,n=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(d=1;d<this.count-1;d++)f+=this._genHTML(n*d,d);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(d=1;d<this.count-1;d++)f+=this._genHTML(100-n*d,d);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(q,f,n,k){return q("dijit.form.NumberSpinner",[n,k.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(d,f){var k=this.constraints,l=isNaN(d),g=!isNaN(k.max),m=!isNaN(k.min);l&&0!=f&&(d=0<f?m?k.min:g?k.max:0:g?this.constraints.max:m?k.min:0);f=d+f;if(l||isNaN(f))return d;g&&f>k.max&&(f=k.max);m&&f<k.min&&(f=k.min);return f},_onKeyDown:function(d){if(!(this.disabled||this.readOnly||d.keyCode!=f.HOME&&d.keyCode!=f.END||
d.ctrlKey||d.altKey||d.metaKey||"undefined"==typeof this.get("value"))){var k=this.constraints[d.keyCode==f.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);d.stopPropagation();d.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(q,f,n,k,d,r,p,l,g,m){return q("dijit.form._Spinner",l,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:g,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(d){return d},_arrowPressed:function(d,c,a){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),c*a),!1),m.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(d,c,a){var e=
this.smallDelta;c==this.textbox&&(c=a.keyCode,e=c==f.PAGE_UP||c==f.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==f.UP_ARROW||c==f.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==d?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(d){if(this.focused){d.stopPropagation();d.preventDefault();var c=d.wheelDelta/120;Math.floor(c)!=c&&(c=0<d.wheelDelta?1:-1);d=d.detail?-1*d.detail:c;if(0!==d){var a=this[0<d?"upArrowNode":"downArrowNode"];this._arrowPressed(a,
d,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(a)},50)}}},_setConstraintsAttr:function(d){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(d,
c){this.focusNode.setAttribute("aria-valuenow",d);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(r(this.domNode,d.wheel,n.hitch(this,"_mouseWheeled")),p.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(q,f,n){return q("dijit.form.RangeBoundTextBox",n,{rangeMessage:"",rangeCheck:function(f,d){return("min"in d?0<=this.compare(f,d.min):!0)&&("max"in d?0>=this.compare(f,d.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");if(null==f)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(f,"number"==typeof d&&
0<=d&&0!=f?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(f,"number"!=typeof d||0<d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var d=this.get("value");return null==d||""===d||"number"==typeof d&&isNaN(d)||this.isInRange(f)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(q,f,n,k,d,r){var p=function(d){d=d||{};var f=n.getLocalization("dojo.cldr","number",n.normalizeLocale(d.locale)),e=d.pattern?d.pattern:f[(d.type||"decimal")+
"Format"];d="number"==typeof d.places?d.places:"string"===typeof d.places&&0<d.places.length?d.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:f.decimal,places:d}},l=q("dijit.form.NumberTextBoxMixin",null,{pattern:function(d){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(d,this.editOptions))+"|":"")+this._regExpGenerator(d)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,
_decimalInfo:p(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(d){var f="number"==typeof d.places?d.places:0;f&&f++;"number"!=typeof d.max&&(d.max=9*Math.pow(10,15-f));"number"!=typeof d.min&&(d.min=-9*Math.pow(10,15-f));this.inherited(arguments,[d]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=p(d)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var d=this.get("value");
"number"!=typeof d||isNaN(d)||(d=this.format(d,this.constraints),void 0!==d&&(this.textbox.value=d));this.inherited(arguments)}},format:function(d,m){var e=String(d);if("number"!=typeof d)return e;if(isNaN(d))return"";if(!("rangeCheck"in this&&this.rangeCheck(d,m))&&!1!==m.exponent&&/\de[-+]?\d/i.test(e))return e;this.editOptions&&this.focused&&(m=f.mixin({},m,this.editOptions));return this._formatter(d,m)},_parser:d.parse,parse:function(d,m){var e=f.mixin({},m,this.editOptions&&this.focused?this.editOptions:
{});if(this.focused&&null!=e.places){var c=e.places,c="number"===typeof c?c:Number(c.split(",").pop());e.places="0,"+c}e=this._parser(d,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(d,m));return e},_getDisplayedValueAttr:function(){var d=this.inherited(arguments);return isNaN(d)?this.textbox.value:d},filter:function(f){if(null==f||"string"==typeof f&&""==f)return NaN;"number"!=typeof f||isNaN(f)||0==f||(f=d.round(f,this._decimalInfo.places));return this.inherited(arguments,[f])},serialize:function(d,
f){return"number"!=typeof d||isNaN(d)?"":this.inherited(arguments)},_setBlurValue:function(){var d=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(d,!0)},_setValueAttr:function(d,f,e){if(void 0!==d&&void 0===e)if(e=String(d),"number"==typeof d)if(isNaN(d))e="";else{if("rangeCheck"in this&&this.rangeCheck(d,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else d?d=void 0:(e="",d=NaN);this.inherited(arguments,[d,f,e])},_getValueAttr:function(){var g=
this.inherited(arguments);if(isNaN(g)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+d._realNumberRegexp(f.delegate(this.constraints))+"$")).test(this.textbox.value))return g=Number(this.textbox.value),isNaN(g)?void 0:g}else return g},isValid:function(d){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var f=this.get("value");return!isNaN(f)&&this.rangeCheck(f,this.constraints)?!1!==this.constraints.exponent&&
/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var d="number"==typeof this.constraints.min,f="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!d&&!f)return this.inherited(arguments);var c=e|0,a=0>e,h=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),b=(this.maxLength||20)-this.textbox.value.length,l=h?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",c=h?c+"."+l:c+"",b=k.rep("9",b),h=e;a?h=Number(c+
b):e=Number(c+b);return!(d&&e<this.constraints.min||f&&h>this.constraints.max)}});q=q("dijit.form.NumberTextBox",[r,l],{baseClass:"dijitTextBox dijitNumberTextBox"});q.Mixin=l;return q})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),function(q,f,n,k,d,r,p,l){return q([l],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,
declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(k(this,"Change",n.hitch(this,"_onServiceUrlChange")))},
setProcessFunction:function(d,f){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof d&&(this._fetchHandle=r.after(this,"onFetch",d),this.own(this._fetchHandle));"function"===typeof f&&(this._fetchErrHandle=r.after(this,"onFetchError",f),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),
this._fetchErrHandle=null)},onFetch:function(d){return d},onFetchError:function(d){},getStatus:function(){return this._status},_onServiceUrlChange:function(f){var g=new d;g.then(n.hitch(this,function(){this._valid()}),n.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();f?p({url:n.trim(f||""),handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(d){this.onFetch({url:this.getValue(),data:d})?g.resolve("success"):g.reject("error")}),
n.hitch(this,function(d){g.reject(d)})):g.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},
_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c){return q([f,
n,k],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(e.bindClickAndDblclickEvents(this.tableInBodySection,d.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(a){return r.hasClass(a,"simple-table-row")&&r.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),d.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(a){return r.hasClass(a,"simple-table-row")&&r.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var a=Math.random().toString();this._name="jimu_table_"+a.slice(2,a.length);if(this.fields&&0<this.fields.length){var f=r.create("tr",{},this.thead);p.forEach(this.fields,d.hitch(this,function(a){var b="auto";"actions"===a.type&&(a.name="actions");a.hidden?b=1:void 0!==a.width&&null!==a.width?b=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+20,b=a.width);r.create("col",{width:b},this.headColgroup);
r.create("col",{width:b},this.bodyColgroup);b=r.create("th",{innerHTML:a.title,title:a.title},f);if("checkbox"===a.type){b.innerHTML="";var e=new c({label:a.title}),h=g(".checkbox",e.domNode)[0];h&&(h.style.marginTop="10px");this.own(l(e.domNode,"click",d.hitch(this,function(){e.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));e.placeAt(b)}r.addClass(b,"simple-table-field");a.hidden&&r.addClass(b,"hidden-column");a["class"]&&r.addClass(b,a["class"]);r.addClass(b,
a.name)}))}else this.fields=null},_getThCheckBox:function(a){var c=null;a=g(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return c=m.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=g(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=p.map(a,function(a){return m.byNode(a)});return a=p.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);p.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);p.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(d.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var c=this._getAllEnabledTdCheckBoxes(a),c=p.filter(c,d.hitch(this,function(a){return a.getStatus()}));0!==c.length&&(a=this._getThCheckBox(a),p.every(c,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),c=p.map(a,d.hitch(this,function(a){return this.getRowData(a)}));r.empty(this.tbody);p.forEach(a,d.hitch(this,function(a,d){this._onDeleteRow(a,c[d])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var c=[];this.fields&&a&&0<a.length&&p.forEach(a,d.hitch(this,function(a){c.push(this.addRow(a,-1,!0))}));this.updateUI();return c},addRow:function(a,c,b){this._rowIndex++;var e={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return e;var f=p.filter(this.fields,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=p.filter(f,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<f.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=f,e;var g=r.create("tr",{"class":"simple-table-row not-empty"},this.tbody);r.setAttr(g,"rowId","row"+this._rowIndex);
p.forEach(this.fields,d.hitch(this,function(b){var c=a[b.name],d=b.type,e=null;"actions"===d?e=this._createActionsTd(g,b):("text"===d?e=this._createTextTd(g,b,c):"radio"===d?e=this._createRadioTd(g,b,c):"checkbox"===d?e=this._createCheckboxTd(g,b,c):"empty"===d?e=this._createEmptyTd(g,b):"extension"===d&&(e=this._createExtensionTd(g,b,c)),b.hidden&&r.addClass(e,"hidden-column"))}));b||(this.updateUI(),b=this.getRows(),"number"===typeof c&&0<=c&&c<b.length&&r.place(g,b[c],"before"));e.success=!0;e.tr=
g;e.errorMessage=null;this._onAddRow(g);return e},deleteRow:function(a){if(a){var c=this.getRowData(a);r.destroy(a);this.updateUI();this._onDeleteRow(a,c)}},selectRow:function(a){this.selectable&&(g(".simple-table-row",this.tbody).removeClass("jimu-state-active"),r.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();r.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
r.addClass(this.domNode,this._classVerticalScroll);p.forEach(this.fields,d.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=r.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof a&&0<a&&(c=a+"px");r.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){var a=this.getRows();this.autoHeight&&r.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px");a&&0<a.length&&this.bodyTableDiv&&(a=r.getMarginSize(a[0]))&&a.h&&r.setStyle(this.bodyTableDiv,"backgroundSize","1px "+a.h+"px")},_updateRowClassName:function(){var a=g("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=g("."+this._classRowUpDiv,a)[0])&&r.removeClass(a,this._classJimuStateDisabled);(a=g("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=g("."+this._classRowDownDiv,a)[0])&&r.removeClass(a,this._classJimuStateDisabled);a=g("."+this._classSimpleTableRow,
this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);p.forEach(a,d.hitch(this,function(a,c){0===c%2?r.addClass(a,"odd"):r.addClass(a,"even")}));if(0<a.length){var c=a[0];r.addClass(c,this._classFirstSimpleTableRow);(c=g("."+this._classRowUpDiv,c)[0])&&r.addClass(c,this._classJimuStateDisabled);a=a[a.length-1];r.addClass(a,this._classLastSimpleTableRow);(a=g("."+this._classRowDownDiv,a)[0])&&r.addClass(a,this._classJimuStateDisabled)}},
_createTextTd:function(a,c,b){var d=null;return d=c.editable?this._createEditableTextTd(a,c,b):this._createNormalTextTd(a,c,b)},_createNormalTextTd:function(a,c,b){var d=r.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');r.addClass(d,c.name);var e=g("div",d)[0];e.innerHTML=b||"";e.title=b||"";c["class"]&&r.addClass(d,c["class"]);r.place(d,a);return d},_createEditableTextTd:function(a,c,b){var e=r.toDom('\x3ctd class\x3d"editable-text-td '+
c.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');r.addClass(e,"simple-table-cell");r.place(e,a);c["class"]&&r.addClass(e,c["class"]);var f=g("div",e)[0],h=g("input",e)[0];f.innerHTML=b||"";""!==f.innerHTML&&(f.title=f.innerText||f.innerHTML);h.value=f.innerHTML;this.own(l(f,"dblclick",d.hitch(this,function(a){a.stopPropagation();h.value=f.innerText||f.innerHTML;r.setStyle(f,"display","none");
r.setStyle(h,"display","inline");h.focus();h.select&&h.select()})));this.own(l(h,"blur",d.hitch(this,function(){h.value=d.trim(h.value);var b=f.innerText||f.innerHTML,e=h.value;""!==e?c.unique?0<this.getRowDataArrayByFieldValue(c.name,e,a).length?h.value=b:f.innerHTML=e:f.innerHTML=e:h.value=b;r.setStyle(h,"display","none");r.setStyle(f,"display","block")})));return e},_createRadioTd:function(a,c,b){var d=r.toDom('\x3ctd class\x3d"radio-td '+c.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');
r.addClass(d,"simple-table-cell");r.place(d,a);c["class"]&&r.addClass(d,c["class"]);a=g("input",d)[0];a.name=c.radio&&"row"===c.radio?this._name+this._rowIndex:this._name+c.name;a.checked=!0===b;return d},_createCheckboxTd:function(a,e,b){var f=r.toDom('\x3ctd class\x3d"checkbox-td '+e.name+'"\x3e\x3c/td\x3e');r.addClass(f,"simple-table-cell");r.place(f,a);e["class"]&&r.addClass(f,e["class"]);var g=new c({onChange:d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name);
"function"===typeof e.onChange&&setTimeout(d.hitch(this,function(){e.onChange(a,g)}),200)})});this.own(l(g,"status-change",d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name)})));this._setValueForCheckBox(g,b);g.placeAt(f);return f},_createActionsTd:function(a,c){var b=r.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');r.addClass(b,"simple-table-cell");var e=g(".action-item-parent",b)[0];r.place(b,
a);c["class"]&&r.addClass(b,c["class"]);p.forEach(c.actions,d.hitch(this,function(b){"up"===b?(b=r.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},e),b.title=this.nls.moveUp,this.own(l(b,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=g(".simple-table-row",this.tbody);var c=p.indexOf(b,a);0<c&&(b=b[c-1])&&(r.place(a,b,"before"),this.updateUI(),this.emit("row-up",a))}})))):"down"===b?(b=r.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},
e),b.title=this.nls.moveDown,this.own(l(b,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=g(".simple-table-row",this.tbody);var c=p.indexOf(b,a);c<b.length-1&&(b=b[c+1])&&(r.place(a,b,"after"),this.updateUI(),this.emit("row-down",a))}})))):"edit"===b?(b=r.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},e),b.title=this.nls.edit,this.own(l(b,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&
this._onActionsEdit(a)})))):"delete"===b&&(b=r.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},e),b.title=this.nls.deleteRow,this.own(l(b,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));c=this._calculateActionsWidth(c)+"px";r.setStyle(e,"width",c);return b},_calculateActionsWidth:function(a){return 20*p.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},
_createEmptyTd:function(a,c){a=r.create("td",{"class":c.name},a);r.addClass(a,"simple-table-cell");r.addClass(a,"empty-text-td");c["class"]&&r.addClass(a,c["class"]);return a},_createExtensionTd:function(a,c,b){a=r.create("td",{"class":c.name},a);r.addClass(a,"simple-table-cell");r.addClass(a,"extension-td");c["class"]&&r.addClass(a,c["class"]);c.create&&"function"===typeof c.create&&c.create(a);c.setValue&&"function"===typeof c.setValue&&c.setValue(a,b);return a},editRow:function(a,c){var b={success:!1,
tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof c||!r.isDescendant(a,this.tbody))return b;var e=d.mixin([],this.fields),e=p.filter(e,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=p.filter(e,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,c[b.name],a).length}));if(0<e.length)return b.errorCode=this.REPEATING_ERROR,b.errorMessage="repeating data",b.repeatFields=e,b;var f=g(".simple-table-cell",a);p.forEach(this.fields,
d.hitch(this,function(a,b){if(c.hasOwnProperty(a.name)){b=f[b];var d=c[a.name],e=a.type;"text"===e?a.editable?this._editEditableText(b,a,d):this._editNormalText(b,a,d):"radio"===e?this._editRadio(b,a,d):"checkbox"===e?this._editCheckbox(b,a,d):"extension"===e&&this._editExtension(b,a,d)}}));b.success=!0;b.tr=a;b.errorMessage=null;this._onEditRow(a);return b},_editNormalText:function(a,c,b){a=g("div",a)[0];a.innerHTML=b||"";a.title=a.innerHTML},_editEditableText:function(a,c,b){c=g("div",a)[0];c.innerHTML=
b||"";g("input",a)[0].value=c.innerHTML},_editRadio:function(a,c,b){g("input",a)[0].checked=!0===b},_editCheckbox:function(a,c,b){a=g(".jimu-checkbox",a)[0];a=m.byNode(a);this._setValueForCheckBox(a,b)},_setValueForCheckBox:function(a,c){null===c?a.setStatus(!1):(a.setStatus(!0),c!==a.getValue()&&a.setValue(c))},_editExtension:function(a,c,b){c.setValue&&"function"===typeof c.setValue&&c.setValue(a,b)},_getAllRows:function(){return g(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=
this._getAllRows();return p.filter(a,d.hitch(this,function(a){return!r.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return p.filter(a,d.hitch(this,function(a){return r.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,c=g(".simple-table-row",this.tbody),c=p.filter(c,d.hitch(this,function(a){return!r.hasClass(a,"empty")&&r.hasClass(a,"jimu-state-active")}));0<c.length&&(a=c[0]);return a},getSelectedRowData:function(){var a=
null,c=this.getSelectedRow();c&&(a=this._getRowDataByTr(c));return a},getData:function(a){var c=this._getNotEmptyRows();a&&(c=p.filter(c,d.hitch(this,function(b){return b!==a})));return p.map(c,d.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var c=null;if(a)c={};else return null;p.forEach(this.fields,d.hitch(this,function(b){var d=b.type;if("actions"!==d){var e=b.name;c[e]=null;var f=g(".simple-table-cell."+
e,a)[0];f&&("text"===d?(b=g("div",f)[0],c[e]=b.innerText||b.innerHTML):"radio"===d?(b=g("input",f)[0],c[e]=b.checked):"checkbox"===d?(b=g(".jimu-checkbox",f)[0],b=m.byNode(b),b.getStatus()?c[e]=b.getValue():c[e]=null):"extension"===d&&b.getValue&&"function"===typeof b.getValue&&(c[e]=b.getValue(f,b)))}}));return c},getRowDataArrayByFieldValue:function(a,c,b){var e=[];if(!this.fields||!p.some(this.fields,d.hitch(this,function(b){return b.name===a})))return[];b=this.getData(b);return e=p.filter(b,d.hitch(this,
function(b){return b[a]==c}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&r.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,c){this.emit("row-delete",a,c)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",
a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(q,f,n,k,d,r,p,l,g,m){return q([p,l,r],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",
templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new g(null,this.containerNode);var d=1/this.tabs.length*100;this.isNested&&k.addClass(this.domNode,"nested");n.forEach(this.tabs,function(c){this._createTab(c,d)},this)}},startup:function(){this.selected?
this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);m.setVerticalCenter(this.domNode)},_createTab:function(e,c){c=k.create("div",{innerHTML:e.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":c+"%"},label:e.title},this.controlNode);this.viewStack.viewType=e.content.domNode?"dijit":"dom";e.content.label=e.title;this.viewStack.addView(e.content);this.own(d(c,"click",f.hitch(this,this.onSelect,e.title)));c.label=e.title;this.controlNodes.push(c)},
onSelect:function(d){this.selectTab(d)},selectTab:function(d){this._selectControl(d);this.viewStack.switchView(d);this.emit("tabChanged",d)},_selectControl:function(d){n.forEach(this.controlNodes,function(c){k.removeClass(c,"jimu-state-selected");c.label===d&&k.addClass(c,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(q,f,n,k,d){return q(d,{baseClass:"jimu-viewstack",
declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);k.forEach(this.views,f.hitch(this,function(d){1===d.nodeType?(n.place(d,this.domNode),n.addClass(d,"view"),n.setStyle(d,"display","none")):d.domNode&&(n.place(d.domNode,this.domNode),n.addClass(d.domNode,"view"),n.setStyle(d.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},
getSelectedLabel:function(){var d="",f=this.getSelectedView();f&&(d=f.label);return d},getViewByLabel:function(d){for(var f=0;f<this.views.length;f++)if(d===this.views[f].label)return this.views[f];return null},addView:function(d){this.views.push(d);1===d.nodeType?(n.place(d,this.domNode),n.addClass(d,"view")):d.domNode&&(n.place(d.domNode,this.domNode),n.addClass(d.domNode,"view"))},removeView:function(d){var f=this.views.length;this.views=k.filter(this.views,function(f){return d!==f});f!==this.views.length&&
(1===d.nodeType?n.destroy(d):d.domNode&&d.destroyRecursive())},switchView:function(d){var k,l;k="number"===typeof d?this.views[d]:"string"===typeof d?this.getViewByLabel(d):d;this.views.forEach(f.hitch(this,function(d){if(d)if(1===d.nodeType?l=d:d.domNode&&(l=d.domNode),d===k){if(n.setStyle(l,"display","block"),d.domNode)if(!d._started)d.startup(),d._started=!0;else if("function"===typeof d.onShown)d.onShown()}else if(n.setStyle(l,"display","none"),d.domNode&&"function"===typeof d.onHidden)d.onHidden()}));
this._currentView=k;this.onViewSwitch(k)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(q,f,n,k,d,r,p,l,g,m,e){return q([l,g,r],{templateString:m,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,selected:"",tabs:null,
average:!0,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(c){var a=p("td",this.tabTr);n.forEach(a,f.hitch(this,function(a,b){k.removeClass(a,"jimu-state-active");a.label===c&&(k.addClass(a,"jimu-state-active"),this._currentIndex=b)}));this.controlNode.removeChild(this.controlTable);k.place(this.controlTable,this.controlNode);this.viewStack.switchView(c);this.emit("tabChanged",
c)},addTab:function(c){if(!this.average){var a=p("td:last-child",this.tabTr);0<a.length&&k.destroy(a[0])}0<n.filter(this.tabs,function(a){return a.title===c.title}).length?console.error("tab title conflict: "+c.title):(this.tabs.push(c),this._createTab(c),this.average||(a=k.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),k.place(a,this.tabTr)))},removeTab:function(c){var a=-1;if(n.some(this.tabs,function(b,
d){if(b.title===c)return a=d,!0})){var d=this.tabs.splice(a,1)[0],b=p("td",this.tabTr),e;n.some(b,function(a){if(a.label===c)return e=a,!0})&&k.destroy(e);this.viewStack.removeView(d.content)}},showShelter:function(){k.setStyle(this.shelter,"display","block")},hideShelter:function(){k.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new e(null,this.containerNode);
n.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed",k.addClass(this.domNode,"average");else{var c=k.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');k.place(c,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(c){var a=k.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
a.label=c.title||"";k.place(a,this.tabTr);var e=p(".tab-item-div",a)[0];e.innerHTML=a.label;e.label=a.label;c.content.label=a.label;this.viewStack.addView(c.content);this.own(d(a,"click",f.hitch(this,this._onSelect,c.title)))},_onSelect:function(c){this.selectTab(c)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(q,f,n,k){return q([k],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(d){this._placeItem(d)}));this.resize()},_placeItem:function(d){d.domNode?n.place(d.domNode,this.domNode):n.place(d,this.domNode)},addItem:function(d){this.items.push(d);this._placeItem(d);this.resize()},addItems:function(d){this.items=this.items.concat(d);this.items.forEach(f.hitch(this,function(d){this._placeItem(d)}));this.resize()},removeItem:function(d){var f;
for(f=0;f<this.items.length;f++)if(this.items[f].label===d){this.items[f].domNode?this.items[f].destroy():n.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var d;for(d=0;d<this.items.length;d++)this.items[d].domNode?this.items[d].destroy():n.destroy(this.items[d]);this.items=[]},resize:function(){var d,k,p;d=n.getMarginBox(this.domNode);k=this.getItemSize(d);p=Math.floor((d.w+this.hmargin)/(k.width+this.hmargin));this.items.forEach(f.hitch(this,function(d,f){this.setItemPosition(d,
f,k,p)}))},getItemSize:function(d){var f={},k;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(k=0;k<this.itemSize.length;k++){if(d.w<=this.itemSize[k].screenWidth){f.width=this.itemSize[k].width;f.height=this.itemSize[k].height;break}}else"fixCols"===this.strategy&&(f.width=(d.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return f},setItemPosition:function(d,f,k,l){f++;var g=f%l;f=Math.ceil(f/l);0===g&&(g=l);l={position:"absolute",top:(this.vmargin+k.height)*(f-1)+"px"};l[window.isRTL?"right":"left"]=(this.hmargin+k.width)*(g-1)+"px";0<=k.width&&(l.width=k.width+"px");0<=k.height&&(l.height=k.height+"px");n.setStyle(d.domNode?d.domNode:d,l)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){var u={};return q([f,n,k,e],{templateString:d,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var b={};this.drawLayerId&&(b.id=this.drawLayerId);this.drawLayer=new a(b);this._initDefaultSymbols();this._initTypes();b=m(".draw-item",this.domNode);this.own(b.on("click",r.hitch(this,this._onItemClick)));this.own(g(this.btnClear,"click",r.hitch(this,this._onClickClear)));this.own(g(document.body,"keydown",r.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(g(document.body,"keyup",r.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);p.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();u[this.id]=this},enable:function(){this._isDisabled=!1;p.addClass(this.domNode,"enabled");p.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;p.addClass(this.domNode,"disabled");p.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=m(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete u[this.id];this.inherited(arguments)},
setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new h(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(g(this.drawToolBar,"draw-end",r.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},
setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();m(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var b=null,c=m(".draw-item",this.domNode);"TEXT"===a?(a=
"POINT",b=this.textIcon):(c=c.filter(function(b){return b.getAttribute("data-geotype")===a}),0<c.length&&(b=c[0]));b&&this._activate(b)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c,d,e,f){this.emit("draw-end",a,b,c,d,e,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&
0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){p.removeClass(this.domNode,"hidden")},hide:function(){p.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return m(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},c={style:"esriSLSSolid",
color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},d={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=b.fromJson(a));this.polylineSymbol||(this.polylineSymbol=b.fromJson(c));this.polygonSymbol||(this.polygonSymbol=b.fromJson(d))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=
["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var a=m(".draw-item",this.domNode);a.style("display","none");
l.forEach(a,r.hitch(this,function(a){var b=a.getAttribute("data-geotype"),b=0<=l.indexOf(this.geoTypes,b);p.setStyle(a,"display",b?"block":"none")}))},_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,p.hasClass(a,"draw-item")&&(p.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){this._deactiveAllDrawBoxes();m(".draw-item",this.domNode).removeClass("jimu-state-active");p.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),
c=a.getAttribute("data-commontype"),d=h[b];"TEXT"===b&&(d=h.POINT);this.disableWebMapPopup();this.drawToolBar.activate(d);this.emit("draw-activate",d);this.onIconSelected(a,b,c)},_onDrawEnd:function(a){var b=m(".draw-item.jimu-state-active",this.domNode)[0],d=b.getAttribute("data-geotype"),b=b.getAttribute("data-commontype"),e=null,e="extent"===a.geometry.type?t.fromExtent(a.geometry):a.geometry;e.geoType=d;e.commonType=b;a=e.type;var f=null,f="point"===a||"multipoint"===a?p.hasClass(this.textIcon,
"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,e=new c(e,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(e);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(e,d,b,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var a;l.forEach(Object.keys(u),r.hitch(this,function(b){(a=u[b])&&a.drawToolBar&&b!==this.id&&a.deactivate()}))}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F){var E=q(b,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,b){this.markerSymbol=new t(t.STYLE_SOLID,10,new u(u.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,.25]));this.lineSymbol=new u(u.STYLE_SOLID,new d([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new u(u.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,.25]));this._points=[];this._mouse=!p("esri-touch")&&!p("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),b||{});if(l("ios")||l("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=k.connect,e=E;this._options=f.mixin(f.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.TRIANGLE:case e.CIRCLE:case e.ELLIPSE:case e.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&!p("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case e.LINE:case e.EXTENT:case e.FREEHAND_POLYLINE:case e.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&!p("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POLYLINE:case e.POLYGON:case e.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=k.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case E.CIRCLE:case E.ELLIPSE:case E.TRIANGLE:case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.RECTANGLE:case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case E.POLYLINE:case E.POLYGON:case E.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=E,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new y(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new z(c);b=[].concat(b,[b[0].offset(0,0)]);z.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new w(c),n.forEach(b,function(b){a.addPoint(b)})}k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=B.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=D.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;return{x:Math.min(d,
e),y:Math.max(a,b),width:Math.abs(d-e),height:Math.abs(a-b),spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=E;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new C(new y({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new y(e);c.addPath(this._points);this._graphic=b.graphics.add(new C(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new z(e),c.addRing(this._points),this._graphic=b.graphics.add(new C(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}p("esri-touch")&&a.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case E.POLYLINE:case E.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||
this._points.length)if(p("esri-touch")&&!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,e=this.map,g=e.spatialReference;b=this._graphic;var h=E,m=e.toScreen(c),l=e.toScreen(d),k=[],k=l.x-m.x,l=l.y-m.y,n=Math.sqrt(k*k+l*l);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();b.geometry=z.createCircle({center:m,r:n,numberOfPoints:60,map:e});b.setGeometry(b.geometry);
break;case h.ELLIPSE:this._hideTooltip();b.geometry=z.createEllipse({center:m,longAxis:k,shortAxis:l,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case h.TRIANGLE:this._hideTooltip();k=[[0,-n],[.8660254037844386*n,.5*n],[-.8660254037844386*n,.5*n],[0,-n]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.ARROW:this._hideTooltip();c=l/n;e=k/n;d=.25*e*n;g=.25*n/(l/k);n*=.25*c;k=[[k,l],[k-d*(1+24/g),l+24*e-n],[k-d*(1+12/g),l+12*e-n],[-12*c,12*e],[12*c,-12*e],[k-
d*(1-12/g),l-12*e-n],[k-d*(1-24/g),l-24*e-n],[k,l]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.LEFT_ARROW:this._hideTooltip();k=0>=k?[[k,0],[.75*k,l],[.75*k,.5*l],[0,.5*l],[0,-.5*l],[.75*k,-.5*l],[.75*k,-l],[k,0]]:[[0,0],[.25*k,l],[.25*k,.5*l],[k,.5*l],[k,-.5*l],[.25*k,-.5*l],[.25*k,-l],[0,0]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();k=0<=k?[[k,0],[.75*k,l],[.75*k,.5*l],[0,.5*l],[0,-.5*l],[.75*k,
-.5*l],[.75*k,-l],[k,0]]:[[0,0],[.25*k,l],[.25*k,.5*l],[k,.5*l],[k,-.5*l],[.25*k,-.5*l],[.25*k,-l],[0,0]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.UP_ARROW:this._hideTooltip();k=0>=l?[[0,l],[-k,.75*l],[-.5*k,.75*l],[-.5*k,0],[.5*k,0],[.5*k,.75*l],[k,.75*l],[0,l]]:[[0,0],[-k,.25*l],[-.5*k,.25*l],[-.5*k,l],[.5*k,l],[.5*k,.25*l],[k,.25*l],[0,0]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.DOWN_ARROW:this._hideTooltip();k=0<=l?[[0,l],
[-k,.75*l],[-.5*k,.75*l],[-.5*k,0],[.5*k,0],[.5*k,.75*l],[k,.75*l],[0,l]]:[[0,0],[-k,.25*l],[-.5*k,.25*l],[-.5*k,l],[.5*k,l],[.5*k,.25*l],[k,.25*l],[0,0]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.RECTANGLE:this._hideTooltip();k=[[0,0],[k,0],[k,l],[0,l],[0,0]];b.geometry=this._toPolygon(k,m.x,m.y);b.setGeometry(b.geometry);break;case h.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case h.EXTENT:b&&e.graphics.remove(b,!0);b=new A(this._normalizeRect(c,
d,g));b._originOnly=!0;this._graphic=e.graphics.add(new C(b,this.fillSymbol),!0);e.snappingManager&&e.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){p("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){p("esri-touch")&&a.preventDefault();
return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}p("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&
this._graphic){0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,e=E,f;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:f=this._graphic.geometry;break;case e.LINE:f=new y({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});
break;case e.EXTENT:f=(new A(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:f=new y(d);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:f=new z(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),z.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),f.addRing(c)}p("esri-touch")&&a.preventDefault();
this._clear();this._drawEnd(f)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=E;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this.onDrawStart();this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new y(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new C(c,this.lineSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=k.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new C(new y({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0),this.onDrawStart()):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?(c=new z(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new C(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=k.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new C(new y({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0),this.onDrawStart()):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new w(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new C(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(z.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(z.createEllipse({center:c,longAxis:48,
shortAxis:24,numberOfPoints:60,map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new z(d.spatialReference);e.addRing(n.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=E;p("esri-touch")&&c.push(a.mapPoint);var f=c[c.length-1],g=
c[c.length-2],c=f&&g&&f.x===g.x&&f.y===g.y?c.slice(0,c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length){k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new y(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new z(d);a=[].concat(c,[c[0].offset(0,0)]);z.prototype.isClockwise(a)||
this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new w(d),n.forEach(c,function(a){b.addPoint(a)})}k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===g.ESCAPE&&(k.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},
_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||(this._tooltip=m.create("div",{"class":"esriMapTooltip"},this.map.container),c.isBodyLtr()||e.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=k.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=k.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=
k.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(k.disconnect(this._onTooltipMouseEnterHandler_connect),k.disconnect(this._onTooltipMouseLeaveHandler_connect),k.disconnect(this._onTooltipMouseMoveHandler_connect),m.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case E.POINT:c=F.toolbars.draw.addPoint;break;case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.TRIANGLE:case E.RECTANGLE:case E.CIRCLE:case E.ELLIPSE:c=
F.toolbars.draw.addShape;break;case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:c=F.toolbars.draw.freehand;break;case E.POLYLINE:case E.POLYGON:c=F.toolbars.draw.start;1===a?c=F.toolbars.draw.resume:2<=a&&(c=F.toolbars.draw.complete);break;case E.MULTI_POINT:c=F.toolbars.draw.addMultipoint,1<=a&&(c=F.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+r.body().scrollLeft-
r.body().clientLeft,a=a.clientY+r.body().scrollTop-r.body().clientTop);b.style.display="none";e.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});f.mixin(E,{POINT:"point",MULTI_POINT:"multipoint",
LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});p("extend-esri")&&f.setObject("toolbars.Draw",E,a);return E})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],
function(q,f,n,k,d){q=q([d],{declaredClass:"esri.toolbars._Toolbar",constructor:function(d){this.map=d},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(d,f,k,g){var m=this.map;d&&(this._mapNavState={isDoubleClickZoom:m.isDoubleClickZoom,isClickRecenter:m.isClickRecenter,isPan:m.isPan,isRubberBandZoom:m.isRubberBandZoom,
isKeyboardNavigation:m.isKeyboardNavigation,isScrollWheelZoom:m.isScrollWheelZoom},m.disableDoubleClickZoom(),m.disableClickRecenter(),m.disablePan(),m.disableRubberBandZoom(),m.disableKeyboardNavigation());f&&m.hideZoomSlider();k&&m.hidePanArrows();g&&m.graphics.disableMouseEvents()},_activateMapTools:function(d,f,k,g){var m=this.map,e=this._mapNavState;d&&e&&(e.isDoubleClickZoom&&m.enableDoubleClickZoom(),e.isClickRecenter&&m.enableClickRecenter(),e.isPan&&m.enablePan(),e.isRubberBandZoom&&m.enableRubberBandZoom(),
e.isKeyboardNavigation&&m.enableKeyboardNavigation(),e.isScrollWheelZoom&&m.enableScrollWheelZoom());f&&m.showZoomSlider();k&&m.showPanArrows();g&&m.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var d=this.map;this._scrollWheelState={isScrollWheelZoom:d.isScrollWheelZoom,isScrollWheelPan:d.isScrollWheelPan};d.disableScrollWheelZoom();d.disableScrollWheelPan()},_activateScrollWheel:function(){var d=this.map,f=this._scrollWheelState;f&&(f.isScrollWheelZoom&&d.enableScrollWheelZoom(),
f.isScrollWheelPan&&d.enableScrollWheelPan())}});n("extend-esri")&&f.setObject("toolbars._Toolbar",q,k);return q})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(q,f,n,k){return q([n],{declaredClass:"jimu.dijit.URLInput",required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?
this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(d){if(!1===this.required&&""===d)return!0;if(isFinite(d))return!1;var f="^"+k.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=new RegExp(f,"g");f.lastIndex=0;f=f.test(d);return this.rest?(d=/\/rest\/services/gi.test(d),f&&d):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(q,f,n){var k=
q.getObject("validate.regexp",!0,n);return k=n.validate.regexp={ipAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowDottedDecimal&&(d.allowDottedDecimal=!0);"boolean"!=typeof d.allowDottedHex&&(d.allowDottedHex=!0);"boolean"!=typeof d.allowDottedOctal&&(d.allowDottedOctal=!0);"boolean"!=typeof d.allowDecimal&&(d.allowDecimal=!0);"boolean"!=typeof d.allowHex&&(d.allowHex=!0);"boolean"!=typeof d.allowIPv6&&(d.allowIPv6=!0);"boolean"!=typeof d.allowHybrid&&(d.allowHybrid=!0);var f=
[];d.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");d.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");d.allowDottedOctal&&f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");d.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");d.allowHex&&
f.push("0[xX]0*[\\da-fA-F]{1,8}");d.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");d.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");d="";0<f.length&&(d="("+f.join("|")+")");return d},host:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowIP&&(d.allowIP=!0);"boolean"!=typeof d.allowLocal&&(d.allowLocal=!1);"boolean"!=typeof d.allowPort&&(d.allowPort=!0);"boolean"!=typeof d.allowNamed&&
(d.allowNamed=!1);var f=d.allowPort?"(\\:\\d+)?":"",n="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";d.allowIP&&(n+="|"+k.ipAddress(d));d.allowLocal&&(n+="|localhost");d.allowNamed&&(n+="|^[^-][a-zA-Z0-9_-]*");return"("+n+")"+f},url:function(d){d="object"==typeof d?d:{};"scheme"in d||(d.scheme=[!0,!1]);return f.buildGroupRE(d.scheme,function(d){return d?"(https?|ftps?)\\://":""})+k.host(d)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},
emailAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowCruft&&(d.allowCruft=!1);d.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+k.host(d);d.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(d){d="object"==typeof d?d:{};"string"!=typeof d.listSeparator&&(d.listSeparator="\\s;,");var f=k.emailAddress(d);return"("+f+"\\s*["+d.listSeparator+"]\\s*)*"+f+"\\s*["+d.listSeparator+"]?\\s*"},numberFormat:function(d){d=
"object"==typeof d?d:{};"undefined"==typeof d.format&&(d.format="###-###-####");return f.buildGroupRE(d.format,function(d){return f.escapeString(d,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowTerritories&&(d.allowTerritories=!0);"boolean"!=typeof d.allowMilitary&&(d.allowMilitary=!0);
var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";d.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");d.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){return f([n,d,k,q],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);
this.value=this.value?new g(this.value):new g("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",!1)},_createContent:function(){this.appearance=r.mixin(this._defaultAppearance,this.appearance);var a=p.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=p.create("div",{"class":"init-panel"},a);this.customPanel=p.create("div",{"class":"custom-panel hide"},a);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&
this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(a){this._isColorEqual(a)||(this.value=new g(a),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new g("transparent"),!1),this.picker.setColor(new g("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),
!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(a){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==a&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){h.close(this.tooltipDialog);
this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(a){a=p.create("div",{"class":"special-color"},a);this.transparentBtn=p.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(l(this.transparentBtn,t,r.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new g("transparent"));
this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=m(".btn-wapper",this.transparentBtn)[0];p.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&p.addClass(b,"selected")}},_createColorChooser:function(a){this.colorChooser=new e({});this.colorChooser.placeAt(a);this.own(l(this.colorChooser,"change",r.hitch(this,function(a){a=new g(a);this.setColor(a);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=p.create("div",{"class":"coustom btn",
innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(l(this.coustomtBtn,"click",r.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new c({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);
this.own(l(this.picker,"ok",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor();this._addAColorRecord(a);this._toggleCustomColorPicker("init");this._closeDialog()})));this.own(l(this.picker,"apply",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor(!1);this._addAColorRecord(a)})));this.own(l(this.picker,"cancel",r.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(a,b){"custom"===a?(p.removeClass(this.customPanel,
"hide"),p.addClass(this.initPanel,"hide")):(p.addClass(this.customPanel,"hide"),p.removeClass(this.initPanel,"hide"));"undefined"!==typeof b&&!1===b||this.emit("change-style")},_createCoustomRecord:function(b){this.colorRecords=new a({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(b);this.own(l(this.colorRecords,"choose",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor()})))},_addAColorRecord:function(a){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(a)},
_isColorEqual:function(a){return this.value.toString()===(new g(a)).toString()?!0:!1},_changeLabel:function(a){p.empty(this.domNode);p.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:b.invertColor(a.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){return f([n,k,d,q],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=m.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var a=0;a<this._row;a++)for(var d=p.create("tr",{role:"row"},this.gridNode),b=0;b<this._col;b++){var f=this.colorsArray[a][b],g=e.named[f],m="";g?m=f:"rgb(0,0,1)"===
f&&(m="black",g="rgb(0,0,1)");f=this.colorTitleNls[m];g=(new e(g)).toString();this["record"+b]=p.create("td",{"class":"dijitPaletteCell","data-title":g,role:"gridcell"},d);var k=p.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);p.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:f,title:f,"data-title":m,width:"16px",height:"16px",style:"background-color: "+g},k)}this.own(l(this.gridNode,c,r.hitch(this,this.onColorClick)))},onColorClick:function(a){for(var c=
a.target;"TD"!==c.tagName;){if(!c.parentNode||c===this.gridNode)return;c=c.parentNode}c=p.getAttr(c,"data-title");c=(new e(c)).toString();this.setColor(c);a.stopPropagation();a.preventDefault()},_onChange:function(a){this.emit("change",a)},setColor:function(a,c){a=new e(a);for(var b=null,d=g("td",this.domNode),f=0,h=d.length;f<h;f++)p.removeClass(d[f],"dijitPaletteCellSelected");f=0;for(h=d.length;f<h;f++)if(a.toString()===p.getAttr(d[f],"data-title")){b=d[f];break}b&&p.addClass(b,"dijitPaletteCellSelected");
(b&&"undefined"===typeof c||!0===c)&&this._onChange(a)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(q,f,n,k,d,r,p,l,g){return f([n,k,q],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");r.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(d){d&&d.stopPropagation&&d.preventDefault&&(d.stopPropagation(),d.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(d){d&&d.stopPropagation&&d.preventDefault&&(d.stopPropagation(),d.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(d){d&&d.stopPropagation&&d.preventDefault&&(d.stopPropagation(),d.preventDefault());this.emit("cancel")},_createDialog:function(){var f=r.create("div",{"class":"dojox-color-picker-container"},this.domNode),e=new g({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:d.hitch(this,function(a){a=
new l(a);this.setColor(a)})});e.placeAt(f);e.startup();f=r.create("div",{"class":"btns-container jimu-float-trailing"},f);if(!0===this.showOk){var c=r.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},f);this.own(p(c,"click",d.hitch(this,function(a){var c=this.picker.get("value");this.setColor(new l(c));this._handlerOk(a)})))}!0===this.showApply&&(c=r.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
f),this.own(p(c,"click",d.hitch(this,function(a){var c=this.picker.get("value");this.setColor(new l(c));this._handlerApply(a)}))));f=r.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},f);this.own(p(f,"click",d.hitch(this,function(a){this._handlerCancel(a)})));this.picker=e},setColor:function(d){if(d instanceof l){var e=this.color,c="";e&&(c=e.toHex());e=d.toHex();this.color=d;c!==e&&this.picker.set("value",e)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a){return f([n,k,d,q],{templateString:c,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new m(a);for(var b=null,c=g("td",this.domNode),d=0,e=c.length;d<e;d++)p.removeClass(c[d],"dijitPaletteCellSelected");d=0;for(e=c.length;d<e;d++)if(a.toString()===p.getAttr(c[d],"title")){b=c[d];
break}b&&(p.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var c=this.colorList[a].toString();p.setAttr(b,"title",c);b=this._findImg(b);p.setStyle(b,"background-color",c);p.setAttr(b,"alt",c);p.setAttr(b,"title",c)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var c=0;c<this.recordsLength;c++){this["record"+
c]=p.create("td",{"class":"dijitPaletteCell",tabindex:c,title:"",role:"gridcell"},this.container);var b=p.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+c]);p.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},b)}this.own(l(this.gridNode,a,r.hitch(this,this.onRecordClick)))},onRecordClick:function(a){for(var b=a.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=p.getAttr(b,
"title");b=(new m(b)).toString();this.onChoose(b);a.stopPropagation();a.preventDefault()},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=g(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],c=0,d=this.recordsLength;c<d;c++){var f=this.colorList[c];f&&f.toString&&(b[c]=f.toString())}this._cleanCookie(a);try{var g=JSON.stringify(b);e(a,g,{expires:1E3,path:"/"})}catch(D){console.error("ColorRecords: cookieList JSON.stringify error."+
D.stack)}},_getCookie:function(a){a=e(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var c=this.recordsLength;a<c;a++){var d=b[a];d&&d.toString&&(this.colorList[a]=new m(d.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+v.stack)}},_cleanCookie:function(a){e(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(q,f,n,k,d,r,p,l,g){return q([p,r],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(d){d.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(d){d.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(n.removeClass(this.foldableNode,"fold-up"),n.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(n.removeClass(this.foldableNode,"fold-down"),n.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(d){this.panelManager.closePanel(this);d.stopPropagation();"touchstart"===d.type&&d.preventDefault()},_normalizePositionObj:function(d){var e=
this._getLayoutBox();d.left=isFinite(d.left)?d.left:e.w-d.right;d.top=isFinite(d.top)?d.top:e.h-d.bottom;delete d.right;delete d.bottom;this.position=f.mixin(f.clone(this.position),d)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new g({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(g,e){this.disableMoveable();var c=n.getMarginBox(jimuConfig.layoutId);c.l=c.l-g+e;c.w+=2*(g-e);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode,within:!0});this.own(k(this.moveable,
"Moving",f.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&this._setMobilePosition();this.inherited(arguments)},_switchToMobileUI:function(){n.removeClass(this.titleNode,"title-normal");n.addClass(this.titleNode,
"title-full");n.setStyle(this.foldableNode,"display","block");n.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(n.removeClass(this.foldableNode,"fold-up"),n.addClass(this.foldableNode,"fold-down")):(n.removeClass(this.foldableNode,"fold-down"),n.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){n.removeClass(this.titleNode,"title-full");n.addClass(this.titleNode,"title-normal");n.setStyle(this.foldableNode,"display","none");n.setStyle(this.maxNode,"display",
"none")},resize:function(d){var e=this._getPositionInfo(),c={left:e.position.left,top:e.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};d&&(d.t=this.domNode.offsetTop,c.left=isFinite(d.l)?d.l:c.left,c.top=isFinite(d.t)?d.t:c.top,c.width=isFinite(d.w)?d.w:c.width,c.height=isFinite(d.h)?d.h:c.height,this._normalizePositionObj(f.clone(c)),this.makePositionInfoBox(),c.width=this._positionInfoBox.w,c.height=this._positionInfoBox.h);e.position=c;this._onResponsible(e);this.inherited(arguments)},
_onResponsible:function(d){d.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(d.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(d){this._normalizePositionObj(d);this.makePositionInfoBox();d=this._getPositionInfo();this._onResponsible(d)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var d=
jimuConfig.layoutId,d="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return n.getMarginBox(d)},_getPositionInfo:function(){var d={isRunInMobile:!1,position:{left:0,top:5}},e=this._getLayoutBox(),c=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return d.isRunInMobile=!0,d;window.isRTL?(d.position.left=e.w-c,d.position.left+this._positionInfoBox.w>e.w&&(d.position.left-=this._positionInfoBox.w,0>d.position.left&&(d.position.left=e.w-this._positionInfoBox.w))):(d.position.left=
c,d.position.left+this._positionInfoBox.w>e.w&&(d.position.left=e.w>this._positionInfoBox.w?e.w-this._positionInfoBox.w:0));c=this._positionInfoBox.t;e=e.h-c;c>=e?c>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):e>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t+40+3);return d},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==n.byId(jimuConfig.layoutId)&&n.place(this.domNode,jimuConfig.layoutId);
var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var e=l.getPositionStyle(d);f.mixin(e,d.borderRadiusStyle);n.setStyle(this.domNode,e)},_setDesktopPosition:function(d){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==n.byId(jimuConfig.mapId)&&n.place(this.domNode,jimuConfig.mapId);n.setStyle(this.domNode,{left:d.left+"px",right:"auto",top:d.top+"px",width:(d.width||this.position.width||this._originalBox.w)+"px",height:(d.height||
this.position.height||this._originalBox.h)+"px"})},onMoving:function(d){n.setStyle(d.node,"opacity",.9)},onMoveStop:function(d){n.setStyle(d.node,"opacity",1);d=n.getMarginBox(d.node);this._normalizePositionObj(f.clone({left:d.l,top:d.t,width:d.w,height:d.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u){q.experimental("dojox.layout.ResizeHandle");var v=a("dojox.layout._ResizeHelper",t,{show:function(){c.set(this.domNode,"display","")},hide:function(){c.set(this.domNode,"display","none")},resize:function(a){e.setMarginBox(this.domNode,a)}});return a("dojox.layout.ResizeHandle",[t,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,h.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=b.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(p.body()),
m.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(m.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(n.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=b.byId(this.targetId))?this.targetWidget.domNode:g.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var f=e.position(this.targetDomNode,!0);this._resizeHelper.resize({l:f.x,t:f.y,w:f.w,h:f.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:f.x,t:f.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var f=c.getComputedStyle(this.targetDomNode),k="border-model"===e.boxModel?{w:0,h:0}:e.getPadBorderExtents(this.targetDomNode,f),m=e.getMarginExtents(this.targetDomNode,f);this.startSize={w:c.get(this.targetDomNode,"width",f),h:c.get(this.targetDomNode,"height",f),pbw:k.w,pbh:k.h,mw:m.w,mh:m.h};this.isLeftToRight()||"absolute"!=c.get(this.targetDomNode,"position")||(f=e.position(this.targetDomNode,!0),this.startPosition={l:f.x,t:f.y});this._pconnects=[n.connect(p.doc,h.move,this,"_updateSizing"),
n.connect(p.doc,h.release,this,"_endSizing")];d.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(w){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var b=this.targetWidget&&f.isFunction(this.targetWidget.resize),d=this._getNewCoords(a,b&&"margin");if(!1!==d&&(b?this.targetWidget.resize(d):this.animateSizing?l[this.animateMethod]([r.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),r.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():c.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){k.forEach(this._pconnects,n.disconnect);var b=f.partial(n.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),
function(q,f,n,k,d,r){return q(r,{constructor:function(d,f,g,k){this.noLegend=k},_initVisible:function(){var d=!1,f=this.originOperLayer.mapService;this.originOperLayer.mapService&&f.layerInfo._subLayerVisible[f.subId]&&(d=!0);this._visible=d},_setTopLayerVisible:function(d){var f;if(this.originOperLayer.mapService&&(f=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){f.layerInfo._subLayerVisible[f.subId]=d?!0:!1;this._visible=d;var g={};this.traversal(function(d){0===d.getSubLayers().length&&
(g[d.originOperLayer.mapService.subId]=d.isVisbleOrInvisilbe())});f.layerInfo._setSubLayerVisible(g)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(d){},_sevVisible:function(d){this.visible=d},obtainNewSubLayers:function(){var d=[];f.forEach(this.originOperLayer.subLayers,function(f){f.parentLayerInfo=this;f=this._layerInfoFactory.create(f);d.push(f);f.init()},this);return d},getOpacity:function(){},setOpacity:function(d){},getLayerObject:function(){var f=new k;this.layerObject.empty?
d({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(n.hitch(this,function(d){var g=this.layerObject.url;this.layerObject=d;this.layerObject.url=g;this.layerObject.id=this.id;f.resolve(this.layerObject)}),function(d){f.reject(d)}):f.resolve(this.layerObject);return f},getLayerType:function(){var d=new k;d.resolve("GroupLayer");return d},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
getScaleRange:function(){var d=this.originOperLayer.mapService;return(d=d.layerInfo._getJsapiLayerInfoById(d.subId))&&0<=d.minScale&&0<=d.maxScale?{minScale:d.minScale,maxScale:d.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet ./LoadingIndicator".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D){return n([k,d,r,l,f],{templateString:p,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;this.nls.apply=
window.jimuNls.common.apply;this.layerInfosObj=m.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip)},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():
this._setMobileMode())},setMode:function(a){"desktop"===a?this._setDesktopMode():"mobile"===a&&this._setMobileMode()},_setMode:function(a){this.mode=a;this._setModeClass(this.mode)},_setModeClass:function(a){h.removeClass(this.domNode,"desktop-mode");h.removeClass(this.domNode,"mobile-mode");h.addClass(this.desktopAddSection,"hidden");h.addClass(this.mobileAddSection,"hidden");a&&h.addClass(this.domNode,a+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");
h.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");h.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new u;if(this.isBuilding())b.reject("Filter is already building.");
else{this._def=null;this.reset();this.url=a.url;this.isHosted=g.isHostedService(this.url);this._layerDefinition=a.layerDefinition;if(this.featureLayerId=a.featureLayerId)if(b=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo())this._popupFieldsInfo=b.fieldInfos;a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr"));b=this._def}return b},buildByExpr:function(a,b,c){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");
return this.build({url:a,expr:b,layerDefinition:c,featureLayerId:this.featureLayerId})},buildByFilterObj:function(a,b,c){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:a,partsObj:b,layerDefinition:c,featureLayerId:this.featureLayerId})},_updatePartsObj:function(c){b.forEach(c,a.hitch(this,function(c){c.parts?b.forEach(c.parts,a.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade=
"previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):c.interactiveObj&&!0===c.interactiveObj.cascade?c.interactiveObj.cascade="previous":!1===c.interactiveObj.cascade&&(c.interactiveObj.cascade="none")}));return c},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(b,c){var d=new u;c?d.resolve(c):(this.loading.show(),v({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),
d.resolve(a)):d.reject()}),a.hitch(this,function(a){console.error(a);d.reject();this.domNode&&this.loading.hide()})));return d},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(c){var d=new u;if(!this._isString(this.url))return d.reject(),d;var f=a.hitch(this,function(){setTimeout(a.hitch(this,function(){this.emit("change");d.resolve()}),1500)}),g=a.hitch(this,function(){h.addClass(this.errorSection,"hidden");this.removeAllFilters();this.featureLayerId&&this._tryOverrideFieldAliases(this.featureLayerId,
this._layerDefinition);var g=this._layerDefinition.fields;g&&0<g.length?(g=b.filter(g,a.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<g.length?(this._validOptions=!0,h.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),h.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),h.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),h.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),this.valueProviderFactory=new e({url:this.url,
layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===c?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?f():d.reject()):d.reject():"partsObj"===c?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):d.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):this._isString(this.expr)?this._parseExpr(this.expr)?f():d.reject():(this.removeAllFilters(),
f())):(this._showErrorOptions(this.nls.error.noFilterFields),d.reject()):d.reject()});this._validateLayerDefinition(this._layerDefinition)?g():(this.loading.show(),v({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,g()):d.reject()}),a.hitch(this,function(a){console.error(a);d.reject();this.domNode&&this.loading.hide()})));return d},_tryOverrideFieldAliases:function(c,d){if(c=this.layerInfosObj.getLayerOrTableInfoById(c))if(c=
c.getPopupInfo())if(c=c.fieldInfos,d=d.fields,c&&0<c.length&&d&&0<d.length){var e={};b.forEach(c,a.hitch(this,function(a){a.fieldName&&(e[a.fieldName]=a)}));b.forEach(d,a.hitch(this,function(a){var b=e[a.name];b&&b.label&&(a.alias=b.label)}))}},toJson:function(){var c={logicalOperator:this.allAnySelect.value,parts:[]},d=this._getAllSingleFiltersAndFilterSets();if(0===d.length)return c.expr="1\x3d1",c;b.forEach(d,a.hitch(this,function(a){a=a.toJson();c.parts.push(a)}));return b.every(c.parts,a.hitch(this,
function(a){return!!a}))&&0<c.parts.length?(c.expr=this.getExprByFilterObj(c),c):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var b=a.clone(this._layerDefinition).fields;0===this.setFieldsStoreByFieldInfos(b)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();
var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(z){b=null,console.error(z)}b?this._buildEditUIByPartsObj(b):this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(c){c&&(this._destroyAllFilters(),b.forEach(c.parts,
a.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})),this.allAnySelect.value=c.logicalOperator,this._setFilterMsgUI(c.parts.length))},_addSingleFilter:function(b){b={url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,
isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};b=new C(b);b.placeAt(this.allExpsBox);b.startup();this.own(t.after(b,"_destroySelf",a.hitch(this,function(){this._checkFilterNumbers();this.emit("change")})));this.own(q(b,"change",a.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_addFilterSet:function(b){b={url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,
numberFieldTypes:this._numberFieldTypes,partsObj:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};b=new D(b);b.placeAt(this.allExpsBox);b.startup();this.own(t.after(b,"_destroySelf",a.hitch(this,function(){this._checkFilterNumbers();this.emit("change")})));this.own(q(b,"change",a.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_destroyAllFilters:function(){for(var a=
this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var c=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&b.forEach(this.allExpsBox.childNodes,a.hitch(this,function(a){(h.hasClass(a,"jimu-single-filter")||h.hasClass(a,"jimu-filter-set"))&&c.push(a)}));return c},_getAllSingleFiltersAndFilterSets:function(){var d=this._getAllSingleFiltersAndFilterSetsDoms();return b.map(d,a.hitch(this,
function(a){return c.byNode(a)}))},_setFilterMsgUI:function(a){2>a?(this.allAnySelect.value="AND",h.setStyle(this.allAnySelect,"display","none"),h.setStyle(this.oneOrZeroMsg,"display","block")):(h.setStyle(this.oneOrZeroMsg,"display","none"),h.setStyle(this.allAnySelect,"display","block"))},_checkFilterNumbers:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(a.length);0<a.length?h.addClass(this.noFilterTipSection,"hidden"):h.removeClass(this.noFilterTipSection,"hidden");
this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);h.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){var a={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},
stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",
supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",
supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,
filterCodedValueIfPossible:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",
supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},h=n([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(a){q.mixin(this,a);this.nls=window.jimuNls.filterBuilder;a=c.getInstanceSync();this.featureLayerId&&(this.layerInfo=a.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(b,c){var d=[];if(c=a[c])c.value&&d.push("value"),c.field&&0<this._getSameShortTypeFieldNames(b).length&&
d.push("field"),c.unique&&this.url&&(this._isStreamServer(this.url)||10.1<=parseFloat(this.layerDefinition.currentVersion)&&d.push("unique"));return d},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(a){var b=[],c=this._getFieldInfo(this.layerDefinition,a),d=h.getShortTypeByEsriType(c.type);f.forEach(this.layerDefinition.fields,q.hitch(this,function(c){c.name!==a&&h.getShortTypeByEsriType(c.type)===d&&b.push(c.name)}));
return b},getValueProvider:function(b,c){var h=null,n=q.clone(a[b.operator]);if(n){var t=b.valueObj.type,D=b.fieldObj.name,B=this._getFieldInfo(this.layerDefinition,D),y=n[t],z=y.normalProviderType,w=null,A=e.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,D);"field"===t?(t=this._getSameShortTypeFieldNames(D),0<t.length&&(w=f.map(t,q.hitch(this,function(a){return{value:a,label:a}})))):A&&0<A.length&&y.codedValueProviderType&&(z=y.codedValueProviderType);b={nls:this.nls,url:this.url,
layerDefinition:this.layerDefinition,partObj:b,fieldInfo:B,codedValues:A,staticValues:w,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:n,filterCodedValueIfPossible:!!y.filterCodedValueIfPossible,runtime:c};"BLANK_VALUE_PROVIDER"===z?h=new k(b):"SIMPLE_VALUE_PROVIDER"===z?h=new d(b):"TWO_NUMBERS_VALUE_PROVIDER"===z?h=new r(b):"TWO_DATES_VALUE_PROVIDER"===z?h=new p(b):"LIST_VALUE_PROVIDER"===z?(b.showNullValues=!1,h=new l(b)):"NUMBER_LIST_VALUE_PROVIDER"===z?h=new g(b):"DATE_IS_IN_VALUE_PROVIDER"===
z&&(h=new m(b))}return h},_getFieldInfo:function(a,c){a=a.fields;for(var b=0;b<a.length;b++){var d=a[b];if(c===d.name)return d}return null}});h.getOperatorInfo=function(b){return q.clone(a[b])};h.getOperatorsByShortType=function(a,c){var b=[];"string"===a?b="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===a?b="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsLessThan numberOperatorIsAtMost numberOperatorIsGreaterThan numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===a&&(b="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),c&&b.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return b};h.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return h})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(q,f,n){return f([n],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),function(q,f,n,k,d,r,p,l,g,m){return r([p,l,f],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,
cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&
this.filterCodedValueIfPossible&&g.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&d.some(this.popupInfo.fieldInfos,n.hitch(this,function(d){return d.fieldName===this.fieldName?(this.fieldPopupInfo=d,!0):!1}))},getDijits:function(){return[]},bindChangeEvents:function(){var e=this.getDijits();d.forEach(e,n.hitch(this,function(c){c.declaredClass&&
0===c.declaredClass.indexOf("dijit.")&&k.addClass(c.domNode,c.declaredClass.replace(/\./g,"-"));this.own(q(c,"change",n.hitch(this,this._onChanged)));this.own(q(c,"enter",n.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");setTimeout(n.hitch(this,function(){this._onEnterTriggered=!1}),100)},tryLocaleNumber:function(d){var c=g.localizeNumber(d);if(null===c||void 0===
c)c=d;return c},getPartObject:function(){var d=this.getValueObject();if(!d)return null;var c=n.clone(this.partObj);c.valueObj=d;return c},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var e=1,c=this.getDijits();0<c.length&&(e=d.map(c,n.hitch(this,function(a){return"function"===typeof a.getStatus?a.getStatus():this.getStatusForDijit(a)})),e=Math.min.apply(e,e));return e},getStatusForDijit:function(d){return d.validate()?
d.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var d="1\x3d1",d=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var c=this.getCascadeFilterExpr(),d="("+d+") AND ("+c+")";return d},getLayerFilterExpr:function(){var d="1\x3d1";this.layerInfo&&(d=this.layerInfo.getFilter());
d||(d="1\x3d1");return d},_getWebMapFilterExpr:function(){var d="";this.layerInfo&&(d=this.layerInfo.getFilterOfWebmap());d||(d="1\x3d1");return d},getDropdownFilterExpr:function(){var d="1\x3d1",d=this._getWebMapFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var c=this.getCascadeFilterExpr(),d="("+d+") AND ("+c+")";return d},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var d={parts:[]};if("all"===this.cascade||"previous"===this.cascade)d=this.getCascadeFilterPartsObj();
return d},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(d,c,a,f){var b=g.getFieldInfoByFieldName(d.fields,c),e=d.typeIdField,h=null;a=a.parts;for(var k in a){var m=a[k];if(m.fieldObj.name===e){e=m.valueObj.value;h=g._getCodedValueBySubTypeId(d,c,e,b);break}}var l;h||(h=f?f:g._getAllCodedValue(d,b));h&&0<h.length&&(l=h[0].value);return{selectedValue:l,valueLabels:h}},isDefined:function(d){return m.isDefined(d)},disable:function(){this._enabled=!1},enable:function(){this._enabled=
!0},isEnabled:function(){return this._enabled}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/on ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),function(q,f,n,k,d,r,p){return f([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-simple-value-provider");"string"===this.shortType?(this._dijit=new d({required:!1,
trim:!0,intermediateChanges:!1}),this._dijit.startup(),this._dijit.on("keydown",function(d){13===(d.keyCode||d.which)&&(this._dijit.textbox.blur(),this._dijit.emit("enter"))}.bind(this))):"number"===this.shortType?(this._dijit=new r({required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}}),this._dijit.startup(),this._dijit.on("keydown",function(d){13===(d.keyCode||d.which)&&(this._dijit.textbox.blur(),this._dijit.emit("enter"))}.bind(this))):this._dijit=new p({popupInfo:this.popupInfo,
_fieldInfo:this.fieldInfo});q.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},getDijits:function(){return[this._dijit]},setValueObject:function(d){this.isDefined(d.value)&&("date"===this.shortType?this._dijit.setValueObject(d):this._dijit.set("value",d.value))},getValueObject:function(){if(this.isValidValue())if("date"===this.shortType){var d=this._dijit.getValueObject();if(d&&d.value)return d.isValid=!0,d.type=this.partObj.valueObj.type,d}else return d=this._dijit.get("value"),
"number"===this.shortType&&(d=parseFloat(d)),{isValid:!0,type:this.partObj.valueObj.type,value:d};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(d){this._dijit.set("required",d)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./DateValueSelector.html jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a){return p([l,g,m,f],{templateString:e,virtualDates:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,"jimu-date-value-selector");this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[c.VIRTUAL_DATE_TODAY,c.VIRTUAL_DATE_YESTERDAY,c.VIRTUAL_DATE_TOMORROW]);this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});this.dateTypeSelect.addOption({value:"custom",
label:this.nls.custom});r.map(this.virtualDates,d.hitch(this,function(a){var b={value:a,label:a};switch(a){case c.VIRTUAL_DATE_TODAY:b.label=this.nls.today;break;case c.VIRTUAL_DATE_YESTERDAY:b.label=this.nls.yesterday;break;case c.VIRTUAL_DATE_TOMORROW:b.label=this.nls.tomorrow}this.dateTypeSelect.addOption(b)}));this._showDateTypeSelect();this.own(n(k.byId("main-page"),"click",d.hitch(this,function(){this.dateTextBox&&this.dateTextBox.closeDropDown()})));this.own(q.before(this.dateTypeSelect,"openDropDown",
d.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(q.after(this.dateTypeSelect,"closeDropDown",d.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(q.after(this.dateTypeSelect.dropDown,"onItemClick",d.hitch(this,
function(a,b){a&&"custom"===a.option.value&&this._showDateTextBox()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(d.hitch(this,function(a){return a.fieldName===this._fieldInfo.name}))[0])},getDijits:function(){return[]},setValueObject:function(a){a.virtualDate&&"custom"!==a.virtualDate?this.dateTypeSelect.set("value",a.virtualDate,!1):(this.dateTypeSelect.set("value","custom",!1),a.value&&(this.dateTextBox.set("value",new Date(a.value),!1),this.dateTypeSelect.textDirNode.innerText=
this._formatDate(new Date(a.value))))},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var a={value:null,virtualDate:""},b=this.dateTypeSelect.get("value"),d=null;"custom"===b?(d=this.dateTextBox.get("value"),a.value=d?d.toDateString():null,a.virtualDate=""):(d=c.getRealDateByVirtualDate(b),a.virtualDate=b,d?a.value=d.toDateString():a=null);return a},setRequired:function(a){this.dateTextBox.set("required",
a)},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this._getStatusForDijit(this.dateTextBox):""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_showDateTypeSelect:function(){this.dateTextBox.closeDropDown()},_showDateTextBox:function(){this.dateTextBox.openDropDown();
this.dateTextBoxClickBinded=!0},_onDateTypeSelectChanged:function(){"custom"===this.dateTypeSelect.get("value")&&this._showDateTextBox();this.emit("change")},_onDateTextBoxChanged:function(a){this.dateTypeSelect.textDirNode.innerText=this._formatDate(a);this.emit("change")},_formatDate:function(c){return this.fieldInfo?a.localizeDateByFieldInfo(c,this.fieldInfo):c.toDateString()}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(q,f,
n){return q("dijit.form.DateTextBox",n,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:f,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(q,f,n,k,d,r,p,l,g,m,
e,c,a,h,b,t,u){var v=k("dijit.Calendar",[a,h,b],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){l.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:m.hitch(this,
"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,"keydown",m.hitch(this,"_onKeyDown")),e(this.dateRowsNode,"mouseover",m.hitch(this,"_onDayMouseOver")),e(this.dateRowsNode,"mouseout",m.hitch(this,"_onDayMouseOut")),e(this.dateRowsNode,"mousedown",m.hitch(this,"_onDayMouseDown")),e(this.dateRowsNode,"mouseup",m.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=new this.dateClassObj(this.currentFocus);
b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=r.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!r.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(r.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||a.relatedTarget&&
a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",r.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),r.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!r.contains(a,"dijitCalendarDisabledDate")&&(r.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&r.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,c,d=this.currentFocus;switch(a.keyCode){case g.RIGHT_ARROW:b=1;case g.LEFT_ARROW:c="day";this.isLeftToRight()||(b*=-1);break;case g.DOWN_ARROW:b=1;case g.UP_ARROW:c="week";break;case g.PAGE_DOWN:b=1;case g.PAGE_UP:c=a.ctrlKey||a.altKey?"year":"month";break;case g.END:d=this.dateModule.add(d,"month",1),c="day";case g.HOME:d=new this.dateClassObj(d);d.setDate(1);break;default:return!0}c&&(d=this.dateModule.add(d,c,b));this._setCurrentFocusAttr(d);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=k("dijit.Calendar._MonthDropDownButton",u,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
b);this.containerNode.innerHTML=(6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=k("dijit.Calendar._MonthDropDown",[h,t,b],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";q.forEach(a,function(a,b){p.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(d.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){var u=f("dijit.CalendarLite",[h,b],{templateString:t,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=r.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),c=this.dateModule.getDaysInMonth(a),e=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),f=new this.dateClassObj,h=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);h>
b&&(h-=7);if(!this.summary){var k=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",k[a.getMonth()])}this._date2cell={};q.forEach(this.dateCells,function(k,m){var l=m+h,n=new this.dateClassObj(a),p="dijitCalendar",t=0;l<b?(l=e-b+l+1,t=-1,p+="Previous"):l>=b+c?(l=l-b-c+1,t=1,p+="Next"):(l=l-b+1,p+="Current");t&&(n=this.dateModule.add(n,"month",t));n.setDate(l);this.dateModule.compare(n,f,"date")||(p="dijitCalendarCurrentDate "+p);this.isDisabledDate(n,
this.lang)?(p="dijitCalendarDisabledDate "+p,k.setAttribute("aria-disabled","true")):(p="dijitCalendarEnabledDate "+p,k.removeAttribute("aria-disabled"),k.setAttribute("aria-selected","false"));(t=this.getClassForDate(n,this.lang))&&(p=t+" "+p);k.className=p+"Month dijitCalendarDateTemplate";p=n.valueOf();this._date2cell[p]=k;k.dijitDateValue=p;p=n.getDateLocalized?n.getDateLocalized(this.lang):n.getDate();this._setText(this.dateLabels[m],p);g.set(k,"aria-label",d.format(n,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;q.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?m.getObject(a.datePackage,
!1):k;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?m.getObject(a.datePackage+".locale",!1):d},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var b=this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),d=0<=this.dayOffset?this.dayOffset:n.getFirstDayOfWeek(this.lang);this.dayCellsHtml=a.substitute([b,
b,b,b,b,b,b].join(""),{d:""},function(){return c[d++%7]});b=a.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[b,b,b,b,b,b].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);p.setSelectable(this.domNode,!1);b=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",b,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=m.hitch(this,function(a,
b,c){this[a].dojoClick=!0;return e(this[a],"click",m.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,b){var d=this.currentFocus,e=this._getNodeByDate(d);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(d,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));a=this._getNodeByDate(a);a.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&a.focus();e&&e!=a&&(c("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!l.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){l.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}q.forEach(this._selectedCells||[],m.partial(b,!1));this._selectedCells=q.filter(q.map(a,this._getNodeByDate,this),function(a){return a});q.forEach(this._selectedCells,m.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
u._MonthWidget=f("dijit.CalendarLite._MonthWidget",h,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),d=6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+q.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=d+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(q,f,n,k,d,r,p,l){new Date("X");return k("dijit.form._DateTimeTextBox",[r,p],{templateString:l,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:f.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(d,f){var e=this._isInvalidDate(d),c=this._isInvalidDate(f);if(e||c)return e&&c?0:e?-1:1;d=this.format(d,this._unboundedConstraints);f=this.format(f,this._unboundedConstraints);
e=this.parse(d,this._unboundedConstraints);c=this.parse(f,this._unboundedConstraints);return d==f?0:q.compare(e,c,this._selector)},autoWidth:!0,format:function(d,f){return d?this.dateLocaleModule.format(d,f):""},parse:function(d,f){return this.dateLocaleModule.parse(d,f)||(this._isEmpty(d)?null:void 0)},serialize:function(d,f){d.toGregorian&&(d=d.toGregorian());return n.toISOString(d,f)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(g){g=
g||{};this.dateModule=g.datePackage?d.getObject(g.datePackage,!1):q;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=g.datePackage?d.getObject(g.datePackage+".locale",!1):f;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(f){f.selector=this._selector;f.fullYear=!0;var g=n.fromISOString;"string"==typeof f.min&&(f.min=g(f.min),this.dateClassObj instanceof Date||(f.min=new this.dateClassObj(f.min)));"string"==typeof f.max&&(f.max=g(f.max),this.dateClassObj instanceof Date||(f.max=new this.dateClassObj(f.max)));this.inherited(arguments);this._unboundedConstraints=d.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(d){return!d||
isNaN(d)||"object"!=typeof d||d.toString()==this._invalidDate},_setValueAttr:function(d,f,e){void 0!==d&&("string"==typeof d&&(d=n.fromISOString(d)),this._isInvalidDate(d)&&(d=null),d instanceof Date&&!(this.dateClassObj instanceof Date)&&(d=new this.dateClassObj(d)));this.inherited(arguments,[d,f,e]);this.value instanceof Date&&(this.filterString="");!1!==f&&this.dropDown&&this.dropDown.set("value",d,!1)},_set:function(d,f){if("value"==d){f instanceof Date&&!(this.dateClassObj instanceof Date)&&
(f=new this.dateClassObj(f));var e=this._get("value");if(e instanceof this.dateClassObj&&0==this.compare(f,e))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(d){this._isInvalidDate(d)&&(d=new this.dateClassObj);this._set("dropDownDefaultValue",d)},openDropDown:function(f){this.dropDown&&this.dropDown.destroy();var g=d.isString(this.popupClass)?d.getObject(this.popupClass,!1):this.popupClass,e=this,c=this.get("value");this.dropDown=new g({onChange:function(a){e.set("value",
a,!0)},id:this.id+"_popup",dir:e.dir,lang:e.lang,value:c,textDir:e.textDir,currentFocus:this._isInvalidDate(c)?this.dropDownDefaultValue:c,constraints:e.constraints,filterString:e.filterString,datePackage:e.datePackage,isDisabledDate:function(a){return!e.rangeCheck(a,e.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(d,f){this._setValueAttr(this.parse(d,this.constraints),f,d)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox".split(" "),
function(q,f,n,k,d,r){return f([n,k,d],{templateString:r,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-two-numbers-filter-value-provider")},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var d=parseFloat(this._dijit1.get("value")),f=parseFloat(this._dijit2.get("value"));d>f&&(this._dijit1.set("value",f),this._dijit2.set("value",d))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(d){this.isDefined(d.value1)&&
this._dijit1.set("value",d.value1);this.isDefined(d.value2)&&this._dijit2.set("value",d.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var d={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(d.value1)&&(d.value1=null);isNaN(d.value2)&&(d.value2=null);return d}return null},setRequired:function(d){this._dijit1.set("required",d);this._dijit2.set("required",d)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html".split(" "),function(q,f,n,k,d,r,p){return n([k,d,q],{templateString:p,postCreate:function(){this.inherited(arguments);
f.addClass(this.domNode,"jimu-two-dates-filter-value-provider");this._dijit1=new r({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv1);this._dijit2=new r({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv2)},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(d){this._setValueObject(this._dijit1,d,"value1",
"virtualDate1");this._setValueObject(this._dijit2,d,"value2","virtualDate2")},_setValueObject:function(d,f,k,e){if(this.isDefined(f[k])){var c={value:null,virtualDate:""};c.value=f[k];c.virtualDate=f[e];d.setValueObject(c)}},getValueObject:function(){if(this.isValidValue()){var d=this._dijit1.getValueObject(),f=this._dijit2.getValueObject();if(d.value&&f.value)return{isValid:!0,type:this.partObj.valueObj.type,value1:d.value,value2:f.value,virtualDate1:d.virtualDate,virtualDate2:f.virtualDate}}return null},
tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(d){this._dijit1.set("required",d);this._dijit2.set("required",d)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListValueProvider.html dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c){return r([p,l,g],{templateString:m,codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,"jimu-filter-list-value-provider");this._uniqueValueCache={};var a=new e({idProperty:"id",data:[]});this.valuesSelect.set("store",a);if(!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(q.before(this.valuesSelect,
"_onDropDownMouseDown",n.hitch(this,this._onBeforeDropDownMouseDown))),this.layerInfo))this.layerInfo.layerObject.on("edits-complete",n.hitch(this,function(){this.layerDataChanged=!0}))},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var a=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,a,this.codedValues)},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);
return arguments},getDijits:function(){return[this.valuesSelect]},setValueObject:function(a){return this.staticValues?this._setValueForStaticValues(a.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(a.value,!1):this._setValueForStaticValues(a.value,this.codedValues):this._tryUpdatingUniqueValues(a.value,!1)},getValueObject:function(){if(this.isValidValue()){var a=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},
tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(a){this.valuesSelect.set("required",a)},_setValueForStaticValues:function(a,c){var b=null,e=-1,b=null;c&&(b=d.map(c,n.hitch(this,function(b,c){b={id:c,value:b.value,label:b.label};b.value===a&&(e=c);return b})),this.valuesSelect.store.setData(b),0<=e&&(b=this.valuesSelect.store.get(e))&&this.valuesSelect.set("item",
b))},_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(a,c){var b=new f;if(this.valuesSelect._opened)b.resolve();else{var d=this.getDropdownFilterExpr();d!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=d,this._uniqueValueLoadingDef=this._getUniqueValues(d),this._uniqueValueLoadingDef.then(n.hitch(this,
function(d){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(a,d),this._hideLoadingIcon(),c&&this.valuesSelect.toggleDropDown(),b.resolve())}),n.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),b.reject(a))}))):b.resolve()}return b},_setValueForUniqueValues:function(a,c){c.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||
(c=d.filter(c,n.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===a){var b=this.getValueObject();b&&(a=b.value)}var e=-1,b=null;c=d.map(c,n.hitch(this,function(b,c){var d={id:c,value:b.value,label:b.label};b.value===a&&(e=c);return d}));this.valuesSelect.store.setData(c);0<=e&&(b=this.valuesSelect.store.get(e));this.valuesSelect.set("item",b)},_showLoadingIcon:function(){k.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){k.removeClass(this.valuesSelect.domNode,
"loading")},_getUniqueValues:function(a){var d=new f;this._uniqueValueCache[a]&&!this.layerDataChanged?d.resolve(this._uniqueValueCache[a]):(this._showLoadingIcon(),c.getUniqueValues(this.url,this.fieldName,a,this.layerDefinition,this.fieldPopupInfo).then(n.hitch(this,function(b){this.domNode&&(this._uniqueValueCache[a]=b,d.resolve(b),this._hideLoadingIcon())}),n.hitch(this,function(a){this.domNode&&(d.reject(a),this._hideLoadingIcon())})));this.layerDataChanged=!1;return d}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(q,f,n,k,d,r,p,l){return k([d,r,p],{templateString:l,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());n.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),q.hitch(this,function(d){this.rangeSelect.addOption({value:d,label:this.nls[d]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(d){this.isDefined(d.value)&&this._dijit1.set("value",d.value);this.isDefined(d.range)&&this.rangeSelect.set("value",d.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var d=this.rangeSelect.get("value");"none"===d&&(d=null);return d},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var d={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(d.value)&&(d.value=null);return d}return null},setRequired:function(d){this._dijit1.set("required",d);this.rangeSelect.set("required",d)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(q,f,n,k,d,r,p,l){return k([p,d,q],{templateString:r,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(n.hitch(this,function(d){this.dateTypeSelect.addOption({value:d,label:this.nls[d]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(d,f,e,c){if(this.isDefined(f[e])){var a={value:null,virtualDate:""};a.value=f[e];a.virtualDate=f[c];d.setValueObject(a)}},setValueObject:function(d){this.dateTypeSelect.set("value",d.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var d={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},f=this.dateTypeSelect.get("value"),
e=l.getRealDateByVirtualDate(f);d.virtualDate=f;e&&(d.value1=e[0].toDateString(),d.value2=e[1].toDateString());return d},setRequired:function(d){this.dateTypeSelect.set("required",d)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){return f([n,k,d,q],{templateString:r,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);
this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(m(document,"click",p.hitch(this,function(){l.setStyle(this.valueTypePopupNode,"display","none")})))},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},c=this._getFieldObjByUI();if(!c)return null;a.fieldObj=c;c=this._getOperatorByUI();if(!c)return null;a.operator=c;
a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();if(c=this._isUseAskForValues()){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;a.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};"unique"===this._getValueTypeByUI()&&(a.interactiveObj.cascade=this.cascadeSelect.get("value"))}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();
if(!c)return null;c.type=this._getValueTypeByUI();a.valueObj=c;return a},_getFieldObjByUI:function(){var b=this._getSelectedFilteringItem(this.fieldsSelect);if(!b)return null;var c="";0!==this.popupFieldsInfo.length&&(c=a.getDateFieldFormatByFieldName(this.popupFieldsInfo,b.name));return{name:b.name,label:b.name,dateFormat:c,shortType:b.shortType,type:b.type}},_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){l.setStyle(this.btnDelete,
"display","inline-block")},hideDeleteIcon:function(){l.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.layerInfo=
p.mixin({},this.layerInfo);this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(m(this.fieldsSelect,"MouseEnter",p.hitch(this,this._updateFieldsSelectTitle)));this.own(m(this.operatorsSelect,"MouseEnter",p.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?(l.setStyle(this.cbxAskValues.domNode,"display","inline-block"),l.setStyle(this.promptSection,"display","block"),
this.own(m(this.cbxAskValues,"status-change",p.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=p.hitch(this,this._onCbxAskValuesClicked)):(l.setStyle(this.cbxAskValues.domNode,"display","none"),l.setStyle(this.promptSection,"display","none"));var a=this.layerInfo.fields;a&&0<a.length&&(a=g.filter(a,p.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),0<a.length&&(this._enableAllValueTypeOptions(),this._initFieldsSelect(a),this.part?this._showPart(this.part):
this._resetByFieldAndOperator(),setTimeout(p.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=m(this.fieldsSelect,"change",p.hitch(this,this._onFieldsSelectChange));this._handle2=m(this.operatorsSelect,"change",p.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();
this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,c){return this._isStreamServer(a)?!1:10.1<=parseFloat(c.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title=
"";var a=this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label)},_showValidationErrorTip:function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(t){console.error(t)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===this.stringFieldType?"string":a===this.dateFieldType?
"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(a){a=g.map(a,p.hitch(this,function(a,b){var c=p.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);a="";"string"===c.shortType?a=this.nls.string:"number"===c.shortType?a=this.nls.number:"date"===c.shortType&&(a=this.nls.date);c.displayName=c.alias+" ("+a+")";return c}));if(0<a.length){var b=new c({data:a});this.fieldsSelect.set("store",b);this.fieldsSelect.set("value",a[0].id)}this._updateOperatorsByFieldsSelect()},
_showPart:function(a){if((this.part=a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&
(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",
label:this.nls.none});var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.operatorsSelect.shortType=a.shortType,a=h.getOperatorsByShortType(a.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),g.forEach(a,p.hitch(this,function(a){this.operatorsSelect.addOption({value:a,label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){l.removeClass(this.domNode,"value-type");l.removeClass(this.domNode,
"field-type");l.removeClass(this.domNode,"unique-type");l.removeClass(this.domNode,"support-cascade");var b=this._getValueTypeByUI();"value"===b?(l.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===b?(l.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none")):(l.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),b=!0,b=this._getSelectedFilteringItem(this.fieldsSelect),b=a.getCodedValuesOrTypesCount(b,this.layerInfo),
(b=0<b?a.isCodedValuesSupportFilter(this.layerInfo,b):!0)?(this.cascadeSelect.set("value","previous"),l.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(a,c){a=e("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];c?l.removeClass(a,"disabled"):l.addClass(a,"disabled")},_onValueTypeSetClick:function(a){var b=l.position(a.target),c;c=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var d=
l.position(c);if("none"!==l.getStyle(this.valueTypePopupNode,"display"))l.setStyle(this.valueTypePopupNode,"display","none");else{g.forEach(e(".value-type-popup",c),function(a){l.setStyle(a,"display","none")},this);l.place(this.valueTypePopupNode,c);var f;f=l.hasClass(e(".desktop-add-section",c.parentNode)[0],"hidden")?55:90;f=b.y-d.y-c.parentNode.scrollTop+f;f+170>c.parentNode.scrollHeight&&(f=c.parentNode.scrollHeight-170);window.isRTL?b=b.x-d.x+20:(b=b.x-d.x-100,b+150>c.clientWidth&&(b=c.clientWidth-
150));l.setStyle(this.valueTypePopupNode,{display:"block",left:b+"px",top:f+"px"});a.stopPropagation()}},_onValueTypeClick:function(a){var b=l.getAttr(a.currentTarget,"data-type");l.hasClass(a.currentTarget,"disabled")?a.stopPropagation():(e("li",this.valueTypePopupNode).forEach(function(a){l.removeClass(a,"selected")}),l.addClass(a.currentTarget,"selected"),this._resetByFieldAndOperator(null,b))},_enableValueTypeOption:function(a){this._enableValueTypeSelectOption("value",a)},_enableFieldTypeOption:function(a){this._enableValueTypeSelectOption("field",
a)},_enableUniqueTypeOption:function(a){this._enableValueTypeSelectOption("unique",a)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0)},_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1)},_resetByFieldAndOperator:function(a,c){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();
this._disableAllValueTypeOptions();a||(a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},a.fieldObj=this._getFieldObjByUI(),a.operator=this._getOperatorByUI());var b=[],d=null;a.fieldObj&&a.operator&&(b=this.valueProviderFactory.getSupportedValueTypes(a.fieldObj.name,a.operator),a.valueObj?d=a.valueObj.type:(d=c&&0<=b.indexOf(c)?c:b[0],a.valueObj={type:d}),0<=b.indexOf("value")&&this._enableValueTypeOption(!0),0<=b.indexOf("field")&&this._enableFieldTypeOption(!0),0<=b.indexOf("unique")&&
this._enableUniqueTypeOption(!0),"value"===d?this._enableValueTypeOption(!0):"field"===d?this._enableFieldTypeOption(!0):"unique"===d&&this._enableUniqueTypeOption(!0),this._updateValueTypeUI(d));0<b.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(a,!1),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(a.valueObj),this.own(m(this.valueProvider,"change",p.hitch(this,function(){this.emit("change")}))),this.valueProvider.bindChangeEvents(),
this.valueProvider.isBlankValueProvider()?(l.addClass(this.valueProvider.domNode,"hidden"),l.addClass(this.attributeValueContainer,"hidden")):l.removeClass(this.attributeValueContainer,"hidden"),(c=h.getOperatorInfo(a.operator))&&d&&(c[d]&&c[d].supportCaseSensitive&&this._showCaseSensitive(),a&&this.cbxCaseSensitive.setValue(a.caseSensitive))):l.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},_updateWhenValueRadioChanged:function(){this._updatePrompt();
this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();this._updatePrompt()},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){return this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},_getValueTypeByUI:function(){var a=e("li.selected",this.valueTypePopupNode)[0];
return a?l.getAttr(a,"data-type"):null},_updateValueTypeUI:function(a){e("li",this.valueTypePopupNode).forEach(function(a){l.removeClass(a,"selected")});if(a=e("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0])return l.addClass(a,"selected")},_updatePrompt:function(){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);l.setStyle(this.promptTable,"display","table");var a=this.operatorsSelect.get("value"),c=this.nls[a],d=!1,e=this._getValueTypeByUI(),f=h.getOperatorInfo(a);
f&&e&&(e=f[e])&&e.supportAskForValue&&(d=!0);d||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));this.cbxAskValues.status&&this.cbxAskValues.checked?(l.setStyle(this.promptTable,"display","table"),(d=this._getSelectedFilteringItem(this.fieldsSelect))&&"none"!==a&&this.promptTB.set("value",(d.alias||d.name)+" "+c)):l.setStyle(this.promptTable,"display","none")},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.inherited(arguments)}})})},
"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/aspect dojo/query ./_SingleFilter".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){return f([n,k,d,q],{templateString:r,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],
partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var b=a(".jimu-single-filter",this.allExpsBox),b=m.map(b,l.hitch(this,function(a){return p.byNode(a).toJson()}));return m.every(b,l.hitch(this,function(a){return!!a}))&&0<b.length?{logicalOperator:this.allAnySelect.value,parts:b}:null},
showDelteIcon:function(){g.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){g.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(e(this.btnAdd,"click",l.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):m.forEach(a,
l.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter()},_addSingleFilter:function(a){a=new h({url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0});a.placeAt(this.allExpsBox);
a.startup();this.own(c.after(a,"_destroySelf",l.hitch(this,this._checkFilterNumbers)));this.own(e(a,"change",l.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_checkFilterNumbers:function(){var b=a(".jimu-single-filter",this.allExpsBox),c=2<b.length;m.forEach(b,l.hitch(this,function(a){a=p.byNode(a);c?a.showDelteIcon():a.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u){return d([r,p,l,f],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new h;this.OPERATORS=g.clone(this._filterUtils.OPERATORS);
this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(a){var b=this._getNewValidPartsObj(this.partsObj,!0),c=b?this._getFilterExprByPartsObj(b):null;return a&&a.ifDisplaySQL?void 0===b.displaySQL?c:b.displaySQL:c},getValueProviders:function(){for(var a=[],b=this._getAllInteractiveSinglePartArray(this.partsObj),c=0;c<b.length;c++){var d=b[c].spId;d&&(d=this._getSingleFilterParameterBySpId(d),a.push(d))}return a},_getNewValidPartsObj:function(a,
b){a=g.clone(a);for(var c={logicalOperator:a.logicalOperator,parts:[]},d=g.hitch(this,function(a){if(a.spId){var b=this._getSingleFilterParameterBySpId(a.spId);a.valueObj=b.getValueObject();return b.getStatus()}return a.valueObj?1:-1}),f=g.hitch(this,function(a){var b=d(a);0<b&&c.parts.push(a);return b}),h=g.hitch(this,function(a){var b=[];a.parts=e.filter(a.parts,g.hitch(this,function(a){a=d(a);b.push(a);return 0<a}));1===a.parts.length?c.parts.push(a.parts[0]):2<=a.parts.length&&c.parts.push(a);
return Math.min.apply(b,b)}),k=0;k<a.parts.length;k++){var m=a.parts[k];if(m.parts){if(0>h(m)&&b)return null}else if(0>f(m)&&b)return null}return c},_getFilterExprByPartsObj:function(a){this._filterUtils.isHosted=b.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(a)},_getSingleFilterParameterBySpId:function(a){return this._spObj[a]},_getCascadeFilterPartsObj:function(a){var b={logicalOperator:this.partsObj.logicalOperator,parts:[]},c=g.clone(this.partsObj),d,f,h;d="none";a.interactiveObj&&
a.interactiveObj.cascade&&(d=a.interactiveObj.cascade);if("previous"===d)for(d=0;d<c.parts.length;d++)f=c.parts[d],f.majorCascadeIndex<a.majorCascadeIndex?b.parts.push(f):f.parts&&f.majorCascadeIndex===a.majorCascadeIndex&&(h=g.clone(f),h.parts=e.filter(h.parts,g.hitch(this,function(b){return b.minorCascadeIndex<a.minorCascadeIndex})),b.parts.push(h));else if("all"===d)for(d=0;d<c.parts.length;d++)f=c.parts[d],f.majorCascadeIndex!==a.majorCascadeIndex?b.parts.push(f):f.majorCascadeIndex===a.majorCascadeIndex&&
f.parts&&(h=g.clone(f),e.some(f.parts,g.hitch(this,function(b){return b.spId===a.spId}))&&(h.parts=e.filter(h.parts,g.hitch(this,function(b){return b.minorCascadeIndex!==a.minorCascadeIndex})),b.parts.push(h)));return b=this._getNewValidPartsObj(b,!1)},_getCascadeFilterExpr:function(a){var b="1\x3d1";(a=this._getCascadeFilterPartsObj(a))&&(b=this._getFilterExprByPartsObj(a));b||(b="1\x3d1");return b},clear:function(){this.featureLayerId=this.url=null;var b=c(".jimu-widget-query-single-parameter",
this.tbody);e.forEach(b,g.hitch(this,function(b){a.byNode(b).destroy()}));m.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(a,b,d,f){var h=new n;this.clear();this.url=a;this.layerInfo=b;this.partsObj=g.clone(d);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=f;this._setCascadeIndexForPartsObj(this.partsObj);a=this._getAllInteractiveSinglePartArray(this.partsObj);if(0<a.length){var l=new u({url:this.url,layerDefinition:b,featureLayerId:this.featureLayerId});
a=e.map(a,g.hitch(this,function(a){var d=m.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody),d=c("td",d)[0],e=this._getFieldInfo(a.fieldObj.name,this.layerInfo),e=new t({nls:this.nls,url:this.url,layerDefinition:b,fieldInfo:e,part:a,valueProviderFactory:l});this.own(q(e,"change",g.hitch(this,this._onSingleFilterParameterChanged)));e.placeAt(d);e.startup();a.spId=e.id;return this._spObj[e.id]=e}));e.forEach(a,g.hitch(this,function(a){a.valueProvider.getCascadeFilterExpr=g.hitch(this,this._getCascadeFilterExpr,
a.part);a.valueProvider.getCascadeFilterPartsObj=g.hitch(this,this._getCascadeFilterPartsObj,a.part)}));a=e.map(a,g.hitch(this,function(a){return a.init()}));k(a).then(g.hitch(this,function(){h.resolve()}),g.hitch(this,function(){h.reject()}))}else h.resolve();return h},_updatePartsObj:function(a){e.forEach(a,g.hitch(this,function(a){a.parts?e.forEach(a.parts,g.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&
(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},_setCascadeIndexForPartsObj:function(a){for(var b=0;b<a.parts.length;b++){var c=a.parts[b];c.majorCascadeIndex="AND"===a.logicalOperator?b:0;c.minorCascadeIndex=0;c.cascadeIndex=c.majorCascadeIndex;if(c.parts)for(var d=0;d<c.parts.length;d++){var e=c.parts[d];e.majorCascadeIndex=c.majorCascadeIndex;e.minorCascadeIndex=
"AND"===c.logicalOperator?d:0;e.cascadeIndex=parseFloat(e.majorCascadeIndex+"."+e.minorCascadeIndex)}}},_getFieldInfo:function(a,b){b=b.fields;for(var c=0;c<b.length;c++){var d=b[c];if(a===d.name)return d}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],c=0;c<a.parts.length;c++){var d=a.parts[c];if(d.parts)for(var e=0;e<d.parts.length;e++){var f=d.parts[e];f.interactiveObj&&b.push(f)}else d.interactiveObj&&b.push(d)}return b},_onSingleFilterParameterChanged:function(){this.emit("change",
this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang".split(" "),function(q,f,n,k,d,r,p,l,g){return k([d,r,p,f],{baseClass:"jimu-single-filter-parameter",templateString:l,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,
postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(q(this.valueProvider,"change",g.hitch(this,this._onValueProviderChanged)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,this.part)},build:function(d,e){var c=null;this.fieldInfo=d;this.part=e;if(d=e.interactiveObj)this.promptNode.innerHTML=
d.prompt||"",this.hintNode.innerHTML=d.hint||"";(d=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof d.then?c=d:(c=new n,c.resolve());return c},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},_showValidationErrorTip:function(d){!d.validate()&&d.domNode&&d.focusNode&&(d.focusNode.focus(),d.focusNode.blur())},
_onValueProviderChanged:function(){this.emit("change")}})})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),function(q,f,n,k,d,r){var p=q([d],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(d){this._layerInfos=d;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},
getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(d){var f=null;if(d=this._layerInfos.addTable(d))f=d._adaptor;return f},removeTable:function(d){(d=this.getNodeById(d))&&this._layerInfos.removeTable(d._layerInfo)},
_traversal:function(d,f){for(var e=0;e<f.length;e++)if(f[e].traversal(d))return!0;return!1},traversal:function(d){return this._traversal(d,this.getLayerNodes().concat(this.getTableNodes()))},traversalWithNodes:function(d,f){return this._traversal(d,f)},getNodeById:function(d){var f=null;this.traversal(function(e){if(e.id===d)return f=e,!0});return f},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(d){this._layerInfos.restoreState(d)},destroy:function(){f.forEach(this._eventHandles,
function(d){d.remove()});this.inherited(arguments)},_getNodesArrayFromInfosArray:function(d){var g=[];f.forEach(d,function(d){g.push(d._adaptor)},this);return g},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(g){console.warn(g)}},_bindEvents:function(){var d;d=k(this._layerInfos,"layerInfosChanged",n.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(d);d=k(this._layerInfos,"tableInfosChanged",n.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(d);
d=k(this._layerInfos,"layerInfosReorder",n.hitch(this,this._onLayerReordered));this._eventHandles.push(d);d=k(this._layerInfos,"layerInfosIsShowInMapChanged",n.hitch(this,this._onVisibilityChanged));this._eventHandles.push(d);d=k(this._layerInfos,"layerInfosIsVisibleChanged",n.hitch(this,this._onToggleChanged));this._eventHandles.push(d);d=k(this._layerInfos,"layerInfosFilterChanged",n.hitch(this,this._onFilterChanged));this._eventHandles.push(d);d=k(this._layerInfos,"layerInfosRendererChanged",n.hitch(this,
this._onRendererChanged));this._eventHandles.push(d);d=k(this._layerInfos,"layerInfosOpacityChanged",n.hitch(this,this._onOpacityChanged));this._eventHandles.push(d)},_onLayerNodesStructureChanged:function(d,f,e){this._emitEvent(p.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:[e._adaptor],rootLayerNodes:[d._adaptor]})},_onTableNdoesStructureChanged:function(d,f){d=this._getNodesArrayFromInfosArray(d);this._emitEvent(p.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:d,rootLayerNodes:d})},_onLayerReordered:function(d,
f){d=[d._adaptor];this._emitEvent(p.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:d,rootLayerNodes:d})},_onVisibilityChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(p.EVENT_VISIBILITY_CHANGE,d)},_onToggleChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(p.EVENT_TOOGLE_CHANGE,d)},_onFilterChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(p.EVENT_FILTER_CHANGE,d)},_onRendererChanged:function(d){d=
{layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(p.EVENT_RENDERER_CHANGE,d)},_onOpacityChanged:function(d){d={layerNodes:this._getNodesArrayFromInfosArray(d)};this._emitEvent(p.EVENT_OPACITY_CHANGE,d)}}),l=null;p.getInstance=function(){l&&l._layerInfos._objectId===r.getInstanceSync()._objectId||(l&&l.destroy(),l=new p(r.getInstanceSync()));return l};p.createInstance=function(d){return new p(r.createInstance(d))};n.mixin(p,{STRUCTURE_CHANGE_ADD:r.ADDED,STRUCTURE_CHANGE_REMOVE:r.REMOVED,
STRUCTURE_CHANGE_SUBNODE_ADD:r.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:r.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:r.UPDATED,STRUCTURE_CHANGE_REORDER:r.REORDERED,EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change"});return p})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(q,f,n,k,d,r,p,l,g){return r("dijit.layout._LayoutWidget",[f,n,k],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);p.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var f=this.getParent&&this.getParent();f&&f.isLayoutContainer||(this.resize(),this.own(d.on("resize",q.hitch(this,"resize"))))}},resize:function(d,e){var c=this.domNode;d&&l.setMarginBox(c,d);e=e||{};
q.mixin(e,d||{});"h"in e&&"w"in e||(e=q.mixin(l.getMarginBox(c),e));d=g.getComputedStyle(c);var a=l.getMarginExtents(c,d),f=l.getBorderExtents(c,d);e=this._borderBox={w:e.w-(a.w+f.w),h:e.h-(a.h+f.h)};a=l.getPadExtents(c,d);this._contentBox={l:g.toPixelValue(c,d.paddingLeft),t:g.toPixelValue(c,d.paddingTop),w:e.w-a.w,h:e.h-a.h};this.layout()},layout:function(){},_setupChild:function(d){p.add(d.domNode,this.baseClass+"-child "+(d.baseClass?this.baseClass+"-"+d.baseClass:""))},addChild:function(d,e){this.inherited(arguments);
this._started&&this._setupChild(d)},removeChild:function(d){p.remove(d.domNode,this.baseClass+"-child"+(d.baseClass?" "+this.baseClass+"-"+d.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t){e("dijit-legacy-requires")&&
t(0,function(){q(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return n("dijit.Menu",b,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(b){return a.get(this._iframeContentDocument(b))||
this._iframeContentDocument(b).__parent__||b.name&&document.frames[b.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=k.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var e=a;b=this._iframeContentWindow(e);b=c.body(b.document)}else b=a==c.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var f={node:a,
iframe:e};d.set(a,"_dijitMenu"+this.id,this._bindings.push(f));var h=g.hitch(this,function(a){var b=this.selector,c=b?function(a){return m.selector(b,a)}:function(a){return a},d=this;return[m(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<d._lastKeyDown+500||d._scheduleOpen(this,e,{x:a.pageX,y:a.pageY},a.target)}),m(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||d.leftClickToOpen&&a.keyCode==l.SPACE)a.stopPropagation(),
a.preventDefault(),d._scheduleOpen(this,e,null,a.target),d._lastKeyDown=(new Date).getTime()})]});f.connects=b?h(b):[];e&&(f.onloadHandler=g.hitch(this,function(){var a=this._iframeContentWindow(e),a=c.body(a.document);f.connects=h(a)}),e.addEventListener?e.addEventListener("load",f.onloadHandler,!1):e.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(a){var b;try{b=k.byId(a,this.ownerDocument)}catch(y){return}a="_dijitMenu"+this.id;if(b&&d.has(b,a)){for(var c=d.get(b,a)-1,e=this._bindings[c],
f;f=e.connects.pop();)f.remove();(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",e.onloadHandler));d.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){t.refocus&&q&&q.focus();h.close(t)}var c=a.target,d=a.iframe,f=a.coords,g=!f;this.currentTarget=
a.delegatedTarget;if(f){if(d){a=r.position(d,!0);var c=this._iframeContentWindow(d),c=r.docScroll(c.document),l=p.getComputedStyle(d),m=p.toPixelValue,n=(e("ie")&&e("quirks")?0:m(d,l.paddingLeft))+(e("ie")&&e("quirks")?m(d,l.borderLeftWidth):0),d=(e("ie")&&e("quirks")?0:m(d,l.paddingTop))+(e("ie")&&e("quirks")?m(d,l.borderTopWidth):0);f.x+=a.x+n-c.x;f.y+=a.y+d-c.y}}else f=r.position(c,!0),f.x+=10,f.y+=10;var t=this,d=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var q=!a||
k.isDescendant(a,this.domNode)?d:a;h.open({popup:this,x:f.x,y:f.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();g||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);h.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(q,f,n){return q("dgrid.OnDemandGrid",[f,n],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(q,f,n,k,d,r,p){function l(d,c){c&&c.nodeType&&d.appendChild(c)}function g(d,c,a,f){if(this.formatter){f=this.formatter;var b=this.grid.formatterScope;a.innerHTML="string"===typeof f&&b?b[f](c,d):this.formatter(c,d)}else null!=c&&a.appendChild(document.createTextNode(c))}var m=8>k("ie")&&
!k("quirks");f=f("dgrid.Grid",r,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(d){return"object"!=typeof d?this.columns[d]:this.cell(d).column},listType:"grid",cell:function(d,c){if(d.column&&d.element)return d;d.target&&d.target.nodeType&&(d=d.target);var a;if(d.nodeType){do{if(this._rowIdToObject[d.id])break;var e=d.columnId;if(e){c=e;a=d;break}d=d.parentNode}while(d&&d!=this.domNode)}if(!a&&"undefined"!=typeof c){var b=this.row(d);if(e=b&&b.element)for(var e=e.getElementsByTagName("td"),
f=0;f<e.length;f++)if(e[f].columnId==c){a=e[f];break}}if(null!=d)return{row:b||this.row(d),column:c&&this.column(c),element:a}},createRowCells:function(e,c,a,f){var b=d("table.dgrid-row-table[role\x3dpresentation]"),g=9>k("ie")||k("quirks")?d(b,"tbody"):b,h,l,n,q,r,y,z,w,A,F;a=a||this.subRows;l=0;for(n=a.length;l<n;l++)for(y=a[l],h=d(g,"tr"),y.className&&d(h,"."+y.className),q=0,r=y.length;q<r;q++){z=y[q];w=z.id;A=z.field?".field-"+p.escapeCssIdentifier(z.field,"-"):"";(F="function"===typeof z.className?
z.className(f):z.className)&&(A+="."+F);A=d(e+(".dgrid-cell.dgrid-cell-padding"+(w?".dgrid-column-"+p.escapeCssIdentifier(w,"-"):"")+A.replace(/ +/g,"."))+"[role\x3d"+("th"===e?"columnheader":"gridcell")+"]");A.columnId=w;m?(w=d(A,"!dgrid-cell-padding div.dgrid-cell-padding"),A.contents=w):w=A;if(F=z.colSpan)A.colSpan=F;if(F=z.rowSpan)A.rowSpan=F;c(w,z);h.appendChild(A)}return b},left:function(d,c){d.element||(d=this.cell(d));return this.cell(this._move(d,-(c||1),"dgrid-cell"))},right:function(d,
c){d.element||(d=this.cell(d));return this.cell(this._move(d,c||1,"dgrid-cell"))},renderRow:function(e,c){var a=this.createRowCells("td",function(a,b){var d=e;b.get?d=b.get(e):"field"in b&&"_item"!=b.field&&(d=d[b.field]);b.renderCell?l(a,b.renderCell(e,d,a,c)):g.call(b,e,d,a,c)},c&&c.subRows,e);return d("div[role\x3drow]\x3e",a)},renderHeader:function(){var e=this,c=this.headerNode,a=c.childNodes.length;for(c.setAttribute("role","row");a--;)d(c.childNodes[a],"!");a=this.createRowCells("th",function(a,
b){var c=b.headerNode=a;m&&(a=a.parentNode);var d=b.field;d&&(a.field=d);b.renderHeaderCell?l(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&d&&"_item"!=d&&(a.sortable=!0,a.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[a.id=this.id+"-header"]=this.columns;c.appendChild(a);this._sortListener&&this._sortListener.remove();this._sortListener=n(a,"click,keydown",function(a){if("click"==
a.type||32==a.keyCode||!k("opera")&&13==a.keyCode){var b=a.target,d,f,g;do if(b.sortable){g=[{attribute:d=b.field||b.columnId,descending:(f=e._sort[0])&&f.attribute==d&&!f.descending}];d={bubbles:!0,cancelable:!0,grid:e,parentType:a.type,sort:g};n.emit(a.target,"dgrid-sort",d)&&(e._sortNode=b,e.set("sort",g));break}while((b=b.parentNode)&&b!=c)}})},resize:function(){var d=this.headerNode.firstChild,c=this.contentNode,a;this.inherited(arguments);if(!k("ie")||7<k("ie")&&!k("quirks"))c.style.width="",
c&&d&&(a=d.offsetWidth)!=c.offsetWidth&&(c.style.width=a+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(d,c){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(d){var c=this.columns,a;for(a in c){var e=c[a];if(e.field==d)return e.headerNode}},updateSortArrow:function(e,c){this._lastSortedArrow&&(d(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),d(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);c&&(this._sort=e);if(e[0]){c=e[0].attribute;e=e[0].descending;c=this._sortNode||this._findSortArrowParent(c);var a;delete this._sortNode;c&&(c=c.contents||c,a=this._lastSortedArrow=d("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),a.innerHTML="\x26nbsp;",c.insertBefore(a,c.firstChild),d(c,e?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(d,c){return this.addCssRule("#"+p.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+p.escapeCssIdentifier(d,
"-"),c)},_configColumns:function(d,c){var a=[],e=c instanceof Array;p.each(c,function(b,f){"string"==typeof b&&(c[f]=b={label:b});e||b.field||(b.field=f);f=b.id=b.id||(isNaN(f)?f:d+f);this._configColumn&&(this._configColumn(b,f,c,d),f=b.id);e&&(this.columns[f]=b);b.grid=this;"function"===typeof b.init&&b.init();a.push(b)},this);return e?c:a},_destroyColumns:function(){var d=this.subRows,c=d&&d.length,a,f,b,g;this.cleanup();for(a=0;a<c;a++)for(f=0,g=d[a].length;f<g;f++)b=d[a][f],"function"===typeof b.destroy&&
b.destroy()},configStructure:function(){var d=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(d)for(c=0;c<d.length;c++)d[c]=this._configColumns(c+"-",d[c]);else this.subRows=[this._configColumns("",c)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(d){this._destroyColumns();this.subRows=null;this.columns=d;this._updateColumns()},_setSubRows:function(d){this._destroyColumns();this.subRows=d;this._updateColumns()},setColumns:function(d){q.deprecated("setColumns(...)",
'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",d)},setSubRows:function(d){q.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",d)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=l;f.defaultRenderCell=g;return f})},"put-selector/put":function(){(function(q){var f,
n=/[-+,> ]/;q([],f=function(k,d){function q(d){function c(){r&&f&&r!=f&&(f==d&&(a||(a=n.test(B)&&k.createDocumentFragment()))?a:f).insertBefore(r,b||null)}for(var a,e,b,f,r,v=arguments,C=v[0],D=0;D<v.length;D++){var B=v[D];if("object"==typeof B){e=!1;if(B instanceof Array){r=k.createDocumentFragment();for(var y=0;y<B.length;y++)r.appendChild(q(B[y]));B=r}if(B.nodeType)r=B,c(),f=B,b=0;else for(y in B)r[y]=B[y]}else if(e)e=!1,r.appendChild(k.createTextNode(B));else{1>D&&(d=null);e=!0;if(C=B.replace(p,
function(a,e,h,n,p,t){e&&(c(),"-"==e||"+"==e?(f=(b=r||f).parentNode,r=null,"+"==e&&(b=b.nextSibling)):("\x3c"==e?f=r=(r||f).parentNode:(","==e?f=d:r&&(f=r),r=null),b=0),r&&(f=r));if((a=!h&&n)||!r&&(h||p))"$"==a?(a=v[++D],f.appendChild(k.createTextNode(a))):(a=a||q.defaultTag,(e=m&&v[D+1]&&v[D+1].name)&&(a="\x3c"+a+' name\x3d"'+e+'"\x3e'),r=g&&~(l=a.indexOf("|"))?k.createElementNS(g[a.slice(0,l)],a.slice(l+1)):k.createElement(a));if(h)if("$"==n&&(n=v[++D]),"#"==h)r.id=n;else if(e=(a=r.className)&&
(" "+a+" ").replace(" "+n+" "," "),"."==h)r.className=a?(e+n).substring(1):n;else if("!"==B){var u;m?q("div",r,"\x3c").innerHTML="":(u=r.parentNode)&&u.removeChild(r)}else e=e.substring(1,e.length-1),e!=a&&(r.className=e);p&&("$"==t&&(t=v[++D]),"style"==p?r.style.cssText=t:(h="!"==p.charAt(0)?(p=p.substring(1))&&"removeAttribute":"setAttribute",t=""===t?p:t,g&&~(l=p.indexOf("|"))?r[h+"NS"](g[p.slice(0,l)],p.slice(l+1),t):r[h](p,t)));return""}))throw new SyntaxError("Unexpected char "+C+" in "+B);
c();f=C=r||f}}d&&a&&d.appendChild(a);return C}n=d||n;var p=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,l,g=!1;k=k||document;var m="object"==typeof k.createElement;q.addNamespace=function(d,c){k.createElementNS?(g||(g={}))[d]=c:k.namespaces.add(d,c)};q.defaultTag="div";q.forDocument=f;return q})})(function(q,f,n){n=n||f;"function"===typeof define?define([],function(){return n()}):"undefined"==typeof window?require("./node-html")(module,n):put=
n()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(q,f,n,k,d,r,p,l,g){function m(a,b){g(document.body,a,".dgrid-scrollbar-measure");b=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return b}function e(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+b);
g(this.domNode,b);this._class=a}function c(){return this._class}function a(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function h(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}l("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var b,t;d.add("dom-scrollbar-width",function(a,b,c){return m(c,"Width")});d.add("dom-scrollbar-height",function(a,b,c){return m(c,"Height")});d.add("dom-rtl-scrollbar-left",
function(a,b,c){a=g("div");g(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");g(c,a);b=!!d("ie")||!!d("trident")||a.offsetLeft>=d("dom-scrollbar-width");c.className="";document.body.removeChild(c);g(a,"!");c.removeAttribute("dir");return b});var u=0,v=/ +/g,C=7>d("ie")&&!d("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};
return f("dgrid.List",d("touch")?p:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=
this.domNode=b||g("div");var c;a?(this.params=a,f.safeMixin(this,a),c=a["class"]||a.className||b.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=b.id=b.id||this.id||"dgrid_"+u++;null===this.useTouchScroll&&(this.useTouchScroll=!d("dom-scrollbar-width"));this.buildRendering();c&&e.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&
this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,e,f,h,l;l=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";g(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));e=this.headerNode=g(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(d("quirks")||8>d("ie"))&&g(a,"div.dgrid-spacer");f=this.bodyNode=g(a,"div.dgrid-scroller");
d("ff")&&(f.tabIndex=-1);this.headerScrollNode=g(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));h=this.footerNode=g("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));g(a,h);l&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));k(f,"scroll",function(b){c.showHeader&&(e.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();k.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=
this.touchNode=g(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=k(window,"resize",r.throttleDelayed(C,this)))},postCreate:d("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,c=this.headerNode,e=this.footerNode,f=c.offsetHeight,
g=this.showFooter?e.offsetHeight:0,h=d("quirks")||7>d("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=g+"px";h&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-f-g,0)+"px",g&&(e.style.bottom="1px",setTimeout(function(){e.style.bottom=""},0)));b||(b=d("dom-scrollbar-width"),t=d("dom-scrollbar-height"),d("ie")&&(b++,t++),r.addCssRule(".dgrid-scrollbar-width","width: "+b+"px"),r.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17==b||
h||(r.addCssRule(".dgrid-header-row","right: "+b+"px"),r.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+b+"px")));h&&(c.style.width=a.clientWidth+"px",setTimeout(function(){c.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){a=r.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,b){a=k(this.domNode,a,b);d("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=
this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();g(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";
this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);g(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){g(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&g(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=
b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var d=0;d<b.length;d++){var f=b[d],g=m[f?0:m.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),m[f](k.element),c.count++)}}}function e(a){return!n.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){u=h.insertRow(a,t,null,k++,c);u.observerIndex=
q;return u}function g(a){v=a.slice(0);(p=b?b.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(t,b||null),(u=a[a.length-1])&&h.adjustRowIndices(u)):l[q]&&h.cleanEmptyObservers&&"undefined"!==typeof q&&(l[q].cancel(),l[q]=0,h._numObservers--);m=a;r&&(r.rows=m)}c=c||{};var h=this,k=c.start||0,l=this.observers,m,p,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var r=a.observe(function(f,g,k){var l,n,r;-1<g&&m[g]&&(l=m.splice(g,
1)[0],l.parentNode==p&&((n=l.nextSibling)&&g!=k&&n.rowIndex--,h.removeRow(l)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(m.length)if(0===k)r=(r=m[k])&&e(r);else{if(r=m[k-1])r=e(r),r=(r.connected||r).nextSibling}else r=h._getFirstRowSibling&&h._getFirstRowSibling(p);l&&r&&l.id===r.id&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));l=b&&b.parentNode||r&&r.parentNode||h.contentNode;if(l=h.newRow(f,l,r,c.start+k,c))if(l.observerIndex=q,m.splice(k,
0,l),!n||k<g)n=(n=l.previousSibling)&&n.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?n:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&n&&h.adjustRowIndices(n);h._onNotification(m,f,g,k)},!0);q=l.push(r)-1}var t=document.createDocumentFragment(),u,v;if(a.map){if(m=a.map(f,console.error),m.then)return a.then(function(b){a=b;return m.then(function(a){g(a);d(1,1,0,0);return v})})}else{m=[];for(var C=0,D=a.length;C<D;C++)m[C]=f(a[C])}g(m);d(1,1,0,0);return v},_onNotification:function(a,b,c,
d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,
c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return g("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||g(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):
(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:d("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):h.call(this,a)}:h,getScrollPosition:d("touch")?function(){return this.useTouchScroll?this.inherited(arguments):a.call(this)}:a,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,
1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:c,_setClass:e,_getClassName:c,_setClassName:e,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,
d){c=c[a];d=d[a];void 0===c&&(c="");void 0===d&&(d="");return c==d?0:c>d==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){q.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;g(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){q.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;g(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(q,f){q.add("dom-contains",function(d,f,e){return!!e.contains});var n=[],k,d,r,p=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,l={defaultDelay:15,throttle:function(d,f,e){var c=!1;e=e||l.defaultDelay;return function(){c||(c=!0,d.apply(f,arguments),
setTimeout(function(){c=!1},e))}},throttleDelayed:function(d,f,e){var c=!1;e=e||l.defaultDelay;return function(){if(!c){c=!0;var a=arguments;setTimeout(function(){c=!1;d.apply(f,a)},e)}}},debounce:function(d,f,e){var c;e=e||l.defaultDelay;return function(){c&&(clearTimeout(c),c=null);var a=arguments;c=setTimeout(function(){d.apply(f,a)},e)}},each:function(d,f,e){var c,a;if(d)if("number"===typeof d.length)for(c=0,a=d.length;c<a;c++)f.call(e,d[c],c,d);else for(c in d)f.call(e,d[c],c,d)},contains:function(d,
f){return q("dom-contains")?d.contains(f):d.compareDocumentPosition(f)&8},addCssRule:function(g,l){k||(k=f(document.getElementsByTagName("head")[0],"style"),k=k.sheet||k.styleSheet,d=k.deleteRule?"deleteRule":"removeRule",r=k.cssRules?"cssRules":"rules");var e=n.length;n[e]=(k.cssRules||k.rules).length;k.addRule?k.addRule(g,l):k.insertRule(g+"{"+l+"}",n[e]);return{get:function(c){return k[r][n[e]].style[c]},set:function(c,a){"undefined"!==typeof n[e]&&(k[r][n[e]].style[c]=a)},remove:function(){var c=
n[e],a,f;if(void 0!==c)for(k[d](c),n[e]=void 0,a=e+1,f=n.length;a<f;a++)n[a]>c&&n[a]--}}},escapeCssIdentifier:function(d,f){return"string"===typeof d?d.replace(p,f||"\\$1"):d}};return l})},"xstyle/has-class":function(){define(["dojo/has"],function(q){var f={};return function(){for(var n,k=arguments,d=0;d<k.length;d++)if(n=k[d],!f[n]){f[n]=!0;var r=n.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),p=q(r[2]),l=-r[4];(0<l?l<=p&&(-r[5]||l)>=p:!!p)==!r[1]&&(document.documentElement.className+=" has-"+n)}}})},
"xstyle/css":function(){define(["require"],function(q){function f(f,k,d){var n=document.documentElement;f=n.insertBefore(document.createElement(f),n.firstChild);f.id=k;k=(f.currentStyle||getComputedStyle(f,null)||{})[d];n.removeChild(f);return k}return{load:function(n,k,d,r){function p(e){var c=f("x-parse",null,"content"),a=e&&(e.sheet||e.styleSheet);c&&"none"!=c&&"normal"!=c?k([eval(c)],function(c){e?c.process(e,d):(c.processAll(),d(a))}):d(a)}var l=k.toUrl(n),g;l.match(/!$/)&&(g={wait:!1},l=l.slice(0,
-1));var m=k.cache&&k.cache["url:"+l];if(m)m.xCss&&(m=m.cssText),q(["./core/load-css"],function(d){p(d.insertCss(m))});else{if("none"==f("div",n.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return p();q(["./core/load-css"],function(d){d(l,p,g)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(q,f,n,k,d,r,p,l,g){return n("dgrid.OnDemandList",[q,
f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:l.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var d=this;p(this.bodyNode,"scroll",l[this.pagingMethod](function(e){d._processScroll(e)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(f,e){function c(b){g(q,
"!");if(b)throw a._refreshDeferred&&(a._refreshDeferred.reject(b),delete a._refreshDeferred),b;}var a=this,h=e&&e.container||this.contentNode,b={query:f,count:0,options:e},l,m=this.preload,n,p={node:g(h,"div.dgrid-preload",{rowIndex:0}),count:0,query:f,next:b,options:e};p.node.style.height="0";b.node=l=g(h,"div.dgrid-preload");b.previous=p;l.rowIndex=this.minRowsPerPage;m?((b.next=m.next)&&l.offsetTop>=m.node.offsetTop?b.previous=m:(b.next=m,b.previous=m.previous),b.previous.next=b,b.next.previous=
b):this.preload=b;var q=g(l,"-div.dgrid-loading");g(q,"div.dgrid-below").innerHTML=this.loadingMessage;e=k.mixin(this.get("queryOptions"),e,{start:0,count:this.minRowsPerPage},"level"in f?{queryLevel:f.level}:null);this._trackError(function(){return n=f(e)});if("undefined"===typeof n)c();else return d.when(a.renderArray(n,l,e),function(f){return d.when("undefined"===typeof n.total?n.length:n.total,function(c){var d=f.length,h=l.parentNode,k=a.noDataNode;g(q,"!");"queryLevel"in e||(a._total=c);0===
c&&h&&(k&&(g(k,"!"),delete a.noDataNode),a.noDataNode=k=g("div.dgrid-no-data"),h.insertBefore(k,a._getFirstRowSibling(h)),k.innerHTML=a.noDataMessage);for(k=h=0;k<d;k++)h+=a._calcRowHeight(f[k]);d&&h&&(a.rowHeight=h/d);h=a.rowHeight*a.bufferRows;h>a.farOffRemoval&&(a.farOffRemoval=h);c-=d;b.count=c;l.rowIndex=d;c?l.style.height=Math.min(c*a.rowHeight,a.maxEmptySpace)+"px":(l.style.display="none",e.count++);a._previousScrollPosition&&(a.scrollTo(a._previousScrollPosition),delete a._previousScrollPosition);
a._processScroll();a._refreshDeferred&&(a._refreshDeferred.resolve(n),delete a._refreshDeferred);return f},c)},c),n},refresh:function(f){var e=this,c=f&&f.keepScrollPosition,a;"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return c=this._refreshDeferred=new d,a=e.renderQuery(function(a){return e.store.query(e.query,a)}),"undefined"===typeof a&&c.reject(),c.then(function(a){e._refreshTimeout=setTimeout(function(){p.emit(e.domNode,
"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:e,results:a});e._refreshTimeout=null},0);delete e._refreshDeferred;return a},function(a){delete e._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(d){return d.lastChild},_calcRowHeight:function(d){var e=d.nextSibling;return e&&!/\bdgrid-preload\b/.test(e.className)?e.offsetTop-d.offsetTop:d.offsetHeight},lastScrollTop:0,_processScroll:function(f){function e(a,b,d,e){var f=
h.farOffRemoval,k=a.node;if(b>2*f){for(var l,m=k[d],n=0,p=0,q=[];l=m;){var r=h._calcRowHeight(l);if(n+r+f>b||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[d];n+=r;p+=l.count||1;h.removeRow(l,!0);q.push(l)}a.count+=p;e?(k.rowIndex-=p,c(a)):k.style.height=k.offsetHeight+n+"px";var t=g("div",q);setTimeout(function(){g(t,"!")},1)}}function c(a,b){a.node.style.height=Math.min(a.count*h.rowHeight,b?Infinity:h.maxEmptySpace)+"px"}function a(a,b){do a=b?a.next:a.previous;
while(a&&!a.node.offsetWidth);return a}var h=this,b=h.bodyNode;f=f&&f.scrollTop||this.getScrollPosition().y;var b=b.offsetHeight+f,l,m,n=h.preload,p=h.lastScrollTop,q=h.bufferRows*h.rowHeight,r=q-h.rowHeight,y,z,w,A=!0;for(h.lastScrollTop=f;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=l;){l=h.preload;h.preload=n;m=n.node;var F=m.offsetTop;if(b+1+r<F)n=a(n,A=!1);else if(f-1-r>F+m.offsetHeight)n=a(n,A=!0);else{var E=((m.rowIndex?f-q:b)-F)/h.rowHeight,F=(b-f+2*q)/h.rowHeight,F=F+Math.min(Math.abs(Math.max(Math.min((f-
p)*h.rowHeight,h.maxRowsPerPage/2),h.maxRowsPerPage/-2)),10);0==m.rowIndex&&(E-=F);E=Math.max(E,0);10>E&&0<E&&F+E<h.maxRowsPerPage&&(F+=Math.max(0,E),E=0);F=Math.min(Math.max(F,h.minRowsPerPage),h.maxRowsPerPage,n.count);if(0==F)n=a(n,A);else{var F=Math.ceil(F),E=Math.min(Math.floor(E),n.count-F),G=k.mixin(h.get("queryOptions"),n.options);n.count-=F;var H=m,L,J=h.queryRowsOverlap,K=(0<m.rowIndex||m.offsetTop>f)&&n;if(K){var O=n.previous;O&&(e(O,f-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),
0<E&&O.node==m.previousSibling?(E=Math.min(n.count,E),n.previous.count+=E,c(n.previous,!0),m.rowIndex+=E,J=0):F+=E,n.count-=E);G.start=m.rowIndex-J;G.count=Math.min(F+J,h.maxRowsPerPage);m.rowIndex=G.start+G.count}else n.next&&(e(n.next,n.next.node.offsetTop-b,"previousSibling",!0),H=m.nextSibling,H==n.next.node?(n.next.count+=n.count-E,n.next.node.rowIndex=E+F,c(n.next),n.count=E,J=0):L=!0),G.start=n.count,G.count=Math.min(F+J,h.maxRowsPerPage);L&&H&&H.offsetWidth&&(L=H.offsetTop);c(n);"level"in
n.query&&(G.queryLevel=n.query.level);if("queryLevel"in G||!(G.start>h._total||0>G.count)){m=g(H,"-div.dgrid-loading[style\x3dheight:"+F*h.rowHeight+"px]");g(m,"div.dgrid-"+(K?"below":"above")).innerHTML=h.loadingMessage;m.count=F;var N=n.query(G);if(void 0===h._trackError(function(){return N})){g(m,"!");return}(function(a,b,e,f){w=d.when(h.renderArray(f,a,G),function(k){z=f;H=a.nextSibling;g(a,"!");if(e&&H&&H.offsetWidth){var l=h.getScrollPosition();h.scrollTo({x:l.x,y:l.y+H.offsetTop-e,preserveMomentum:!0})}d.when(f.total||
f.length,function(a){"queryLevel"in G||(h._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&G.count++,c(b))});h._processScroll();return k},function(b){g(a,"!");throw b;})}).call(this,m,K,L,N);n=n.previous}}}}w&&(y=this._refreshDeferred)&&(delete this._refreshDeferred,d.when(w,function(){y.resolve(z)}))},removeRow:function(d,e){if(d){var c=d.previousSibling,a=d.nextSibling,f;if(f=c)f=c.observerIndex,f=null!=f?f:c.previousObserverIndex;c=f;if(f=a)f=a.observerIndex,f=null!=f?f:a.nextObserverIndex;
a=d.observerIndex;d.observerIndex=void 0;e&&(d.nextObserverIndex=f,d.previousObserverIndex=c);if(this.cleanEmptyObservers&&-1<a&&a!==c&&a!==f&&(c=this.observers,f=c[a])){if(!e)for(var b=f.rows,g=0;g<b.length;g++)if(b[g]!=d&&r.isDescendant(b[g],this.domNode))return this.inherited(arguments);f.cancel();this._numObservers--;c[a]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(q,f,n,k,d,r,p){function l(d){return d}function g(f){if("object"!==typeof f)f=Error(f);else if("cancel"===f.dojoType)return;f.grid=this;d.emit(this.domNode,"dgrid-error",{grid:this,error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};r.before(this,"configStructure",
n.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(d){d.set&&(this._columnsWithSet[d.field]=d);this.inherited(arguments)},_updateNotifyHandle:function(d){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);d&&"function"===typeof d.notify&&this.shouldObserveStore&&
(this._notifyHandle=r.after(d,"notify",n.hitch(this,"_onNotify"),!0),(d=this.get("sort"))&&d.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(d,e,c){this._updateNotifyHandle(d);this.store=d;this.dirty={};this.set("query",e,c)},_setQuery:function(d,e){var c=e&&e.sort;this.query=void 0!==d?d:this.query;this.queryOptions=e||this.queryOptions;
this._started&&(c?this.set("sort",c):this.refresh())},setStore:function(d,e,c){q.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",d,e,c)},setQuery:function(d,e){q.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",d,e)},_getQueryOptions:function(){var d=n.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)d.sort=this._sort;return d},_getQuery:function(){var d=this.query;return"object"==typeof d&&
null!=d?n.delegate(d,{}):d},_setSort:function(d,e){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(d,e){this.inherited(arguments);d&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var d=this.inherited(arguments);this.store||(this.noDataNode=p(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return d},renderArray:function(){var d=this,e=this.inherited(arguments);this.store||k.when(e,function(c){c.length&&
d.noDataNode&&p(d.noDataNode,"!")});return e},insertRow:function(d,e,c,a,f){var b=this.store,g=this.dirty,b=b&&b.getIdentity(d),h;b in g&&!(b in this._updating)&&(h=g[b]);h&&(d=n.delegate(d,h));return this.inherited(arguments)},updateDirty:function(d,e,c){var a=this.dirty,f=a[d];f||(f=a[d]={});f[e]=c},setDirty:function(d,e,c){q.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(d,e,c)},save:function(){function d(b,d){return function(f){var g=e._columnsWithSet,h=e._updating,
l,m;if("function"===typeof f.set)f.set(d);else for(l in d)f[l]=d[l];for(l in g)m=g[l].set(f),void 0!==m&&(f[l]=m);h[b]=!0;return k.when(c.put(f),function(){delete a[b];delete h[b]})}}var e=this,c=this.store,a=this.dirty,f=new k,b=f.promise,g=function(a){var b;return e.getBeforePut||!(b=e.row(a).data)?function(){return c.get(a)}:function(){return b}},l;for(l in a)var n=d(l,a[l]),b=b.then(g(l)).then(n);f.resolve();return b},revert:function(){this.dirty={};this.refresh()},_trackError:function(d){var e;
"string"==typeof d&&(d=n.hitch(this,d));try{e=d()}catch(c){g.call(this,c)}return k.when(e,l,n.hitch(this,g))},newRow:function(){var d=this.inherited(arguments);this.noDataNode&&(p(this.noDataNode,"!"),delete this.noDataNode);return d},removeRow:function(d,e){var c={element:d};!e&&this.noDataMessage&&this.up(c).element===d&&this.down(c).element===d&&(this.noDataNode=p(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(q,f,n,k,d,r,p,l,g){function m(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function e(b,c){var e=b.bodyNode,f=c?"text":21>d("ff")?"-moz-none":"none";a&&"msUserSelect"!==a?e.style[a]=f:d("dom-selectstart")?c||b._selectstartHandle?c&&b._selectstartHandle&&(b._selectstartHandle.remove(),delete b._selectstartHandle):b._selectstartHandle=k(e,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(m(e,!c),c||b._unselectableHandle)?c&&b._unselectableHandle&&(b._unselectableHandle.remove(),delete b._unselectableHandle):b._unselectableHandle=r.after(b,"renderRow",function(a){m(a,!0);return a})}d.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});d.add("css-user-select",function(a,b,c){a=c.style;
b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});d.add("dom-selectstart","undefined"!==typeof document.onselectstart);var c=d("mac")?"metaKey":"ctrlKey",a=d("css-user-select"),h=(p=d("pointer"))&&"MS"===p.slice(0,2),b=p?p+(h?"Down":"down"):"mousedown",t=p?p+(h?"Up":"up"):"mouseup";"WebkitUserSelect"===a&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(a=!1);return f("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:b+","+t+",dgrid-cellfocusin",selectionTouchEvents:d("touch")?l.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){q.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?e(this,a):e(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==t||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===b&&this.isSelected(c))this._waitForMouseUp=
c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[c];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var d=this._lastSelected,e=a.keyCode?a.ctrlKey:a[c],f;a.shiftKey||(f=e?null:!0,d=null);this.select(b,d,f);d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):
a.keyCode?a.ctrlKey:a[c])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};d("touch")&&!d("pointer")&&this.selectionTouchEvents?(k(b,l.selector(e,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),k(b,k.selector(e,this.selectionEvents),function(b){a._ignoreMouseSelect!==
this?a._handleSelect(b,this):b.type===t&&(a._ignoreMouseSelect=null)})):k(b,k.selector(e,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b[c]&&65==b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&r.after(this,"_setStore",function(){a._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=r.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=r.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=r.before(this,"removeRow",function(a,b){b||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];k.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,c){var d,e,f;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],f&&(c?g(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):g(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(d=this._determineSelectionDirection(f,
b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(f,b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:d("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);n.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(q,f,n,k,d){function r(d){d=document.getElementsByTagName(d);for(var e=0;e<d.length;e++)l(d[e])}function p(){r("link");r("style")}function l(d,e,c){function a(){q(["xstyle/core/load-imports"],function(a){a(d,
function(){l(d,e,!0)})})}function f(a){for(var b=a.cssRules,c=0;c<b.length;c++){var d=b[c];if(d.selectorText&&"x-"==d.selectorText.substring(0,2)&&(k=!0,/^'/.test(d.style.content)))return g(eval(d.style.content),a,e),!0}}var b=d.sheet||d.styleSheet;if(b&&(!b.processed||c)){b.processed=!0;var k=b.needsParsing,m=b.rules||b.cssRules;if((b.href||b.imports&&b.imports.length)&&!c)return a();if(!k)for(var n=0;n<m.length;n++){var p=m[n];if(p.href&&!c){if(!f(p.styleSheet))return a();return}}g(b.localSource||
(b.ownerNode||b.owningElement).innerHTML,b,e)}}function g(d,e,c){e.addRule||(e.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});e.deleteRule||(e.deleteRule=e.removeRule);var a=1;(e.href||location.href).replace(/[^\/]+$/,"");n.css=d;f(n,d,e);0==--a&&c&&c(e);return n}k.ready(p);f.getStyleSheet=function(d,e){return d.styleSheet||d};return{process:l,processAll:p,parse:g,generate:d,update:k.update,load:function(d,e,c,a){e(["xstyle/css"],function(f){f.load(d,e,function(a){a?
l({sheet:a},c):(p(),c())},a)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function q(){this.push.apply(this,arguments)}function f(c){this.value=c}function n(){var c,a=this.args[0];if("string"==typeof a)c=a.split(/\s*,\s*/);else if(a){c=[];for(var d=0,b=0;b<a.length+1;b++){var e=a[b];if("string"==typeof e||void 0===e)if(e=e&&e.split(/\s*,\s*/),1<c.length||void 0===e){var f=a.slice(d,b);0<d&&f.unshift(c.pop());d=b+1;c.push(f);e&&c.push.apply(c,e.slice(1))}}}else return[];
return c}function k(c,a,e){function b(a,e){function t(a){D=!1;var b=u.lastIndex;a.then(function(){D=!0;c&&(u.lastIndex=b,C())});var c=!0}function C(){function c(a){a&&"string"==typeof a&&y&&(a=y+a);I?I.push?"string"==typeof I[I.length-1]&&"string"==typeof a?I[I.length-1]+=a:a&&I.push(a):"string"==typeof I&&"string"==typeof a?I+=a:I=new q(I,a):I=a}for(D=!0;D;){var p=u.exec(a);if(!p)break;var C=p[5],y=p[1],B=p[2],A=p[3],Q=p[4],M,P,I,V,Q=Q&&m(Q),B=B&&m(B);H?(A?(P=B,M=A.charAt(0),V="?"==A.charAt(1),-1<
A.indexOf("\n")&&(Q=A.slice(1))):Q=B,I=Q,H=!1):(Q=A?B+A:B,c(Q));"{"!=C&&(G+=p[0]);switch(C){case "'":case '"':var U="'"==C?d:r;U.lastIndex=u.lastIndex;(C=U.exec(a))||z("unterminated string");B=C[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});u.lastIndex=U.lastIndex;c(new f(B));G+=C[0];continue;case "\\":C=U.lastIndex++;c(a.charAt(C));continue;case "(":case "{":case "[":if("{"==C){H=!0;":"==M&&A&&(B+=A);G=m((G+B).replace(/\s+/g," "));c(A=
w.newRule(G));"\x3d"==M&&(E=!1,I.creating=!0);var R=null,ba=F;p[6]&&(Q=e.cssRules||e.rules,A.cssRule=R=Q[p[6].slice(1)])&&(G=R.selectorText);if(w.root&&E)for(Q=e.cssRules||e.rules;R=Q[F++];)if(R.selectorText==G||R.selectorText&&R.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){A.cssRule=R;break}R||(A.ruleIndex=F=ba);A.styleSheet=e;I.creating?(A.selector="."+("\x3d"==M?B.match(/[\w-]*$/g,"")[0]:"")+"-x-"+g++,A.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?
A.setMediaSelector(G):A.selector=w.root?G:w.selector+" "+G;G=""}else B=Q.match(/(.*?)([\w-]*)$/),c(A=w.newCall(B[2],I,w)),A.ref=w.getDefinition(B[2]),A.getArgs=n,(I.calls||(I.calls=[])).push(A);w.currentName=P;w.currentSequence=I;w.assignmentOperator=M;var W;"{"==C&&(W=A.selector.match(/[@:]\w+/))&&(W=W[0],(P=w.getDefinition(W))&&P.selector&&P.selector(A));v.push(w=A);w.operator=C;w.start=u.lastIndex;I=P=null;continue}if(I)if(B="string"==typeof I?I:I[0],B.charAt&&"@"==B.charAt(0))if(p=B.match(/\w+/)[0],
"import"==p)B=k.getStyleSheet((e.cssRules||e.imports)[F++],I,e),p=u.lastIndex,b(B.localSource,B),u.lastIndex=p;else{if("xstyle"==p){if("start"==B.slice(8,13))A=w?w.newRule(""):X,A.root=w.root,v.push(w=A);else{var X=w||X;v.pop();w=v[v.length-1]}u=w?h:/(@[\w\s])/g}}else if("\x3d"===M)try{var x=w.declareDefinition(P,I,V);x&&x.then&&t(x)}catch(T){z(T)}switch(C){case ":":"\x3d"==M?(H=!0,M=":"):c(":");break;case "}":if(P&&!w.root&&!w.isMediaBlock)try{w[":"==M?"setValue":"declareDefinition"](P,I,V)}catch(T){z(T)}case ")":case "]":l[w.operator]!=
C&&z("Incorrect opening operator "+w.operator+" with closing operator "+C);P=null;P=a.slice(w.start,u.lastIndex-1);w.cssText=w.cssText?w.cssText+";"+P:P;if("}"==C){"}"==Y&&(Y=w.parent.selector)&&"@"==!Y.charAt(0)&&z("A nested rule must end with a semicolon");if(w.root)z("Unmatched "+C);else{try{w.onRule(w.selector,w)}catch(T){z(T)}E=!0}G=""}if(")"==C||"]"==C)w.args=[I];if(")"==C&&!M){try{x=v[v.length-2].onArguments(w)}catch(T){z(T)}x&&x.then&&t(x)}v.pop();w=v[v.length-1];I=w.currentSequence;P=w.currentName;
M=w.assignmentOperator;if(w.root&&"}"==C){if(M)try{w[":"==M?"setValue":"declareDefinition"](P,I,V)}catch(T){z(T)}H=!0;M=!1}break;case "":case void 0:return;case ";":if(w&&P){try{(x=w[":"==M?"setValue":"declareDefinition"](P,I,V))&&x.then&&t(x)}catch(T){z(T)}P}I=null;H=!0;M=E=!1;G=""}var Y=C}}function z(c){var d=a.slice(0,u.lastIndex).split("\n"),f=d[d.length-1],d=(e.href||"in-page stylesheet")+":"+d.length+":"+f.length+" near:\n"+f.slice(-40);if(b.onerror)b.onerror(c,d);console.error(c.message||c,
d);c.stack&&console.error(c.stack)}a=a.replace(p,function(a){return a.replace(/[^\n]/g,"")});var w=c;u.lastIndex=0;var D,F=0,E=!0,G="",H=!0;C()}e=e||{addRule:function(){},cssRules:[]};var h,u=h=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[c];c.parse=b;b(a,e)}var d=/((?:\\.|[^'])*)'/g,r=/((?:\\.|[^"])*)"/g,p=/\/\*[\w\W]*?\*\//g,l={"{":"}","[":"]","(":")"},g=0,m="".trim?function(c){return c.trim()}:
function(c){return c.replace(/^\s+|\s+$/g,"")},e=q.prototype=[];e.toString=function(){return this.join("")};e.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return k})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(q,f,n,k,d,r,p){function l(a,b,
d){function e(b){return{selectElement:function(c){d.newElement&&(c=c.parentNode);if(b&&b.selector)for(;!u(c,b);)if(c=c.parentNode,!c)throw Error("Rule not found");if(d.inherit)for(;!(a in c);)if(c=c.parentNode,!c)throw Error(a?a+" not found":"Property was never defined");return c},forElement:function(e){var f=e;e=this.selectElement(e);d.newElement&&(e["_"+a+"Node"]=f);e=d.get?d.get(e,a):e[a];return void 0===e&&b?c(a).valueOf().forRule(b):e},forRule:d.inherit&&function(a){return e(a)}}}var f=new n(function(){return e(b)});
f.define=function(b,c){return l(a||c,b,d)};f.keepCSSValue=!0;f.put=d.inherit?function(b,d){return c(a).put(b,d,a)}:function(c){return{forElement:function(e){if(b&&b.selector)for(;!u(e,b);)if(e=e.parentNode,!e)throw Error("Rule not found");d.set?d.set(e,a,c):e[a]=c;f.invalidate({elements:[e]})}}};return f}function g(a,b,c,d){return k.when(f.evaluate(a,c),function(b){b.forElement?q.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}function m(a,b){return{apply:function(c,d,e){g(c,e,d[0],function(d,
f){d.observe(function(d){d=d?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function e(a,b){var c=a.variables;if(c&&b in c)return c[b];if(a=a.bases)for(c=0;c<a.length;c++){var d=e(a[c],b);if(void 0!==d)return d}}function c(a){var b=v[a];b||(b=v[a]=new n(function(){return{forRule:function(b){a:{do{var c=e(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);
for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var a=d("div"),h=navigator.userAgent,b=-1<h.indexOf("WebKit")?"-webkit-":-1<h.indexOf("Firefox")?"-moz-":-1<h.indexOf("MSIE")?"-ms-":-1<h.indexOf("Opera")?"-o-":"",t;r=new r;var u=q.matchesRule;r.root=!0;var v={};r.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new p.Promise(function(b){require([a],
function(a){b(a)})})).then(b)}}}),item:l("item",null,{inherit:!0}),pageContent:new n,content:l("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:l(null,null,{}),elementClass:l(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!u(b,
a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(t)},valueOf:function(){return t}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(c,d,e){return{forRule:function(d){if("string"==typeof a.style[b+e])return d._setStyleFromValue(b+e,c),!0}}}},"var":{define:function(a,b){return c(b)},selfResolving:!0,apply:function(a,b){return c(k.convertCssNameToJs(b[0]))}},inline:m("inline","none"),block:m("block","none"),visible:m("visible",
"hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return k.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){q.on(document,c.charAt(2).toLowerCase()+c.slice(3),b,function(d){t=d;try{k.when(f.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&
(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(d.target));t=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(w){console.error("Error in "+c+" event handler, executing "+a,w)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(b){function c(b){var e;if(e=b.match(/^\s*not(.*)/))return!c(e[1]);if(e=b.match(/\((.*)\)/))return c(e[1]);if(e=b.match(/([^:]*):(.*)/))return b=
k.convertCssNameToJs(e[1]),e=a.style[b]=e[2],a.style[b]==e;if(e=b.match(/\w+\[(.*)=(.*)\]/))return d(e[0])[e[1]]==e[2];if(e=b.match(/\w+/))return k.isTagSupported(e);throw Error("can't parse @supports string");}c(b.selector.slice(10))?b.selector="":b.disabled=!0}},"true":!0,"false":!1,"null":null};r.elementProperty=l;return r})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(q,f){function n(b,d,e,f){function g(a){if(!e)return f(a);
var b=a.target;do if(y(b,e))return f(a);while((b=b.parentNode)&&1===b.nodeType)}c?b.addEventListener(d,g,!!a[d]):k(b,a[d]||d,g)}function k(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function d(a){/e/.test(m.readyState||"")?a():m.addEventListener("DOMContentLoaded",a)}function r(a){for(var b=m.querySelectorAll(a.selector),c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities=
{});var h=f.renderings;h||(h=f.renderings=[],C.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function p(){for(;C.length;){for(var a=C.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;B=c[d.name]==e.propertyValue;if(!f&&B)try{e.render(a)}catch(H){console.error(H,H.stack),q(a,"div.error",H.toString())}f&&!B&&e.unrender&&e.unrender(a)}a.renderings=void 0}}function l(a,b){for(var c=0,d=u.length;c<d;c++){var e=u[c];
b&&b!=e.selector||!y(a,e.rule)||e.render(a)}}function g(a,b){var c={selector:a.selector,rule:a,render:b};u.push(c);D&&r(c);p();return{remove:function(){u.splice(u.indexOf(c),1)}}}var m=document,e=1,c=!!m.addEventListener,a={blur:"focusout",focus:"focusin"};n(m,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));
var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&n(m,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});var h=m.createElement("div"),b={"dom-qsa2.1":!!h.querySelectorAll},t=h.matches||
h.matchesSelector||h.webkitMatchesSelector||h.mozMatchesSelector||h.msMatchesSelector||h.oMatchesSelector,u=[],v=[],C=[],D;d(function(){if(!D)if(D=!0,b["dom-qsa2.1"]){for(var a=0,c=u.length;a<c;a++)r(u[a]);p()}else for(var d=m.all,a=0,c=d.length;a<c;a++)l(d[a])});var B,y=t?function(a,b){return t.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+e++,"true");return!!a.currentStyle[b.ieId]};return{ready:d,on:n,matchesRule:y,addRenderer:g,addInputConnector:function(a,b){v.push({rule:a,
definition:b})},update:l,clearRenderers:function(){u=[]},observeForElement:function(a,b,c){return f.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?g(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function q(d,f){for(var k=0,l=d.length;k<l;k++){var g=d[k];if(g&&"object"==typeof g&&f in g)return!0}}function f(d,f){return f.toUpperCase()}var n="div"==document.createElement("div").tagName,k={};return{when:function(d,
f,k){return d&&d.then?d.then(f,k)||d:f(d)},whenAll:function(d,f){return q(d,"then")?{then:function(k,l){function g(){m--;m||k(f(e))}for(var m=1,e=[],c=0;c<d.length;c++){var a=d[c];m++;a&&a.then?function(c){a.then(function(a){e[c]=a;g()},l)}(c):(e[c]=a,g())}g()},inputs:d}:f(d)},convertCssNameToJs:function(d){return d.replace(/-(\w)/g,f)},isTagSupported:function(d){if(d in k)return k[d];var f=document.createElement(d);n?(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==
d.toUpperCase();return k[d]=f},extend:function(d,f){var k=f.split(".");f=k[0];var l=d.getDefinition(f,"rules");k[0]="";d.selector+=d.extraSelector=k.join(".");if(l)return this.when(l,function(f){if(f.extend)f.extend(d,!0);else for(var g in f)d[g]=f[g]});d.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:q}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(q,f){function n(a,
b){var c=b[0];return c&&a?(c=g(c),n(a.property?a.property(c):a[c],b.slice(1))):a}function k(a,b,c){if(m(b,a)){var d={};d[a]=function(d){for(var e=[],f=0,g=b.length;f<g;f++){var h=b[f];h&&"function"==typeof h[a]&&(h=h[a](d));e[f]=h}return c(e)};return d}return c(b)}function d(a,b){return{apply:function(c,d,e){for(var f=0,g=d.length;f<g;f++){var h=d[f];h.dependencyOf&&h.dependencyOf(e)}f=function(){var b=[];if(a.selfExecuting)return a.apply(c,d,e);for(var f=0,g=d.length;f<g;f++)b[f]=d[f].valueOf();
if(a.selfWaiting)return a.apply(c,b,e);b.push(c);return q.whenAll(b,function(b){var c=b.pop();return k("forRule",b,function(b){return k("forElement",b,function(b){return a.apply(c,b,e)})})})};f.reverse=function(a){return b(a,d)};return f}}}function r(a){return c[a]||(c[a]=new Function("a","b","return "+a))}function p(c,b,f,g,k){function h(a){a.skipResolve=!0;a.precedence=b;a.infix=!1!==k}var l=function(a,b){var c=b[0];b=b[1];if(c&&c.put)a=g(a,b&&b.valueOf()),a!==e&&c.put(a);else if(b&&b.put)b.put(k(a,
c&&c.valueOf()));else throw new TypeError("Can not put");},m={apply:function(b,e,m){var n;f=r(f);g=g&&r(g);k=k&&r(k);a[c]=n=d(f,l);h(n);return n.apply(b,e,m)}};h(m);a[c]=m}function l(c,b){function e(b){for(;m<=b.precedence;){var c=p.pop(),d=a[p.pop()],e=new f;e.setCompute(d.apply(null,d.infix?[p.pop(),c]:[c],e));r=p.length?p[p.length-1]:void 0;p.push(e);m=r&&a[r]&&a[r].precedence}}var g,h;b=b.join?b.slice():[b];for(g=0;g<b.length;g++)if(h=b[g],"string"==typeof h){var k=h.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);
h=[g,1];k&&h.push.apply(h,k);b.splice.apply(b,h);g+=h.length-3}var m,p=[],r,k={};for(g=0;g<b.length;g++){h=b[g];if("("==h.operator){var z=p[p.length-1];void 0===z||a.hasOwnProperty(z)?h=l(c,h.getArgs()[0]):(p.pop(),h=function(a,b){function e(e){return q.when(a.valueOf(),function(f){var m=a.parent&&a.parent.valueOf();if(!f.selfResolving){if(!g){g=[];for(var n=0,p=b.length;n<p;n++)g[n]=l(c,b[n]);h=f.selfReacting?f.apply(m,g,k):d(f).apply(m,g,k)}return h()}f=f.apply(m,b,k);return e?f:f.valueOf()})}var g,
h,k=new f(e);k.setReverseCompute(function(){var a=arguments;return q.when(e(!0),function(b){return b.put.apply(b,a)})});return k}(z,h.getArgs()))}else if(a.hasOwnProperty(h))z=a[h],e(z),m=(r||z).precedence;else if(-1<h)h=+h;else if(h.isLiteralString)h=h.value;else{h=h.split(/\s*\/\s*/);var z=h[0],w=c.getDefinition(z);if("string"==typeof w||w instanceof Array)w=l(c,w);else if(void 0===w)throw Error('Could not find reference "'+z+'"');k[z]=w;1<h.length&&(w=n(w,h.slice(1)));h=w}p.push(h)}e({precedence:100});
if(1<p.length)throw Error("Could not reduce expression");h=p[0];h.inputs=k;return h}var g=q.convertCssNameToJs,m=q.someHasProperty,e={},c={},a={};p("+",6,"a+b","a-b","a-b");p("-",6,"a-b","a+b","b-a");p("*",5,"a*b","a/b","a/b");p("/",5,"a/b","a*b","b/a");p("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");p(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");p("!",4,"!a","!a",!1);p("%",5,"a%b");p("\x3e",8,"a\x3eb");p("\x3e\x3d",8,"a\x3e\x3db");p("\x3c",8,"a\x3cb");p("\x3c\x3d",8,"a\x3c\x3db");
p("\x3d\x3d",9,"a\x3d\x3d\x3db");p("\x26",8,"a\x26\x26b");p("|",8,"a||b");return{react:d,evaluate:l,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(q,f){function n(d){(this.computeValue=d)&&d.reverse&&this.setReverseCompute(d.reverse)}function k(k,g,m){if(g&&g.forElement)return{forElement:function(e){e=g.selectElement?g.selectElement(e):e;var c=["_cache_"+k.id];if(c in e){var a=e[c+"observe"];a.addKey&&
a.addKey(m);return e[c][m]}var h=e[c]=g.forElement(e),b=e[c+"observe"]=d(k,h,m,{elements:[e]});e.xcleanup=function(a){a&&f.unobserve(h,b)};return h[m]}}}function d(d,g,k,e){var c=d._properties,a;"object"==typeof g&&(a=function(a){for(var b=0;b<a.length;b++){var d=c[a[b].name];d&&d.invalidate&&d.invalidate(e)}},f.observe(g,a),a.addKey&&a.addKey(k));return a}var r={},p=1;n.prototype={id:"x-variable-"+p++,cache:r,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==r)return this.cache;
var d=this,f=this.computeValue;if(f.then)return this.cache=f.then(function(f){d.computeValue=f;(f=d.cache=f())&&f.then&&f.then(function(e){d.cache=e});return f});(f=d.cache=f())&&f.then&&f.then(function(f){d.cache=f});return f},property:function(f){var g=this._properties||(this._properties={}),l=g[f];if(!l){var e=this,l=g[f]=new n(function(){return q.when(e.valueOf(),function(c){if(c&&c.forRule)return{forRule:function(a){a=c.selectRule?c.selectRule(a):a;var b=["_cache_"+e.id],g;if((g=b in a?a[b]:
a[b]=c.forRule(a))&&g.forElement)return k(e,g,f);var h=a[b+"observe"];h&&(h.addKey?h.addKey(f):a[b+"observe"]=d(e,g,f,{rules:[a]}));return g[f]}};if(c&&c.forElement)return k(e,c,f);var a=e.cacheObserve;a?a.addKey&&a.addKey(f):a=e.cacheObserve=d(e,c,f);return c[f]})});l.key=f;l.parent=this;l.put=function(c){return q.when(e.valueOf(),function(a){function d(a){if(a.forElement)return{forElement:function(b){a.forElement(b)[f]=c}};a[f]=c}if(a.forRule)return{forRule:function(b){return d(a.forRule(b))}};
d(a)})};l.id=this.id+"-"+f}return l},invalidate:function(d){var g=this.cacheObserve;g&&(f.unobserve(this.cache,g),this.cacheObserve=null);this.cache=r;var k,g=this._properties;for(k in g)g[k].invalidate(d);var e=this.dependents||0;k=0;for(g=e.length;k<g;k++)try{e[k].invalidate(d)}catch(c){console.error(c,"invalidating a definition")}},dependencyOf:function(d){(this.dependents||(this.dependents=[])).push(d)},notDependencyOf:function(d){for(var f=this.dependents||0,k=0;k<f.length;k++)f[k]===d&&f.splice(k--,
1)},setReverseCompute:function(d){this.put=function(){var f=d.apply(this,arguments);this.invalidate();return f}},setCompute:function(d){(this.computeValue=d)&&d.reverse&&this.setReverseCompute(d.reverse);this.invalidate()},setSource:function(d){this.computeValue=function(){return d};this.invalidate()},observe:function(d){this.computeValue&&d(this.valueOf());var f=this;return this.dependencyOf({invalidate:function(){d(f.valueOf())}})},newElement:function(){return q.when(this.valueOf(),function(d){return d&&
d.newElement&&d.newElement()})}};return n})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function q(a,c,b){r?-1===r.indexOf(a)&&r.push(a):(r=[a],setTimeout(function(){r.forEach(function(a){var b=[];a.properties.forEach(function(c){b.push({target:a.object,name:c})});a(b);a.object=null;a.properties=null});r=null},0));a.object=c;a=a.properties||(a.properties=[]);-1===a.indexOf(b)&&a.push(b)}function f(){return f}var n=Object.observe,k;if(k=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});k=!0;break a}catch(a){}k=void 0}var d={observe:n,defineProperty:k,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},n=d.observe?Object.observe:d.defineProperty?function(a,c){c.addKey=function(b){var d="key"+b;if(!this[d]){this[d]=!0;var e=a[b];if((d=Object.getOwnPropertyDescriptor(a,b))&&d.set){var f=d.set,g=d.get;Object.defineProperty(a,b,{get:function(){return e=g.call(this)},set:function(a){f.call(this,a);e!==a&&(e=a,c&&q(c,this,b))}})}else Object.defineProperty(a,
b,{get:function(){return e},set:function(a){e!==a&&(e=a,c&&q(c,this,b))}})}};c.remove=function(){c=null}}:function(a,c){m||(m=!0,setInterval(function(){for(var a=0,b=p.length;a<b;a++){var c=l[a],d=p[a],e=g[a],f=void 0,h=void 0;for(h in c)c.hasOwnProperty(h)&&c[h]!==d[h]&&(c[h]=d[h],(f||(f=[])).push({name:h}));for(h in d)d.hasOwnProperty(h)&&!c.hasOwnProperty(h)&&(c[h]=d[h],(f||(f=[])).push({name:h}));f&&e(f)}},20));var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);p.push(a);l.push(b);g.push(c)},
r;k=d.observe?Object.unobserve:function(a,c){c.remove&&c.remove();for(var b=0,d=p.length;b<d;b++)if(p[b]===a&&g[b]===c){p.splice(b,1);l.splice(b,1);g.splice(b,1);break}};var p=[],l=[],g=[],m=!1,e=1,c=function(){};c.prototype.toJSON=f;return{Promise:d.promise?Promise:function(){function a(c){function b(a){a&&a.then?a.then(b,d):(g=a,e())}function d(a){h=a;e()}function e(){f=!0;for(var a=0,b=k.length;a<b;a++)k[a]();k=0}var f,g,h,k=0;c(b,d);return{then:function(b,c){return new a(function(a,d){function e(){try{h&&
!c?d(h):a(h?c(h):b?b(g):g)}catch(E){d(E)}}f?e():(k||(k=[])).push(e)})}}}return a}(),WeakMap:d.WeakMap?WeakMap:function(a,f){var b="__"+(f||"")+e++;return d.defineProperty?{get:function(a){return a[b]},set:function(a,c){Object.defineProperty(a,b,{value:c,enumerable:!1})}}:{get:function(a){return(a=a[b])&&a.value},set:function(a,d){(a[b]||(a[b]=new c)).value=d}}},observe:n,unobserve:k,copy:function(a,c){for(var b in c)a[b]=c[b];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(q,f,n,k,d){function r(a,b,c){try{a[b]=c}catch(D){}}function p(){}function l(a,b,d,e){if(a.calls){var h;for(d=0;d<a.length;d++){var k=a[d];if(k instanceof g){a.hasOwnProperty(d)||(a[d]=k=c(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(b,k.getArgs(),b):q.evaluate(b,[k.caller,k]));void 0!==l&&((h||(h=[])).push(l),k.evaluated=!0)}}}if(h)return b=q.react(function(){for(var b=0,c=a.slice(),d=0;d<a.length;d++){var e=
a[d];e instanceof g&&e.evaluated&&(c[d-1]=a[d-1].slice(0,-e.caller.length),c[d]=arguments[b++])}return c.join("")}),b.skipResolve=!0,e=new f,e.setCompute(b.apply(e,h,e)),e;if(!e)return a.toString()}function g(a){this.caller=a;this.args=[]}function m(a,b,c,f){return d.when(b,function(b){var d=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=d.forRule(a,!0);b&&b.forElement?e(a,b,f):c&&c(b)}),b=b.forRule(a));if(b&&b.forElement)return e(a,b,f);c&&c(b)})}function e(a,
b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var c=Object.create||function(a){function b(){}b.prototype=a;return new b},a=d.convertCssNameToJs,h={"{":"}","[":"]","(":")"},b=n("div").style;p.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",
b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new p;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new g(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(y){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];r(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?r(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(c,e,f){c=c&&a(c);if(!this.disabled){var g=this;if(e.length)if("\x3e"==e[0].toString().charAt(0))c||(this.generator=e,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){e=a.forSelector(e,g);b.addRenderer(g,e)}));else{var h=c in b||this.getDefinition(c);if(!f||!h){f=this.definitions||(this.definitions={});var k=e[0];if(k.indexOf&&-1<k.indexOf(","))for(var k=
e.join("").split(/\s*,\s*/),l=[],m=0;m<k.length;m++)l[m]=q.evaluate(this,k[m]);e[0]&&"{"==e[0].operator?l=e[0]:e[1]&&"{"==e[1].operator&&(l=e[1],d.extend(l,e[0]));l=l||q.evaluate(this,e);if(l.then)var n=l,l={then:function(a){return n.then(function(b){return a(p(b))})}};var p=function(a){a.define&&(a=a.define(g,c));return a};h&&console.warn('Overriding existing property "'+c+'"');return f[c]=p(l)}}else return f=this.definitions||(this.definitions={}),f[c]=e}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(c,d,e){var f=a(c);if(!this.disabled){var g=this.values||(this.values=[]);g.push(c);g[c]=d;if(c){do{g=(e||this).getDefinition(c);if(void 0!==g){if(this.cssRule&&(!g||!g.keepCSSValue)){var h=this.cssRule.style;f in h&&r(h,f,"")}m(this,g.put(d,this,f))}c=c.substring(0,c.lastIndexOf("-"))}while(c)}f in b&&this._setStyleFromValue(f,d,!0)}},_setStyleFromValue:function(a,b,c){var f=b[0];if(f instanceof p)for(c=f.values,f=0;f<c.length;f++){var g=c[f];this._setStyleFromValue(a+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),c[g])}else{if(b.calls){var h=this;if(b.expression=l(b,this,a,!0)){var k=b.expression&&b.expression.valueOf(),m=function(b,c){var d=k&&k.forRule?k.forRule(b,!0):k;if(d&&d.forElement)if(c=c&&c.elements)for(var f=0;f<c.length;f++)for(var g=c[f].querySelectorAll(b.selector),h=0;h<g.length;h++){var l=g[h];r(l.style,a,d.forElement(l))}else e(b,d,function(b,c){r(c.style,a,b)});else b.setStyle(a,d)},n=[h];d.when(k,function(a){(k=a)&&k.forRule&&(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){n.push(a);m(a)});m(h)});b.expression.dependencyOf({invalidate:function(a){d.when(b.expression.valueOf(),function(b){k=b;for(b=0;b<n.length;b++){var c=!0,d=n[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&m(d,a)}})}})}}c||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=
b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(d,e){(this.derivatives||(this.derivatives=[])).push(d);var f=this.extraSelector;f&&(d.selector+=f);for(var g=this.cssRule.style,h=d.getCssRule().style,l=d.inheritedStyles||(d.inheritedStyles={}),f=0;f<g.length;f++){var m=a(g[f]);if(!h[m]||l[m])h[m]=g[m],l[m]=!0}if(f=this.values){var f=c(f),n=d.values;d.values=n?k.copy(f,n):f}if(e){if(f=this.definitions){var f=c(f),p=d.definitions;d.definitions=p?k.copy(f,p):f}d.tagName=this.tagName||d.tagName}(d.bases||
(d.bases=[])).push(this);e=this._subRuleListeners||0;for(f=0;f<e.length;f++)e[f](d);var q=d.getCssRule().style;this.eachProperty(function(e,f){e=a(e);"object"==typeof f&&(f=c(f));e in b&&!q[e]&&d._setStyleFromValue(e,f)});if(n&&d.definitions)for(f=0,e=n.length;f<e;f++)m=n[f],g=a(m),d.definitions[g]!==(p&&p[g])&&d.setValue(m,n[g]);if(n=this.generator){if(n instanceof Array)for(n=n.slice(0),f=0;f<n.length;f++)p=n[f],"{"===p.operator&&(e=d.newRule(),e.selector=p.selector+d.selector.slice(1),e.styleSheet=
d.styleSheet||d.cssRule.parentStyleSheet,p.extend(e,!0),n[f]=e);d.declareDefinition(null,n)}},getDefinition:function(b,c){b=a(b);var d=this;do{var e=d.definitions&&d.definitions[b];void 0===e&&c&&d[c]&&(e=d[c][b]);d=d.parent}while(void 0===e&&d);return e},newElement:function(){return n((this.tagName||"span")+(this.selector||""))},cssText:""};q.evaluateText=l;var t=g.prototype=new p;t.declareDefinition=t.setValue=function(a,b){this.args.push(b)};t.toString=function(){var a=this.operator;return a+this.args+
h[a]};p.updateStaleProperties=function(){};return p})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(q,f,n,k,d){function r(a,c){a=a.sort?a:[a];return function(d,e,h){var k=d,l;"content"in d||(d.content=void 0);if(void 0===h){var r=(d._contentNode||d).childNodes||0,t=r[0];if(t){var u=b.createDocumentFragment();do u.appendChild(t);while(t=r[0]);d.content=u}if(d._contentNode){d._contentNode=
void 0;try{d.innerHTML=""}catch(I){}}}for(var v=0,C=[d],B=[],r=0,t=a.length;r<t;r++){var D=J,J=a[r];try{if(J.eachProperty){if(J.args)if("("==J.operator){var K=a[r+1];p(J,K,k,function(a,b,d){m(a,b,d,c)})}else{var O=J.args[0];if("string"===typeof O){var N=O.split("\x3d");try{k.setAttribute(N[0],N[1])}catch(I){console.error(I)}}else{var S=O[0].replace(/=$/,""),Q=O[1];"("==Q.operator?p(O[1],S,k,function(a,b,d){g(a,b,d,c)}):k.setAttribute(S,Q.value)}}}else if("string"==typeof J){"\x3d"==J.charAt(0)&&(J=
J.slice(1));var M=k,K=a[r+1],N=[];J.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){N.push(arguments)});for(var P=0;P<N.length;P++)(function(a,b,g,m,p,q,r){function t(){var a=M._contentNode;a&&(a.innerHTML="",M=a)}b?(a=g?g.length:0,a>v?(t(),C[a]=M):M=C[a]||M,v=a):t();var u;if(m)u=(D&&D.args?"":"span")+m+p;else{m=p.match(/^[-\w]+/);if(!m)throw new SyntaxError("Unable to parse selector",p);m=m[0];var w;P===N.length-1&&K&&K.selector?(K.bases||n.extend(K,
m),w=K):w=c.getDefinition(m);w&&(w.then||w.newElement)?M=function(a,b,c,d){var e,g;n.when(w&&w.newElement&&w.newElement(),function(a){(e=a)?(c=c.slice(d.length))&&f(e,c):e=f(c);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);g=f("span");return a.insertBefore(g,b||null)}(M,h,p,m):u=p}u&&(M=f(h||M,(h?"-":"")+u));h=null;q&&M.setAttribute(q,""===r?q:r);e&&(M.item=e);l=l||M;(P<N.length-1||M!=k&&M!=d)&&B.push(P==
N.length-1&&K&&K.selector,M);k=M}).apply(this,N[P])}else k.appendChild(b.createTextNode(J.value))}catch(I){console.error(I,I.stack),k.innerHTML&&(k.innerHTML=""),k.appendChild(b.createTextNode(I))}}for(;J=B.pop();)q.update(J,B.pop());return l}}function p(a,b,c,d){var e,g;b&&b.eachProperty?(f(c,e=b.selector),g=b):(f(c,e=a.selector||(a.selector=".-xbind-"+t++)),g=a);var h=a.getArgs()[0],l=a.expressionResult,m=a.expressionDefinition;m||(m=a.expressionDefinition=k.evaluate(a.parent,h),l=m.valueOf(),q.addInputConnector(g,
m),function(b,c,e){a.expressionResult=l;e.dependencyOf&&e.dependencyOf({invalidate:function(a){a=a?q.matchesRule(a.elements[0],g)?a.elements:a.elements[0].querySelectorAll(c):document.querySelectorAll(c);for(var f=0,h=a.length;f<h;f++)d(a[f],b,e.valueOf())}})}(b,e,m));d(c,b,l)}function l(a,b,c,d){return n.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(c));d(a)})}function g(a,b,c,d){l(c,d,a,function(c){a.setAttribute(b,c)})}function m(c,d,g,k){c._defaultBinding=
!0;if(g&&g.then&&"INPUT"!==c.tagName)try{c.appendChild(b.createTextNode("Loading"))}catch(B){}l(g,k,c,function(g){if(c._defaultBinding)if(e(c),c.childNodes.length&&(c.innerHTML=""),g&&g.sort)if(g.isSequence)r(g,k)(c);else{var l=d&&d.definitions&&d.definitions.each,m=k.newRule(),l=l?r(l,m):function(b,c,d){return f(d||b,(d?"-":"")+(a[b.tagName]||"span"),""+c)},n=[],p;g.track&&(g=g.track(),p=g.tracking);g.forEach(function(a){n.push(l(c,a,null))});if(g.on)var q=g.on("add,delete,update",function(a){var b=
a.target,d=a.previousIndex;a=a.index;if(-1<d){var f=n[d];e(f,!0);f.parentNode.removeChild(f);n.splice(d,1)}-1<a&&n.splice(a,0,l(c,b,n[a]||null))});if(p=p||q)c.xcleanup=function(){p.remove()}}else g&&g.nodeType?c.appendChild(g):(g=void 0===g?"":g,c.tagName in h?"checkbox"===c.type?c.checked=g:c.value=g:c.appendChild(b.createTextNode(g)))})}function e(a,b){a.xcleanup&&a.xcleanup(b);a=a.getElementsByTagName("*");b=0;for(var c=a.length;b<c;b++){var d=a[b];d.xcleanup&&d.xcleanup(!0)}}function c(a,b){return r(b,
d)(a)}var a={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},h={INPUT:1,TEXTAREA:1,SELECT:1},b=document,t=1;c.forSelector=r;return c})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c){n.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var a=f("dojo.dnd.Source",e,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){k.mixin(this,k.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,"dojoDndTarget");
this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[g.subscribe("/dnd/source/over",k.hitch(this,"onDndSourceOver")),g.subscribe("/dnd/start",k.hitch(this,"onDndStart")),g.subscribe("/dnd/drop",k.hitch(this,"onDndDrop")),g.subscribe("/dnd/cancel",k.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},
copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==c.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){a.superclass.destroy.call(this);q.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(d){if(!this.isDragging||"Disabled"!=this.targetState){a.superclass.onMouseMove.call(this,d);var b=c.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(d.pageX-this._lastX)>
this.delay||Math.abs(d.pageY-this._lastY)>this.delay)){var e=this.getSelectedNodes();e.length&&b.startDrag(this,e,this.copyState(m.getCopyKeyState(d),!0))}this.isDragging&&(e=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=r.position(this.current,!0)),e=this.horizontal?d.pageX-this.targetBox.x<this.targetBox.w/2==r.isBodyLtr(this.current.ownerDocument):d.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||e!=this.before)&&(this._markTargetAnchor(e),
b.canDrop(!this.current||b.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(c){this.mouseDown||!this._legalMouseDown(c)||this.skipForm&&m.isFormElement(c)||(this.mouseDown=!0,this._lastX=c.pageX,this._lastY=c.pageY,a.superclass.onMouseDown.call(this,c))},onMouseUp:function(c){this.mouseDown&&(this.mouseDown=!1,a.superclass.onMouseUp.call(this,c))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=c.manager(),
a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&c.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,c){var d=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return d.call(this,a.getItem(b.id).data,c)}:c?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=m.getUniqueId();return{node:b,
data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();c||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!c&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=d},onDropInternal:function(a,b){var c=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return c.call(this,this.getItem(a.id).data,b)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=m.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=c}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){a.superclass.onOverEvent.call(this);c.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){a.superclass.onOutEvent.call(this);c.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!p.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;if(d.contains(a,"dojoDndItem")||d.contains(a,
"dojoDndIgnore"))break}return!1}});return a})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c){var a=f("dojo.dnd.Selector",c,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(g(this.node,m.press,k.hitch(this,
"onMouseDown")),g(this.node,m.release,k.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new l,b=e._empty,c;for(c in this.selection)c in b||a.push(d.byId(c));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(d.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=e._empty,b;for(b in this.selection)if(!(b in a)){var c=
d.byId(b);this.delItem(b);r.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||n.global;var c=this.selection,d=e._empty,f;for(f in c)f in d||a.call(b,this.getItem(f),f,this)},sync:function(){a.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var c=[],b=e._empty,d;for(d in this.selection)d in b||this.getItem(d)||c.push(d);q.forEach(c,function(a){delete this.selection[a]},this);return this},insertNodes:function(c,
b,d,e){var f=this._normalizedCreator;this._normalizedCreator=function(a,b){a=f.call(this,a,b);c?(this.anchor?this.anchor!=a.node&&(this._removeItemClass(a.node,"Anchor"),this._addItemClass(a.node,"Selected")):(this.anchor=a.node,this._removeItemClass(a.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[a.node.id]=1):(this._removeItemClass(a.node,"Selected"),this._removeItemClass(a.node,"Anchor"));return a};a.superclass.insertNodes.call(this,b,d,e);this._normalizedCreator=f;
return this},destroy:function(){a.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!e.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,p.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){e.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&(d=b[c],d!=this.anchor&&d!=this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?e.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):e.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=g(this.node,m.move,k.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=e._empty,b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return a})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){f=f("dojo.dnd.Container",g,{skipForm:!1,allowNested:!1,constructor:function(b,c){this.node=r.byId(b);c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&r.byId(c.dropParent);this.map={};this.current=null;this.containerState="";p.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[e(this.node,a.over,k.hitch(this,"onMouseOver")),e(this.node,a.out,k.hitch(this,"onMouseOut")),e(this.node,"dragstart",
k.hitch(this,"onSelectStart")),e(this.node,"selectstart",k.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,c){this.map[a]=c},delItem:function(a){delete this.map[a]},forInItems:function(a,c){c=c||n.global;var b=this.map,d=h._empty,e;for(e in b)e in d||a.call(c,b[e],e,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return c((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=h.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,c,d){this.parent.firstChild?c?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var b;if(d)for(c=0;c<a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),d.parentNode.insertBefore(b.node,d);else for(c=0;c<
a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),this.parent.appendChild(b.node);return this},destroy:function(){q.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,c,d){a._skipStartup=!0;return new d(c,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=h._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(u){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(t){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||this.skipForm&&h.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,c){var b="dojoDnd"+a;a=a.toLowerCase()+"State";p.replace(this.node,b+c,b+this[a]);this[a]=c},_addItemClass:function(a,c){p.add(a,"dojoDndItem"+c)},_removeItemClass:function(a,c){p.remove(a,"dojoDndItem"+
c)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&p.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,c){a=(this.creator||this.defaultCreator).call(this,a,c);k.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=h.getUniqueId());p.add(a.node,"dojoDndItem");return a}});h._createNode=function(a){return a?function(b){return l.create(a,{innerHTML:b})}:h._createSpan};h._createTrTd=function(a){var b=
l.create("tr");l.create("td",{innerHTML:a},b);return b};h._createSpan=function(a){return l.create("span",{innerHTML:a})};h._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};h._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?h._createTrTd:h._createNode(h._defaultCreatorNodes[a]);return function(a,c){var d=a&&k.isObject(a),e;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"]):
(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],a=("avatar"==c?h._createSpan:b)(String(e)));a.id||(a.id=h.getUniqueId());return{node:a,data:e,type:d}}};return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h){var b=f("dojo.dnd.Manager",[r],{constructor:function(){this.source=this.avatar=null;this.nodes=
[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:p("touch")?4:16,OFFSET_Y:p("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());m.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),m.publish("/dnd/source/over",null)):m.publish("/dnd/source/over",null)},startDrag:function(b,c,f){function h(a){a.preventDefault();
a.stopPropagation()}a.autoScrollStart(k.doc);this.source=b;this.nodes=c;this.copy=!!f;this.avatar=this.makeAvatar();k.body().appendChild(this.avatar.node);m.publish("/dnd/start",b,c,this.copy);this.events=[g(k.doc,e.move,n.hitch(this,"onMouseMove")),g(k.doc,e.release,n.hitch(this,"onMouseUp")),g(k.doc,"keydown",n.hitch(this,"onKeyDown")),g(k.doc,"keyup",n.hitch(this,"onKeyUp")),g(k.doc,"dragstart",h),g(k.body(),"selectstart",h)];b="dojoDnd"+(f?"Copy":"Move");d.add(k.body(),b)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(k.body(),["dojoDndCopy","dojoDndMove"]);q.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new h(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(b){var d=this.avatar;d&&(a.autoScrollNodes(b),d=d.node.style,d.left=b.pageX+this.OFFSET_X+"px",d.top=
b.pageY+this.OFFSET_Y+"px",d=!!this.source.copyState(c.getCopyKeyState(b)),this.copy!=d&&this._setCopyStatus(d));p("touch")&&b.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=!!this.source.copyState(c.getCopyKeyState(a));m.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);m.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else m.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case l.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case l.ESCAPE:m.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==l.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(k.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});c._manager=null;b.manager=c.manager=function(){c._manager||
(c._manager=new b);return c._manager};return b})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(q,f,n,k,d,r,p,l){return q("dojo.dnd.Avatar",null,{constructor:function(d){this.manager=d;this.construct()},construct:function(){var d=r.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,e,c=r.create("tbody",null,d),a=r.create("tr",
null,c),h=r.create("td",null,a),b=Math.min(5,this.manager.nodes.length),l=0;p("highcontrast")&&r.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},h);r.create("span",{innerHTML:f.generateText?this._generateText():""},h);for(k.set(a,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});l<b;++l)f.creator?e=f._normalizedCreator(f.getItem(this.manager.nodes[l].id).data,"avatar").node:(e=this.manager.nodes[l].cloneNode(!0),"tr"==e.tagName.toLowerCase()&&(a=r.create("table"),r.create("tbody",
null,a).appendChild(e),e=a)),e.id="",a=r.create("tr",null,c),h=r.create("td",null,a),h.appendChild(e),k.set(a,{"class":"dojoDndAvatarItem",style:{opacity:(9-l)/10}});this.node=d},destroy:function(){r.destroy(this.node);this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(p("highcontrast")){var f=n.byId("a11yIcon"),k="+";this.manager.canDropFlag&&!this.manager.copy?k="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(k="x"):
k="o";f.innerHTML=k}l("tr.dojoDndAvatarHeader td span"+(p("highcontrast")?" span":""),this.node).forEach(function(d){d.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(q,f,n,k){return q("dijit.CheckedMenuItem",n,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:k,checked:!1,_setCheckedAttr:function(d){this.domNode.setAttribute("aria-checked",d?"true":"false");this._set("checked",d)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(d){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(d)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(q,f,n,k,d,r,p,l,g,m,e){var c=g("dijit.ColorPalette",[n,k,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,b,d){return new this._dyeClass(a,
c,b,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=g(c._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],p.getLocalization("dojo","colors",this.lang))}});c._Color=g("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":q.toUrl("./themes/a11y/colors7x10.png"),"3x4":q.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,c,b,d){this._title=d;this._row=c;this._col=b;this.setColor(l.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,c){c=e.substitute(r("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});m.place(c,a)}});return c})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(q,f,n,k,d,r,p,l,g,m,e){return q("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(c){return new ("string"==
typeof this.dyeClass?r.getObject(this.dyeClass):this.dyeClass)(c)},_preparePalette:function(c,a){this._cells=[];var f=this._blankGif;this.own(p(this.gridNode,g,r.hitch(this,"_onCellClick")));for(var b=0;b<c.length;b++)for(var l=k.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),m=0;m<c[b].length;m++){var n=c[b][m];if(n){var q=this._dyeFactory(n,b,m,a[n]),n=k.create("td",{"class":this.cellClass,tabIndex:"-1",title:a[n],role:"gridcell"},l);q.fillCell(n,f);n.idx=this._cells.length;this._cells.push({node:n,
dye:q})}}this._xDim=c[0].length;this._yDim=c.length;var D={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},B;for(B in D)this.own(e.addKeyListener(this.domNode,{keyCode:d[B],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=D[B];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){m.focus(this._currentFocus)},
_onCellClick:function(c){for(var a=c.target;"TD"!=a.tagName;){if(!a.parentNode||a==this.gridNode)return;a=a.parentNode}var d=this._getDye(a).getValue();this._setCurrent(a);m.focus(a);this._setValueAttr(d,!0);c.stopPropagation();c.preventDefault()},_setCurrent:function(c){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=c)&&f.set(c,"tabIndex",this.tabIndex)},_setValueAttr:function(c,a){0<=this._selectedCell&&n.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(c)for(var d=0;d<this._cells.length;d++)if(c==this._cells[d].dye.getValue()){this._selectedCell=d;n.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?c:null);if(a||void 0===a)this.onChange(c)},onChange:function(){},_navigateByKey:function(c,a){-1!=a&&(c=this._currentFocus.idx+c,c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(r.hitch(m,"focus",c))))},_getDye:function(c){return this._cells[c.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(q){return q})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(q,f,n,k,d,r,p,l,g){k("dijit-legacy-requires")&&r(0,function(){q(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[p,l],{templateString:g,baseClass:"dijitCheckBox",_setValueAttr:function(d,
e){"string"==typeof d&&(this.inherited(arguments),d=!0);this._created&&this.set("checked",d,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(q,f){return q("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(n){this._set("readOnly",n);f.set(this.focusNode,"readOnly",n)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(n){n=this._getSubmitValue(n);this._set("value",n);f.set(this.focusNode,
"value",n)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(q,f,n){return q("dijit.form.ComboBox",[f,n],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang",
"../when","../_base/array"],function(q,f,n,k){q=function(d){function q(e,c){var a=d[e];a&&(d[e]=function(f){var b;"put"===e&&(b=d.getIdentity(f));if(m)return a.apply(this,arguments);m=!0;try{var g=a.apply(this,arguments);n(g,function(a){c("object"==typeof a&&a||f,b)});return g}finally{m=!1}})}var p=[],l=0;d=f.delegate(d);d.notify=function(d,c){l++;for(var a=p.slice(),e=0,b=a.length;e<b;e++)a[e](d,c)};var g=d.query;d.query=function(e,c){c=c||{};var a=g.apply(this,arguments);if(a&&a.forEach){var h=
f.mixin({},c);delete h.start;delete h.count;var b=d.queryEngine&&d.queryEngine(e,h),m=l,q=[],r;a.observe=function(e,f){1==q.push(e)&&p.push(r=function(e,g){n(a,function(a){var h=a.length!=c.count,n,p;if(++m!=l)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,t=-1,u=-1;if(void 0!==g){var w=[].concat(a);b&&!e&&(w=b(a));n=0;for(p=a.length;n<p;n++){var v=a[n];if(d.getIdentity(v)==g&&!(0>w.indexOf(v))){r=v;t=n;!b&&e||a.splice(n,1);break}}}b?e&&(b.matches?
b.matches(e):b([e]).length)&&(n=-1<t?t:a.length,a.splice(n,0,e),u=k.indexOf(b(a),e),a.splice(n,1),c.start&&0==u||!h&&u==a.length?u=-1:a.splice(u,0,e)):e&&(void 0!==g?u=t:c.start||(u=d.defaultIndex||0,a.splice(u,0,e)));if((-1<t||-1<u)&&(f||!b||t!=u))for(h=q.slice(),n=0;a=h[n];n++)a(e||r,t,u)})});var g={};g.remove=g.cancel=function(){var a=k.indexOf(q,e);-1<a&&(q.splice(a,1),q.length||p.splice(k.indexOf(p,r),1))};return g}}return a};var m;q("put",function(e,c){d.notify(e,c)});q("add",function(e){d.notify(e)});
q("remove",function(e){d.notify(void 0,e)});return d};f.setObject("dojo.store.Observable",q);return q})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(q,f,n,k){return q("dijit.form.SimpleTextarea",k,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&
this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);n("ie")&&this.cols&&f.add(this.textbox,"dijitTextAreaCols")},filter:function(d){d&&(d=d.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(d){if(this.maxLength){var f=parseInt(this.maxLength),k=this.textbox.value.replace(/\r/g,""),f=k.length-f;if(0<f){var l=this.textbox;if(l.selectionStart){var g=l.selectionStart,m=0;n("opera")&&(m=(this.textbox.value.substring(0,
g).match(/\r/g)||[]).length);this.textbox.value=k.substring(0,g-f-m)+k.substring(g-m);l.setSelectionRange(g-f,g-f)}else this.ownerDocument.selection&&(l.focus(),k=this.ownerDocument.selection.createRange(),k.moveStart("character",-f),k.text="",k.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(q,f,n){return q("dijit.form.RadioButton",[f,n],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),
function(q,f,n,k,d,r){return f("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var f=[];d("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(k.hitch(this,function(d){d.name==this.name&&d.form==this.focusNode.form&&(d=r.getEnclosingWidget(d))&&f.push(d)}));return f},_setCheckedAttr:function(d){this.inherited(arguments);this._created&&d&&q.forEach(this._getRelatedWidgets(),k.hitch(this,function(d){d!=this&&d.checked&&d.set("checked",!1)}))},_getSubmitValue:function(d){return null==
d?"on":d},_onClick:function(d){if(this.checked||this.disabled)return d.stopPropagation(),d.preventDefault(),!1;if(this.readOnly)return d.stopPropagation(),d.preventDefault(),q.forEach(this._getRelatedWidgets(),k.hitch(this,function(d){n.set(this.focusNode||this.domNode,"checked",d.checked)})),!1;var f=!1,g;q.some(this._getRelatedWidgets(),function(d){return d.checked?(g=d,!0):!1});this.checked=!0;g&&(g.checked=!1);if(!1===this.onClick(d)||d.defaultPrevented)f=!0;this.checked=!1;g&&(g.checked=!0);
f?d.preventDefault():this.set("checked",!0);return!f}})})},"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"jimu-loading"\x3e\x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" data-dojo-attach-point\x3d"btnAddExpDesktop"\r\n\t\t\t class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" data-dojo-attach-point\x3d"btnAddSetDesktop"\r\n\t\t\t class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateValueSelector.html":'\x3cdiv\x3e\r\n\t\x3cinput data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-point\x3d"dateTextBox" class\x3d"custom-date-text-box" data-dojo-attach-event\x3d"change:_onDateTextBoxChanged" data-dojo-props\x3d\'required:false,trim:true\' /\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/ListValueProvider.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"valuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"input:_onFilteringSelectInput"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting" data-dojo-attach-event\x3d"click:_onValueTypeSetClick"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"click:_destroySelf"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valueTypePopupNode"\x3e\r\n    \x3cul\x3e\r\n      \x3cli data-type\x3d"value" data-dojo-attach-event\x3d"click:_onValueTypeClick"\x3e\x3cspan\x3e${nls.value}\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\r\n      \x3cli data-type\x3d"field" data-dojo-attach-event\x3d"click:_onValueTypeClick"\x3e\x3cspan\x3e${nls.field}\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\r\n      \x3cli data-type\x3d"unique" data-dojo-attach-event\x3d"click:_onValueTypeClick"\x3e\x3cspan\x3e${nls.unique}\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\r\n    \x3c/ul\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"onclick:_destroySelf"\r\n\t\t\t\t\t class\x3d"jimu-icon jimu-icon-delete"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAdd" class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"*now":function(q){q(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main".split(" "),function(q,f,n,k,d,r,p,l,g,m,e,c,a,h,b,t,u,v,C,D,B,y,z,w,A,F,E,G){function H(a,
b){L=a;"loadingPageChange"!==b&&(g.setStyle(jimuConfig.loadingId,"display","none"),g.setStyle(jimuConfig.mainPageId,"display","block"))}t={};var L;window.topic=h;C.defaults.io.timeout=18E4;"function"!==typeof b.getAll&&(b.getAll=function(a){var c=[];(a=b(a))&&c.push(a);return c});window.jimuNls=E;window.apiNls=G.bundle;y.setProtocolErrorHandler(function(){return!0});y=w.getAncestorWindow();var J=!1,K=/^http(s?):\/\//gi;try{J=0===y.location.href.indexOf("https://")}catch(O){}D.setRequestPreCallback(function(a){a.content&&
a.content.printFlag&&(a.timeout=3E5);J&&(a.url=a.url.replace(K,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=C.defaults.io.proxyUrl;c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));w.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());window.isBuilder||!L||L.mode||(L.appProxies&&0<L.appProxies.length&&e.some(L.appProxies,function(b){var c=b.sourceUrl;b=b.proxyUrl;J&&(c=c.replace(K,
"//"),b=b.replace(K,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}),L.map.appProxy&&e.some(L.map.appProxy.proxyItems,function(b){if(!b.useProxy||!b.proxyUrl)return!1;var c=b.sourceUrl;b=b.proxyUrl;J&&(c=c.replace(K,"//"),b=b.replace(K,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}));return a});c(window,"mousedown",function(b){if(a.isMiddle(b))return b.preventDefault(),b.stopPropagation(),b.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,
a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};Number.isNaN=Number.isNaN||function(a){return a!==a};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=m.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.8";window.productVersion="Online 6.1";window.isBuilder?
(h.subscribe("app/appConfigLoaded",H),h.subscribe("app/appConfigChanged",H)):(h.subscribe("appConfigLoaded",H),h.subscribe("appConfigChanged",H));10<w.has("ie")&&g.addClass(document.body,"ie-gte-10");t.initApp=function(){var a,b;console.log("jimu.js init...");var c=window.location.search;a={query:!0};if(""===c)a={};else{var c=v.queryToObject(c.substr(1)),e;for(e in c)a[e]||(c[e]=w.sanitizeHTML(c[e]));a=c}if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(M){console.error("mobileBreakPoint URL parameter must be a number.",
M)}a.mode&&(g.setStyle(jimuConfig.loadingId,"display","none"),g.setStyle(jimuConfig.mainPageId,"display","block"));n.getInstance(k.getInstance());d.getInstance();r.getInstance();p.getInstance();l.getInstance();b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=q.getInstance(a);b.startup();a.loadConfig();A(["dynamic-modules/preload"])};return t});